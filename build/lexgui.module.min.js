"use strict";var LX={version:"0.3.0",ready:!1,components:[],signals:{},extraCommandbarEntries:[]};function clamp(e,t,i){return Math.min(Math.max(e,t),i)}function round(e,t){return 0==t?Math.floor(e):+e.toFixed(t??2).replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1")}function remapRange(e,t,i,a,n){return(e-t)*(n-a)/(i-t)+a}LX.MOUSE_LEFT_CLICK=0,LX.MOUSE_MIDDLE_CLICK=1,LX.MOUSE_RIGHT_CLICK=2,LX.MOUSE_DOUBLE_CLICK=2,LX.MOUSE_TRIPLE_CLICK=3,LX.CURVE_MOVEOUT_CLAMP=0,LX.CURVE_MOVEOUT_DELETE=1,LX.clamp=clamp,LX.round=round,LX.remapRange=remapRange,"undefined"!=typeof performance?LX.getTime=performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?LX.getTime=Date.now.bind(Date):"undefined"!=typeof process?LX.getTime=function(){var e=process.hrtime();return .001*e[0]+1e-6*e[1]}:LX.getTime=function(){return new Date().getTime()};let ASYNC_ENABLED=!0;function doAsync(e,t){ASYNC_ENABLED?setTimeout(e,t??0):e()}function getSupportedDOMName(e){return e.replace(/\s/g,"").replaceAll("@","_").replaceAll("+","_plus_").replaceAll(".","")}function has(e){return LX.components.indexOf(e)>-1}function getExtension(e){return e.includes(".")?e.split(".").pop():null}function deepCopy(e){return JSON.parse(JSON.stringify(e))}function setTheme(e){e="light"==e?"light":"dark",document.documentElement.setAttribute("data-theme",e),LX.emit("@on_new_color_scheme",e)}function setThemeColor(e,t){document.querySelector(":root").style.setProperty("--"+e,t)}function getThemeColor(e){let t=getComputedStyle(document.querySelector(":root")),i=t.getPropertyValue("--"+e);if(document.documentElement.getAttribute("data-theme"),i.includes("light-dark")){let a=t.getPropertyValue("color-scheme");return"light"==a?i.substring(i.indexOf("(")+1,i.indexOf(",")).replace(/\s/g,""):i.substring(i.indexOf(",")+1,i.indexOf(")")).replace(/\s/g,"")}return i}function getBase64Image(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")}function hexToRgb(e){let t=parseInt(e.substring(1,3),16)/255,i=parseInt(e.substring(3,5),16)/255,a=parseInt(e.substring(5,7),16)/255;return[t,i,a]}function rgbToHex(e){let t="#";for(let i of e)t+=(i=Math.floor(255*i)).toString(16);return t}function measureRealWidth(e,t=8){var i=document.createElement("span");i.className="lexinputmeasure",i.innerHTML=e,document.body.appendChild(i);var a=i.getBoundingClientRect();return LX.UTILS.deleteElement(i),a.width+t}function simple_guidGenerator(){var e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return e()+"-"+e()+"-"+e()}function buildTextPattern(e={}){let t=[];e.lowercase&&t.push("(?=.*[a-z])"),e.uppercase&&t.push("(?=.*[A-Z])"),e.digit&&t.push("(?=.*\\d)"),e.specialChar&&t.push("(?=.*[@#$%^&+=!])"),e.noSpaces&&t.push("(?!.*\\s)");let i,a=`^${t.join("")}.{${e.minLength||0},${e.maxLength||""}}$`;return e.asRegExp?RegExp(a):a}function makeDraggable(e,t={}){let i=0,a=0,n=null,s=t.targetClass,l=t.dragMargin??3,r=(t,n,s)=>{let r=e.parentElement?e.parentElement.getBoundingClientRect():{x:0,y:0,width:0,height:0},o="fixed"==e.style.position,d=o?new LX.vec2(r.x,r.y):new LX.vec2;s=s??t.clientX-i-r.x,n=n??t.clientY-a-r.y,e.style.left=clamp(s,l+d.x,d.x+r.width-e.offsetWidth-l)+"px",e.style.top=clamp(n,l+d.y,d.y+r.height-e.offsetHeight-l)+"px"};t.autoAdjust&&r(null,parseInt(e.style.left),parseInt(e.style.top));let o=LX.UTILS.uidGenerator();e["draggable-id"]=o;let d=e=>{n&&r(e)},c=e=>{n&&t.onMove&&t.onMove(n)},h=t.onMove?c:d,u=t.onDragStart;e.setAttribute("draggable",!0),e.addEventListener("mousedown",function(e){n=e.target.classList.contains(s)||!s?e.target:null}),e.addEventListener("dragstart",function(e){if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!n)return;var t=new Image;t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=",e.dataTransfer.setDragImage(t,0,0),e.dataTransfer.effectAllowed="move";let s=e.target.getBoundingClientRect(),l=n.parentElement.getBoundingClientRect(),r="fixed"==n.style.position,o=r?new LX.vec2(l.x,l.y):new LX.vec2;i=e.clientX-s.x-o.x,a=e.clientY-s.y-o.y,document.addEventListener("mousemove",h),u&&u(n,e)},!1),document.addEventListener("mouseup",()=>{n&&(n=null,document.removeEventListener("mousemove",h))})}function makeCodeSnippet(e,t,i={}){if(!LX.has("CodeEditor")){console.error("Import the CodeEditor component to create snippets!");return}let a=document.createElement("div");a.className="lexcodesnippet",a.style.width=t?t[0]:"auto",a.style.height=t?t[1]:"auto";let n=new Area({noAppend:!0}),s=new LX.CodeEditor(n,{skipInfo:!0,disableEdition:!0,allowAddScripts:!1,name:i.tabName});if(s.setText(e,i.language??"Plain Text"),i.linesAdded){let l=s.root.querySelector(".code");for(let r of i.linesAdded)if(r.constructor==Number)l.childNodes[r-1].classList.add("added");else if(r.constructor==Array)for(let o=r[0]-1;o<=r[1]-1;o++)l.childNodes[o].classList.add("added")}if(i.linesRemoved){let d=s.root.querySelector(".code");for(let c of i.linesRemoved)if(c.constructor==Number)d.childNodes[c-1].classList.add("removed");else if(c.constructor==Array)for(let h=c[0]-1;h<=c[1]-1;h++)d.childNodes[h].classList.add("removed")}if(i.windowMode){let u=document.createElement("div");u.className="lexwindowbuttons";let p=document.createElement("span");p.style.background="#ee4f50";let m=document.createElement("span");m.style.background="#f5b720";let g=document.createElement("span");g.style.background="#53ca29",u.appendChild(p),u.appendChild(m),u.appendChild(g);let f=s.root.querySelector(".lexareatabs");f.prepend(u)}return(i.lineNumbers??!0)||s.root.classList.add("no-gutter"),a.appendChild(n.root),a}function registerCommandbarEntry(e,t){LX.extraCommandbarEntries.push({name:e,callback:t})}LX.doAsync=doAsync,LX.getSupportedDOMName=getSupportedDOMName,LX.has=has,LX.getExtension=getExtension,LX.deepCopy=deepCopy,LX.setTheme=setTheme,LX.setThemeColor=setThemeColor,LX.getThemeColor=getThemeColor,LX.getBase64Image=getBase64Image,LX.hexToRgb=hexToRgb,LX.rgbToHex=rgbToHex,LX.measureRealWidth=measureRealWidth,LX.guidGenerator=simple_guidGenerator,LX.buildTextPattern=buildTextPattern,LX.makeDraggable=makeDraggable,LX.makeCodeSnippet=makeCodeSnippet,LX.registerCommandbarEntry=registerCommandbarEntry;class vec2{constructor(e,t){this.x=e??0,this.y=t??e??0}get xy(){return[this.x,this.y]}get yx(){return[this.y,this.x]}set(e,t){this.x=e,this.y=t}add(e,t=new vec2){return t.set(this.x+e.x,this.y+e.y),t}sub(e,t=new vec2){return t.set(this.x-e.x,this.y-e.y),t}mul(e,t=new vec2){return e.constructor==Number&&(e=new vec2(e)),t.set(this.x*e.x,this.y*e.y),t}div(e,t=new vec2){return e.constructor==Number&&(e=new vec2(e)),t.set(this.x/e.x,this.y/e.y),t}abs(e=new vec2){return e.set(Math.abs(this.x),Math.abs(this.y)),e}dot(e){return this.x*e.x+this.y*e.y}len2(){return this.dot(this)}len(){return Math.sqrt(this.len2())}nrm(e=new vec2){return e.set(this.x,this.y),e.mul(1/this.len(),e)}dst(e){return e.sub(this).len()}clp(e,t,i=new vec2){return i.set(clamp(this.x,e,t),clamp(this.y,e,t)),i}}function _createCommandbar(e){let t=document.createElement("dialog");t.className="commandbar",t.tabIndex=-1,e.appendChild(t);let i=[],a=null;t.addEventListener("keydown",function(e){if(e.stopPropagation(),e.stopImmediatePropagation(),a=a??-1,"Escape"==e.key)this.close(),p(!0);else if("Enter"==e.key){let n=i[a];if(n){let s=n.item.type&&"checkbox"===n.item.type;this.close(),s?(n.item.checked=!n.item.checked,n.callback.call(window,n.item.checked,n.entry_name)):n.callback.call(window,n.entry_name)}}else if("ArrowDown"==e.key&&a<i.length-1){a++,t.querySelectorAll(".hovered").forEach(e=>e.classList.remove("hovered")),i[a].classList.add("hovered");let l=i[a].offsetHeight*(a+1)-h.offsetHeight;l>0&&h.scrollTo({top:l,behavior:"smooth"})}else"ArrowUp"==e.key&&a>0&&(a--,t.querySelectorAll(".hovered").forEach(e=>e.classList.remove("hovered")),i[a].classList.add("hovered"))}),t.addEventListener("focusout",function(e){e.relatedTarget!=e.currentTarget&&(e.stopPropagation(),e.stopImmediatePropagation(),this.close(),p(!0))}),e.addEventListener("keydown",e=>{if(" "==e.key&&e.ctrlKey)e.stopImmediatePropagation(),e.stopPropagation(),LX.setCommandbarState(!0);else for(let t of LX.components){if(!LX[t]||!LX[t].prototype.onKeyPressed)continue;let i=LX.CodeEditor.getInstances();for(let a of i)a.onKeyPressed(e)}});let n=document.createElement("div");n.className="gs-header";let s=document.createElement("a");s.className="fa-solid fa-magnifying-glass",n.appendChild(s);let l=document.createElement("input");l.placeholder="Search...",l.value="",n.appendChild(l);let r=new Area({width:"100%",skipAppend:!0,className:"gs-tabs"}),o=r.addTabs(),d=null;{let c=(e,t)=>{d=t};o.add("All",document.createElement("div"),{selected:!0,onSelect:c})}let h=document.createElement("div");h.className="searchitembox";let u=null,p=e=>{h.innerHTML="",i.length=0,a=null,e&&(l.value="")},m=(e,n,s,l)=>{if(!e.length)return;u&&u.classList.remove("last");let r=document.createElement("div");r.className="searchitem last";let o=l&&l.type&&"checkbox"===l.type;o?r.innerHTML="<a class='fa fa-check'></a><span>"+(s+e)+"</span>":r.innerHTML=s+e,r.entry_name=e,r.callback=n,r.item=l,r.addEventListener("click",function(e){this.callback.call(window,this.entry_name),LX.setCommandbarState(!1),p(!0)}),r.addEventListener("mouseenter",function(e){t.querySelectorAll(".hovered").forEach(e=>e.classList.remove("hovered")),this.classList.add("hovered"),a=i.indexOf(this)}),r.addEventListener("mouseleave",function(e){this.classList.remove("hovered")}),i.push(r),h.appendChild(r),u=r},g=(e,t,i)=>{let a=Object.keys(e)[0];if((e.name??i+a).toLowerCase().includes(t)&&e.callback&&m(e.name??a,e.callback,i,e),!e.name)for(let n of(i+=a+" > ",e[a]))g(n,t,i)};return t._addElements=e=>{for(let t of(p(),LX.menubars))for(let i of t.items)g(i,e,"");for(let a of LX.extraCommandbarEntries){let n=a.name;n.toLowerCase().includes(e)&&m(n,a.callback,"",{})}if(LX.has("CodeEditor")){let s=LX.CodeEditor.getInstances();if(!s.length)return;let l=s[0].languages;for(let r of Object.keys(l)){let o="Language: "+r,d=s[0]._getFileIcon(null,l[r].ext),c=d.includes("fa-")?"<i class='"+d+"'></i>":"<img src='https://raw.githubusercontent.com/jxarco/lexgui.js/master/"+d+"'>";c+=o+" <span class='lang-ext'>("+l[r].ext+")</span>",o.toLowerCase().includes(e)&&m(c,()=>{for(let e of s)e._changeLanguage(r)},"",{})}}},l.addEventListener("input",function(e){t._addElements(this.value.toLowerCase())}),t.appendChild(n),t.appendChild(r.root),t.appendChild(h),t}function init(e={}){if(this.ready)return this.main_area;var t=document.createElement("div");t.id="lexroot",t.tabIndex=-1;var i=document.createElement("div");i.id="modal",this.modal=i,this.root=t,this.container=document.body,this.modal.classList.add("hiddenOpacity"),this.modal.toggle=function(e){this.classList.toggle("hiddenOpacity",e)},e.container&&(this.container=document.getElementById(e.container)),document.documentElement.setAttribute("data-strictVP",e.strictViewport??!0?"true":"false"),this.commandbar=_createCommandbar(this.container),this.container.appendChild(i),e.skipRoot?this.root=document.body:this.container.appendChild(t);{let a=document.createElement("section");a.className="notifications",this.notifications=document.createElement("ol"),this.notifications.className="",this.notifications.iWidth=0,a.appendChild(this.notifications),this.container.appendChild(a),this.notifications.addEventListener("mouseenter",()=>{this.notifications.classList.add("list")}),this.notifications.addEventListener("mouseleave",()=>{this.notifications.classList.remove("list")})}t.addEventListener("dragover",function(e){e.preventDefault()},!1),document.addEventListener("contextmenu",function(e){e.preventDefault()},!1);var n=document.getElementsByTagName("HEAD")[0],s=document.createElement("link");return s.rel="stylesheet",s.type="text/css",s.crossOrigin="anonymous",s.href="https://use.fontawesome.com/releases/v6.7.2/css/all.css",n.appendChild(s),this.DEFAULT_NAME_WIDTH="30%",this.DEFAULT_SPLITBAR_SIZE=4,this.OPEN_CONTEXTMENU_ENTRY="click",this.ready=!0,this.menubars=[],e.skipRoot||e.skipDefaultArea||(this.main_area=new Area({id:e.id??"mainarea"})),(e.autoTheme??!0)&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&(LX.setTheme("light"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{LX.setTheme(e.matches?"dark":"light")})),this.main_area}function setCommandbarState(e,t=!0){let i=this.commandbar;e?(i.show(),i.querySelector("input").focus(),t&&i._addElements(void 0)):i.close()}function message(e,t,i={}){if(!e)throw"No message to show";return i.modal=!0,new Dialog(t,t=>{t.addTextArea(null,e,null,{disabled:!0,fitHeight:!0})},i)}function popup(e,t,i={}){if(!e)throw"No message to show";i.size=i.size??["max-content","auto"],i.class="lexpopup";let a=i.timeout||3e3,n=new Dialog(t,t=>{t.addTextArea(null,e,null,{disabled:!0,fitHeight:!0})},i);return setTimeout(()=>{n.close()},Math.max(a,150)),n}function prompt(e,t,i,a={}){a.modal=!0,a.className="prompt";let n="",s=new Dialog(t,l=>{l.addTextArea(null,e,null,{disabled:!0,fitHeight:!0}),(a.input??!0)&&l.addText(null,a.input||n,e=>n=e,{placeholder:"..."}),l.sameLine(2),l.addButton(null,"Cancel",()=>{a.on_cancel&&a.on_cancel(),s.close()}),l.addButton(null,a.accept||"Continue",()=>{a.required&&""===n?(e+=e.includes("You must fill the input text.")?"":"\nYou must fill the input text.",s.close(),prompt(e,t,i,a)):(i&&i.call(this,n),s.close())},{buttonClass:"primary"})},a);return(a.input??!0)&&s.root.querySelector("input").focus(),s}function toast(e,t,i={}){if(!e)throw"The toast needs at least a title!";console.assert(this.notifications);let a=document.createElement("li");a.className="lextoast",a.style.translate="0 calc(100% + 30px)",this.notifications.prepend(a),doAsync(()=>{this.notifications.offsetWidth>this.notifications.iWidth&&(this.notifications.iWidth=Math.min(this.notifications.offsetWidth,480),this.notifications.style.width=this.notifications.iWidth+"px"),a.dataset.open=!0},10);let n=document.createElement("div");n.className="lextoastcontent",a.appendChild(n);let s=document.createElement("div");if(s.className="title",s.innerHTML=e,n.appendChild(s),t){let l=document.createElement("div");l.className="desc",l.innerHTML=t,n.appendChild(l)}if(i.action){let r=new Panel;r.addButton(null,i.action.name??"Accept",i.action.callback.bind(this,a),{width:"auto",maxWidth:"150px",className:"right",buttonClass:"outline"}),a.appendChild(r.root.childNodes[0])}let o=this;if(a.close=function(){this.dataset.closed=!0,doAsync(()=>{this.remove(),o.notifications.childElementCount||(o.notifications.style.width="unset",o.notifications.iWidth=0)},500)},i.closable??!0){let d=document.createElement("a");d.className="fa fa-xmark lexicon closer",d.addEventListener("click",()=>{a.close()}),a.appendChild(d)}let c=i.timeout??3e3;-1!=c&&doAsync(()=>{a.close()},c)}function badge(e,t,i={}){let a=document.createElement("div");return a.innerHTML=e,a.className="lexbadge "+(t??""),Object.assign(a.style,i.style??{}),a.outerHTML}function makeContainer(e,t,i={}){let a=document.createElement("div");return a.className="lexcontainer "+(t??""),a.style.width=e&&e[0]?e[0]:"100%",a.style.height=e&&e[1]?e[1]:"100%",Object.assign(a.style,i),a}LX.vec2=vec2,LX.init=init,LX.setCommandbarState=setCommandbarState,LX.message=message,LX.popup=popup,LX.prompt=prompt,LX.toast=toast,LX.badge=badge,LX.makeContainer=makeContainer;class IEvent{constructor(e,t,i){this.name=e,this.value=t,this.domEvent=i}}LX.IEvent=IEvent;class TreeEvent{static NONE=0;static NODE_SELECTED=1;static NODE_DELETED=2;static NODE_DBLCLICKED=3;static NODE_CONTEXTMENU=4;static NODE_DRAGGED=5;static NODE_RENAMED=6;static NODE_VISIBILITY=7;static NODE_CARETCHANGED=8;constructor(e,t,i){this.type=e||TreeEvent.NONE,this.node=t,this.value=i,this.multiple=!1,this.panel=null}string(){switch(this.type){case TreeEvent.NONE:return"tree_event_none";case TreeEvent.NODE_SELECTED:return"tree_event_selected";case TreeEvent.NODE_DELETED:return"tree_event_deleted";case TreeEvent.NODE_DBLCLICKED:return"tree_event_dblclick";case TreeEvent.NODE_CONTEXTMENU:return"tree_event_contextmenu";case TreeEvent.NODE_DRAGGED:return"tree_event_dragged";case TreeEvent.NODE_RENAMED:return"tree_event_renamed";case TreeEvent.NODE_VISIBILITY:return"tree_event_visibility";case TreeEvent.NODE_CARETCHANGED:return"tree_event_caretchanged"}}}function emit(e,t,i={}){let a=LX.signals[e];if(!a)return;let n=i.target;if(n){n[e]&&n[e].call(n,t);return}for(let s of a)if(s.constructor===Widget)s.set(t,i.skipCallback??!0),s.options&&s.options.callback&&s.options.callback(t,a);else{let l=s;l(null,t)}}function addSignal(e,t,i){t[e]=i,LX.signals[e]||(LX.signals[e]=[]),!(LX.signals[e].indexOf(t)>-1)&&LX.signals[e].push(t)}LX.TreeEvent=TreeEvent,LX.emit=emit,LX.addSignal=addSignal;class Area{constructor(e={}){var t,i=document.createElement("div");i.className="lexarea",e.id&&(i.id=e.id),e.className&&(i.className+=" "+e.className);var a=e.width||"calc( 100% )",n=e.height||"100%";this.setLimitBox(e.minWidth,e.minHeight,e.maxWidth,e.maxHeight),a.constructor==Number&&(a+="px"),n.constructor==Number&&(n+="px"),i.style.width=a,i.style.height=n,this.offset=0,this.root=i,this.size=[this.root.offsetWidth,this.root.offsetHeight],this.sections=[],this.panels=[],!e.skipAppend&&document.getElementById("lexroot").appendChild(this.root);let s=e.overlay;if(s){this.root.classList.add("overlay-"+s),e.left?this.root.style.left=e.left:e.right?this.root.style.right=e.right:e.top?this.root.style.top=e.top:e.bottom&&(this.root.style.bottom=e.bottom);let l=e.draggable??!0;if(l&&makeDraggable(i,e),e.resizeable&&i.classList.add("resizeable"),e.resize){this.splitBar=document.createElement("div");let r="left"==s||"right"==s?"horizontal":"vertical";if(this.type=s,this.splitBar.className="lexsplitbar "+r,"right"==s)this.splitBar.style.width=LX.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.left=-(LX.DEFAULT_SPLITBAR_SIZE/2)+"px";else if("left"==s){let o=Math.min(document.body.clientWidth-LX.DEFAULT_SPLITBAR_SIZE,this.root.clientWidth);this.splitBar.style.width=LX.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.left=o+LX.DEFAULT_SPLITBAR_SIZE/2+"px"}else if("top"==s){let d=Math.min(document.body.clientHeight-LX.DEFAULT_SPLITBAR_SIZE,this.root.clientHeight);this.splitBar.style.height=LX.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.top=d+LX.DEFAULT_SPLITBAR_SIZE/2+"px"}else"bottom"==s&&(this.splitBar.style.height=LX.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.top=-(LX.DEFAULT_SPLITBAR_SIZE/2)+"px");this.splitBar.addEventListener("mousedown",u),this.root.appendChild(this.splitBar);var c=this,h=[0,0];function u(e){var t=c.root.ownerDocument;t.addEventListener("mousemove",p),t.addEventListener("mouseup",m),h[0]=e.x,h[1]=e.y,e.stopPropagation(),e.preventDefault(),document.body.classList.add("nocursor"),c.splitBar.classList.add("nocursor")}function p(e){switch(c.type){case"right":var t=h[0]-e.x,i=c.root.offsetWidth+t;c.root.style.width=i+"px";break;case"left":var t=h[0]-e.x,i=Math.min(document.body.clientWidth-LX.DEFAULT_SPLITBAR_SIZE,c.root.offsetWidth-t);c.root.style.width=i+"px",c.splitBar.style.left=i+LX.DEFAULT_SPLITBAR_SIZE/2+"px";break;case"top":var t=h[1]-e.y,i=Math.min(document.body.clientHeight-LX.DEFAULT_SPLITBAR_SIZE,c.root.offsetHeight-t);c.root.style.height=i+"px",c.splitBar.style.top=i+LX.DEFAULT_SPLITBAR_SIZE/2+"px";break;case"bottom":var t=h[1]-e.y,i=c.root.offsetHeight+t;c.root.style.height=i+"px"}h[0]=e.x,h[1]=e.y,e.stopPropagation(),e.preventDefault(),c.onresize&&c.onresize(c.root.getBoundingClientRect())}function m(e){var t=c.root.ownerDocument;t.removeEventListener("mousemove",p),t.removeEventListener("mouseup",m),document.body.classList.remove("nocursor"),c.splitBar.classList.remove("nocursor")}}}}attach(e){if(this.sections.length){this.sections[1].attach(e);return}if(!e)throw"no content to attach";e.parent=this;let t=e.root?e.root:e;this.root.appendChild(t)}split(e={}){this.sections.length&&(this.offset=this.root.childNodes[0].offsetHeight,this._root=this.sections[0].root,this.root=this.sections[1].root);var t=e.type||"horizontal",i=e.sizes||["50%","50%"],a="auto"===e.sizes;if(!i[1]){let n=i[0],s=e.top?e.top:0;n.constructor==Number&&(n+=s,n+="px"),i[1]="calc( 100% - "+n+" )"}var l=new Area({skipAppend:!0,className:"split"+(e.menubar||e.sidebar?"":" origin")}),r=new Area({skipAppend:!0,className:"split"});l.parentArea=this,r.parentArea=this;let o=e.minimizable??!1,d=(e.resize??!0)||o;var c="0px";if(this.offset=0,d&&(this.resize=d,this.splitBar=document.createElement("div"),this.splitBar.className="lexsplitbar "+t,"horizontal"==t?this.splitBar.style.width=LX.DEFAULT_SPLITBAR_SIZE+"px":this.splitBar.style.height=LX.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.addEventListener("mousedown",function e(t){var i=f.root.ownerDocument;i.addEventListener("mousemove",v),i.addEventListener("mouseup",E),t.stopPropagation(),t.preventDefault(),document.body.classList.add("nocursor"),f.splitBar.classList.add("nocursor")}),c=LX.DEFAULT_SPLITBAR_SIZE/2+"px",o&&(this.splitExtended=!1,r.root.addEventListener("animationend",e=>{let i=getComputedStyle(r.root).opacity;r.root.classList.remove(e.animationName+"-"+t),r.root.style.opacity=i,flushCss(r.root)}),this.splitBar.addEventListener("contextmenu",e=>{e.preventDefault(),addContextMenu(null,e,e=>{e.add("Extend",{disabled:this.splitExtended,callback:()=>{this.extend()}}),e.add("Reduce",{disabled:!this.splitExtended,callback:()=>{this.reduce()}})})}))),"horizontal"==t){var h=i[0],u=i[1];h.constructor==Number&&(h+="px"),u.constructor==Number&&(u+="px"),l.root.style.width="calc( "+h+" - "+c+" )",l.root.style.height="calc(100% - 0px)",r.root.style.width="calc( "+u+" - "+c+" )",r.root.style.height="calc(100% - 0px)",this.root.style.display="flex"}else if(l.root.style.width="100%",r.root.style.width="100%",a){l.root.style.height="auto";let p=new ResizeObserver(e=>{for(let t of e){let i=t.contentRect;r.root.style.height="calc(100% - "+(i.height+4)+"px )"}});p.observe(l.root)}else{var m=i[0],g=i[1];m.constructor==Number&&(m+="px"),g.constructor==Number&&(g+="px"),l.root.style.width="100%",l.root.style.height="auto"==m?m:"calc( "+m+" - "+c+" )",r.root.style.height="auto"==g?g:"calc( "+g+" - "+c+" )"}if(this.root.appendChild(l.root),d&&this.root.appendChild(this.splitBar),this.root.appendChild(r.root),this.sections=[l,r],this.type=t,this._update(),!d)return this.sections;var f=this;function v(e){"horizontal"==f.type?f._moveSplit(-e.movementX):f._moveSplit(-e.movementY);let t=f.root.querySelectorAll(".lexwidget");for(let i of t){let a=i.jsInstance;a.onresize&&a.onresize()}e.stopPropagation(),e.preventDefault()}function E(e){var t=f.root.ownerDocument;t.removeEventListener("mousemove",v),t.removeEventListener("mouseup",E),document.body.classList.remove("nocursor"),f.splitBar.classList.remove("nocursor")}return this.sections}setLimitBox(e=0,t=0,i=1/0,a=1/0){this.minWidth=e,this.minHeight=t,this.maxWidth=i,this.maxHeight=a}setSize(e){let[t,i]=e;void 0!=t&&t.constructor==Number&&(t+="px"),void 0!=i&&i.constructor==Number&&(i+="px"),t&&(this.root.style.width=t),i&&(this.root.style.height=i),this.size=[this.root.clientWidth,this.root.clientHeight],this.propagateEvent("onresize")}extend(){if(this.splitExtended)return;let[e,t]=this.sections;this.splitExtended=!0,"vertical"==this.type?(this.offset=t.root.offsetHeight,t.root.classList.add("fadeout-vertical"),this._moveSplit(-1/0,!0)):(this.offset=t.root.offsetWidth-8,t.root.classList.add("fadeout-horizontal"),this._moveSplit(-1/0,!0,8)),doAsync(()=>this.propagateEvent("onresize"),150)}reduce(){if(!this.splitExtended)return;this.splitExtended=!1;let[e,t]=this.sections;"vertical"==this.type?(t.root.classList.add("fadein-vertical"),this._moveSplit(this.offset)):(t.root.classList.add("fadein-horizontal"),this._moveSplit(this.offset)),doAsync(()=>this.propagateEvent("onresize"),150)}hide(){this.root.classList.add("hidden")}show(){this.root.classList.remove("hidden")}toggle(e){this.root.classList.toggle("hidden",e)}propagateEvent(e){for(var t=0;t<this.sections.length;t++){let i=this.sections[t];i[e]&&i[e].call(this,i.root.getBoundingClientRect()),i.propagateEvent(e)}}addPanel(e){let t=new Panel(e);return this.attach(t),this.panels.push(t),t}addMenubar(e,t={}){let i=new Menubar(t);e&&e(i),LX.menubars.push(i);let[a,n]=this.split({type:"vertical",sizes:[48,null],resize:!1,menubar:!0});return a.attach(i),a.is_menubar=!0,(t.sticky??!0)&&a.root.classList.add("sticky"),i}addSidebar(e,t={}){let i=new SideBar(t);e&&e(i),LX.menubars.push(i);let[a,n]=this.split({type:"horizontal",sizes:[64,null],resize:!1,sidebar:!0});return a.attach(i),a.is_sidebar=!0,i}addOverlayButtons(e,t={}){if(this.sections.length){this.sections[1].addOverlayButtons(e,t);return}console.assert(e.constructor==Array&&e.length),this.root.style.position="relative",t.className="lexoverlaybuttons";let i=this.addPanel(t),a=null,n=document.createElement("div");n.className="lexoverlaybuttonscontainer",n.appendChild(i.root),this.attach(n);let s=t.float;if(s)for(var l=0;l<s.length;l++){let r=s[l];switch(r){case"h":case"t":case"l":break;case"v":n.className+=" vertical";break;case"m":n.className+=" middle";break;case"b":n.className+=" bottom";break;case"c":n.className+=" center";break;case"r":n.className+=" right"}}let o=function(e,t,n){let s={width:"auto",selectable:e.selectable,selected:e.selected,icon:e.icon,img:e.img,className:e.class};t&&(a||((a=document.createElement("div")).className="lexoverlaygroup",i.queuedContainer=a),s.parent=a);let l=e.callback;e.options?i.addDropdown(null,e.options,e.name,l,s):i.addButton(null,e.name,function(t,i){if(e.selectable){if(e.group){let a=e.selected;e.group.forEach(e=>e.selected=!1),e.selected=!a}else e.selected=!e.selected}l(t,i)},s),a&&n&&(i.root.appendChild(a),a=null,i.clearQueue())};!function(){for(let t of(i.clear(),e))if(t.constructor===Array)for(let a=0;a<t.length;++a){let l=t[a];l.group=t,o(l,!0,a==t.length-1)}else o(t);if(s){var r=0;i.root.childNodes.forEach(e=>{r+=e.offsetHeight}),n.className.includes("middle")&&(n.style.top="-moz-calc( 50% - "+.5*r+"px )",n.style.top="-webkit-calc( 50% - "+.5*r+"px )",n.style.top="calc( 50% - "+.5*r+"px )")}}()}addTabs(e={}){let t=new Tabs(this,e);return e.folding&&(this.parentArea._disableSplitResize(),this.root.style.paddingTop="4px"),t}_moveSplit(e,t=!1,i=0){if(!this.type)throw"No split area";if(void 0===e)return;let a=this.sections[0];var n=a.root;n.classList.contains("origin")||(n=n.parentElement);let s=this.sections[1],l=s.root,r=" - "+LX.DEFAULT_SPLITBAR_SIZE+"px",o=null;if(t||(o=n.style.transition,n.style.transition=l.style.transition="none",flushCss(n),flushCss(l)),"horizontal"==this.type){var d=Math.max(l.offsetWidth+e,parseInt(s.minWidth));i&&(d=i),n.style.width="-moz-calc( 100% - "+d+"px "+r+" )",n.style.width="-webkit-calc( 100% - "+d+"px "+r+" )",n.style.width="calc( 100% - "+d+"px "+r+" )",n.style.minWidth=parseInt(a.minWidth)+"px",l.style.width=d+"px",a.maxWidth!=1/0&&(l.style.minWidth="calc( 100% - "+parseInt(a.maxWidth)+"px )")}else{var d=Math.max(l.offsetHeight+e+s.offset,parseInt(s.minHeight));i&&(d=i),n.style.height="-moz-calc( 100% - "+d+"px "+r+" )",n.style.height="-webkit-calc( 100% - "+d+"px "+r+" )",n.style.height="calc( 100% - "+d+"px "+r+" )",n.style.minHeight=a.minHeight+"px",l.style.height=d-s.offset+"px"}t||(n.style.transition=l.style.transition=o),this._update(),this.propagateEvent("onresize")}_disableSplitResize(){this.resize=!1,this.splitBar.remove(),delete this.splitBar}_update(){let e=this.root.getBoundingClientRect();this.size=[e.width,e.height];for(var t=0;t<this.sections.length;t++)this.sections[t]._update()}}function flushCss(e){e.offsetHeight}LX.Area=Area;class Tabs{static TAB_SIZE=28;static TAB_ID=0;constructor(e,t={}){this.onclose=t.onclose;let i=document.createElement("div");i.className="lexareatabs "+(t.fit?"fit":"row");let a=t.folding??!1;a&&i.classList.add("folding");let n=this;if(i.addEventListener("dragenter",function(e){e.preventDefault(),this.classList.add("dockingtab")}),i.addEventListener("dragleave",function(e){e.preventDefault(),this.classList.remove("dockingtab")}),i.addEventListener("drop",function(e){e.preventDefault();let t=e.dataTransfer.getData("source"),i=document.getElementById(t);if(!i)return;this.appendChild(i);let a=document.getElementById(t+"_content");n.area.attach(a),this.classList.remove("dockingtab"),LX.emit("@on_tab_docked"),i.instance=n,i.click(),n.tabs[i.dataset.name]=a}),e.root.classList.add("lexareatabscontainer"),e.split({type:"vertical",sizes:t.sizes??"auto",resize:!1,top:6}),e.sections[0].attach(i),this.area=e.sections[1],this.area.root.className+=" lexareatabscontent",this.selected=null,this.root=i,this.tabs={},this.tabDOMs={},t.fit){let s=document.createElement("span");s.className="lexareatab thumb",this.thumb=s,this.root.appendChild(s);let l=new ResizeObserver(e=>{let t=this.thumb.item;if(t){var i=this.thumb.style.transition;this.thumb.style.transition="none",this.thumb.style.transform="translate( "+t.childIndex*t.offsetWidth+"px )",this.thumb.style.width=t.offsetWidth-5+"px",this.thumb.style.height=t.offsetHeight-6+"px",flushCss(this.thumb),this.thumb.style.transition=i}});l.observe(this.area.root)}if(a){this.folded=!0,this.folding=a,"up"==a&&e.root.insertChildAtIndex(e.sections[1].root,0);let r=new ResizeObserver(t=>{for(let i of t){let a=i.contentRect,n=e.parentArea.sections[0].root;n.style.height="calc(100% - "+(42+a.height)+"px )"}});r.observe(this.area.root),this.area.root.classList.add("folded")}}add(e,t,i={}){let a=i.selected??!1;a&&(this.root.querySelectorAll("span").forEach(e=>e.classList.remove("selected")),this.area.root.querySelectorAll(".lextabcontent").forEach(e=>e.style.display="none")),a=!Object.keys(this.tabs).length&&!this.folding||a;let n=t.root?t.root:t;n.originalDisplay=n.style.display,n.style.display=a?n.originalDisplay:"none",n.classList.add("lextabcontent"),i.icon&&(i.icon.includes("fa-")?i.icon="<i class='"+i.icon+"'></i>":i.icon="<img src='https://raw.githubusercontent.com/jxarco/lexgui.js/master/"+i.icon+"'>");let s=document.createElement("span");s.dataset.name=e,s.className="lexareatab"+(a?" selected":""),s.innerHTML=(i.icon??"")+e,s.id=e.replace(/\s/g,"")+Tabs.TAB_ID++,s.title=i.title??"",s.selected=a??!1,s.fixed=i.fixed,s.instance=this,n.id=s.id+"_content",s.selected&&(this.selected=e),LX.addSignal("@on_tab_docked",s,function(){1==this.parentElement.childNodes.length&&this.parentElement.childNodes[0].click()}),s.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),!s.fixed){let t=s.selected;s.parentElement.querySelectorAll("span").forEach(e=>e.selected=!1),s.selected=!t,s.parentElement.querySelectorAll("span").forEach(e=>e.classList.remove("selected")),s.classList.toggle("selected",this.folding&&s.selected),s.instance.area.root.querySelectorAll(".lextabcontent").forEach(e=>e.style.display="none"),n.style.display=n.originalDisplay,s.instance.selected=s.dataset.name}this.folding&&(this.folded=s.selected,this.area.root.classList.toggle("folded",!this.folded)),i.onSelect&&i.onSelect(e,s.dataset.name),this.thumb&&(this.thumb.style.transform="translate( "+s.childIndex*s.offsetWidth+"px )",this.thumb.style.width=s.offsetWidth-5+"px",this.thumb.style.height=s.offsetHeight-6+"px",this.thumb.item=s)}),s.addEventListener("contextmenu",e=>{e.preventDefault(),e.stopPropagation(),i.onContextMenu&&i.onContextMenu(e,s.dataset.name)}),s.addEventListener("mouseup",e=>{e.preventDefault(),e.stopPropagation(),1==e.button&&this.delete(s.dataset.name)}),s.setAttribute("draggable",!0),s.addEventListener("dragstart",function(e){if(1==this.parentElement.childNodes.length){e.preventDefault();return}e.dataTransfer.setData("source",e.target.id)}),s.childIndex=this.root.childElementCount-1,this.root.appendChild(s),this.area.attach(n),this.tabDOMs[e]=s,this.tabs[e]=t,setTimeout(()=>{i.onCreate&&i.onCreate.call(this,this.area.root.getBoundingClientRect()),a&&this.thumb&&(this.thumb.style.transform="translate( "+s.childIndex*s.offsetWidth+"px )",this.thumb.style.width=s.offsetWidth-5+"px",this.thumb.style.height=s.offsetHeight-6+"px",this.thumb.item=s)},10)}select(e){this.tabDOMs[e]&&this.tabDOMs[e].click()}delete(e){let t=this.tabDOMs[e];if(!t||t.fixed)return;this.onclose&&this.onclose(e),this.tabDOMs[e].remove(),delete this.tabDOMs[e],this.tabs[e].remove(),delete this.tabs[e];let i=this.root.lastChild;i&&!i.fixed&&this.root.lastChild.click()}}LX.Tabs=Tabs;class Menubar{constructor(e={}){this.root=document.createElement("div"),this.root.className="lexmenubar",e.float&&(this.root.style.justifyContent=e.float),this.items=[],this.buttons=[],this.icons={},this.shorts={}}add(e,t={}){t.constructor==Function&&(t={callback:t});let i=e.split("/"),a=i[i.length-1];this.icons[a]=t.icon,this.shorts[a]=t.short;let n=0,s=this,l=(e,a)=>{if(void 0==e)return;let s=null;if(a.forEach(t=>{let i=Object.keys(t),a=i.find(t=>t==e);a&&(s=t[a])}),s)l(i[n++],s);else{let r={};r[e]=[];let o=i[n++];o||(r.callback=t.callback,r.disabled=t.disabled,r.type=t.type,r.checked=t.checked),a.push(r),l(o,r[e])}};for(let r of(l(i[n++],this.items),this.items)){let o=Object.keys(r)[0],d=o.replace(/\s/g,"").replaceAll(".","");if(this.root.querySelector("#"+d))continue;let c=document.createElement("div");c.className="lexmenuentry",c.id=d,c.innerHTML="<span>"+o+"</span>",c.tabIndex="1","left"==t.position?this.root.prepend(c):("right"==t.position&&(c.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(c):this.root.appendChild(c));let h=function(){s.root.querySelectorAll(".lexmenuentry").forEach(e=>{e.classList.remove("selected"),e.built=!1}),LX.root.querySelectorAll(".lexmenubox").forEach(e=>e.remove()),s.focused=!1},u=function(e,t,i,a){let n=document.createElement("div");n.className="lexmenubox",n.tabIndex="0",i.currentMenu=n;let l=i.classList.contains("lexmenuboxentry");l&&(n.dataset.submenu=!0);var r=i.getBoundingClientRect();n.style.left=(l?r.x+r.width:r.left)+"px",n.style.top=(l?r.y:r.bottom-4)+"px",r=n.getBoundingClientRect(),doAsync(()=>{n.dataset.open=!0},10),LX.root.appendChild(n),console.log(e,t,i,a);for(var o=0;o<e[t].length;++o){let d=e[t][o],c=Object.keys(d)[0],p=d[c].length,m="checkbox"==d.type,g=document.createElement("div");if(g.className="lexmenuboxentry",g.className+=(o==e[t].length-1?" last":"")+(d.disabled?" disabled":""),""==c)g.className=" lexseparator";else{g.id=c;let f=document.createElement("div");f.innerHTML="",f.classList="lexmenuboxentrycontainer",g.appendChild(f);let v=s.icons[c];m?f.innerHTML+="<input type='checkbox' >":v?f.innerHTML+="<a class='"+v+" fa-sm'></a>":(f.innerHTML+="<a class='fa-solid fa-sm noicon'></a>",f.classList.add("noicon")),f.innerHTML+="<div class='lexentryname'>"+c+"</div>"}let E=g.querySelector("input");if(E&&(E.checked=d.checked??!1,E.addEventListener("change",e=>{d.checked=E.checked;let t=d.callback;t&&(t.call(this,d.checked,c,g),h()),e.stopPropagation(),e.stopImmediatePropagation()})),n.appendChild(g),""==c)continue;if(n.addEventListener("keydown",function(e){e.preventDefault();let t=s.shorts[c];t&&(t=1==t.length?t.toLowerCase():t)==e.key&&g.click()}),g.addEventListener("click",e=>{E&&(d.checked=!d.checked);let t=d.callback;t&&(t.call(this,E?d.checked:c,E?c:g),h()),e.stopPropagation(),e.stopImmediatePropagation()}),!p){if(s.shorts[c]){let y=document.createElement("div");y.className="lexentryshort",y.innerText=s.shorts[c],g.appendChild(y)}continue}let $=document.createElement("a");$.className="fa-solid fa-angle-right fa-xs",g.appendChild($),g.addEventListener("mouseover",e=>{!g.built&&(g.built=!0,u(d,c,g,++a),e.stopPropagation())}),g.addEventListener("mouseleave",e=>{g.currentMenu&&g.currentMenu!=e.toElement&&(a=-1,delete g.built,g.currentMenu.remove(),delete g.currentMenu)})}n.style.width=n.offsetWidth+"px"},p=()=>{h(),c.classList.add("selected"),c.built=!0,u(r,o,c,-1)};c.addEventListener("click",()=>{let e=r.callback;if(e){e.call(this,o,c);return}p(),this.focused=!0}),c.addEventListener("mouseover",e=>{this.focused&&!c.built&&p()}),c.addEventListener("blur",e=>{!(e.relatedTarget&&e.relatedTarget.classList.contains("lexmenubox"))&&h()})}}getButton(e){return this.buttons[e]}getSubitem(e,t){let i=null,a=t[0];for(let n=0;n<e.length;n++)if(e[n][a]){if(1==t.length)return e[n];return t.splice(0,1),this.getSubitem(e[n][a],t)}}getItem(e){let t=e.split("/");return this.getSubitem(this.items,t)}setButtonIcon(e,t,i,a={}){let n=this.buttons[e];if(n)n.querySelector("a").className="fa-solid "+t+" lexicon";else{let s=document.createElement("div"),l=a.disabled??!1;s.className="lexmenubutton"+(l?" disabled":""),s.title=e??"",s.innerHTML="<a class='"+t+" lexicon' style='font-size:x-large;'></a>",s.style.padding="5px 10px",s.style.maxHeight="calc(100% - 10px)",s.style.alignItems="center","right"==a.float&&(s.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(s):"left"==a.float?this.root.prepend(s):this.root.appendChild(s);let r=s.querySelector("a");r.addEventListener("click",e=>{i&&!l&&i.call(this,r,e)})}}setButtonImage(e,t,i,a={}){let n=this.buttons[e];if(n)n.querySelector("a").className="fa-solid "+icon+" lexicon";else{let s=document.createElement("div"),l=a.disabled??!1;s.className="lexmenubutton"+(l?" disabled":""),s.title=e??"",s.innerHTML="<a><image src='"+t+"' class='lexicon' style='height:32px;'></a>",s.style.padding="5px",s.style.alignItems="center","right"==a.float&&(s.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(s):"left"==a.float?this.root.prepend(s):this.root.appendChild(s);let r=s.querySelector("a");r.addEventListener("click",e=>{i&&!l&&i.call(this,r,e)})}}addButtons(e,t={}){if(!e)throw"No buttons to add!";this.buttonContainer||(this.buttonContainer=document.createElement("div"),this.buttonContainer.className="lexmenubuttons",this.buttonContainer.classList.add(t.float??"center"),"right"==t.position&&(this.buttonContainer.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(this.buttonContainer):this.root.appendChild(this.buttonContainer));for(let i=0;i<e.length;++i){let a=e[i],n=document.createElement("label"),s=a.title,l=a.disabled??!1;n.className="lexmenubutton"+(l?" disabled":""),n.title=s??"",this.buttonContainer.appendChild(n);let r=document.createElement("a");r.className=a.icon+" lexicon",n.appendChild(r);let o=r;if(a.swap){n.classList.add("swap"),r.classList.add("swap-off");let d=document.createElement("input");d.type="checkbox",n.prepend(d),o=d;let c=document.createElement("a");c.className=a.swap+" swap-on lexicon",n.appendChild(c),n.swap=function(){let e=this.querySelector("input");e.checked=!e.checked},n.setState=function(e){let t=this.querySelector("input");t.checked=e}}o.addEventListener("click",e=>{if(a.callback&&!l){let t=n.querySelector("input");a.callback.call(this,e,t?.checked)}}),s&&(this.buttons[s]=n)}}}LX.Menubar=Menubar;class SideBar{constructor(e={}){this.root=document.createElement("div"),this.root.className="lexsidebar",this.footer=document.createElement("div"),this.footer.className="lexsidebarfooter",this.root.appendChild(this.footer),this.items=[]}add(e,t={}){t.constructor==Function&&(t={callback:t});let i=e.replace(/\s/g,"").replaceAll(".","");if(this.items.findIndex((e,t)=>e.key==i)>-1){console.warn(`'${e}' already created in Sidebar`);return}let a=document.createElement("div");a.className="lexsidebarentry "+(t.className??""),a.id=i,t.bottom?this.footer.appendChild(a):this.root.appendChild(a),this.root.appendChild(this.footer);let n=document.createElement("button");n.innerHTML="<i class='"+(t.icon??"")+"'></i>",a.appendChild(n);let s=document.createElement("span");s.className="lexsidebarentrydesc",s.innerHTML=e,a.appendChild(s),n.addEventListener("mouseenter",()=>{setTimeout(()=>{s.style.display="unset"},100)}),n.addEventListener("mouseleave",()=>{setTimeout(()=>{s.style.display="none"},100)}),a.addEventListener("click",()=>{let i=t.callback;i&&i.call(this,e,a),t.bottom||(this.root.querySelectorAll(".lexsidebarentry").forEach(e=>e.classList.remove("selected")),a.classList.add("selected"))}),this.items.push({name:i,domEl:a,callback:t.callback})}select(e){let t=e.replace(/\s/g,"").replaceAll(".",""),i=this.items.find(e=>e.name===t);i&&i.domEl.click()}}LX.SideBar=SideBar;class Widget{static NONE=0;static TEXT=1;static TEXTAREA=2;static BUTTON=3;static DROPDOWN=4;static CHECKBOX=5;static TOGGLE=6;static COLOR=7;static RANGE=8;static NUMBER=9;static TITLE=10;static VECTOR=11;static TREE=12;static PROGRESS=13;static FILE=14;static LAYERS=15;static ARRAY=16;static LIST=17;static TAGS=18;static CURVE=19;static CARD=20;static IMAGE=21;static CONTENT=22;static CUSTOM=23;static SEPARATOR=24;static KNOB=25;static SIZE=26;static PAD=27;static FORM=28;static DIAL=29;static COUNTER=30;static TABLE=31;static NO_CONTEXT_TYPES=[Widget.BUTTON,Widget.LIST,Widget.FILE,Widget.PROGRESS];constructor(e,t,i){this.name=e,this.type=t,this.options=i}value(){if(this.onGetValue)return this.onGetValue();console.warn("Can't get value of "+this.typeName())}set(e,t=!1,i=""){if(this.onSetValue)return this.onSetValue(e,t);console.warn("Can't set value of "+this.typeName())}oncontextmenu(e){Widget.NO_CONTEXT_TYPES.includes(this.type)||addContextMenu(this.typeName(),e,e=>{e.add("Copy",()=>{this.copy()}),e.add("Paste",{disabled:!this._can_paste(),callback:()=>{this.paste()}})})}copy(){navigator.clipboard.type=this.type,navigator.clipboard.customIdx=this.customIdx,navigator.clipboard.data=this.value(),navigator.clipboard.writeText(navigator.clipboard.data)}_can_paste(){return this.type===Widget.CUSTOM?void 0!==navigator.clipboard.customIdx&&this.customIdx==navigator.clipboard.customIdx:navigator.clipboard.type===this.type}paste(){this._can_paste()&&this.set(navigator.clipboard.data)}typeName(){switch(this.type){case Widget.TEXT:return"Text";case Widget.TEXTAREA:return"TextArea";case Widget.BUTTON:return"Button";case Widget.DROPDOWN:return"Dropdown";case Widget.CHECKBOX:return"Checkbox";case Widget.TOGGLE:return"Toggle";case Widget.COLOR:return"Color";case Widget.RANGE:return"Range";case Widget.NUMBER:return"Number";case Widget.VECTOR:return"Vector";case Widget.TREE:return"Tree";case Widget.PROGRESS:return"Progress";case Widget.FILE:return"File";case Widget.LAYERS:return"Layers";case Widget.ARRAY:return"Array";case Widget.LIST:return"List";case Widget.TAGS:return"Tags";case Widget.CURVE:return"Curve";case Widget.KNOB:return"Knob";case Widget.SIZE:return"Size";case Widget.PAD:return"Pad";case Widget.FORM:return"Form";case Widget.DIAL:return"Dial";case Widget.COUNTER:return"Counter";case Widget.TABLE:return"Table";case Widget.CUSTOM:return this.customName}console.error(`Unknown Widget type: ${this.type}`)}refresh(){}}function ADD_CUSTOM_WIDGET(e,t={}){let i=simple_guidGenerator();Panel.prototype["add"+e]=function(a,n,s){let l=this.create_widget(a,Widget.CUSTOM,t);l.customName=e,l.customIdx=i,l.onGetValue=()=>n,l.onSetValue=(e,t)=>{n=e,h(),r.querySelector(".lexcustomitems").toggleAttribute("hidden",!1),t||this._trigger(new IEvent(a,n,null),s)};let r=l.domEl;r.style.flexWrap="wrap";let o,d,c=t.default??{},h=()=>{n&&(l.instance=n=Object.assign(deepCopy(c),n)),o&&o.remove(),d&&d.remove(),(o=document.createElement("div")).className="lexcustomcontainer",o.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")",this.queue(o);let i="<a class='fa-solid "+(t.icon??"fa-cube")+"' style='float:left'></a>";i+=e+(n?"":" [empty]"),i+="<a class='fa-solid "+(n?"fa-bars-staggered":" ")+" menu' style='float:right; width:5%;'></a>";let u=this.addButton(null,i,(t,i)=>{n?r.querySelector(".lexcustomitems").toggleAttribute("hidden"):addContextMenu(null,i,t=>{t.add("New "+e,()=>{n={},h(),r.querySelector(".lexcustomitems").toggleAttribute("hidden",!1)})})},{buttonClass:"custom"});if(this.clearQueue(),n&&u.querySelector("a.menu").addEventListener("click",e=>{e.stopImmediatePropagation(),e.stopPropagation(),addContextMenu(null,e,e=>{e.add("Clear",()=>{n=null,h()})})}),(d=document.createElement("div")).className="lexcustomitems",d.toggleAttribute("hidden",!0),r.appendChild(o),r.appendChild(d),n){this.queue(d);let p=(e,t,i)=>{n[e]=t,this._trigger(new IEvent(a,n,i),s)};for(let m in c){let g=n[m]??c[m];switch(g.constructor){case String:"#"===g[0]?this.addColor(m,g,p.bind(this,m)):this.addText(m,g,p.bind(this,m));break;case Number:this.addNumber(m,g,p.bind(this,m));break;case Boolean:this.addCheckbox(m,g,p.bind(this,m));break;case Array:g.length>4?this.addArray(m,g,p.bind(this,m)):this._add_vector(g.length,m,g,p.bind(this,m))}}this.clearQueue()}};h()}}LX.Widget=Widget,LX.ADD_CUSTOM_WIDGET=ADD_CUSTOM_WIDGET;class NodeTree{constructor(e,t,i){if(this.domEl=e,this.data=t,this.onevent=i.onevent,this.options=i,this.selected=[],t.constructor===Object)this._create_item(null,t);else for(let a of t)this._create_item(null,a)}_create_item(e,t,i=0,a){let n=this,s=this.domEl.querySelector("#lexnodetree_filter");if(t.children=t.children??[],s&&!t.id.includes(s.value)||void 0!=a&&a!=t.id){for(var l=0;l<t.children.length;++l)this._create_item(t,t.children[l],i+1,a);return}let r=this.domEl.querySelector("ul");t.visible=t.visible??!0,t.parent=e;let o=t.children.length>0,d=this.selected.indexOf(t)>-1||t.selected;if(this.options.onlyFolders){let c=!1;t.children.forEach(e=>c|="folder"==e.type),o=!!c}let h=document.createElement("li");h.className="lextreeitem datalevel"+i+(o?" parent":"")+(d?" selected":""),h.id=LX.getSupportedDOMName(t.id),h.tabIndex="0";let u=this.options.skip_default_icon??!0?"":"fa-solid fa-square";o&&(u=t.closed?"fa-solid fa-caret-right":"fa-solid fa-caret-down"),h.innerHTML="<a class='"+u+" hierarchy'></a>",u=t.icon,t.icon&&(t.icon.includes("fa-")?h.innerHTML+="<a class='"+t.icon+" tree-item-icon'></a>":h.innerHTML+="<img src='https://raw.githubusercontent.com/jxarco/lexgui.js/master/"+t.icon+"'>"),h.innerHTML+=t.rename?"":t.id,h.setAttribute("draggable",!0),h.style.paddingLeft=(o?0:3)+(3+(i+1)*15)+"px",r.appendChild(h),h.addEventListener("click",e=>{if(m){m=!1;return}e.shiftKey||(r.querySelectorAll("li").forEach(e=>{e.classList.remove("selected")}),this.selected.length=0);let i=this.selected.indexOf(t);if(i>-1?(h.classList.remove("selected"),this.selected.splice(i,1)):(h.classList.add("selected"),this.selected.push(t)),o&&t.id.length>1){if(t.closed=!1,n.onevent){let a=new TreeEvent(TreeEvent.NODE_CARETCHANGED,t,t.closed);n.onevent(a)}n.frefresh(t.id)}if(n.onevent){let s=new TreeEvent(TreeEvent.NODE_SELECTED,e.shiftKey?this.selected:t);s.multiple=e.shiftKey,n.onevent(s)}}),h.addEventListener("dblclick",function(){if((n.options.rename??!0)&&(t.rename=!0,n.refresh()),n.onevent){let e=new TreeEvent(TreeEvent.NODE_DBLCLICKED,t);n.onevent(e)}}),h.addEventListener("contextmenu",e=>{if(e.preventDefault(),!n.onevent)return;let i=new TreeEvent(TreeEvent.NODE_CONTEXTMENU,this.selected.length>1?this.selected:t,e);i.multiple=this.selected.length>1,LX.addContextMenu(i.multiple?"Selected Nodes":i.node.id,i.value,e=>{i.panel=e}),n.onevent(i),(this.options.addDefault??!1)==!0&&(i.panel.items&&i.panel.add(""),i.panel.add("Select Children",()=>{let e=t=>{if(!t.closed)for(let i of t.children??[]){if(i)this.domEl.querySelector("#"+i.id).classList.add("selected"),this.selected.push(i),e(i)}};e(t)}),i.panel.add("Delete",{callback:()=>{if(!t.parent)return;if(n.onevent){let i=new TreeEvent(TreeEvent.NODE_DELETED,t,e);n.onevent(i)}let a=t.parent.children,s=a.indexOf(t);a.splice(s,1),this.refresh()}}))}),h.addEventListener("keydown",e=>{if(!t.rename){if(e.preventDefault(),"Delete"==e.key){if(n.onevent){let i=new TreeEvent(TreeEvent.NODE_DELETED,this.selected.length>1?this.selected:t,e);i.multiple=this.selected.length>1,n.onevent(i)}for(let a of this.selected){let s=a.parent.children,l=s.indexOf(a);s.splice(l,1)}this.selected.length=0,this.refresh()}else if("ArrowUp"==e.key||"ArrowDown"==e.key){var r=this.selected.length>1?"ArrowUp"==e.key?this.selected.shift():this.selected.pop():this.selected[0],o=this.domEl.querySelector("#"+LX.getSupportedDOMName(r.id)),d="ArrowUp"==e.key?o.previousSibling:o.nextSibling;d&&d.click()}}});let p=document.createElement("input");p.toggleAttribute("hidden",!t.rename),p.value=t.id,h.appendChild(p),t.rename&&(h.classList.add("selected"),p.focus()),p.addEventListener("keyup",function(e){if("Enter"==e.key){if(this.value=this.value.replace(/\s/g,"_"),n.onevent){let i=new TreeEvent(TreeEvent.NODE_RENAMED,t,this.value);n.onevent(i)}t.id=LX.getSupportedDOMName(this.value),delete t.rename,n.frefresh(t.id),r.querySelector("#"+t.id).classList.add("selected")}else"Escape"==e.key&&(delete t.rename,n.frefresh(t.id))}),p.addEventListener("blur",function(e){delete t.rename,n.refresh()}),(this.options.draggable??!0)&&(e&&h.addEventListener("dragstart",e=>{window.__tree_node_dragged=t}),h.addEventListener("dragover",e=>{e.preventDefault()},!1),h.addEventListener("dragenter",e=>{e.target.classList.add("draggingover")}),h.addEventListener("dragleave",e=>{e.target.classList.remove("draggingover")}),h.addEventListener("drop",e=>{e.preventDefault();let i=window.__tree_node_dragged;if(!i)return;let a=t;if(i.id==a.id){console.warn("Cannot parent node to itself!");return}let s=function(e,t){var i=!1;for(var a of t.children){if(a.id==e.id)return!0;i|=s(e,a)}return i};if(s(a,i)){console.warn("Cannot parent node to a current child!");return}if(n.onevent){let l=new TreeEvent(TreeEvent.NODE_DRAGGED,i,a);n.onevent(l)}let r=i.parent.children.findIndex(e=>e.id==i.id),o=i.parent.children.splice(r,1);a.children.push(o[0]),n.refresh(),delete window.__tree_node_dragged}));let m=!1;if(o&&h.querySelector("a.hierarchy").addEventListener("click",function(e){if(m=!0,e.stopImmediatePropagation(),e.stopPropagation(),t.closed=!t.closed,n.onevent){let i=new TreeEvent(TreeEvent.NODE_CARETCHANGED,t,t.closed);n.onevent(i)}n.frefresh(t.id)}),!t.skipVisibility){let g=document.createElement("a");g.className="itemicon fa-solid fa-eye"+(t.visible?"":"-slash"),g.title="Toggle visible",g.addEventListener("click",function(e){if(e.stopPropagation(),t.visible=void 0!==t.visible&&!t.visible,this.className="itemicon fa-solid fa-eye"+(t.visible?"":"-slash"),n.onevent){let i=new TreeEvent(TreeEvent.NODE_VISIBILITY,t,t.visible);n.onevent(i)}}),h.appendChild(g)}if(t.actions)for(var l=0;l<t.actions.length;++l){let f=t.actions[l];var v=document.createElement("a");v.className="itemicon "+f.icon,v.title=f.name,v.addEventListener("click",function(e){f.callback(t,v),e.stopPropagation()}),h.appendChild(v)}if(void 0!=a&&t.id==a&&(this.selected=[t],h.click()),!t.closed)for(var l=0;l<t.children.length;++l){let E=t.children[l];(!this.options.onlyFolders||"folder"==E.type)&&this._create_item(t,E,i+1)}}refresh(e,t){this.data=e??this.data,this.domEl.querySelector("ul").innerHTML="",this._create_item(null,this.data,0,t)}frefresh(e){this.refresh();var t=this.domEl.querySelector("#"+e);t&&t.focus()}select(e){this.refresh(null,e)}}class Panel{constructor(e={}){var t=document.createElement("div");t.className="lexpanel",e.id&&(t.id=e.id),e.className&&(t.className+=" "+e.className),t.style.width=e.width||"calc( 100% - 6px )",t.style.height=e.height||"100%",Object.assign(t.style,e.style??{}),this._inline_widgets_left=-1,this._inline_queued_container=null,this.root=t,this.onevent=e=>{},this.branch_open=!1,this.branches=[],this.current_branch=null,this.widgets={},this._queue=[]}get(e){return this.widgets[e]}getValue(e){let t=this.widgets[e];if(!t)throw"No widget called "+e;return t.value()}setValue(e,t,i){let a=this.widgets[e];if(!a)throw"No widget called "+e;return a.set(t,i)}attach(e){if(!e)throw"no content to attach";e.parent=this;let t=e.root?e.root:e;this.root.appendChild(t)}clear(){for(let e in this.branch_open=!1,this.branches=[],this.current_branch=null,this.widgets)if(this.widgets[e].options&&this.widgets[e].options.signal){let t=this.widgets[e].options.signal;for(let i=0;i<LX.signals[t].length;i++)LX.signals[t][i]==this.widgets[e]&&(LX.signals[t]=[...LX.signals[t].slice(0,i),...LX.signals[t].slice(i+1)])}if(this.signals)for(let a=0;a<this.signals.length;a++){let n=Object.values(this.signals[a])[0],s=n.options.signal;for(let l=0;l<LX.signals[s].length;l++)LX.signals[s][l]==n&&(LX.signals[s]=[...LX.signals[s].slice(0,l),...LX.signals[s].slice(l+1)])}this.widgets={},this.root.innerHTML=""}sameLine(e){this._inline_queued_container=this.queuedContainer,this._inline_widgets_left=e||1/0}endLine(e){if(-1==this._inline_widgets_left){console.warn("No pending widgets to be inlined!");return}for(let t of(this._inline_widgets_left=-1,!this._inlineContainer&&(this._inlineContainer=document.createElement("div"),this._inlineContainer.className="lexinlinewidgets",e&&(this._inlineContainer.style.justifyContent=e)),this._inlineWidgets)){let i=t.constructor==Array;i?this._inline_queued_container?this._inlineContainer.appendChild(t[0]):t[1].appendChild(t[0]):this._inlineContainer.appendChild(t)}this._inline_queued_container?this._inline_queued_container.appendChild(this._inlineContainer):this.current_branch?this.current_branch.content.appendChild(this._inlineContainer):this.root.appendChild(this._inlineContainer),delete this._inlineWidgets,delete this._inlineContainer}branch(e,t={}){this.branch_open&&this.merge();var i=new Branch(e,t);return i.panel=this,this.branch_open=!0,this.current_branch=i,0==this.branches.length&&i.root.classList.add("first"),this.root.querySelectorAll(".lexbranch.last").forEach(e=>{e.classList.remove("last")}),i.root.classList.add("last"),this.branches.push(i),this.root.appendChild(i.root),t.filter&&this._addFilter(t.filter,{callback:this._searchWidgets.bind(this,i.name)}),i}merge(){this.branch_open=!1,this.current_branch=null}_pick(e,t){return void 0===e?t:e}static _dispatch_event(e,t,i,a,n){let s=new CustomEvent(t,{detail:i,bubbles:a,cancelable:n});e.dispatchEvent(s)}static _add_reset_property(e,t){var i=document.createElement("a");return i.style.display="none",i.style.marginRight="6px",i.className="lexicon fa fa-rotate-left",i.addEventListener("click",t),e.appendChild(i),i}create_widget(e,t,i={}){let a=new Widget(e,t,i),n=document.createElement("div");if(n.className="lexwidget",n.id=i.id??"",n.title=i.title??"",i.className&&(n.className+=" "+i.className),t!=Widget.TITLE&&(n.style.width="calc(100% - "+(this.current_branch||t==Widget.FILE?10:20)+"px)",i.width&&(n.style.width=n.style.minWidth=i.width),i.maxWidth&&(n.style.maxWidth=i.maxWidth),i.minWidth&&(n.style.minWidth=i.minWidth),i.height&&(n.style.height=n.style.minHeight=i.height)),void 0!=e){if(!i.hideName){let s=document.createElement("div");s.className="lexwidgetname",i.justifyName&&s.classList.add("float-"+i.justifyName),s.innerHTML=e||"",s.title=i.title??s.innerHTML,s.style.width=i.nameWidth||LX.DEFAULT_NAME_WIDTH,n.appendChild(s),n.domName=s,s.addEventListener("contextmenu",function(e){e.preventDefault(),a.oncontextmenu(e)})}this.widgets[e]=a}return i.signal&&(e||(this.signals||(this.signals=[]),this.signals.push({[i.signal]:a})),LX.addSignal(i.signal,a)),a.domEl=n,n.jsInstance=a,this._inline_widgets_left>0&&!i.skipInlineCount?(this._inlineWidgets||(this._inlineWidgets=[]),(e=>{this.queuedContainer?this._inlineWidgets.push([e,this.queuedContainer]):this._inlineWidgets.push(e)})(n),this._inline_widgets_left--,this._inline_widgets_left||this.endLine()):(e=>{i.container?i.container.appendChild(e):this.queuedContainer?this.queuedContainer.appendChild(e):this.current_branch?(i.skipWidget||this.current_branch.widgets.push(a),this.current_branch.content.appendChild(e)):(e.classList.add("nobranch"),this.root.appendChild(e))})(n),a}_addFilter(e,t={}){t.placeholder=e.constructor==String?e:"Filter properties..",t.skipWidget=t.skipWidget??!0,t.skipInlineCount=!0;let i=this.create_widget(null,Widget.TEXT,t).domEl;i.className+=" lexfilter noname";let a=document.createElement("input");a.className="lexinput-filter",a.setAttribute("placeholder",t.placeholder),a.style.width="calc( 100% - 17px )",a.value=t.filterValue||"";let n=document.createElement("a");return n.className="fa-solid fa-magnifying-glass",i.appendChild(n),i.appendChild(a),a.addEventListener("input",e=>{t.callback&&t.callback(a.value,e)}),i}_searchWidgets(e,t){for(let i of this.branches){if(i.name!==e)continue;for(let a of i.widgets)!a.domEl.classList.contains("lexfilter")&&a.domEl.remove();this.queue(i.content);let n=!t.length;for(let s of i.widgets){if(!n){if(!s.name)continue;t.toLowerCase();let l=s.name.toLowerCase();if(!l.includes(t))continue}this.queuedContainer.appendChild(s.domEl)}this.clearQueue();return}}_filterOptions(e,t){let i=!t.length,a=[];for(let n=0;n<e.length;n++){let s=e[n];if(!i){let l="string"==typeof s?s:s.value,r=t.toLowerCase(),o=l.toLowerCase();if(!o.includes(r))continue}a.push(s)}this.refresh(a)}_trigger(e,t){t&&t.call(this,e.value,e.domEvent,e.name),this.onevent&&this.onevent.call(this,e)}getBranch(e){return e?this.branches.find(t=>t.name==e):this.current_branch}queue(e){!e&&this.current_branch&&(e=this.current_branch.root),this.queuedContainer&&this._queue.push(this.queuedContainer),this.queuedContainer=e}clearQueue(){if(this._queue&&this._queue.length){this.queuedContainer=this._queue.pop();return}delete this.queuedContainer}addBlank(e=8,t){let i=this.create_widget(null,Widget.addBlank);return i.domEl.className+=" blank",i.domEl.style.height=e+"px",t&&(i.domEl.style.width=t),i}addTitle(e,t={}){if(!e)throw"Can't create Title without text!";let i=this.create_widget(null,Widget.TITLE,t).domEl;if(i.className="lextitle",t.icon){let a=document.createElement("a");a.className=t.icon,a.style.color=t.iconColor||"",i.appendChild(a)}let n=document.createElement("span");if(n.innerText=e,i.appendChild(n),Object.assign(i.style,t.style??{}),void 0!=t.link){let s=document.createElement("a");s.innerText=e,s.href=t.link,s.target=t.target??"",s.className="lextitle link",Object.assign(s.style,t.style??{}),i.replaceWith(s)}return i}addText(e,t,i,a={}){let n=this.create_widget(e,Widget.TEXT,a);n.onGetValue=()=>r.value,n.onSetValue=(e,t)=>{this.disabled?r.innerText=e:r.value=e,Panel._dispatch_event(r,"focusout",t)},n.valid=()=>{if(""==r.pattern)return!0;let e=RegExp(r.pattern);return e.test(r.value)};let s=n.domEl;n.name&&!a.skipReset&&Panel._add_reset_property(s.domName,function(){r.value=r.iValue,this.style.display="none",Panel._dispatch_event(r,"focusout")});let l=document.createElement("div");l.className="lextext"+(a.warning?" lexwarning":""),l.style.width=a.inputWidth||"calc( 100% - "+LX.DEFAULT_NAME_WIDTH+" )",l.style.display="flex",a.textClass&&l.classList.add(a.textClass),this.disabled=(a.disabled||a.warning)??!!a.url;let r=null;if(this.disabled){r=document.createElement(a.url?"a":"div"),a.url&&(r.href=a.url,r.target="_blank");let o=a.warning?'<i class="fa-solid fa-triangle-exclamation"></i>':"";r.innerHTML=o+t||"",r.style.width="100%",r.style.textAlign=a.float??""}else{(r=document.createElement("input")).type=a.type||"",r.value=r.iValue=t||"",r.style.width="100%",r.style.textAlign=a.float??"",r.setAttribute("placeholder",a.placeholder??""),a.required&&r.setAttribute("required",a.required),a.pattern&&r.setAttribute("pattern",a.pattern);var d=(function(t,a){if(!n.valid())return;let l=a.detail,o=s.querySelector(".lexwidgetname .lexicon");o&&(o.style.display=t!=r.iValue?"block":"none"),l||this._trigger(new IEvent(e,t,a),i)}).bind(this);let c=a.trigger??"default";if("default"==c?(r.addEventListener("keyup",function(e){"Enter"==e.key&&d(e.target.value,e)}),r.addEventListener("focusout",function(e){d(e.target.value,e)})):"input"==c&&r.addEventListener("input",function(e){d(e.target.value,e)}),r.addEventListener("mousedown",function(e){e.stopImmediatePropagation(),e.stopPropagation()}),a.icon){let h=document.createElement("a");h.className="inputicon "+a.icon,l.appendChild(h)}}return Object.assign(r.style,a.style??{}),l.appendChild(r),s.appendChild(l),n.name||(s.className+=" noname",l.style.width="100%"),n}addTextArea(e,t,i,a={}){let n=this.create_widget(e,Widget.TEXTAREA,a);n.onGetValue=()=>r.value,n.onSetValue=(e,t)=>{r.value=e,Panel._dispatch_event(r,"focusout",t)};let s=n.domEl;n.name&&!a.skipReset&&Panel._add_reset_property(s.domName,function(){r.value=r.iValue,this.style.display="none",Panel._dispatch_event(r,"focusout")});let l=document.createElement("div");l.className="lextextarea",l.style.width=a.inputWidth||"calc( 100% - "+LX.DEFAULT_NAME_WIDTH+" )",l.style.height=a.height,l.style.display="flex";let r=document.createElement("textarea");r.value=r.iValue=t||"",r.style.width="100%",r.style.textAlign=a.float??"",Object.assign(r.style,a.style??{}),a.disabled&&r.setAttribute("disabled",!0),a.placeholder&&r.setAttribute("placeholder",a.placeholder);var o=(function(t,a){let n=a.detail,l=s.querySelector(".lexwidgetname .lexicon");l&&(l.style.display=t!=r.iValue?"block":"none"),n||this._trigger(new IEvent(e,t,a),i)}).bind(this);let d=a.trigger??"default";if("default"==d?(r.addEventListener("keyup",function(e){"Enter"==e.key&&o(e.target.value,e)}),r.addEventListener("focusout",function(e){o(e.target.value,e)})):"input"==d&&r.addEventListener("input",function(e){o(e.target.value,e)}),a.icon){let c=document.createElement("a");c.className="inputicon "+a.icon,l.appendChild(c)}return l.appendChild(r),s.appendChild(l),n.name||(s.className+=" noname",l.style.width="100%"),doAsync(()=>{a.fitHeight&&(r.style.height=r.scrollHeight+"px")},10),n}addLabel(e,t={}){return t.disabled=!0,this.addText(null,e,null,t)}addButton(e,t,i,a={}){let n=this.create_widget(e,Widget.BUTTON,a);n.onGetValue=()=>l.innerText,n.onSetValue=(e,t)=>{l.innerHTML=a.icon?"<a class='"+a.icon+"'></a>":a.img?"<img src='"+a.img+"'>":"<span>"+(e||"")+"</span>"};let s=n.domEl;var l=document.createElement("button");return l.title=a.title??"",l.className="lexbutton "+(a.buttonClass??""),a.selected&&l.classList.add("selected"),l.innerHTML=a.icon?"<a class='"+a.icon+"'></a>":a.img?"<img src='"+a.img+"'>":"<span>"+(t||"")+"</span>",l.style.width="calc( 100% - "+(a.nameWidth??LX.DEFAULT_NAME_WIDTH)+")",a.disabled&&l.setAttribute("disabled",!0),l.addEventListener("click",n=>{a.selectable&&(a.parent&&a.parent.querySelectorAll(".lexbutton.selected").forEach(e=>{e!=l&&e.classList.remove("selected")}),l.classList.toggle("selected")),this._trigger(new IEvent(e,t,n),i)}),s.appendChild(l),n.name||(l.className+=" noname",l.style.width="100%"),s}addComboButtons(e,t,i={}){let a=this.create_widget(e,Widget.BUTTON,i),n=a.domEl,s=this,l=document.createElement("div");l.className="lexcombobuttons ",i.float&&(l.className+=i.float),l.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";let r=document.createElement("div");r.className="lexcombobuttonsbox ";let o=!i.noSelection,d=o&&(i.toggle??!1);for(let c of t){if(!c.value)throw"Set 'value' for each button!";let h=document.createElement("button");h.className="lexbutton combo",h.title=c.icon?c.value:"",h.id=c.id??"",i.buttonClass&&h.classList.add(i.buttonClass),o&&(c.selected||i.selected==c.value)&&h.classList.add("selected"),h.innerHTML=(c.icon?"<a class='"+c.icon+"'></a>":"")+"<span>"+(c.icon?"":c.value)+"</span>",c.disabled&&h.setAttribute("disabled",!0),h.addEventListener("click",function(t){o&&(d?this.classList.toggle("selected"):(l.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),this.classList.add("selected"))),s._trigger(new IEvent(e,c.value,t),c.callback)}),r.appendChild(h)}return a.name||(n.className+=" noname",l.style.width="100%"),l.appendChild(r),n.appendChild(l),a}addCard(e,t={}){t.hideName=!0;let i=this.create_widget(e,Widget.CARD,t),a=i.domEl,n=document.createElement("div");if(n.className="lexcard",n.style.width="100%",t.img){let s=document.createElement("img");s.src=t.img,n.appendChild(s),void 0!=t.link&&(s.style.cursor="pointer",s.addEventListener("click",function(){let e=n.querySelector("a");e&&e.click()}))}let l=document.createElement("span");if(l.innerText=e,void 0!=t.link){let r=document.createElement("a");r.innerText=e,r.href=t.link,r.target=t.target??"",l.innerText="",l.appendChild(r)}return n.appendChild(l),t.callback&&(n.style.cursor="pointer",n.addEventListener("click",i=>{this._trigger(new IEvent(e,null,i),t.callback)})),a.appendChild(n),i}addForm(e,t,i,a={}){if(t.constructor!=Object){console.error("Form data must be an Object");return}a.hideName=!0;let n=this.create_widget(e,Widget.FORM,a);n.onGetValue=()=>l.formData,n.onSetValue=(e,t)=>{l.formData=e;let i=l.querySelectorAll(".lexwidget");for(let a=0;a<i.length;++a){let n=i[a];if(n.jsInstance.type!=LX.Widget.TEXT)continue;let s=i[a].querySelector(".lexwidgetname").innerText,r=i[a].querySelector(".lextext input");r.value=e[s]??"",Panel._dispatch_event(r,"focusout",t)}};let s=n.domEl,l=document.createElement("div");for(let r in l.className="lexformdata",this.queue(l),l.formData={},t){let o=t[r];o.constructor!=Object&&(o={}),o.placeholder=o.placeholder??r,o.width="calc(100% - 10px)",this.addLabel(r,{textClass:"formlabel"}),o.textWidget=this.addText(null,o.constructor==Object?o.value:o,e=>{l.formData[r]=e},o),l.formData[r]=o.constructor==Object?o.value:o}return this.addBlank(),this.addButton(null,a.actionName??"Submit",(e,a)=>{for(let n in t)if(!t[n].textWidget.valid())return;i&&i(l.formData,a)},{buttonClass:"primary",width:"calc(100% - 10px)"}),this.clearQueue(),s.appendChild(l),(!n.name||a.hideName)&&(s.className+=" noname",l.style.width="100%"),n}addContent(e,t={}){if(!e)return;if(e.constructor==String){let i=document.createElement("div");i.innerHTML=e,e=i.childElementCount>1?i:i.firstElementChild}let a=this.create_widget(null,Widget.CONTENT,t);return a.domEl.appendChild(e),a}async addImage(e,t={}){if(!e)return;t.hideName=!0;let i=this.create_widget(null,Widget.IMAGE,t),a=i.domEl,n=document.createElement("div");n.className="leximage",n.style.width="100%";let s=document.createElement("img");for(let l in s.src=e,t.style)s.style[l]=t.style[l];return await s.decode(),n.appendChild(s),a.appendChild(n),i}addDropdown(e,t,i,a,n={}){let s=this.create_widget(e,Widget.DROPDOWN,n);s.onGetValue=()=>l.querySelector("li.selected").getAttribute("value"),s.onSetValue=(t,n)=>{let s=l.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=t!=d.iValue?"block":"none"),i=t,m.querySelectorAll("li").forEach(e=>{e.getAttribute("value")==i&&e.click()}),n||this._trigger(new IEvent(e,i,null),a)};let l=s.domEl,r=this;s.name&&!n.skipReset&&Panel._add_reset_property(l.domName,function(){i=d.iValue,m.querySelectorAll("li").forEach(e=>{e.getAttribute("value")==i&&e.click()}),this.style.display="none"});let o=document.createElement("div");o.className="lexdropdown",o.style.width=n.inputWidth||"calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";let d=document.createElement("div");d.className="lexdropdown lexoption",d.name=e,d.iValue=i;let c=i;c+="<a class='fa-solid fa-angle-down' style='float:right; margin-right: 3px;'></a>",this.queue(o);let h=e=>{console.log("Replacing container");let t=e.getParentArea(),i=u.getBoundingClientRect(),a=e.parentElement.closest("dialog");{let n=e.offsetHeight,s=i.y,l=window.innerHeight;if(t){let r=t.getBoundingClientRect();l=r.y+r.height}if(a){let o=a.getBoundingClientRect();s-=o.y}e.style.top=s+u.offsetHeight+"px";let d=s+n>l;d&&(e.style.top=s-n+"px",e.classList.add("place-above"))}{let c=e.offsetWidth,h=i.x;if(e.style.minWidth=i.width+"px",a){let p=a.getBoundingClientRect();h-=p.x}e.style.left=h+"px";let m=window.innerWidth;if(t){let g=t.getBoundingClientRect();m=g.x+g.width}let f=h+c>m;f&&(e.style.left=h-(c-i.width)+"px")}},u=this.addButton(null,c,(e,t)=>{if(m.unfocus_event){delete m.unfocus_event;return}p.classList.remove("place-above");let i=p.hasAttribute("open");i?p.close():(p.show(),h(p)),g&&g.querySelector("input").focus()},{buttonClass:"array",skipInlineCount:!0,disabled:n.disabled});this.clearQueue(),u.style.width="100%",u.refresh=e=>{""==u.querySelector("span").innerText?u.querySelector("span").innerText=e:u.querySelector("span").innerHTML=u.querySelector("span").innerHTML.replaceAll(u.querySelector("span").innerText,e)};let p=document.createElement("dialog");p.className="lexdropdownoptions";let m=document.createElement("ul");m.tabIndex=-1,m.className="lexoptions",p.appendChild(m),m.addEventListener("focusout",function(e){if(e.stopPropagation(),e.stopImmediatePropagation(),e.relatedTarget===u.querySelector("button"))this.unfocus_event=!0,setTimeout(()=>delete this.unfocus_event,200);else if(e.relatedTarget&&"INPUT"==e.relatedTarget.tagName)return;else if("lexinput-filter"==e.target.className)return;p.close()});let g=null;n.filter&&(g=this._addFilter(n.placeholder??"Search...",{container:m,callback:this._filterOptions.bind(m,t)}),m.appendChild(g),g.addEventListener("focusout",function(e){!(e.relatedTarget&&"UL"==e.relatedTarget.tagName&&e.relatedTarget.classList.contains("lexoptions"))&&p.close()}));let f=document.createElement("span");return f.style.height="calc(100% - 25px)",m.appendChild(f),m.refresh=n=>{if(f.innerHTML="",!n.length){let s=n.emptyMsg??"No options found.",o=document.createElement("div");o.className="option",o.style.flexDirection="unset",o.innerHTML=s;let c=document.createElement("li");c.className="lexdropdownitem empty",c.appendChild(o),f.appendChild(c);return}for(let h=0;h<n.length;h++){let v=n[h],E=document.createElement("li"),y=document.createElement("div");if(y.className="option",E.appendChild(y),E.addEventListener("click",n=>{p.close();let s=l.querySelector(".lexoptions .selected");s&&s.classList.remove("selected"),i=n.currentTarget.getAttribute("value"),n.currentTarget.toggleAttribute("hidden",!1),n.currentTarget.classList.add("selected"),u.refresh(i);let o=l.querySelector(".lexwidgetname .lexicon");o&&(o.style.display=i!=d.iValue?"block":"none"),r._trigger(new IEvent(e,i,null),a),g&&(g.querySelector("input").value="",this._filterOptions.bind(m,t,"")())}),v.constructor!=Object)y.style.flexDirection="unset",y.innerHTML="</a><span>"+v+"</span><a class='fa-solid fa-check'>",y.value=v,E.setAttribute("value",v),E.className="lexdropdownitem",v==i&&(E.classList.add("selected"),d.innerHTML=v);else{let $=document.createElement("img");$.src=v.src,E.setAttribute("value",v.value),E.className="lexlistitem",y.innerText=v.value,y.className+=" media",y.prepend($),y.setAttribute("value",v.value),y.setAttribute("data-index",h),y.setAttribute("data-src",v.src),y.setAttribute("title",v.value),i==v.value&&E.classList.add("selected")}f.appendChild(E)}},m.refresh(t),o.appendChild(p),l.appendChild(o),s.name||(l.className+=" noname",o.style.width="100%"),s}addCurve(e,t,i,a={}){if(!e)throw"Set Widget Name!";let n=this,s=this.create_widget(e,Widget.CURVE,a);s.onGetValue=()=>JSON.parse(JSON.stringify(d.element.value)),s.onSetValue=(t,a)=>{let s=l.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=t!=d.element.value?"block":"none"),d.element.value=JSON.parse(JSON.stringify(t)),d.redraw(),a||n._trigger(new IEvent(e,d.element.value,null),i)};let l=s.domEl,r=JSON.parse(JSON.stringify(t));a.skipReset||Panel._add_reset_property(l.domName,function(t){this.style.display="none",d.element.value=JSON.parse(JSON.stringify(r)),d.redraw(),n._trigger(new IEvent(e,d.element.value,t),i)});var o=document.createElement("div");o.className="lexcurve",o.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")",a.callback=(t,a)=>{let s=l.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=t!=r?"block":"none"),n._trigger(new IEvent(e,t,a),i)},a.name=e;let d=new Curve(this,t,a);return o.appendChild(d.element),l.appendChild(o),s.onresize=d.redraw.bind(d),s.curveInstance=d,doAsync(()=>{d.canvas.width=o.offsetWidth,d.redraw()}),s}addDial(e,t,i,a={}){let n=this,s=this.create_widget(e,Widget.DIAL,a);s.onGetValue=()=>JSON.parse(JSON.stringify(d.element.value)),s.onSetValue=(t,a)=>{let s=l.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=t!=d.element.value?"block":"none"),d.element.value=JSON.parse(JSON.stringify(t)),d.redraw(),a||n._trigger(new IEvent(e,d.element.value,null),i)};let l=s.domEl,r=JSON.parse(JSON.stringify(t));s.name&&!a.skipReset&&Panel._add_reset_property(l.domName,function(t){this.style.display="none",d.element.value=JSON.parse(JSON.stringify(r)),d.redraw(),n._trigger(new IEvent(e,d.element.value,t),i)});var o=document.createElement("div");o.className="lexcurve",o.style.width=s.name?"calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")":"100%",a.callback=(t,a)=>{let s=l.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=t!=r?"block":"none"),n._trigger(new IEvent(e,t,a),i)},a.name=e;let d=new Dial(this,t,a);return o.appendChild(d.element),l.appendChild(o),s.onresize=d.redraw.bind(d),s.curveInstance=d,doAsync(()=>{d.element.style.height=d.element.offsetWidth+"px",d.canvas.width=d.element.offsetWidth,o.style.width=d.element.offsetWidth+"px",d.canvas.height=d.canvas.width,d.redraw()}),s}addLayers(e,t,i,a={}){if(!e)throw"Set Widget Name!";let n=this,s=this.create_widget(e,Widget.LAYERS,a);s.onGetValue=()=>l.value,s.onSetValue=(a,s)=>{let r=l.querySelector(".lexwidgetname .lexicon");r&&(r.style.display=a!=o?"block":"none"),t=l.value=a,d(),s||n._trigger(new IEvent(e,t),i)};let l=s.domEl;Panel._add_reset_property(l.domName,function(a){this.style.display="none",t=l.value=o,d(),n._trigger(new IEvent(e,t,a),i)});var r=document.createElement("div");r.className="lexlayers",r.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";let o=l.value=t,d=()=>{r.innerHTML="";let a=t.toString(2),n=a.length;for(var s=0;s<16-n;++s)a="0"+a;for(let d=0;d<16;++d){let c=document.createElement("div");if(c.className="lexlayer",void 0!=t){let h=a[16-d-1];void 0!=h&&"1"==h&&c.classList.add("selected")}c.innerText=d+1,c.title="Bit "+d+", value "+(1<<d),r.appendChild(c),c.addEventListener("click",a=>{a.stopPropagation(),a.stopImmediatePropagation(),a.target.classList.toggle("selected"),t^=1<<d,l.value=t;let n=l.querySelector(".lexwidgetname .lexicon");n&&(n.style.display=t!=o?"block":"none"),this._trigger(new IEvent(e,t,a),i)})}};return d(),l.appendChild(r),s}addArray(e,t=[],i,a={}){if(!e)throw"Set Widget Name!";let n=this.create_widget(e,Widget.ARRAY,a);n.onGetValue=()=>{let e=s.querySelectorAll("input"),t=[];for(var i of e)t.push(i.value);return t},n.onSetValue=(a,n)=>{t=a,c(),n||this._trigger(new IEvent(e,t,null),i)};let s=n.domEl;s.style.flexWrap="wrap";var l=document.createElement("div");l.className="lexarray",l.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")",this.queue(l);let r="<a class='fa-solid fa-angle-down' style='float:right; margin-right: 3px;'></a>",o="Array (size "+t.length+")";o+=r,this.addButton(null,o,()=>{s.querySelector(".lexarrayitems").toggleAttribute("hidden")},{buttonClass:"array"}),this.clearQueue();let d=document.createElement("div");d.className="lexarrayitems",d.toggleAttribute("hidden",!0),s.appendChild(l),s.appendChild(d);let c=()=>{let n=s.querySelector(".lexbutton.array span");n.innerHTML="Array (size "+t.length+")",n.innerHTML+=r,d.innerHTML="",this.queue(d);for(let l=0;l<t.length;++l){let h=t[l],u=a.innerValues?"dropdown":h.constructor;switch(this.sameLine(2),u){case String:this.addText(l+"",h,function(e,a){t[l]=e,i(t)},{nameWidth:"4%",inputWidth:"95%",skipReset:!0});break;case Number:this.addNumber(l+"",h,function(e,a){t[l]=e,i(t)},{nameWidth:"4%",inputWidth:"95%",skipReset:!0});break;case"dropdown":this.addDropdown(l+"",a.innerValues,h,function(e,a){t[l]=e,i(t)},{nameWidth:"4%",inputWidth:"95%",skipReset:!0})}this.addButton(null,"<a class='lexicon fa-solid fa-trash'></a>",(a,n)=>{t.splice(t.indexOf(h),1),c(),this._trigger(new IEvent(e,t,n),i)},{title:"Remove item",className:"micro"})}o="Add item",o+="<a class='fa-solid fa-plus' style='float:right; margin-right: 3px; margin-top: 2px;'></a>",this.addButton(null,o,(n,s)=>{t.push(a.innerValues?a.innerValues[0]:""),c(),this._trigger(new IEvent(e,t,s),i)},{buttonClass:"array"}),this.clearQueue()};return c(),n}addList(e,t,i,a,n={}){let s=this.create_widget(e,Widget.LIST,n);s.onGetValue=()=>i,s.onSetValue=(n,s)=>{r.querySelectorAll(".lexlistitem").forEach(e=>e.classList.remove("selected"));let l=t.indexOf(n);-1==l||(r.children[l].classList.toggle("selected"),i=n,s||this._trigger(new IEvent(e,n),a))},s.updateValues=n=>{t=n,r.innerHTML="";for(let s=0;s<t.length;++s){let l=null,o=t[s];o.constructor===Array&&(l=o[1],o=o[0]);let d=document.createElement("div");d.className="lexlistitem"+(i==o?" selected":""),d.innerHTML="<span>"+o+"</span>"+(l?"<a class='"+l+"'></a>":""),d.addEventListener("click",t=>{r.querySelectorAll(".lexlistitem").forEach(e=>e.classList.remove("selected")),d.classList.toggle("selected"),i=o,this._trigger(new IEvent(e,o,t),a)}),r.appendChild(d)}};let l=s.domEl,r=document.createElement("div");return r.className="lexlist",r.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")",s.updateValues(t),s.name||(l.className+=" noname",r.style.width="100%"),l.appendChild(r),s}addTags(e,t,i,a={}){let n=[].concat(t=t.replace(/\s/g,"").split(",")),s=this.create_widget(e,Widget.TAGS,a);s.onGetValue=()=>[].concat(t),s.onSetValue=(a,s)=>{t=[].concat(a),d();let o=l.querySelector(".lexwidgetname .lexicon");o&&(o.style.display=a!=n?"block":"none"),s||r._trigger(new IEvent(e,t),i)};let l=s.domEl,r=this;s.name&&Panel._add_reset_property(l.domName,function(a){this.style.display="none",t=[].concat(n),d(),r._trigger(new IEvent(e,t,a),i)});let o=document.createElement("div");o.className="lextags",o.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";let d=()=>{o.innerHTML="";for(let a=0;a<t.length;++a){let s=t[a],c=document.createElement("span");c.className="lextag",c.innerHTML=s;let h=document.createElement("a");h.className="lextagrmb fa-solid fa-xmark lexicon",c.appendChild(h),h.addEventListener("click",a=>{c.remove(),t.splice(t.indexOf(s),1);let o=l.querySelector(".lexwidgetname .lexicon");o&&(o.style.display=t!=n?"block":"none"),r._trigger(new IEvent(e,t,a),i)}),o.appendChild(c)}let u=document.createElement("input");u.value="",u.placeholder="Add tag...",o.appendChild(u),u.onkeydown=function(a){let n=this.value.replace(/\s/g,"");if(" "==a.key||"Enter"==a.key){if(a.preventDefault(),!n.length||t.indexOf(n)>-1)return;t.push(n),d();let s=l.querySelector(".lexwidgetname .lexicon");s&&(s.style.display="block"),r._trigger(new IEvent(e,t,a),i)}},u.focus()};return d(),s.name||(l.className+=" noname",o.style.width="100%"),l.appendChild(o),s}addCheckbox(e,t,i,a={}){if(!e)throw"Set Widget Name!";let n=this.create_widget(e,Widget.CHECKBOX,a);n.onGetValue=()=>r.checked,n.onSetValue=(e,t)=>{r.checked!==e&&(r.checked=e,Panel._dispatch_event(r,"change",t))};let s=n.domEl;Panel._add_reset_property(s.domName,function(){r.checked=!r.checked,Panel._dispatch_event(r,"change")});var l=document.createElement("div");l.className="lexcheckboxcont";let r=document.createElement("input");r.type="checkbox",r.className="lexcheckbox "+(a.className??""),r.checked=t,r.iValue=t,r.disabled=a.disabled??!1;let o=document.createElement("span");if(o.className="checkboxtext",o.innerHTML="On",l.appendChild(r),l.appendChild(o),r.addEventListener("change",t=>{let a=t.detail?.constructor==Number?null:t.detail;if(!a){let n=s.querySelector(".lexwidgetname .lexicon");n&&(n.style.display=r.checked!=r.iValue?"block":"none")}let l=s.querySelector(".lexcheckboxsubmenu");l&&l.toggleAttribute("hidden",!r.checked),a||this._trigger(new IEvent(e,r.checked,t),i)}),s.appendChild(l),a.suboptions){s.style.flexWrap="wrap";let d=document.createElement("div");d.className="lexcheckboxsubmenu",d.toggleAttribute("hidden",!r.checked),this.queue(d),a.suboptions.call(this,this),this.clearQueue(),s.appendChild(d)}return n}addToggle(e,t,i,a={}){if(!e)throw"Set Widget Name!";let n=this.create_widget(e,Widget.TOGGLE,a);n.onGetValue=()=>r.checked,n.onSetValue=(e,t)=>{r.checked!==e&&(r.checked=e,Panel._dispatch_event(r,"change",t))};let s=n.domEl;Panel._add_reset_property(s.domName,function(){r.checked=!r.checked,Panel._dispatch_event(r,"change")});var l=document.createElement("div");l.className="lextogglecont";let r=document.createElement("input");r.type="checkbox",r.className="lextoggle "+(a.className??""),r.checked=t,r.iValue=t,r.disabled=a.disabled??!1;let o=document.createElement("span");if(o.className="toggletext",o.innerHTML="On",l.appendChild(r),l.appendChild(o),r.addEventListener("change",t=>{let a=t.detail?.constructor==Number?null:t.detail;if(!a){let n=s.querySelector(".lexwidgetname .lexicon");n&&(n.style.display=r.checked!=r.iValue?"block":"none")}let l=s.querySelector(".lextogglesubmenu");l&&l.toggleAttribute("hidden",!r.checked),a||this._trigger(new IEvent(e,r.checked,t),i)}),s.appendChild(l),a.suboptions){s.style.flexWrap="wrap";let d=document.createElement("div");d.className="lextogglesubmenu",d.toggleAttribute("hidden",!r.checked),this.queue(d),a.suboptions.call(this,this),this.clearQueue(),s.appendChild(d)}return n}addColor(e,t,i,a={}){if(!e)throw"Set Widget Name!";let n=this.create_widget(e,Widget.COLOR,a);n.onGetValue=()=>o.value,n.onSetValue=(e,t)=>{o.value=e,Panel._dispatch_event(o,"input",t)};let s=n.domEl,l=!1;Panel._add_reset_property(s.domName,function(){this.style.display="none",o.value=o.iValue,Panel._dispatch_event(o,"input")});var r=document.createElement("span");r.className="lexcolor",r.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";let o=document.createElement("input");o.style.width="32px",o.type="color",o.className="colorinput",o.id="color"+simple_guidGenerator(),o.useRGB=a.useRGB??!1,o.value=o.iValue=t.constructor===Array?rgbToHex(t):t,a.disabled&&(o.disabled=!0),o.addEventListener("input",t=>{let a=t.target.value,n=t.detail;if(l||d.set(a),!n){let r=s.querySelector(".lexwidgetname .lexicon");r&&(r.style.display=a!=o.iValue?"block":"none")}o.useRGB&&(a=hexToRgb(a)),n||this._trigger(new IEvent(e,a,t),i)},!1),r.appendChild(o),this.queue(r);let d=this.addText(null,o.value,e=>{l=!0,n.set(e),l=!1},{width:"calc( 100% - 32px )"});return d.domEl.style.marginLeft="4px",this.clearQueue(),s.appendChild(r),n}addRange(e,t,i,a={}){let n=this.create_widget(e,Widget.RANGE,a);n.onGetValue=()=>+r.value,n.onSetValue=(e,t)=>{r.value=e,Panel._dispatch_event(r,"input",t)};let s=n.domEl;n.name&&Panel._add_reset_property(s.domName,function(){this.style.display="none",r.value=r.iValue,Panel._dispatch_event(r,"input")});var l=document.createElement("div");l.className="lexrange",l.style.width=a.inputWidth||"calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";let r=document.createElement("input");return r.className="lexrangeslider "+(a.className??""),r.value=r.iValue=t,r.min=a.min,r.max=a.max,r.step=a.step??1,r.type="range",r.disabled=a.disabled??!1,a.left&&r.classList.add("left"),(a.fill??!0)||r.classList.add("no-fill"),r.addEventListener("input",t=>{if(isNaN(t.target.valueAsNumber))return;let n=t.detail,l=t.target.value=clamp(+t.target.valueAsNumber,+r.min,+r.max);if(r.value=l,!n){let o=s.querySelector(".lexwidgetname .lexicon");o&&(o.style.display=l!=r.iValue?"block":"none")}a.left&&(l=+r.max-l+ +r.min),n||this._trigger(new IEvent(e,l,t),i)},{passive:!1}),r.addEventListener("mousedown",function(e){a.onPress&&a.onPress.bind(r)(e,r)},!1),r.addEventListener("mouseup",function(e){a.onRelease&&a.onRelease.bind(r)(e,r)},!1),n.setLimits=(e,t,i)=>{r.min=e??r.min,r.max=t??r.max,r.step=i??r.step,Panel._dispatch_event(r,"input",!0)},t.constructor==Number&&(t=clamp(t,+r.min,+r.max)),l.appendChild(r),s.appendChild(l),n.name||(s.className+=" noname",l.style.width="100%"),n}addNumber(e,t,i,a={}){let n=this.create_widget(e,Widget.NUMBER,a);n.onGetValue=()=>+o.value,n.onSetValue=(e,t)=>{o.value=round(e,a.precision),Panel._dispatch_event(o,"change",t)};let s=n.domEl;n.name&&Panel._add_reset_property(s.domName,function(){this.style.display="none",o.value=o.iValue,Panel._dispatch_event(o,"change")});var l=document.createElement("div");l.className="lexnumber",l.style.width=a.inputWidth||"calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";let r=document.createElement("div");r.className="numberbox";let o=document.createElement("input");if(o.id="number_"+simple_guidGenerator(),o.className="vecinput",o.min=a.min??-1e24,o.max=a.max??1e24,o.step=a.step??"any",o.type="number",t.constructor==Number&&(t=clamp(t,+o.min,+o.max),t=round(t,a.precision)),o.value=o.iValue=t,r.appendChild(o),a.units){let d=document.createElement("span");d.className="lexunit",d.innerText=a.units,d.style.left=measureRealWidth(o.value)+"px",o.unitSpan=d,r.appendChild(d)}let c=document.createElement("a");if(c.className="fa-solid fa-arrows-up-down drag-icon hidden",r.appendChild(c),a.disabled&&(o.disabled=!0),!a.skipSlider&&void 0!==a.min&&void 0!==a.max){let h=document.createElement("input");h.className="lexinputslider",h.min=a.min,h.max=a.max,h.step=a.step??1,h.type="range",h.value=t,h.addEventListener("input",function(e){let t=+this.valueAsNumber;o.value=round(t,a.precision),Panel._dispatch_event(o,"change")},!1),h.addEventListener("mousedown",function(e){a.onPress&&a.onPress.bind(h)(e,h)},!1),h.addEventListener("mouseup",function(e){a.onRelease&&a.onRelease.bind(h)(e,h)},!1),r.appendChild(h),n.setLimits=(e,t,i)=>{o.min=h.min=e??o.min,o.max=h.max=t??o.max,o.step=i??o.step,h.step=i??h.step,Panel._dispatch_event(o,"change",!0)}}o.addEventListener("input",function(e){let t=+this.valueAsNumber;o.value=round(t,a.precision),a.units&&(o.unitSpan.style.left=measureRealWidth(o.value)+"px")},!1),o.addEventListener("wheel",function(e){if(e.preventDefault(),this!==document.activeElement)return;let t=a.step??1;e.shiftKey?t*=10:e.altKey&&(t*=.1);let i=+this.valueAsNumber-t*(e.deltaY>0?1:-1);this.value=round(i,a.precision),Panel._dispatch_event(o,"change")},{passive:!1}),o.addEventListener("change",t=>{if(isNaN(t.target.valueAsNumber))return;let n=t.detail,l=t.target.value=clamp(+t.target.valueAsNumber,+o.min,+o.max);if(l=a.precision?round(l,a.precision):l,r.querySelector(".lexinputslider")&&(r.querySelector(".lexinputslider").value=l),o.value=l,a.units&&(o.unitSpan.style.left=measureRealWidth(o.value)+"px"),!n){let d=s.querySelector(".lexwidgetname .lexicon");d&&(d.style.display=l!=o.iValue?"block":"none")}n||this._trigger(new IEvent(e,l,t),i)},{passive:!1}),o.addEventListener("mousedown",function e(t){if(document.activeElement!=o){var i=u.root.ownerDocument;i.addEventListener("mousemove",p),i.addEventListener("mouseup",m),document.body.classList.add("noevents"),c.classList.remove("hidden"),t.stopImmediatePropagation(),t.stopPropagation(),document.pointerLockElement||o.requestPointerLock(),a.onPress&&a.onPress.bind(o)(t,o)}});var u=this;function p(e){let t=-e.movementY;if(0!=t){let i=a.step??1;e.shiftKey?i*=10:e.altKey&&(i*=.1);let n=+o.valueAsNumber+i*t;o.value=(+n).toFixed(4).replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1"),Panel._dispatch_event(o,"change")}e.stopPropagation(),e.preventDefault()}function m(e){var t=u.root.ownerDocument;t.removeEventListener("mousemove",p),t.removeEventListener("mouseup",m),document.body.classList.remove("noevents"),c.classList.add("hidden"),document.pointerLockElement&&document.exitPointerLock(),a.onRelease&&a.onRelease.bind(o)(e,o)}return l.appendChild(r),s.appendChild(l),n.name||(s.className+=" noname",l.style.width="100%"),n}static VECTOR_COMPONENTS={0:"x",1:"y",2:"z",3:"w"};_add_vector(e,t,i,a,n={}){if(e=clamp(e,2,4),i=i??Array(e).fill(0),!t)throw"Set Widget Name!";let s=this.create_widget(t,Widget.VECTOR,n);s.onGetValue=()=>{let e=l.querySelectorAll("input"),t=[];for(var i of e)t.push(+i.value);return t},s.onSetValue=(e,t)=>{let i=l.querySelectorAll(".vecinput");if(i.length==e.length){console.error("Input length does not match vector length.");return}for(let a=0;a<i.length;++a){let s=e[a];i[a].value=round(s,n.precision)??0,Panel._dispatch_event(i[a],"change",t)}};let l=s.domEl;Panel._add_reset_property(l.domName,function(){for(let e of(this.style.display="none",l.querySelectorAll(".vecinput")))e.value=e.iValue,Panel._dispatch_event(e,"change")});var r=document.createElement("div");r.className="lexvector",r.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";for(let o=0;o<e;++o){let d=document.createElement("div");d.className="vecbox",d.innerHTML="<span class='"+Panel.VECTOR_COMPONENTS[o]+"'></span>";let c=document.createElement("input");c.className="vecinput v"+e,c.min=n.min??-1e24,c.max=n.max??1e24,c.step=n.step??"any",c.type="number",c.id="vec"+e+"_"+simple_guidGenerator(),c.idx=o,i[o].constructor==Number&&(i[o]=clamp(i[o],+c.min,+c.max),i[o]=round(i[o],n.precision)),c.value=c.iValue=i[o];let h=document.createElement("a");h.className="fa-solid fa-arrows-up-down drag-icon hidden",d.appendChild(h),n.disabled&&(c.disabled=!0),c.addEventListener("wheel",function(e){if(e.preventDefault(),this!==document.activeElement)return;let t=n.step??1;if(e.shiftKey?t=10:e.altKey&&(t=.1),f.locked)for(let i of l.querySelectorAll(".vecinput"))i.value=round(+i.valueAsNumber-t*(e.deltaY>0?1:-1),n.precision),Panel._dispatch_event(i,"change");else this.value=round(+this.valueAsNumber-t*(e.deltaY>0?1:-1),n.precision),Panel._dispatch_event(c,"change")},{passive:!1}),c.addEventListener("change",e=>{if(isNaN(e.target.value))return;let s=e.detail,r=e.target.value=clamp(e.target.value,+c.min,+c.max);if(r=round(r,n.precision),!s){let o=l.querySelector(".lexwidgetname .lexicon");o&&(o.style.display=r!=c.iValue?"block":"none")}if(f.locked)for(let d of l.querySelectorAll(".vecinput"))d.value=r,i[d.idx]=r;else c.value=r,i[e.target.idx]=r;s||this._trigger(new IEvent(t,i,e),a)},!1),c.addEventListener("mousedown",p);var u=this;function p(e){if(document.activeElement!=c){var t=u.root.ownerDocument;t.addEventListener("mousemove",m),t.addEventListener("mouseup",g),document.body.classList.add("noevents"),h.classList.remove("hidden"),e.stopImmediatePropagation(),e.stopPropagation(),document.pointerLockElement||c.requestPointerLock(),n.onPress&&n.onPress.bind(c)(e,c)}}function m(e){let t=-e.movementY;if(0!=t){let i=n.step??1;if(e.shiftKey?i=10:e.altKey&&(i=.1),f.locked)for(let a of l.querySelectorAll(".vecinput"))a.value=round(+a.valueAsNumber+i*t,n.precision),Panel._dispatch_event(a,"change");else c.value=round(+c.valueAsNumber+i*t,n.precision),Panel._dispatch_event(c,"change")}e.stopPropagation(),e.preventDefault()}function g(e){var t=u.root.ownerDocument;t.removeEventListener("mousemove",m),t.removeEventListener("mouseup",g),document.body.classList.remove("noevents"),h.classList.add("hidden"),document.pointerLockElement&&document.exitPointerLock(),n.onRelease&&n.onRelease.bind(c)(e,c)}d.appendChild(c),r.appendChild(d)}(void 0!==n.min||void 0!==n.max)&&(s.setLimits=(e,n,s)=>{let r=l.querySelectorAll(".vecinput");for(let o of r)o.min=e??o.min,o.max=n??o.max,o.step=s??o.step,Panel._dispatch_event(o,"change",!0);this._trigger(new IEvent(t,i),a)});let f=document.createElement("a");return f.title="Lock",f.className="fa-solid fa-lock-open lexicon lock",r.appendChild(f),f.addEventListener("click",function(e){this.locked=!this.locked,this.locked?(this.classList.add("fa-lock"),this.classList.remove("fa-lock-open")):(this.classList.add("fa-lock-open"),this.classList.remove("fa-lock"))},!1),l.appendChild(r),s}addVector2(e,t,i,a){return this._add_vector(2,e,t,i,a)}addVector3(e,t,i,a){return this._add_vector(3,e,t,i,a)}addVector4(e,t,i,a){return this._add_vector(4,e,t,i,a)}addSize(e,t,i,a={}){let n=this.create_widget(e,Widget.SIZE,a);n.onGetValue=()=>{let e=[];for(let t=0;t<s.dimensions.length;++t)e.push(s.dimensions[t].onGetValue());return e},n.onSetValue=(e,t)=>{for(let i=0;i<s.dimensions.length;++i)s.dimensions[i].onSetValue(e[i],t)};let s=n.domEl;this.queue(s),s.aspectRatio=2==t.length?t[0]/t[1]:null,s.dimensions=[];for(let l=0;l<t.length;++l)if(s.dimensions[l]=this.addNumber(null,t[l],e=>{let t=n.onGetValue();if(s.locked){let a=0==l?1/s.aspectRatio:s.aspectRatio,r=(1+l)%2;t[r]=e*a,s.dimensions[r].onSetValue(t[r],!0)}i&&i(t)},{min:0,disabled:a.disabled,precision:a.precision}),l+1!=t.length){let r=document.createElement("a");r.className="lexsizecross fa-solid fa-xmark",s.appendChild(r)}if(this.clearQueue(),a.units){let o=document.createElement("span");o.className="lexunit",o.innerText=a.units,s.appendChild(o)}if(s.aspectRatio){let d=document.createElement("a");d.title="Lock Aspect Ratio",d.className="fa-solid fa-lock-open lexicon lock",s.appendChild(d),d.addEventListener("click",function(e){if(s.locked=!s.locked,s.locked){this.classList.add("fa-lock"),this.classList.remove("fa-lock-open");let t=n.onGetValue();s.aspectRatio=t[0]/t[1]}else this.classList.add("fa-lock-open"),this.classList.remove("fa-lock")},!1)}return n.name||(s.className+=" noname",container.style.width="100%"),n}addPad(e,t,i,a={}){if(!e)throw"Set Widget Name!";let n=this.create_widget(e,Widget.PAD,a);n.onGetValue=()=>o.value.xy,n.onSetValue=(t,a)=>{o.value.set(t[0],t[1]),d(o.value),a||this._trigger(new IEvent(e,o.value.xy),i)};let s=n.domEl;var l=document.createElement("div");l.className="lexpad",l.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";let r=document.createElement("div");r.id="lexpad-"+e,r.className="lexinnerpad",r.style.width=a.padSize??"96px",r.style.height=a.padSize??"96px";let o=document.createElement("div");o.className="lexpadthumb",o.value=new LX.vec2(t[0],t[1]),o.min=a.min??0,o.max=a.max??1;let d=e=>{let[t,i]=[r.offsetWidth,r.offsetHeight],a=new LX.vec2(remapRange(e.x,o.min,o.max,0,1),remapRange(e.y,o.min,o.max,0,1));o.style.transform=`translate(calc( ${t*a.x}px - 50% ), calc( ${i*a.y}px - 50%)`};doAsync(()=>{d(o.value)}),r.appendChild(o),l.appendChild(r),s.appendChild(l),r.addEventListener("mousedown",function e(t){if(document.activeElement!=o){var i=c.root.ownerDocument;i.addEventListener("mousemove",h),i.addEventListener("mouseup",u),document.body.classList.add("nocursor"),document.body.classList.add("noevents"),t.stopImmediatePropagation(),t.stopPropagation(),a.onPress&&a.onPress.bind(o)(t,o)}});let c=this;function h(t){let a=r.getBoundingClientRect(),n=new LX.vec2(t.x-a.x,t.y-a.y);n.clp(0,r.offsetWidth,n);let[s,l]=[r.offsetWidth,r.offsetHeight],d=n.div(new LX.vec2(r.offsetWidth,r.offsetHeight));o.style.transform=`translate(calc( ${s*d.x}px - 50% ), calc( ${l*d.y}px - 50%)`,o.value=new LX.vec2(remapRange(d.x,0,1,o.min,o.max),remapRange(d.y,0,1,o.min,o.max)),c._trigger(new IEvent(e,o.value.xy,t),i),t.stopPropagation(),t.preventDefault()}function u(e){var t=c.root.ownerDocument;t.removeEventListener("mousemove",h),t.removeEventListener("mouseup",u),document.body.classList.remove("nocursor"),document.body.classList.remove("noevents"),a.onRelease&&a.onRelease.bind(o)(e,o)}return n}addProgress(e,t,i={}){if(!e)throw"Set Widget Name!";let a=this.create_widget(e,Widget.PROGRESS,i);a.onGetValue=()=>l.value,a.onSetValue=(e,t)=>{n.querySelector("meter").value=e,r(),n.querySelector("span")&&(n.querySelector("span").innerText=e)};let n=a.domEl;var s=document.createElement("div");s.className="lexprogress",s.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";let l=document.createElement("meter");l.id="lexprogressbar-"+e,l.className="lexprogressbar",l.step="any",l.min=i.min??0,l.max=i.max??1,l.low=i.low??l.low,l.high=i.high??l.high,l.optimum=i.optimum??l.optimum,l.value=t;let r=()=>{let e=LX.getThemeColor("global-selected");void 0!=l.low&&l.value<l.low?e=LX.getThemeColor("global-color-error"):void 0!=l.high&&l.value<l.high&&(e=LX.getThemeColor("global-color-warning")),l.style.background=`color-mix(in srgb, ${e} 20%, transparent)`};if(s.appendChild(l),n.appendChild(s),i.showValue){document.getElementById("progressvalue-"+e)&&document.getElementById("progressvalue-"+e).remove();let o=document.createElement("span");o.id="progressvalue-"+e,o.style.padding="0px 5px",o.innerText=t,s.appendChild(o)}if(i.editable){l.classList.add("editable"),l.addEventListener("mousedown",function t(i){var a=d.root.ownerDocument;a.addEventListener("mousemove",c),a.addEventListener("mouseup",h),document.body.classList.add("noevents"),l.classList.add("grabbing"),i.stopImmediatePropagation(),i.stopPropagation();let n=l.getBoundingClientRect(),s=round(remapRange(i.offsetX,0,n.width,l.min,l.max));d.setValue(e,s)});let d=this;function c(t){if(0!=t.movementX){let a=l.getBoundingClientRect(),n=round(remapRange(t.offsetX-a.x,0,a.width,l.min,l.max));d.setValue(e,n),i.callback&&i.callback(n,t)}t.stopPropagation(),t.preventDefault()}function h(e){var t=d.root.ownerDocument;t.removeEventListener("mousemove",c),t.removeEventListener("mouseup",h),document.body.classList.remove("noevents"),l.classList.remove("grabbing")}}return r(),a}addFile(e,t,i={}){if(!e)throw"Set Widget Name!";let a=this.create_widget(e,Widget.FILE,i),n=a.domEl,s=i.local??!0,l=i.type??"text",r=i.read??!0,o=document.createElement("input");if(o.className="lexfileinput",o.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+" - 10%)",o.type="file",o.disabled=i.disabled??!1,i.placeholder&&(o.placeholder=i.placeholder),o.addEventListener("change",function(e){let a=e.target.files;if(a.length){if(r){i.onBeforeRead&&i.onBeforeRead();let n=new FileReader;"text"===l?n.readAsText(a[0]):"buffer"===l?n.readAsArrayBuffer(a[0]):"bin"===l?n.readAsBinaryString(a[0]):"url"===l&&n.readAsDataURL(a[0]),n.onload=e=>{t.call(this,e.target.result,a[0])}}else t(a[0])}}),o.addEventListener("cancel",function(e){t(null)}),n.appendChild(o),this.queue(n),s){let d=null;this.addButton(null,"<a style='margin-top: 0px;' class='fa-solid fa-gear'></a>",()=>{!d&&(d=new Dialog("Load Settings",e=>{e.addDropdown("Type",["text","buffer","bin","url"],l,e=>{l=e}),e.addButton(null,"Reload",e=>{o.dispatchEvent(new Event("change"))})},{onclose(e){e.remove(),d=null}}))},{className:"micro",skipInlineCount:!0,title:"Settings"})}return this.clearQueue(),a}addTree(e,t,i={}){let a=document.createElement("div");if(a.className="lextree",e){let n=document.createElement("span");n.innerHTML=e,a.appendChild(n)}let s=document.createElement("div");if(s.className="lextreetools",e||(s.className+=" notitle"),i.icons)for(let l of i.icons){let r=document.createElement("a");r.title=l.name,r.className="lexicon "+l.icon,r.addEventListener("click",l.callback),s.appendChild(r)}i.filter=i.filter??!0;let o=null;if(i.filter){(o=document.createElement("input")).id="lexnodetree_filter",o.setAttribute("placeholder","Filter.."),o.style.width="calc( 100% - 17px )",o.addEventListener("input",function(){h.refresh()});let d=document.createElement("a");d.className="lexicon fa-solid fa-magnifying-glass",s.appendChild(o),s.appendChild(d)}(i.icons||i.filter)&&a.appendChild(s);let c=document.createElement("ul");c.addEventListener("contextmenu",function(e){e.preventDefault()}),a.appendChild(c),this.root.appendChild(a);let h=new NodeTree(a,t,i);return h}addSeparator(){var e=document.createElement("div");e.className="lexseparator";let t=new Widget(null,Widget.SEPARATOR);t.domEl=e,this.current_branch?(this.current_branch.content.appendChild(e),this.current_branch.widgets.push(t)):this.root.appendChild(e)}addTabs(e,t={}){let i=this.current_branch?this.current_branch.content:this.root;if(this.current_branch||console.warn("No current branch!"),e.constructor!=Array)throw"Param @tabs must be an Array!";let a=t.vertical??!0,n=!a&&(t.showNames??!1),s=document.createElement("div");s.className="lextabscontainer",a||(s.className+=" horizontal");let l=document.createElement("div");l.className="tabs",s.appendChild(l),i.appendChild(s);for(let r=0;r<e.length;++r){let o=e[r];console.assert(o.name);let d=0==r,c=document.createElement("div");c.className="lextab "+(r==e.length-1?"last":"")+(d?"selected":""),c.innerHTML=(n?o.name:"")+"<a class='"+(o.icon||"fa fa-hashtag")+" "+(n?"withname":"")+"'></a>",c.title=o.name;let h=document.createElement("div");h.id=o.name.replace(/\s/g,""),h.className="widgets",d||h.toggleAttribute("hidden",!0),s.appendChild(h),c.addEventListener("click",e=>{l.querySelectorAll(".lextab").forEach(e=>{e.classList.remove("selected")}),e.target.classList.add("selected"),s.querySelectorAll(".widgets").forEach(e=>{e.toggleAttribute("hidden",!0)});let t=s.querySelector("#"+h.id);t.toggleAttribute("hidden"),o.onSelect&&o.onSelect(this,h)}),l.appendChild(c),o.onCreate&&(this.queue(h),o.onCreate(this,h),this.clearQueue())}this.addSeparator()}addCounter(e,t,i,a={}){let n=this.create_widget(e,Widget.COUNTER,a);n.onGetValue=()=>u.count,n.onSetValue=(e,t)=>{d(e,t)};let s=n.domEl,l=a.min??0,r=a.max??100,o=a.step??1,d=(t,a,n)=>{t=clamp(t,l,r),u.count=t,u.innerHTML=t,a||this._trigger(new IEvent(e,t,n),i)},c=document.createElement("div");c.className="lexcounter",s.appendChild(c),this.queue(c),this.addButton(null,"<a style='margin-top: 0px;' class='fa-solid fa-minus'></a>",(e,t)=>{let i=o??1;t.shiftKey&&(i*=10),d(u.count-i,!1,t)},{className:"micro",skipInlineCount:!0,title:"Minus"}),this.clearQueue();let h=document.createElement("div");h.className="lexcounterbox",c.appendChild(h);let u=document.createElement("span");if(u.className="lexcountervalue",u.innerHTML=t,u.count=t,h.appendChild(u),a.label){let p=document.createElement("span");p.className="lexcounterlabel",p.innerHTML=a.label,h.appendChild(p)}return this.queue(c),this.addButton(null,"<a style='margin-top: 0px;' class='fa-solid fa-plus'></a>",(e,t)=>{let i=o??1;t.shiftKey&&(i*=10),d(u.count+i,!1,t)},{className:"micro",skipInlineCount:!0,title:"Plus"}),this.clearQueue(),n}addTable(e,t,i={}){if(!t)throw"Data is needed to create a table!";let a=this.create_widget(e,Widget.TABLE,i);a.onGetValue=()=>{},a.onSetValue=(e,t)=>{};let n=a.domEl,s=document.createElement("div");s.className="lextable",s.style.width="calc( 100% - "+LX.DEFAULT_NAME_WIDTH+")";let l=document.createElement("table");function r(e,t,i,a){return i[e]<a[e]?-t:i[e]>a[e]?t:0}return s.appendChild(l),t.head=t.head??[],t.body=t.body??[],t.orderMap={},t.checkMap={},a.refreshTable=()=>{l.innerHTML="";{let e=document.createElement("thead");e.className="lextablehead",l.appendChild(e);let n=document.createElement("tr");if(i.selectable){let s=document.createElement("th"),o=document.createElement("input");o.type="checkbox",o.className="lexcheckbox",o.checked=t.checkMap[":root"]??!1,s.appendChild(o),o.addEventListener("change",function(){t.checkMap[":root"]=this.checked;let e=l.querySelector("tbody");for(let i of e.childNodes)t.checkMap[i.getAttribute("rowId")]=this.checked,i.querySelector("input").checked=this.checked}),n.appendChild(s)}for(let d of t.head){let c=document.createElement("th");c.innerHTML=`${d} <a class="fa-solid fa-sort"></a>`,c.querySelector("a").addEventListener("click",()=>{t.orderMap[d]||(t.orderMap[d]=1);let e=t.head.indexOf(d);t.body=t.body.sort(r.bind(this,e,t.orderMap[d])),t.orderMap[d]=-t.orderMap[d],a.refreshTable()}),n.appendChild(c)}if(i.rowActions){let h=document.createElement("th");h.className="sm",n.appendChild(h)}e.appendChild(n)}{let u=document.createElement("tbody");u.className="lextablebody",l.appendChild(u);for(let p=0;p<t.body.length;++p){let m=t.body[p],g=document.createElement("tr"),f=LX.getSupportedDOMName(m.join("-"));if(g.setAttribute("rowId",f),i.selectable){let v=document.createElement("td"),E=document.createElement("input");E.type="checkbox",E.className="lexcheckbox",E.checked=t.checkMap[f],v.appendChild(E),E.addEventListener("change",function(){t.checkMap[f]=this.checked}),g.appendChild(v)}for(let y of m){let $=document.createElement("td");$.innerHTML=`${y}`,g.appendChild($)}if(i.rowActions){let x=document.createElement("td");x.className="sm";let L=document.createElement("div");for(let b of(L.className="lextablebuttons",x.appendChild(L),i.rowActions)){let w=document.createElement("a");w.className="lexicon","delete"==b?(w.className+=" fa-solid fa-trash-can",w.addEventListener("click",function(){t.body.splice(p,1),g.remove()})):"menu"==b?(w.className+=" fa-solid fa-ellipsis",w.addEventListener("click",function(e){addContextMenu(null,e,e=>{if(i.onMenuAction){i.onMenuAction(e);return}console.warn("Using <Menu action> without action callbacks.")})})):(console.assert(b.constructor==Object),w.className+=` ${b.icon}`),L.appendChild(w)}g.appendChild(x)}u.appendChild(g)}}},a.refreshTable(),a.name||(n.className+=" noname",s.style.width="100%"),n.appendChild(s),a}}LX.Panel=Panel;class Branch{constructor(e,t={}){this.name=e;var i=document.createElement("div");i.className="lexbranch",t.id&&(i.id=t.id),t.className&&(i.className+=" "+t.className),i.style.width="calc(100% - 7px)",i.style.margin="0 auto";var a=this;this.root=i,this.widgets=[];var n=document.createElement("div");n.className="lexbranchtitle",n.innerHTML="<a class='fa-solid fa-angle-up switch-branch-button'></a>",t.icon&&(n.innerHTML+="<a class='branchicon "+t.icon+"' style='margin-right: 8px; margin-bottom: -2px;'>"),n.innerHTML+=e||"Branch",i.appendChild(n);var s=document.createElement("div");s.id=e.replace(/\s/g,""),s.className="lexbranchcontent",i.appendChild(s),this.content=s,this._addBranchSeparator(),t.closed&&(n.className+=" closed",i.className+=" closed",this.grabber.setAttribute("hidden",!0),doAsync(()=>{this.content.setAttribute("hidden",!0)},15)),this.onclick=function(e){e.stopPropagation(),this.classList.toggle("closed"),this.parentElement.classList.toggle("closed"),a.content.toggleAttribute("hidden"),a.grabber.toggleAttribute("hidden"),LX.emit("@on_branch_closed",this.classList.contains("closed"),{target:a.panel})},this.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation(),!this.parentElement.classList.contains("dialog")&&addContextMenu("Dock",e,t=>{e.preventDefault(),t.add("Floating",a._on_make_floating.bind(a))},{icon:"fa-regular fa-window-restore"})},n.addEventListener("click",this.onclick),n.addEventListener("contextmenu",this.oncontextmenu)}_on_make_floating(){let e=new Dialog(this.name,e=>{for(let t of this.widgets)e.root.appendChild(t.domEl)});e.widgets=this.widgets;let t=this.root.parentElement;this.root.remove();let i=t.querySelector(".lexbranch");i&&i.classList.add("first");let a=t.querySelectorAll(".lexbranch");a.length&&a[a.length-1].classList.add("last")}_addBranchSeparator(){let e=document.createElement("div");e.className="lexwidgetseparator",e.style.width="100%",e.style.background="none";let t=document.createElement("div");t.innerHTML="&#9662;",e.appendChild(t),doAsync(()=>{t.style.marginLeft=parseFloat(LX.DEFAULT_NAME_WIDTH)/100*this.content.offsetWidth+"px"},10);let i=document.createElement("div");i.style.width="1px",i.style.marginLeft="6px",i.style.marginTop="2px",i.style.height="0px",t.appendChild(i),t.addEventListener("mousedown",function e(t){var l=a.root.ownerDocument;l.addEventListener("mouseup",s),l.addEventListener("mousemove",n),t.stopPropagation(),t.preventDefault();let r=a.root.offsetHeight-a.root.children[0].offsetHeight;i.style.height=r-3+"px",document.body.classList.add("nocursor")}),this.grabber=t;let a=this;function n(e){let i=e.movementX;if(0!=i){let n=parseFloat(t.style.marginLeft);t.style.marginLeft=clamp(n+i,32,a.content.offsetWidth-32)+"px"}}function s(e){a._updateWidgets(),i.style.height="0px";var t=a.root.ownerDocument;t.removeEventListener("mouseup",s),t.removeEventListener("mousemove",n),document.body.classList.remove("nocursor")}this.content.appendChild(e)}_updateWidgets(){for(var e=this.grabber.style.marginLeft,t=0;t<this.widgets.length;t++){let i=this.widgets[t],a=i.domEl;if(a.children.length<2)continue;var n=a.children[0],s=a.children[1];n.style.width=e;let l="0px";i.type===Widget.FILE&&(l="10%"),s.style.width="-moz-calc( 100% - "+e+" - "+l+" )",s.style.width="-webkit-calc( 100% - "+e+" - "+l+" )",s.style.width="calc( 100% - "+e+" - "+l+" )",i.onresize&&i.onresize()}}}LX.Branch=Branch;class Footer{constructor(e={}){let t=document.createElement("footer");t.className="lexfooter";let i=document.createElement("div");if(i.className="wrapper",t.appendChild(i),e.columns&&e.columns.constructor==Array){let a=document.createElement("div");for(let n of(a.className="columns",a.style.gridTemplateColumns="1fr ".repeat(e.columns.length),i.appendChild(a),e.columns)){let s=document.createElement("div");s.className="col",a.appendChild(s);let l=document.createElement("h2");if(l.innerHTML=n.title,s.appendChild(l),!n.items||!n.items.length)continue;let r=document.createElement("ul");for(let o of(s.appendChild(r),n.items)){let d=document.createElement("li");d.innerHTML=`<a class="" href="${o.link}">${o.title}</a>`,r.appendChild(d)}}}if(e.credits||e.socials){let c=document.createElement("hr");i.appendChild(c);let h=document.createElement("div");if(h.className="credits-and-socials",i.appendChild(h),e.credits){let u=document.createElement("p");u.innerHTML=e.credits,h.appendChild(u)}if(e.socials){let p=document.createElement("div");for(let m of(p.className="social",e.socials)){let g=document.createElement("a");g.title=m.title,g.innerHTML=m.icon,g.href=m.link,g.target="_blank",p.appendChild(g)}h.appendChild(p)}}let f=e.parent??document.body;f.appendChild(t)}}LX.Footer=Footer;class Dialog{static _last_id=0;constructor(e,t,i={}){t||console.warn("Content is empty, add some widgets using 'callback' parameter!"),this._oncreate=t,this.id=simple_guidGenerator();let a=i.size??[],n=i.position??[],s=i.draggable??!0,l=i.modal??!1;var r=document.createElement("dialog");r.className="lexdialog "+(i.className??""),r.id=i.id??"dialog"+Dialog._last_id++,LX.root.appendChild(r),doAsync(()=>{l?r.showModal():r.show()},10);let o=this;var d=document.createElement("div");if(e&&(d.className="lexdialogtitle",d.innerHTML=e,d.setAttribute("draggable",!1),d.oncontextmenu=function(t){t.preventDefault(),t.stopPropagation(),LX.main_area&&"horizontal"===LX.main_area.type&&addContextMenu("Dock",t,i=>{t.preventDefault();let a=function(e){let t=e.panels[0];if(t)return t;for(var i of e.sections)if(t=a(i))return t},n=function(t){let i=t.branches.find(t=>t.name===e);for(let a of(i?t.root.appendChild(i.root):(t.branch(e),i=t.branches.find(t=>t.name===e)),o.widgets))i.content.appendChild(a.domEl);i.widgets=o.widgets,t.root.querySelectorAll(".lexbranch.last").forEach(e=>{e.classList.remove("last")}),i.root.classList.add("last"),r.remove()},s=a(LX.main_area.sections[1]);i.add('<i class="fa-regular fa-window-maximize fa-window-maximize fa-rotate-90">',{disabled:!s,id:"dock_options0",callback(){n(s)}});let l=a(LX.main_area.sections[0]);i.add('<i class="fa-regular fa-window-maximize fa-window-maximize fa-rotate-270">',{disabled:!l,id:"dock_options1",callback(){n(l)}})},{icon:"fa-regular fa-window-restore"})},r.appendChild(d)),i.closable??!0){this.close=()=>{i.onBeforeClose&&i.onBeforeClose(this),i.onclose?i.onclose(this.root):(r.close(),doAsync(()=>{o.panel.clear(),r.remove()},150))};var c=document.createElement("a");c.className="lexdialogcloser fa-solid fa-xmark",c.title="Close",c.addEventListener("click",this.close),e?d.appendChild(c):(c.classList.add("notitle"),r.appendChild(c))}let h=new Panel;h.root.classList.add("lexdialogcontent"),e||h.root.classList.add("notitle"),t&&t.call(this,h),r.appendChild(h.root),h.root.querySelectorAll(".lexbranch").forEach(e=>e.classList.add("dialog")),this.panel=h,this.root=r,this.title=d,s&&makeDraggable(r,Object.assign({targetClass:"lexdialogtitle"},i)),a.length&&"string"!=typeof a[0]&&(a[0]+="px"),a.length&&"string"!=typeof a[1]&&(a[1]+="px"),r.style.width=a[0]?a[0]:"25%",r.style.height=a[1]?a[1]:"auto",r.style.margin="auto",i.size&&(this.size=a),i.position&&(r.style.margin="unset"),r.style.left=n[0]??"0",r.style.top=n[1]??"0",h.root.style.width="calc( 100% - 30px )",h.root.style.height=e?"calc( 100% - "+(d.offsetHeight+30)+"px )":"calc( 100% - 51px )"}destroy(){this.root.remove()}refresh(){this.panel.root.innerHTML="",this._oncreate.call(this,this.panel)}setPosition(e,t){this.root.style.left=e+"px",this.root.style.top=t+"px"}setTitle(e){let t=this.root.querySelector(".lexdialogtitle");t&&(t.innerText=e)}}LX.Dialog=Dialog;class PocketDialog extends Dialog{static TOP=0;static BOTTOM=1;constructor(e,t,i={}){i.draggable=i.draggable??!1,i.closable=i.closable??!1;super(e,t,i);let a=this;if(LX.addSignal("@on_branch_closed",this.panel,e=>{this.dock_pos==PocketDialog.BOTTOM&&(this.root.style.top="calc(100% - "+(this.root.offsetHeight+3)+"px)")}),this.root.classList.add("pocket"),this.root.style.left="unset",i.position||(this.root.style.right="3px",this.root.style.top="3px"),this.panel.root.style.width="calc( 100% - 12px )",this.panel.root.style.height="calc( 100% - 40px )",this.dock_pos=PocketDialog.TOP,this.minimized=!1,this.title.tabIndex=-1,this.title.addEventListener("click",e=>{this.size&&(this.minimized?this.root.style.height=this.size[1]:this.root.style.height="auto"),this.root.classList.toggle("minimized"),this.minimized=!this.minimized,this.dock_pos==PocketDialog.BOTTOM&&(a.root.style.top=this.root.classList.contains("minimized")?"calc(100% - "+(a.title.offsetHeight+6)+"px)":"calc(100% - "+(a.root.offsetHeight+3)+"px)")}),!i.draggable){let n=i.float;if(n)for(var s=0;s<n.length;s++){let l=n[s];switch(l){case"b":this.root.style.top="calc(100% - "+(this.root.offsetHeight+3)+"px)";break;case"l":this.root.style.right="unset",this.root.style.left=i.position?i.position[1]:"3px"}}this.root.classList.add("dockable"),this.title.addEventListener("keydown",function(e){e.ctrlKey&&(a.root.style.right="unset","ArrowLeft"==e.key?a.root.style.left="0px":"ArrowRight"==e.key?a.root.style.left="calc(100% - "+(a.root.offsetWidth+3)+"px)":"ArrowUp"==e.key?(a.root.style.top="0px",a.dock_pos=PocketDialog.TOP):"ArrowDown"==e.key&&(a.root.style.top="calc(100% - "+(a.root.offsetHeight+3)+"px)",a.dock_pos=PocketDialog.BOTTOM))})}}}LX.PocketDialog=PocketDialog;class ContextMenu{constructor(e,t,i={}){if(document.body.querySelectorAll(".lexcontextmenu").forEach(e=>e.remove()),this.root=document.createElement("div"),this.root.className="lexcontextmenu",this.root.style.left=e.x-48+document.scrollingElement.scrollLeft+"px",this.root.style.top=e.y-8+document.scrollingElement.scrollTop+"px",this.root.addEventListener("mouseleave",function(){this.remove()}),this.items=[],this.colors={},t){let a={};a[t]=[],a.className="cmtitle",a.icon=i.icon,this.items.push(a)}}_adjust_position(e,t,i=!1){let a=e.getBoundingClientRect();if(i){let n=window.innerWidth-a.right;n<0&&(e.style.left=e.offsetLeft+(n-t)+"px"),(n=window.innerHeight-(a.top+a.height))<0&&(e.style.top=e.offsetTop+(n-t+20)+"px")}else{let s=a.width;a.left<0?e.style.left=t+"px":window.innerWidth-a.right<0&&(e.style.left=window.innerWidth-s-t+"px"),a.top<0?e.style.top=t+"px":a.top+a.height>window.innerHeight&&(e.style.top=window.innerHeight-a.height-t+"px")}}_create_submenu(e,t,i,a){this.root.querySelectorAll(".lexcontextmenu").forEach(e=>e.remove());let n=document.createElement("div");n.className="lexcontextmenu",i.appendChild(n);for(var s=0;s<e[t].length;++s){let l=e[t][s],r=Object.keys(l)[0];this._create_entry(l,r,n,a)}var o=i.getBoundingClientRect();n.style.left=o.width+"px",n.style.marginTop=3.5-i.offsetHeight+"px",this._adjust_position(n,6,!0)}_create_entry(e,t,i,a){let n=e[t].length,s=document.createElement("div");s.className="lexmenuboxentry"+(e.className?" "+e.className:""),s.id=e.id??"eId"+getSupportedDOMName(t),s.innerHTML="";let l=e.icon;l&&(s.innerHTML+="<a class='"+l+" fa-sm'></a>");let r=e.disabled;if(s.innerHTML+="<div class='lexentryname"+(r?" disabled":"")+"'>"+t+"</div>",i.appendChild(s),this.colors[t]&&(s.style.borderColor=this.colors[t]),""==t){s.className+=" cmseparator";return}if(s.addEventListener("click",i=>{if(i.stopPropagation(),i.stopImmediatePropagation(),r)return;let l=e.callback;l&&(l.call(this,t,s),this.root.remove()),n&&"click"==LX.OPEN_CONTEXTMENU_ENTRY&&this._create_submenu(e,t,s,++a)}),!n)return;let o=document.createElement("a");o.className="fa-solid fa-bars-staggered fa-xs",s.appendChild(o),"mouseover"==LX.OPEN_CONTEXTMENU_ENTRY&&s.addEventListener("mouseover",i=>{s.built||(s.built=!0,this._create_submenu(e,t,s,++a),i.stopPropagation())}),s.addEventListener("mouseleave",()=>{a=-1,i.querySelectorAll(".lexcontextmenu").forEach(e=>e.remove())})}onCreate(){doAsync(()=>this._adjust_position(this.root,6))}add(e,t={}){t.constructor==Function&&(t={callback:t}),e+="";let i=e.split("/"),a=i[i.length-1];this.colors[a]=t.color;let n=0,s=(e,a)=>{if(void 0==e)return;let l=null;if(a.forEach(t=>{let i=Object.keys(t),a=i.find(t=>t==e);a&&(l=t[a])}),l)s(i[n++],l);else{let r={};r[e]=[];let o=i[n++];o||(r.id=t.id,r.callback=t.callback,r.disabled=t.disabled??!1),a.push(r),s(o,r[e])}};s(i[n++],this.items);let l=e=>{let t=Object.keys(e)[0],i=e[t];if(i.length){if(null==i.find(e=>Object.keys(e)[0]==t)){let a={};a[t]=[],a.className="cmtitle",e[t].unshift(a)}for(var n of e[t]){let s=Object.keys(n)[0];for(var r=0;r<n[s].length;++r)l(n)}}};for(let r of this.items)l(r);for(let o of this.items){let d=Object.keys(o)[0],c="eId"+getSupportedDOMName(d),h="#"+(o.id??c);this.root.querySelector(h)||this._create_entry(o,d,this.root,-1)}}setColor(e,t){"#"!==t[0]&&(t=rgbToHex(t)),this.colors[e]=t}}function addContextMenu(e,t,i,a){var n=new ContextMenu(t,e,a);return LX.root.appendChild(n.root),i&&i(n),n.onCreate(),n}LX.ContextMenu=ContextMenu,LX.addContextMenu=addContextMenu;class Curve{constructor(e,t,i={}){let a=document.createElement("div");a.className="curve "+(i.className?i.className:""),a.style.minHeight="50px",a.style.width=i.width||"100%",a.style.minWidth="50px",a.style.minHeight="20px",a.bgcolor=i.bgColor||LX.getThemeColor("global-intense-background"),a.pointscolor=i.pointsColor||LX.getThemeColor("global-selected-light"),a.linecolor=i.lineColor||"#555",a.value=t||[],a.xrange=i.xrange||[0,1],a.yrange=i.yrange||[0,1],a.defaulty=null!=i.defaulty?i.defaulty:0,a.no_overlap=i.noOverlap||!1,a.show_samples=i.showSamples||0,a.allow_add_values=i.allowAddValues??!0,a.draggable_x=i.draggableX??!0,a.draggable_y=i.draggableY??!0,a.smooth=(i.smooth&&"number"==typeof i.smooth?i.smooth:.3)||!1,a.move_out=i.moveOutAction??LX.CURVE_MOVEOUT_DELETE,LX.addSignal("@on_new_color_scheme",(e,t)=>{a.bgcolor=i.bgColor||LX.getThemeColor("global-intense-background"),a.pointscolor=i.pointsColor||LX.getThemeColor("global-selected-light"),this.redraw()}),this.element=a;let n=document.createElement("canvas");function s(e){return[n.width*(e[0]-a.xrange[0])/a.xrange[1],n.height*(e[1]-a.yrange[0])/a.yrange[1]]}function l(e){return[e[0]*a.xrange[1]/n.width+a.xrange[0],e[1]*a.yrange[1]/n.height+a.yrange[0]]}n.width=i.width||200,n.height=i.height||50,a.appendChild(n),this.canvas=n,a.addEventListener("mousedown",d),a.getValueAt=function(e){if(e<a.xrange[0]||e>a.xrange[1])return a.defaulty;for(var t=[a.xrange[0],a.defaulty],i=0,n=0;n<a.value.length;n+=1){var s=a.value[n];if(e==s[0])return s[1];if(e<s[0])return i=(e-t[0])/(s[0]-t[0]),t[1]*(1-i)+s[1]*i;t=s}return s=[a.xrange[1],a.defaulty],i=(e-t[0])/(s[0]-t[0]),t[1]*(1-i)+s[1]*i},a.resample=function(e){for(var t=[],i=(a.xrange[1]-a.xrange[0])/e,n=a.xrange[0];n<=a.xrange[1];n+=i)t.push(a.getValueAt(n));return t},a.addValue=function(e){for(var t=0;t<a.value;t++)if(!(a.value[t][0]<e[0])){a.value.splice(t,0,e),redraw();return}a.value.push(e),redraw()};var r=-1;a.redraw=function(e={}){e.value&&(a.value=e.value),e.xrange&&(a.xrange=e.xrange),e.yrange&&(a.yrange=e.yrange),e.smooth&&(a.smooth=e.smooth);var t=n.parentElement.getBoundingClientRect();n.parentElement.parentElement&&(t=n.parentElement.parentElement.getBoundingClientRect()),t&&n.width!=t.width&&t.width&&t.width<1e3&&(n.width=t.width);var i=n.getContext("2d");i.setTransform(1,0,0,1,0,0),i.translate(0,n.height),i.scale(1,-1),i.fillStyle=a.bgcolor,i.fillRect(0,0,n.width,n.height),i.strokeStyle=a.linecolor,i.beginPath();var l=s([a.xrange[0],a.defaulty]);i.moveTo(l[0],l[1]);let o=[l[0],l[1]];for(var d in a.value){var c=a.value[d];l=s(c),o.push(l[0]),o.push(l[1]),a.smooth||i.lineTo(l[0],l[1])}l=s([a.xrange[1],a.defaulty]),o.push(l[0]),o.push(l[1]),a.smooth?LX.UTILS.drawSpline(i,o,a.smooth):(i.lineTo(l[0],l[1]),i.stroke());for(var d=0;d<a.value.length;d+=1){var c=a.value[d];l=s(c),r==d?i.fillStyle="white":i.fillStyle=a.pointscolor,i.beginPath(),i.arc(l[0],l[1],r==d?4:3,0,2*Math.PI),i.fill()}if(a.show_samples){var h=a.resample(a.show_samples);i.fillStyle="#888";for(var d=0;d<h.length;d+=1){var c=[d*((a.xrange[1]-a.xrange[0])/a.show_samples)+a.xrange[0],h[d]];l=s(c),i.beginPath(),i.arc(l[0],l[1],2,0,2*Math.PI),i.fill()}}};var o=[0,0];function d(e){document.addEventListener("mousemove",c),document.addEventListener("mouseup",h);var t=n.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top;if(r=m(i,n.height-s),e.button==LX.MOUSE_LEFT_CLICK&&-1==r&&a.allow_add_values){var d=l([i,n.height-s]);a.value.push(d),g(),r=a.value.indexOf(d)}o=[i,s],a.redraw(),e.preventDefault(),e.stopPropagation()}function c(e){var t=n.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top;i<0?i=0:i>n.width&&(i=n.width),s<0?s=0:s>n.height&&(s=n.height);let d=[e.clientX-t.left,e.clientY-t.top];if(-1!=r&&p(d,[i,s])>.5*n.height){if(a.move_out==LX.CURVE_MOVEOUT_DELETE)a.value.splice(r,1);else{let c=[d[0]-i,d[1]-s],m=a.value[r];m[0]=0==c[0]?m[0]:c[0]<0?a.xrange[0]:a.xrange[1],m[1]=0==c[1]?m[1]:c[1]<0?a.yrange[1]:a.yrange[0]}h(e);return}var f,v=l([-(a.draggable_x?o[0]-i:0),a.draggable_y?o[1]-s:0]);if(-1!=r){var E=a.xrange[0],y=a.xrange[1];a.no_overlap&&(r>0&&(E=a.value[r-1][0]),r<a.value.length-1&&(y=a.value[r+1][0]));var $=a.value[r];$[0]+=v[0],$[1]+=v[1],$[0]<E?$[0]=E:$[0]>y&&($[0]=y),$[1]<a.yrange[0]?$[1]=a.yrange[0]:$[1]>a.yrange[1]&&($[1]=a.yrange[1])}g(),a.redraw(),o[0]=i,o[1]=s,u(e),e.preventDefault(),e.stopPropagation()}function h(e){r=-1,a.redraw(),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",h),u(e),e.preventDefault(),e.stopPropagation()}function u(e){i.callback&&i.callback.call(a,a.value,e)}function p(e,t){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function m(e,t){for(var i=1e5,n=-1,l=0;l<a.value.length;l++){var r=s(a.value[l]),o=p([e,t],r);o<i&&o<8&&(i=o,n=l)}return n}function g(){var e=null;-1!=r&&(e=a.value[r]),a.value.sort(function(e,t){return e[0]-t[0]}),e&&(r=a.value.indexOf(e))}return a.redraw(),this}redraw(e={}){this.element.redraw(e)}}LX.Curve=Curve;class Dial{constructor(e,t,i={}){let a=document.createElement("div");a.className="dial "+(i.className?i.className:""),a.style.width=a.style.height=i.size||"100%",a.style.minWidth=a.style.minHeight="50px",a.bgcolor=i.bgColor||LX.getThemeColor("global-dark-background"),a.pointscolor=i.pointsColor||LX.getThemeColor("global-selected-light"),a.linecolor=i.lineColor||"#555",a.value=t||[],a.xrange=i.xrange||[0,1],a.yrange=i.yrange||[0,1],a.defaulty=null!=i.defaulty?i.defaulty:0,a.no_overlap=i.noOverlap||!1,a.show_samples=i.showSamples||0,a.allow_add_values=i.allowAddValues??!0,a.draggable_x=i.draggableX??!0,a.draggable_y=i.draggableY??!0,a.smooth=(i.smooth&&"number"==typeof i.smooth?i.smooth:.3)||!1,a.move_out=i.moveOutAction??LX.CURVE_MOVEOUT_DELETE,this.element=a;let n=document.createElement("canvas");function s(e,t){return e[0],[n.width*(e[0]-a.xrange[0])/a.xrange[1],n.height*(e[1]-a.yrange[0])/a.yrange[1]]}function l(e){return[e[0]*a.xrange[1]/n.width+a.xrange[0],e[1]*a.yrange[1]/n.height+a.yrange[0]]}n.width=n.height=i.size||200,a.appendChild(n),this.canvas=n,a.addEventListener("mousedown",d),a.getValueAt=function(e){if(e<a.xrange[0]||e>a.xrange[1])return a.defaulty;for(var t=[a.xrange[0],a.defaulty],i=0,n=0;n<a.value.length;n+=1){var s=a.value[n];if(e==s[0])return s[1];if(e<s[0])return i=(e-t[0])/(s[0]-t[0]),t[1]*(1-i)+s[1]*i;t=s}return s=[a.xrange[1],a.defaulty],i=(e-t[0])/(s[0]-t[0]),t[1]*(1-i)+s[1]*i},a.resample=function(e){for(var t=[],i=(a.xrange[1]-a.xrange[0])/e,n=a.xrange[0];n<=a.xrange[1];n+=i)t.push(a.getValueAt(n));return t},a.addValue=function(e){for(var t=0;t<a.value;t++)if(!(a.value[t][0]<e[0])){a.value.splice(t,0,e),redraw();return}a.value.push(e),redraw()};var r=-1;a.redraw=function(e={}){e.value&&(a.value=e.value),e.xrange&&(a.xrange=e.xrange),e.yrange&&(a.yrange=e.yrange),e.smooth&&(a.smooth=e.smooth);var t=n.parentElement.getBoundingClientRect();n.parentElement.parentElement&&(t=n.parentElement.parentElement.getBoundingClientRect()),t&&n.width!=t.width&&t.width&&t.width<1e3&&(n.width=t.width);var i=n.getContext("2d");i.setTransform(1,0,0,1,0,0),i.translate(0,n.height),i.scale(1,-1),i.fillStyle=a.bgcolor,i.fillRect(0,0,n.width,n.height),i.strokeStyle=a.linecolor,i.beginPath();var l=s([a.xrange[0],a.defaulty]);i.moveTo(l[0],l[1]);let o=[l[0],l[1]];for(var d in a.value){var c=a.value[d];l=s(c),o.push(l[0]),o.push(l[1])}l=s([a.xrange[1],a.defaulty]),o.push(l[0]),o.push(l[1]),l=s([0,0]),i.fillStyle="gray",i.beginPath(),i.arc(l[0],l[1],3,0,2*Math.PI),i.fill();for(var d=0;d<a.value.length;d+=1){var c=a.value[d];l=s(c),r==d?i.fillStyle="white":i.fillStyle=a.pointscolor,i.beginPath(),i.arc(l[0],l[1],r==d?4:3,0,2*Math.PI),i.fill()}if(a.show_samples){var h=a.resample(a.show_samples);i.fillStyle="#888";for(var d=0;d<h.length;d+=1){var c=[d*((a.xrange[1]-a.xrange[0])/a.show_samples)+a.xrange[0],h[d]];l=s(c),i.beginPath(),i.arc(l[0],l[1],2,0,2*Math.PI),i.fill()}}};var o=[0,0];function d(e){document.addEventListener("mousemove",c),document.addEventListener("mouseup",h);var t=n.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top;if(r=m(i,n.height-s),e.button==LX.MOUSE_LEFT_CLICK&&-1==r&&a.allow_add_values){var d=l([i,n.height-s]);a.value.push(d),g(),r=a.value.indexOf(d)}o=[i,s],a.redraw(),e.preventDefault(),e.stopPropagation()}function c(e){var t=n.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top;i<0?i=0:i>n.width&&(i=n.width),s<0?s=0:s>n.height&&(s=n.height);let d=[e.clientX-t.left,e.clientY-t.top];if(-1!=r&&p(d,[i,s])>.5*n.height){if(a.move_out==LX.CURVE_MOVEOUT_DELETE)a.value.splice(r,1);else{let c=[d[0]-i,d[1]-s],m=a.value[r];m[0]=0==c[0]?m[0]:c[0]<0?a.xrange[0]:a.xrange[1],m[1]=0==c[1]?m[1]:c[1]<0?a.yrange[1]:a.yrange[0]}h(e);return}var f,v=l([-(a.draggable_x?o[0]-i:0),a.draggable_y?o[1]-s:0]);if(-1!=r){var E=a.xrange[0],y=a.xrange[1];a.no_overlap&&(r>0&&(E=a.value[r-1][0]),r<a.value.length-1&&(y=a.value[r+1][0]));var $=a.value[r];$[0]+=v[0],$[1]+=v[1],$[0]<E?$[0]=E:$[0]>y&&($[0]=y),$[1]<a.yrange[0]?$[1]=a.yrange[0]:$[1]>a.yrange[1]&&($[1]=a.yrange[1])}g(),a.redraw(),o[0]=i,o[1]=s,u(e),e.preventDefault(),e.stopPropagation()}function h(e){r=-1,a.redraw(),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",h),u(e),e.preventDefault(),e.stopPropagation()}function u(e){i.callback&&i.callback.call(a,a.value,e)}function p(e,t){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function m(e,t){for(var i=1e5,n=-1,l=0;l<a.value.length;l++){var r=s(a.value[l]),o=p([e,t],r);o<i&&o<8&&(i=o,n=l)}return n}function g(){var e=null;-1!=r&&(e=a.value[r]),a.value.sort(function(e,t){return e[0]-t[0]}),e&&(r=a.value.indexOf(e))}return a.redraw(),this}redraw(e={}){this.element.redraw(e)}}LX.Dial=Dial;class AssetViewEvent{static NONE=0;static ASSET_SELECTED=1;static ASSET_DELETED=2;static ASSET_RENAMED=3;static ASSET_CLONED=4;static ASSET_DBLCLICKED=5;static ENTER_FOLDER=6;static ASSET_CHECKED=7;constructor(e,t,i){this.type=e||TreeEvent.NONE,this.item=t,this.value=i,this.multiple=!1}string(){switch(this.type){case AssetViewEvent.NONE:return"assetview_event_none";case AssetViewEvent.ASSET_SELECTED:return"assetview_event_selected";case AssetViewEvent.ASSET_DELETED:return"assetview_event_deleted";case AssetViewEvent.ASSET_RENAMED:return"assetview_event_renamed";case AssetViewEvent.ASSET_CLONED:return"assetview_event_cloned";case AssetViewEvent.ASSET_DBLCLICKED:return"assetview_event_dblclicked";case AssetViewEvent.ENTER_FOLDER:return"assetview_event_enter_folder";case AssetViewEvent.ASSET_CHECKED:return"assetview_event_checked"}}}LX.AssetViewEvent=AssetViewEvent;class AssetView{static LAYOUT_CONTENT=0;static LAYOUT_LIST=1;static MAX_PAGE_ELEMENTS=50;constructor(e={}){this.rootPath="https://raw.githubusercontent.com/jxarco/lexgui.js/master/",this.layout=e.layout??AssetView.LAYOUT_CONTENT,this.contentPage=1,e.rootPath&&(e.rootPath.constructor!==String?console.warn("Asset Root Path must be a String (now is "+path.constructor.name+")"):this.rootPath=e.rootPath);let t=document.createElement("div");t.className="lexassetbrowser",this.root=t;let i=new LX.Area({height:"100%"});t.appendChild(i.root);let a,n,s=i;this.skipBrowser=e.skipBrowser??!1,this.skipPreview=e.skipPreview??!1,this.useNativeTitle=e.useNativeTitle??!1,this.onlyFolders=e.onlyFolders??!0,this.allowMultipleSelection=e.allowMultipleSelection??!1,this.previewActions=e.previewActions??[],this.contextMenu=e.contextMenu??[],this.onRefreshContent=e.onRefreshContent,this.skipBrowser||([a,n]=i.split({type:"horizontal",sizes:["15%","85%"]}),s=n,a.setLimitBox(210,0),n.setLimitBox(512,0)),this.skipPreview||([s,n]=s.split({type:"horizontal",sizes:["80%","20%"]})),this.allowedTypes=e.allowedTypes||["None","Image","Mesh","Script","JSON","Clip"],this.prevData=[],this.nextData=[],this.data=[],this._processData(this.data,null),this.currentData=this.data,this.path=["@"],this.skipBrowser||this._createTreePanel(a),this._createContentPanel(s),this.skipPreview||(this.previewPanel=n.addPanel({className:"lexassetcontentpanel",style:{overflow:"scroll"}}))}load(e,t){this.prevData.length=0,this.nextData.length=0,this.data=e,this._processData(this.data,null),this.currentData=this.data,this.path=["@"],this.skipBrowser||this._createTreePanel(this.area),this._refreshContent(),this.onevent=t}clear(){this.previewPanel&&this.previewPanel.clear(),this.leftPanel&&this.leftPanel.clear(),this.rightPanel&&this.rightPanel.clear()}_processData(e,t){e.constructor!==Array&&(e.folder=t,e.children=e.children??[]);let i=e.constructor===Array?e:e.children;for(var a=0;a<i.length;++a)this._processData(i[a],e)}_updatePath(e){this.path.length=0;let t=e=>{if(!e)return;let i=(e.children?e.children:e)[0];i&&i.folder&&(this.path.push(i.folder.id??"@"),t(i.folder.folder))};t(e),LX.emit("@on_folder_change",this.path.reverse().join("/"))}_createTreePanel(e){this.leftPanel?this.leftPanel.clear():this.leftPanel=e.addPanel({className:"lexassetbrowserpanel"});let t={id:"/",children:this.data};this.tree=this.leftPanel.addTree("Content Browser",t,{filter:!1,onlyFolders:this.onlyFolders,onevent:e=>{let t=e.node,i=e.value;switch(e.type){case LX.TreeEvent.NODE_SELECTED:e.multiple||this._enterFolder(t),t.parent||(this.prevData.push(this.currentData),this.currentData=this.data,this._refreshContent(),this.path=["@"],LX.emit("@on_folder_change",this.path.join("/")));break;case LX.TreeEvent.NODE_DRAGGED:t.folder=i,this._refreshContent()}}})}_setContentLayout(e){this.layout=e,this._refreshContent()}_createContentPanel(e){this.rightPanel?this.rightPanel.clear():this.rightPanel=e.addPanel({className:"lexassetcontentpanel"});let t=(e,t)=>{let i=addContextMenu("Sort by",t,e=>{e.add("Name",()=>this._sortData("id")),e.add("Type",()=>this._sortData("type")),e.add(""),e.add("Ascending",()=>this._sortData()),e.add("Descending",()=>this._sortData(null,!0))}),a=this.parent.root.parentElement;a.classList.contains("lexdialog")&&(i.root.style.zIndex=+getComputedStyle(a).zIndex+1)},i=(e,t)=>{let i=addContextMenu("Layout",t,e=>{e.add("Content",()=>this._setContentLayout(AssetView.LAYOUT_CONTENT)),e.add(""),e.add("List",()=>this._setContentLayout(AssetView.LAYOUT_LIST))}),a=this.parent.root.parentElement;a.classList.contains("lexdialog")&&(i.root.style.zIndex=+getComputedStyle(a).zIndex+1)},a=(e,t)=>{if(!this.allowNextPage)return;let i=this.contentPage;this.contentPage+=e,this.contentPage=Math.min(this.contentPage,((this.currentData.length-1)/AssetView.MAX_PAGE_ELEMENTS|0)+1),this.contentPage=Math.max(this.contentPage,1),i!=this.contentPage&&this._refreshContent()};this.rightPanel.sameLine(),this.rightPanel.addDropdown("Filter",this.allowedTypes,this.allowedTypes[0],e=>this._refreshContent.call(this,null,e),{width:"30%",minWidth:"128px"}),this.rightPanel.addText(null,this.searchValue??"",e=>this._refreshContent.call(this,e,null),{placeholder:"Search assets.."}),this.rightPanel.addButton(null,"<a class='fa fa-arrow-up-short-wide'></a>",t.bind(this),{className:"micro",title:"Sort"}),this.rightPanel.addButton(null,"<a class='fa-solid fa-grip'></a>",i.bind(this),{className:"micro",title:"View"}),this.rightPanel.addButton(null,"<a class='fa-solid fa-angles-left'></a>",a.bind(this,-1),{className:"micro",title:"Previous Page"}),this.rightPanel.addButton(null,"<a class='fa-solid fa-angles-right'></a>",a.bind(this,1),{className:"micro",title:"Next Page"}),this.rightPanel.endLine(),this.skipBrowser||(this.rightPanel.sameLine(),this.rightPanel.addComboButtons(null,[{value:"Left",icon:"fa-solid fa-left-long",callback:e=>{this.prevData.length&&(this.nextData.push(this.currentData),this.currentData=this.prevData.pop(),this._refreshContent(),this._updatePath(this.currentData))}},{value:"Right",icon:"fa-solid fa-right-long",callback:e=>{this.nextData.length&&(this.prevData.push(this.currentData),this.currentData=this.nextData.pop(),this._refreshContent(),this._updatePath(this.currentData))}},{value:"Refresh",icon:"fa-solid fa-arrows-rotate",callback:e=>{this._refreshContent()}}],{width:"auto",noSelection:!0}),this.rightPanel.addText(null,this.path.join("/"),null,{disabled:!0,signal:"@on_folder_change",style:{fontWeight:"bolder",fontSize:"16px",color:"#aaa"}}),this.rightPanel.addText(null,"Page "+this.contentPage+" / "+(((this.currentData.length-1)/AssetView.MAX_PAGE_ELEMENTS|0)+1),null,{disabled:!0,signal:"@on_page_change",width:"fit-content"}),this.rightPanel.endLine()),this.content=document.createElement("ul"),this.content.className="lexassetscontent",this.rightPanel.root.appendChild(this.content),this.content.addEventListener("dragenter",function(e){e.preventDefault(),this.classList.add("dragging")}),this.content.addEventListener("dragleave",function(e){e.preventDefault(),this.classList.remove("dragging")}),this.content.addEventListener("drop",e=>{e.preventDefault(),this._processDrop(e)}),this.content.addEventListener("click",function(){this.querySelectorAll(".lexassetitem").forEach(e=>e.classList.remove("selected"))}),this._refreshContent()}_refreshContent(e,t){let i=this.layout==AssetView.LAYOUT_CONTENT;this.filter=t??this.filter??"None",this.searchValue=e??this.searchValue??"",this.content.innerHTML="",this.content.className=i?"lexassetscontent":"lexassetscontent list";let a=this,n=function(e){let t=e.type.charAt(0).toUpperCase()+e.type.slice(1),n=getExtension(e.id),s="Folder"===t,l=document.createElement("li");if(l.className="lexassetitem "+e.type.toLowerCase(),l.tabIndex=-1,a.content.appendChild(l),a.useNativeTitle)l.title=t+": "+e.id;else{let r=document.createElement("span");r.className="lexitemdesc",r.innerHTML="File: "+e.id+"<br>Type: "+t,a.content.appendChild(r),l.addEventListener("mousemove",e=>{if(!i)return;let t=l.getBoundingClientRect(),a=e.target.getBoundingClientRect(),n=r.parentElement.getBoundingClientRect(),s=a.x-n.x-(a.x-t.x),o=a.y-n.y-(a.y-t.y);e.target.classList.contains("lexassettitle")&&(o+=a.y-t.y),r.style.left=s+e.offsetX+12+"px",r.style.top=o+e.offsetY+"px"}),l.addEventListener("mouseenter",()=>{i&&(r.style.display="unset")}),l.addEventListener("mouseleave",()=>{i&&setTimeout(()=>{r.style.display="none"},100)})}if(a.allowMultipleSelection){let o=document.createElement("input");o.type="checkbox",o.className="lexcheckbox",o.checked=e.selected,o.addEventListener("change",(t,i)=>{if(e.selected=!e.selected,a.onevent){let n=new AssetViewEvent(AssetViewEvent.ASSET_CHECKED,t.shiftKey?[e]:e);n.multiple=!!t.shiftKey,a.onevent(n)}t.stopPropagation(),t.stopImmediatePropagation()}),l.appendChild(o)}let d=document.createElement("span");if(d.className="lexassettitle",d.innerText=e.id,l.appendChild(d),!a.skipPreview){let c=null,h=e.src&&(["png","jpg"].indexOf(getExtension(e.src))>-1||e.src.includes("data:image/"));if(h||s||!i){c=document.createElement("img");let u=e.unknown_extension?a.rootPath+"images/file.png":s?a.rootPath+"images/folder.png":e.src;c.src=i||s?u:a.rootPath+"images/file.png",l.appendChild(c)}else{(c=document.createElement("svg")).className="asset-file-preview",l.appendChild(c);let p=document.createElement("text");c.appendChild(p),p.innerText=n&&n!=e.id?"."+n.toUpperCase():e.type.toUpperCase();var m,g=2.5/p.innerText.length;g<1&&(p.style.fontSize=64*g+"px",c.style.paddingTop="calc(50% - "+(.5*p.offsetHeight+10)+"px)")}}if(!s){let f=document.createElement("span");f.className="lexassetinfo",f.innerText=t,l.appendChild(f)}return l.addEventListener("click",function(t){t.stopImmediatePropagation(),t.stopPropagation();let i=t.detail==LX.MOUSE_DOUBLE_CLICK;if(i){if(s){a._enterFolder(e);return}}else t.shiftKey||a.content.querySelectorAll(".lexassetitem").forEach(e=>e.classList.remove("selected")),this.classList.add("selected"),a.selectedItem=e,a.skipPreview||a._previewAsset(e);if(a.onevent){let n=new AssetViewEvent(i?AssetViewEvent.ASSET_DBLCLICKED:AssetViewEvent.ASSET_SELECTED,t.shiftKey?[e]:e);n.multiple=!!t.shiftKey,a.onevent(n)}}),a.contextMenu&&l.addEventListener("contextmenu",function(t){t.preventDefault();let i=a.content.querySelectorAll(".selected").length;LX.addContextMenu(i>1?i+" selected":s?e.id:e.type,t,t=>{i<=1&&t.add("Rename"),s||t.add("Clone",a._cloneItem.bind(a,e)),i<=1&&t.add("Properties"),t.add(""),t.add("Delete",a._deleteItem.bind(a,e))})}),l.addEventListener("dragstart",function(e){e.preventDefault()},!1),l},s=new FileReader,l=this.currentData.filter(e=>("None"==this.filter||e.type.toLowerCase()==this.filter.toLowerCase())&&e.id.toLowerCase().includes(this.searchValue.toLowerCase()));(t||e)&&(this.contentPage=1);let r=(this.contentPage-1)*AssetView.MAX_PAGE_ELEMENTS,o=Math.min(r+AssetView.MAX_PAGE_ELEMENTS,l.length);for(let d=r;d<o;++d){let c=l[d];c.path?LX.request({url:c.path,dataType:"blob",success:i=>{c.bytesize=i.size,s.readAsDataURL(i),s.onload=i=>{c.src=i.currentTarget.result,c._path=c.path,delete c.path,this._refreshContent(e,t)}}}):c.domEl=n(c)}this.allowNextPage=l.length-1>AssetView.MAX_PAGE_ELEMENTS,LX.emit("@on_page_change","Page "+this.contentPage+" / "+(((l.length-1)/AssetView.MAX_PAGE_ELEMENTS|0)+1)),this.onRefreshContent&&this.onRefreshContent(e,t)}_previewAsset(e){let t=e.src&&e.src.includes("data:image/");if(this.previewPanel.clear(),this.previewPanel.branch("Asset"),"image"==e.type||e.src){let i=["png","jpg"].indexOf(getExtension(e.src))>-1||t;i&&this.previewPanel.addImage(e.src,{style:{width:"100%"}})}let a={disabled:!0};this.previewPanel.addText("Filename",e.id,null,a),e.lastModified&&this.previewPanel.addText("Last Modified",new Date(e.lastModified).toLocaleString(),null,a),(e._path||e.src)&&this.previewPanel.addText("URL",e._path?e._path:e.src,null,a),this.previewPanel.addText("Path",this.path.join("/"),null,a),this.previewPanel.addText("Type",e.type,null,a),e.bytesize&&this.previewPanel.addText("Size",(e.bytesize/1024).toPrecision(3)+" KBs",null,a),"folder"==e.type&&this.previewPanel.addText("Files",e.children?e.children.length.toString():"0",null,a),this.previewPanel.addSeparator();let n=[...this.previewActions];for(let s of(n.length||n.push({name:"Download",callback:()=>LX.downloadURL(e.src,e.id)}),n))s.type&&s.type!==e.type||s.path&&s.path!==this.path.join("/")||this.previewPanel.addButton(null,s.name,s.callback.bind(this,e));this.previewPanel.merge()}_processDrop(e){let t=new FileReader,i=e.dataTransfer.files.length;for(let a=0;a<e.dataTransfer.files.length;++a){let n=e.dataTransfer.files[a],s=this.currentData.find(e=>e.id===n.name);s||(t.readAsDataURL(n),t.onload=e=>{let t=n.name.substr(n.name.lastIndexOf(".")+1).toLowerCase(),s={id:n.name,src:e.currentTarget.result,extension:t,lastModified:n.lastModified};switch(t){case"png":case"jpg":s.type="image";break;case"js":case"css":s.type="script";break;case"json":s.type="json";break;case"obj":s.type="mesh";break;default:s.type=t,s.unknown_extension=!0}this.currentData.push(s),a!=i-1||(this._refreshContent(),this.skipBrowser||this.tree.refresh())})}}_sortData(e,t=!1){e=e??this._lastSortBy??"id",this.currentData=this.currentData.sort((i,a)=>{var n=t?a[e].localeCompare(i[e]):i[e].localeCompare(a[e]);return 0==n&&(n=t?a.id.localeCompare(i.id):i.id.localeCompare(a.id)),n}),this._lastSortBy=e,this._refreshContent()}_enterFolder(e){if(this.prevData.push(this.currentData),this.currentData=e.children,this.contentPage=1,this._refreshContent(),this._updatePath(this.currentData),this.onevent){let t=new AssetViewEvent(AssetViewEvent.ENTER_FOLDER,e);this.onevent(t)}}_deleteItem(e){let t=this.currentData.indexOf(e);if(t<0){console.error("[AssetView Error] Cannot delete. Item not found.");return}if(this.currentData.splice(t,1),this._refreshContent(this.searchValue,this.filter),this.onevent){let i=new AssetViewEvent(AssetViewEvent.ASSET_DELETED,e);this.onevent(i)}this.tree.refresh(),this._processData(this.data)}_cloneItem(e){let t=this.currentData.indexOf(e);if(t<0)return;delete e.domEl,delete e.folder;let i=deepCopy(e);if(this.currentData.splice(t,0,i),this._refreshContent(this.searchValue,this.filter),this.onevent){let a=new AssetViewEvent(AssetViewEvent.ASSET_CLONED,e);this.onevent(a)}this._processData(this.data)}}LX.AssetView=AssetView,Object.assign(LX,{request(e){var t=e.dataType||"text";"json"==t?t="text":"xml"==t?t="text":"binary"==t&&(t="arraybuffer",e.mimeType="application/octet-stream");var i=new XMLHttpRequest;i.open(e.data?"POST":"GET",e.url,!0),t&&(i.responseType=t),e.mimeType&&i.overrideMimeType(e.mimeType),e.nocache&&i.setRequestHeader("Cache-Control","no-cache"),i.onload=function(t){var i=this.response;if(200!=this.status){var a="Error "+this.status;e.error&&e.error(a);return}if("json"==e.dataType)try{i=JSON.parse(i)}catch(n){if(e.error)e.error(n);else throw n}else if("xml"==e.dataType)try{i=new DOMParser().parseFromString(i,"text/xml")}catch(s){if(e.error)e.error(s);else throw s}e.success&&e.success.call(this,i,this)},i.onerror=function(t){e.error&&e.error(t)};var a=new FormData;if(e.data)for(var n in e.data)a.append(n,e.data[n]);return i.send(a),i},requestText(e,t,i){return this.request({url:e,dataType:"text",success:t,error:i})},requestJSON(e,t,i){return this.request({url:e,dataType:"json",success:t,error:i})},requestBinary(e,t,i){return this.request({url:e,dataType:"binary",success:t,error:i})},requireScript(e,t,i,a,n){if(!e)throw"invalid URL";e.constructor===String&&(e=[e]);var s=e.length,l=[];for(var r in e){var o=document.createElement("script");o.num=r,o.type="text/javascript",o.src=e[r]+(n?"?version="+n:""),o.original_src=e[r],o.async=!1,o.onload=function(e){s--,l.push(this),s?a&&a(this.original_src,this.num):t&&t(l)},i&&(o.onerror=function(e){i(e,this.original_src,this.num)}),document.getElementsByTagName("head")[0].appendChild(o)}},downloadURL(e,t){let i=new FileReader,a=function(e){var i=document.createElement("a");i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)};e.includes("http")?LX.request({url:e,dataType:"blob",success(e){i.readAsDataURL(e),i.onload=e=>{a(e.currentTarget.result)}}}):a(e)},downloadFile:function(e,t,i){if(!t){console.warn("No file provided to download");return}i||(i=t.constructor===String?"text/plain":"application/octet-stream");var a=null;a=t.constructor!==File&&t.constructor!==Blob?new Blob([t],{type:i}):t;var n=URL.createObjectURL(a),s=document.createElement("a");s.setAttribute("href",n),s.setAttribute("download",e),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(function(){URL.revokeObjectURL(n)},6e4)}}),Object.defineProperty(String.prototype,"lastChar",{get:function(){return this[this.length-1]},enumerable:!0,configurable:!0}),Element.prototype.insertChildAtIndex=function(e,t=1/0){t>=this.children.length?this.appendChild(e):this.insertBefore(e,this.children[t])},Element.prototype.hasClass=function(e){return!!(e=[].concat(e)).filter(e=>this.classList.contains(e)).length},Element.prototype.addClass=function(e){e&&this.classList.add(e)},Element.prototype.getComputedSize=function(){let e=getComputedStyle(this);return{width:this.offsetWidth+e.getPropertyValue("marginLeft")+e.getPropertyValue("marginRight"),height:this.offsetHeight+e.getPropertyValue("marginTop")+e.getPropertyValue("marginBottom")}},Element.prototype.getParentArea=function(){let e=this.parentElement;for(;e;){if(e.classList.contains("lexarea"))return e;e=e.parentElement}},LX.UTILS={getTime:()=>new Date().getTime(),compareThreshold:(e,t,i,a)=>Math.abs(e-t)>=a||Math.abs(e-i)>=a,compareThresholdRange:(e,t,i,a)=>e>=i&&e<=a||t>=i&&t<=a||e<=i&&t>=a,uidGenerator:simple_guidGenerator,deleteElement(e){e&&e.remove()},flushCss(e){e.offsetHeight},getControlPoints(e,t,i,a,n,s,l){var r=Math.sqrt(Math.pow(i-e,2)+Math.pow(a-t,2)),o=l*r/(r+Math.sqrt(Math.pow(n-i,2)+Math.pow(s-a,2))),d=l-o;return[i+o*(e-n),a+o*(t-s),i-d*(e-n),a-d*(t-s)]},drawSpline(e,t,i){e.save();for(var a=[],n=t.length,s=0;s<n-4;s+=2)a=a.concat(LX.UTILS.getControlPoints(t[s],t[s+1],t[s+2],t[s+3],t[s+4],t[s+5],i));for(var s=2;s<t.length-5;s+=2)e.beginPath(),e.moveTo(t[s],t[s+1]),e.bezierCurveTo(a[2*s-2],a[2*s-1],a[2*s],a[2*s+1],t[s+2],t[s+3]),e.stroke(),e.closePath();e.beginPath(),e.moveTo(t[0],t[1]),e.quadraticCurveTo(a[0],a[1],t[2],t[3]),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(t[n-2],t[n-1]),e.quadraticCurveTo(a[2*n-10],a[2*n-9],t[n-4],t[n-3]),e.stroke(),e.closePath(),e.restore()}};export{LX};