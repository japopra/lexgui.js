var y={version:"0.4.2",ready:!1,components:[],signals:{},extraCommandbarEntries:[],activeDraggable:null};function f(e,t,a){return Math.min(Math.max(e,t),a)}function E(e,t){return 0==t?Math.floor(e):+e.toFixed(t??2).replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1")}function p(e,t,a,n,i){return(e-t)*(i-n)/(a-t)+n}y.MOUSE_LEFT_CLICK=0,y.MOUSE_MIDDLE_CLICK=1,y.MOUSE_RIGHT_CLICK=2,y.MOUSE_DOUBLE_CLICK=2,y.MOUSE_TRIPLE_CLICK=3,y.CURVE_MOVEOUT_CLAMP=0,y.CURVE_MOVEOUT_DELETE=1,y.DRAGGABLE_Z_INDEX=101,y.clamp=f,y.round=E,y.remapRange=p,"undefined"!=typeof performance?y.getTime=performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?y.getTime=Date.now.bind(Date):"undefined"!=typeof process?y.getTime=function(){var e=process.hrtime();return.001*e[0]+1e-6*e[1]}:y.getTime=function(){return(new Date).getTime()};function m(e,t){setTimeout(e,t??0)}function c(e){return e.replace(/\s/g,"").replaceAll("@","_").replaceAll("+","_plus_").replaceAll(".","")}function d(e){return e.includes(".")?e.split(".").pop():null}function g(e){return JSON.parse(JSON.stringify(e))}function h(e){return[parseInt(e.substring(1,3),16)/255,parseInt(e.substring(3,5),16)/255,parseInt(e.substring(5,7),16)/255]}function u(e){let t="#";for(var a of e)a=Math.floor(255*a),t+=a.toString(16);return t}function v(e,t=8){var a=document.createElement("span"),e=(a.className="lexinputmeasure",a.innerHTML=e,document.body.appendChild(a),a.getBoundingClientRect());return y.UTILS.deleteElement(a),e.width+t}function b(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+"-"+e()+"-"+e()}function x(s,t={}){let l=0,r=0,n=null,a=t.targetClass,o=t.dragMargin??3,i=(e,t,a)=>{var n=s.parentElement?s.parentElement.getBoundingClientRect():{x:0,y:0,width:0,height:0},i="fixed"==s.style.position?new y.vec2(n.x,n.y):new y.vec2;a=a??e.clientX-l-n.x,t=t??e.clientY-r-n.y,s.style.left=f(a,o+i.x,i.x+n.width-s.offsetWidth-o)+"px",s.style.top=f(t,o+i.y,i.y+n.height-s.offsetHeight-o)+"px",s.style.translate="none"};t.autoAdjust&&i(null,parseInt(s.style.left),parseInt(s.style.top));var e=y.UTILS.uidGenerator();s["draggable-id"]=e;let d=t.onMove?e=>{n&&t.onMove&&t.onMove(n)}:e=>{n&&i(e)},c=t.onDragStart;s.setAttribute("draggable",!0),s.addEventListener("mousedown",function(e){n=e.target.classList.contains(a)||!a?e.target:null}),s.addEventListener("dragstart",function(e){var t,a;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),n&&((t=new Image).src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=",e.dataTransfer.setDragImage(t,0,0),e.dataTransfer.effectAllowed="move",t=e.target.getBoundingClientRect(),a=n.parentElement.getBoundingClientRect(),a="fixed"==n.style.position?new y.vec2(a.x,a.y):new y.vec2,l=e.clientX-t.x-a.x,r=e.clientY-t.y-a.y,document.addEventListener("mousemove",d),n._eventCatched=!0,y.activeDraggable&&(y.activeDraggable.style.zIndex=y.DRAGGABLE_Z_INDEX),y.activeDraggable=s,y.activeDraggable.style.zIndex=y.DRAGGABLE_Z_INDEX+1,c)&&c(n,e)},!1),document.addEventListener("mouseup",e=>{n&&(n=null,document.removeEventListener("mousemove",d))})}y.doAsync=m,y.getSupportedDOMName=c,y.has=function(e){return-1<y.components.indexOf(e)},y.getExtension=d,y.deepCopy=g,y.setTheme=function(e){e="light"==e?"light":"dark",document.documentElement.setAttribute("data-theme",e),y.emit("@on_new_color_scheme",e)},y.setThemeColor=function(e,t){document.querySelector(":root").style.setProperty("--"+e,t)},y.getThemeColor=function(e){var t=getComputedStyle(document.querySelector(":root"));return(e=t.getPropertyValue("--"+e)).includes("light-dark")?("light"==t.getPropertyValue("color-scheme")?e.substring(e.indexOf("(")+1,e.indexOf(",")):e.substring(e.indexOf(",")+1,e.indexOf(")"))).replace(/\s/g,""):e},y.getBase64Image=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")},y.hexToRgb=h,y.rgbToHex=u,y.measureRealWidth=v,y.guidGenerator=b,y.buildTextPattern=function(e={}){var t=[],a=(e.lowercase&&t.push("(?=.*[a-z])"),e.uppercase&&t.push("(?=.*[A-Z])"),e.digit&&t.push("(?=.*\\d)"),e.specialChar&&t.push("(?=.*[@#$%^&+=!])"),e.noSpaces&&t.push("(?!.*\\s)"),e.minLength||0),n=e.maxLength||"",t=`^${t.join("")}.{${a},${n}}$`;return e.asRegExp?new RegExp(t):t},y.makeDraggable=x,y.makeCollapsible=function(e,t,a,n={}){e.classList.add("collapsible");var n=n.collapsed??!0,i=y.makeIcon("Right");i.classList.add("collapser"),i.dataset.collapsed=n,i.style.marginLeft="auto",i.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),this.dataset.collapsed?(delete this.dataset.collapsed,t.style.display="block"):(this.dataset.collapsed=!0,t.style.display="none")}),e.appendChild(i),(a=a??e.parentElement).appendChild(t)},y.makeCodeSnippet=function(e,t,a={}){if(y.has("CodeEditor")){var n,i,s,l=document.createElement("div"),t=(l.className="lexcodesnippet",l.style.width=t?t[0]:"auto",l.style.height=t?t[1]:"auto",new _({noAppend:!0})),r=new y.CodeEditor(t,{skipInfo:!0,disableEdition:!0,allowAddScripts:!1,name:a.tabName});if(r.setText(e,a.language??"Plain Text"),a.linesAdded){let t=r.root.querySelector(".code");for(var o of a.linesAdded)if(o.constructor==Number)t.childNodes[o-1].classList.add("added");else if(o.constructor==Array)for(let e=o[0]-1;e<=o[1]-1;e++)t.childNodes[e].classList.add("added")}if(a.linesRemoved){let t=r.root.querySelector(".code");for(var d of a.linesRemoved)if(d.constructor==Number)t.childNodes[d-1].classList.add("removed");else if(d.constructor==Array)for(let e=d[0]-1;e<=d[1]-1;e++)t.childNodes[e].classList.add("removed")}return a.windowMode&&((e=document.createElement("div")).className="lexwindowbuttons",(n=document.createElement("span")).style.background="#ee4f50",(i=document.createElement("span")).style.background="#f5b720",(s=document.createElement("span")).style.background="#53ca29",e.appendChild(n),e.appendChild(i),e.appendChild(s),r.root.querySelector(".lexareatabs").prepend(e)),(a.lineNumbers??!0)||r.root.classList.add("no-gutter"),l.appendChild(t.root),l}console.error("Import the CodeEditor component to create snippets!")},y.makeIcon=function(e,t,a=""){var n=document.createElement("a");return n.title=t??"",n.className="lexicon "+a,n.innerHTML=y.ICONS[e]??"",n},y.registerCommandbarEntry=function(e,t){y.extraCommandbarEntries.push({name:e,callback:t})};y.vec2=class o{constructor(e,t){this.x=e??0,this.y=t??e??0}get xy(){return[this.x,this.y]}get yx(){return[this.y,this.x]}set(e,t){this.x=e,this.y=t}add(e,t=new o){return t.set(this.x+e.x,this.y+e.y),t}sub(e,t=new o){return t.set(this.x-e.x,this.y-e.y),t}mul(e,t=new o){return e.constructor==Number&&(e=new o(e)),t.set(this.x*e.x,this.y*e.y),t}div(e,t=new o){return e.constructor==Number&&(e=new o(e)),t.set(this.x/e.x,this.y/e.y),t}abs(e=new o){return e.set(Math.abs(this.x),Math.abs(this.y)),e}dot(e){return this.x*e.x+this.y*e.y}len2(){return this.dot(this)}len(){return Math.sqrt(this.len2())}nrm(e=new o){return e.set(this.x,this.y),e.mul(1/this.len(),e)}dst(e){return e.sub(this).len()}clp(e,t,a=new o){return a.set(f(this.x,e,t),f(this.y,e,t)),a}},y.init=function(e={}){var t,a;return this.ready||((a=document.createElement("div")).id="lexroot",a.tabIndex=-1,(t=document.createElement("div")).id="modal",this.modal=t,this.root=a,this.container=document.body,this.modal.classList.add("hiddenOpacity"),this.modal.toggle=function(e){this.classList.toggle("hiddenOpacity",e)},e.container&&(this.container=document.getElementById(e.container)),this.usingStrictViewport=e.strictViewport??!0,document.documentElement.setAttribute("data-strictVP",this.usingStrictViewport?"true":"false"),this.usingStrictViewport||document.addEventListener("scroll",e=>{document.body.querySelectorAll(".lexmenubox").forEach(e=>{e._updatePosition()})}),this.commandbar=(e=>{let l=document.createElement("dialog"),r=(l.className="commandbar",l.tabIndex=-1,e.appendChild(l),[]),o=null;l.addEventListener("keydown",function(e){var t,a;e.stopPropagation(),e.stopImmediatePropagation(),o=o??-1,"Escape"==e.key?(this.close(),h(!0)):"Enter"==e.key?(t=r[o])&&(a=t.item.type&&"checkbox"===t.item.type,this.close(),a?(t.item.checked=!t.item.checked,t.callback.call(window,t.item.checked,t.entry_name)):t.callback.call(window,t.entry_name)):"ArrowDown"==e.key&&o<r.length-1?(o++,l.querySelectorAll(".hovered").forEach(e=>e.classList.remove("hovered")),r[o].classList.add("hovered"),0<(a=r[o].offsetHeight*(o+1)-d.offsetHeight)&&d.scrollTo({top:a,behavior:"smooth"})):"ArrowUp"==e.key&&0<o&&(o--,l.querySelectorAll(".hovered").forEach(e=>e.classList.remove("hovered")),r[o].classList.add("hovered"))}),l.addEventListener("focusout",function(e){e.relatedTarget!=e.currentTarget&&(e.stopPropagation(),e.stopImmediatePropagation(),this.close(),h(!0))}),e.addEventListener("keydown",e=>{if(" "==e.key&&e.ctrlKey)e.stopImmediatePropagation(),e.stopPropagation(),y.setCommandbarState(!0);else for(var t of y.components){var a;if(y[t]&&y[t].prototype.onKeyPressed)for(a of y.CodeEditor.getInstances())a.onKeyPressed(e)}}),(e=document.createElement("div")).className="gs-header";var t=document.createElement("a");t.className="fa-solid fa-magnifying-glass",e.appendChild(t);let a=document.createElement("input");a.placeholder="Search...",a.value="",e.appendChild(a);var n=(t=new _({width:"100%",skipAppend:!0,className:"gs-tabs"})).addTabs();let i,d=(n.add("All",document.createElement("div"),{selected:!0,onSelect:(e,t)=>{i=t}}),document.createElement("div")),c=(d.className="searchitembox",null),h=e=>{d.innerHTML="",r.length=0,o=null,e&&(a.value="")},u=(e,t,a,n)=>{var i,s;e.length&&(c&&c.classList.remove("last"),(i=document.createElement("div")).className="searchitem last",s=n&&n.type&&"checkbox"===n.type,i.innerHTML=s?"<a class='fa fa-check'></a><span>"+(a+e)+"</span>":a+e,i.entry_name=e,i.callback=t,i.item=n,i.addEventListener("click",function(e){this.callback.call(window,this.entry_name),y.setCommandbarState(!1),h(!0)}),i.addEventListener("mouseenter",function(e){l.querySelectorAll(".hovered").forEach(e=>e.classList.remove("hovered")),this.classList.add("hovered"),o=r.indexOf(this)}),i.addEventListener("mouseleave",function(e){this.classList.remove("hovered")}),r.push(i),d.appendChild(i),c=i)},p=(e,t,a)=>{var n=Object.keys(e)[0],i=e.name??a+n;if(i.toLowerCase().includes(t)&&e.callback&&u(e.name??n,e.callback,a,e),!e.name){a+=n+" > ";for(var s of e[n])p(s,t,a)}};return l._addElements=e=>{h();for(var t of y.menubars)for(var a of t.items)p(a,e,"");for(var n of y.extraCommandbarEntries){var i=n.name;i.toLowerCase().includes(e)&&u(i,n.callback,"",{})}if(y.has("CodeEditor")){let a=y.CodeEditor.getInstances();if(a.length){var s=a[0].languages;for(let t of Object.keys(s)){var l="Language: "+t,r=a[0]._getFileIcon(null,s[t].ext),r=r.includes("fa-")?"<i class='"+r+"'></i>":"<img src='https://raw.githubusercontent.com/jxarco/lexgui.js/master/"+r+"'>";r+=l+" <span class='lang-ext'>("+s[t].ext+")</span>",l.toLowerCase().includes(e)&&u(r,()=>{for(var e of a)e._changeLanguage(t)},"",{})}}}},a.addEventListener("input",function(e){l._addElements(this.value.toLowerCase())}),l.appendChild(e),l.appendChild(t.root),l.appendChild(d),l})(this.container),this.container.appendChild(t),e.skipRoot?this.root=document.body:this.container.appendChild(a),(t=document.createElement("section")).className="notifications",this.notifications=document.createElement("ol"),this.notifications.className="",this.notifications.iWidth=0,t.appendChild(this.notifications),this.container.appendChild(t),this.notifications.addEventListener("mouseenter",()=>{this.notifications.classList.add("list")}),this.notifications.addEventListener("mouseleave",()=>{this.notifications.classList.remove("list")}),a.addEventListener("dragover",function(e){e.preventDefault()},!1),document.addEventListener("contextmenu",function(e){e.preventDefault()},!1),t=document.getElementsByTagName("HEAD")[0],(a=document.createElement("link")).rel="stylesheet",a.type="text/css",a.crossOrigin="anonymous",a.href="https://use.fontawesome.com/releases/v6.7.2/css/all.css",t.appendChild(a),this.DEFAULT_NAME_WIDTH="30%",this.DEFAULT_SPLITBAR_SIZE=4,this.OPEN_CONTEXTMENU_ENTRY="click",this.ready=!0,this.menubars=[],e.skipRoot||e.skipDefaultArea||(this.main_area=new _({id:e.id??"mainarea"})),(e.autoTheme??!0)&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&(y.setTheme("light"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{y.setTheme(e.matches?"dark":"light")}))),this.main_area},y.setCommandbarState=function(e,t=!0){var a=this.commandbar;e?(a.show(),a.querySelector("input").focus(),t&&a._addElements(void 0)):a.close()},y.message=function(t,e,a={}){if(t)return a.modal=!0,new A(e,e=>{e.addTextArea(null,t,null,{disabled:!0,fitHeight:!0})},a);throw"No message to show"},y.popup=function(t,e,a={}){if(!t)throw"No message to show";a.size=a.size??["max-content","auto"],a.class="lexpopup";var n=a.timeout||3e3;let i=new A(e,e=>{e.addTextArea(null,t,null,{disabled:!0,fitHeight:!0})},a);return setTimeout(()=>{i.close()},Math.max(n,150)),i},y.prompt=function t(a,n,i,s={}){s.modal=!0,s.className="prompt";let l="",r=new A(n,e=>{e.addTextArea(null,a,null,{disabled:!0,fitHeight:!0}),(s.input??!0)&&e.addText(null,s.input||l,e=>l=e,{placeholder:"..."}),e.sameLine(2),e.addButton(null,"Cancel",()=>{s.on_cancel&&s.on_cancel(),r.close()}),e.addButton(null,s.accept||"Continue",()=>{s.required&&""===l?(a+=a.includes("You must fill the input text.")?"":"\nYou must fill the input text.",r.close(),t(a,n,i,s)):(i&&i.call(this,l),r.close())},{buttonClass:"primary"})},s);return(s.input??!0)&&r.root.querySelector("input").focus(),r},y.toast=function(e,t,a={}){if(!e)throw"The toast needs at least a title!";console.assert(this.notifications);let n=document.createElement("li");n.className="lextoast",n.style.translate="0 calc(100% + 30px)",this.notifications.prepend(n),m(()=>{this.notifications.offsetWidth>this.notifications.iWidth&&(this.notifications.iWidth=Math.min(this.notifications.offsetWidth,480),this.notifications.style.width=this.notifications.iWidth+"px"),n.dataset.open=!0},10);var i=document.createElement("div"),s=(i.className="lextoastcontent",n.appendChild(i),document.createElement("div"));s.className="title",s.innerHTML=e,i.appendChild(s),t&&((e=document.createElement("div")).className="desc",e.innerHTML=t,i.appendChild(e)),a.action&&((s=new k).addButton(null,a.action.name??"Accept",a.action.callback.bind(this,n),{width:"auto",maxWidth:"150px",className:"right",buttonClass:"outline"}),n.appendChild(s.root.childNodes[0]));let l=this;n.close=function(){this.dataset.closed=!0,m(()=>{this.remove(),l.notifications.childElementCount||(l.notifications.style.width="unset",l.notifications.iWidth=0)},500)},(a.closable??!0)&&((t=document.createElement("a")).className="fa fa-xmark lexicon closer",t.addEventListener("click",()=>{n.close()}),n.appendChild(t)),-1!=(i=a.timeout??3e3)&&m(()=>{n.close()},i)},y.badge=function(e,t,a={}){var n=document.createElement("div");return n.innerHTML=e,n.className="lexbadge "+(t??""),Object.assign(n.style,a.style??{}),n.outerHTML},y.makeContainer=function(e,t,a={}){var n=document.createElement("div");return n.className="lexcontainer "+(t??""),n.style.width=e&&e[0]?e[0]:"100%",n.style.height=e&&e[1]?e[1]:"100%",Object.assign(n.style,a),n};class w{constructor(e,t,a){this.name=e,this.value=t,this.domEvent=a}}y.IEvent=w;class L{static NONE=0;static NODE_SELECTED=1;static NODE_DELETED=2;static NODE_DBLCLICKED=3;static NODE_CONTEXTMENU=4;static NODE_DRAGGED=5;static NODE_RENAMED=6;static NODE_VISIBILITY=7;static NODE_CARETCHANGED=8;constructor(e,t,a){this.type=e||L.NONE,this.node=t,this.value=a,this.multiple=!1,this.panel=null}string(){switch(this.type){case L.NONE:return"tree_event_none";case L.NODE_SELECTED:return"tree_event_selected";case L.NODE_DELETED:return"tree_event_deleted";case L.NODE_DBLCLICKED:return"tree_event_dblclick";case L.NODE_CONTEXTMENU:return"tree_event_contextmenu";case L.NODE_DRAGGED:return"tree_event_dragged";case L.NODE_RENAMED:return"tree_event_renamed";case L.NODE_VISIBILITY:return"tree_event_visibility";case L.NODE_CARETCHANGED:return"tree_event_caretchanged"}}}y.TreeEvent=L,y.emit=function(e,t,a={}){var n=y.signals[e];if(n){var i=a.target;if(i)i[e]&&i[e].call(i,t);else for(var s of n)s.constructor===T?(s.set(t,a.skipCallback??!0),s.options&&s.options.callback&&s.options.callback(t,n)):s(null,t)}},y.addSignal=function(e,t,a){t[e]=a,y.signals[e]||(y.signals[e]=[]),-1<y.signals[e].indexOf(t)||y.signals[e].push(t)};class _{constructor(e={}){var n,i,t=document.createElement("div"),a=(t.className="lexarea",e.id&&(t.id=e.id),e.className&&(t.className+=" "+e.className),e.width||"calc( 100% )"),s=e.height||"100%",a=(this.setLimitBox(e.minWidth,e.minHeight,e.maxWidth,e.maxHeight),a.constructor==Number&&(a+="px"),s.constructor==Number&&(s+="px"),t.style.width=a,t.style.height=s,this.offset=0,this.root=t,this.size=[this.root.offsetWidth,this.root.offsetHeight],this.sections=[],this.panels=[],e.skipAppend||document.getElementById("lexroot").appendChild(this.root),e.overlay);function l(e){switch(n.type){case"right":var t=i[0]-e.x,a=n.root.offsetWidth+t;n.root.style.width=a+"px";break;case"left":t=i[0]-e.x,a=Math.min(document.body.clientWidth-y.DEFAULT_SPLITBAR_SIZE,n.root.offsetWidth-t);n.root.style.width=a+"px",n.splitBar.style.left=a+y.DEFAULT_SPLITBAR_SIZE/2+"px";break;case"top":t=i[1]-e.y,a=Math.min(document.body.clientHeight-y.DEFAULT_SPLITBAR_SIZE,n.root.offsetHeight-t);n.root.style.height=a+"px",n.splitBar.style.top=a+y.DEFAULT_SPLITBAR_SIZE/2+"px";break;case"bottom":t=i[1]-e.y,a=n.root.offsetHeight+t;n.root.style.height=a+"px"}i[0]=e.x,i[1]=e.y,e.stopPropagation(),e.preventDefault(),n.onresize&&n.onresize(n.root.getBoundingClientRect())}function r(e){var t=n.root.ownerDocument;t.removeEventListener("mousemove",l),t.removeEventListener("mouseup",r),document.body.classList.remove("nocursor"),n.splitBar.classList.remove("nocursor")}a&&(this.root.classList.add("overlay-"+a),e.left?this.root.style.left=e.left:e.right?this.root.style.right=e.right:e.top?this.root.style.top=e.top:e.bottom&&(this.root.style.bottom=e.bottom),(e.draggable??!0)&&x(t,e),e.resizeable&&t.classList.add("resizeable"),e.resize)&&(this.splitBar=document.createElement("div"),s="left"==a||"right"==a?"horizontal":"vertical",this.type=a,this.splitBar.className="lexsplitbar "+s,"right"==a?(this.splitBar.style.width=y.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.left=-y.DEFAULT_SPLITBAR_SIZE/2+"px"):"left"==a?(t=Math.min(document.body.clientWidth-y.DEFAULT_SPLITBAR_SIZE,this.root.clientWidth),this.splitBar.style.width=y.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.left=t+y.DEFAULT_SPLITBAR_SIZE/2+"px"):"top"==a?(e=Math.min(document.body.clientHeight-y.DEFAULT_SPLITBAR_SIZE,this.root.clientHeight),this.splitBar.style.height=y.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.top=e+y.DEFAULT_SPLITBAR_SIZE/2+"px"):"bottom"==a&&(this.splitBar.style.height=y.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.top=-y.DEFAULT_SPLITBAR_SIZE/2+"px"),this.splitBar.addEventListener("mousedown",function(e){var t=n.root.ownerDocument;t.addEventListener("mousemove",l),t.addEventListener("mouseup",r),i[0]=e.x,i[1]=e.y,e.stopPropagation(),e.preventDefault(),document.body.classList.add("nocursor"),n.splitBar.classList.add("nocursor")}),this.root.appendChild(this.splitBar),n=this,i=[0,0])}attach(e){if(this.sections.length)this.sections[1].attach(e);else{if(!e)throw"no content to attach";(e.parent=this).root.appendChild(e.root||e)}}split(t={}){this.sections.length&&(this.offset=this.root.childNodes[0].offsetHeight,this._root=this.sections[0].root,this.root=this.sections[1].root);var a=t.type||"horizontal",n=t.sizes||["50%","50%"],e="auto"===t.sizes;if(!n[1]){let e=n[0];var i=t.top||0;e.constructor==Number&&(e=e+i+"px"),n[1]="calc( 100% - "+e+" )"}var s,l,i=new _({skipAppend:!0,className:"split"+(t.menubar||t.sidebar?"":" origin")}),r=new _({skipAppend:!0,className:"split"}),o=(i.parentArea=this,r.parentArea=this,t.minimizable??!1),t=(t.resize??!0)||o,d="0px";return this.offset=0,t&&(this.resize=t,this.splitBar=document.createElement("div"),this.splitBar.className="lexsplitbar "+a,"horizontal"==a?this.splitBar.style.width=y.DEFAULT_SPLITBAR_SIZE+"px":this.splitBar.style.height=y.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.addEventListener("mousedown",function(e){var t=l.root.ownerDocument;t.addEventListener("mousemove",c),t.addEventListener("mouseup",h),e.stopPropagation(),e.preventDefault(),document.body.classList.add("nocursor"),l.splitBar.classList.add("nocursor")}),d=y.DEFAULT_SPLITBAR_SIZE/2+"px",o)&&(this.splitExtended=!1,r.root.addEventListener("animationend",e=>{var t=getComputedStyle(r.root).opacity;r.root.classList.remove(e.animationName+"-"+a),r.root.style.opacity=t,C(r.root)}),this.splitBar.addEventListener("contextmenu",e=>{e.preventDefault(),S(null,e,e=>{e.add("Extend",{disabled:this.splitExtended,callback:()=>{this.extend()}}),e.add("Reduce",{disabled:!this.splitExtended,callback:()=>{this.reduce()}})})})),"horizontal"==a?(o=n[0],s=n[1],o.constructor==Number&&(o+="px"),s.constructor==Number&&(s+="px"),i.root.style.width="calc( "+o+" - "+d+" )",i.root.style.height="calc(100% - 0px)",r.root.style.width="calc( "+s+" - "+d+" )",r.root.style.height="calc(100% - 0px)",this.root.style.display="flex"):(i.root.style.width="100%",r.root.style.width="100%",e?(i.root.style.height="auto",new ResizeObserver(e=>{for(var t of e){t=t.contentRect;r.root.style.height="calc(100% - "+(t.height+4)+"px )"}}).observe(i.root)):(o=n[0],s=n[1],o.constructor==Number&&(o+="px"),s.constructor==Number&&(s+="px"),i.root.style.width="100%",i.root.style.height="auto"==o?o:"calc( "+o+" - "+d+" )",r.root.style.height="auto"==s?s:"calc( "+s+" - "+d+" )")),this.root.appendChild(i.root),t&&this.root.appendChild(this.splitBar),this.root.appendChild(r.root),this.sections=[i,r],this.type=a,this._update(),t&&(l=this),this.sections;function c(e){var t;"horizontal"==l.type?l._moveSplit(-e.movementX):l._moveSplit(-e.movementY);for(t of l.root.querySelectorAll(".lexwidget")){var a=t.jsInstance;a.onresize&&a.onresize()}e.stopPropagation(),e.preventDefault()}function h(e){var t=l.root.ownerDocument;t.removeEventListener("mousemove",c),t.removeEventListener("mouseup",h),document.body.classList.remove("nocursor"),l.splitBar.classList.remove("nocursor")}}setLimitBox(e=0,t=0,a=1/0,n=1/0){this.minWidth=e,this.minHeight=t,this.maxWidth=a,this.maxHeight=n}setSize(e){let[t,a]=e;null!=t&&t.constructor==Number&&(t+="px"),null!=a&&a.constructor==Number&&(a+="px"),t&&(this.root.style.width=t),a&&(this.root.style.height=a),this.onresize&&this.onresize(this.root.getBoundingClientRect()),m(()=>{this.size=[this.root.clientWidth,this.root.clientHeight],this.propagateEvent("onresize")},150)}extend(){var e,t;this.splitExtended||([e,t]=this.sections,this.splitExtended=!0,"vertical"==this.type?(this.offset=t.root.offsetHeight,t.root.classList.add("fadeout-vertical"),this._moveSplit(-1/0,!0)):(this.offset=t.root.offsetWidth-8,t.root.classList.add("fadeout-horizontal"),this._moveSplit(-1/0,!0,8)),m(()=>this.propagateEvent("onresize"),150))}reduce(){var e,t;this.splitExtended&&(this.splitExtended=!1,[e,t]=this.sections,"vertical"==this.type?t.root.classList.add("fadein-vertical"):t.root.classList.add("fadein-horizontal"),this._moveSplit(this.offset),m(()=>this.propagateEvent("onresize"),150))}hide(){this.root.classList.add("hidden")}show(){this.root.classList.remove("hidden")}toggle(e){this.root.classList.toggle("hidden",e)}propagateEvent(e){for(var t=0;t<this.sections.length;t++){var a=this.sections[t];a[e]&&a[e].call(this,a.root.getBoundingClientRect()),a.propagateEvent(e)}}addPanel(e){e=new k(e);return this.attach(e),this.panels.push(e),e}addMenubar(e,t={}){var a=new i(t),[e,n]=(e&&e(a),y.menubars.push(a),this.split({type:"vertical",sizes:[48,null],resize:!1,menubar:!0}));return a.siblingArea=n,e.attach(a),e.isMenubar=!0,(t.sticky??!0)&&e.root.classList.add("sticky"),a}addSidebar(e,t={}){var a=new n(t),e=(e&&e(a),a.update(),y.menubars.push(a),t.width??"16rem"),[t,e]=this.split({type:"horizontal",sizes:[e,null],resize:!1,sidebar:!0});return a.siblingArea=e,t.attach(a),t.isSidebar=!0,a}addOverlayButtons(n,i={}){if(this.sections.length)this.sections[1].addOverlayButtons(n,i);else{console.assert(n.constructor==Array&&n.length),this.root.style.position="relative",i.className="lexoverlaybuttons";let s=this.addPanel(i),l=null,e=document.createElement("div"),t=(e.className="lexoverlaybuttonscontainer",e.appendChild(s.root),this.attach(e),i.float);if(t)for(var r=0;r<t.length;r++)switch(t[r]){case"h":break;case"v":e.className+=" vertical";break;case"t":break;case"m":e.className+=" middle";break;case"b":e.className+=" bottom";break;case"l":break;case"c":e.className+=" center";break;case"r":e.className+=" right"}let a=function(n,e,t){var a={width:"auto",selectable:n.selectable,selected:n.selected,icon:n.icon,img:n.img,className:n.class};e&&(l||((l=document.createElement("div")).className="lexoverlaygroup",s.queuedContainer=l),a.parent=l);let i=n.callback;n.options?s.addDropdown(null,n.options,n.name,i,a):s.addButton(null,n.name,function(e,t){var a;n.selectable&&(n.group?(a=n.selected,n.group.forEach(e=>e.selected=!1),n.selected=!a):n.selected=!n.selected),i(e,t)},a),l&&t&&(s.root.appendChild(l),l=null,s.clearQueue())};var o,d;s.clear();for(d of n)if(d.constructor===Array)for(let e=0;e<d.length;++e){var c=d[e];c.group=d,a(c,!0,e==d.length-1)}else a(d);t&&(o=0,s.root.childNodes.forEach(e=>{o+=e.offsetHeight}),e.className.includes("middle"))&&(e.style.top="-moz-calc( 50% - "+.5*o+"px )",e.style.top="-webkit-calc( 50% - "+.5*o+"px )",e.style.top="calc( 50% - "+.5*o+"px )")}}addTabs(e={}){var t=new l(this,e);return e.folding&&(this.parentArea._disableSplitResize(),this.root.style.paddingTop="4px"),t}_moveSplit(t,a=!1,n=0){if(!this.type)throw"No split area";if(void 0!==t){var i,s=this.sections[0],l=s.root,r=(l.classList.contains("origin")||(l=l.parentElement),this.sections[1]),o=r.root,d=" - "+y.DEFAULT_SPLITBAR_SIZE+"px";let e=null;a||(e=l.style.transition,l.style.transition=o.style.transition="none",C(l),C(o)),"horizontal"==this.type?(i=Math.max(o.offsetWidth+t,parseInt(r.minWidth)),l.style.width="-moz-calc( 100% - "+(i=n?n:i)+"px "+d+" )",l.style.width="-webkit-calc( 100% - "+i+"px "+d+" )",l.style.width="calc( 100% - "+i+"px "+d+" )",l.style.minWidth=parseInt(s.minWidth)+"px",o.style.width=i+"px",s.maxWidth!=1/0&&(o.style.minWidth="calc( 100% - "+parseInt(s.maxWidth)+"px )")):(i=Math.max(o.offsetHeight+t+r.offset,parseInt(r.minHeight)),l.style.height="-moz-calc( 100% - "+(i=n?n:i)+"px "+d+" )",l.style.height="-webkit-calc( 100% - "+i+"px "+d+" )",l.style.height="calc( 100% - "+i+"px "+d+" )",l.style.minHeight=s.minHeight+"px",o.style.height=i-r.offset+"px"),a||(l.style.transition=o.style.transition=e),this._update(),this.propagateEvent("onresize")}}_disableSplitResize(){this.resize=!1,this.splitBar.remove(),delete this.splitBar}_update(){var e=this.root.getBoundingClientRect();this.size=[e.width,e.height];for(var t=0;t<this.sections.length;t++)this.sections[t]._update()}}function C(e){e.offsetHeight}y.Area=_;class l{static TAB_SIZE=28;static TAB_ID=0;constructor(a,e={}){this.onclose=e.onclose;var t=document.createElement("div"),n=(t.className="lexareatabs "+(e.fit?"fit":"row"),e.folding??!1);n&&t.classList.add("folding");let i=this;t.addEventListener("dragenter",function(e){e.preventDefault(),this.classList.add("dockingtab")}),t.addEventListener("dragleave",function(e){e.preventDefault(),this.classList.remove("dockingtab")}),t.addEventListener("drop",function(e){e.preventDefault();var e=e.dataTransfer.getData("source"),t=document.getElementById(e);t&&(this.appendChild(t),e=document.getElementById(e+"_content"),i.area.attach(e),this.classList.remove("dockingtab"),y.emit("@on_tab_docked"),t.instance=i,t.click(),i.tabs[t.dataset.name]=e)}),a.root.classList.add("lexareatabscontainer"),a.split({type:"vertical",sizes:e.sizes??"auto",resize:!1,top:6}),a.sections[0].attach(t),this.area=a.sections[1],this.area.root.className+=" lexareatabscontent",this.selected=null,this.root=t,this.tabs={},this.tabDOMs={},e.fit&&((t=document.createElement("span")).className="lexareatab thumb",this.thumb=t,this.root.appendChild(t),new ResizeObserver(e=>{var t,a=this.thumb.item;a&&(t=this.thumb.style.transition,this.thumb.style.transition="none",this.thumb.style.transform="translate( "+a.childIndex*a.offsetWidth+"px )",this.thumb.style.width=a.offsetWidth-5+"px",this.thumb.style.height=a.offsetHeight-6+"px",C(this.thumb),this.thumb.style.transition=t)}).observe(this.area.root)),n&&(this.folded=!0,"up"==(this.folding=n)&&a.root.insertChildAtIndex(a.sections[1].root,0),new ResizeObserver(e=>{for(var t of e){t=t.contentRect;a.parentArea.sections[0].root.style.height="calc(100% - "+(42+t.height)+"px )"}}).observe(this.area.root),this.area.root.classList.add("folded"))}add(e,t,a={}){let n=a.selected??!1,i=(n&&(this.root.querySelectorAll("span").forEach(e=>e.classList.remove("selected")),this.area.root.querySelectorAll(".lextabcontent").forEach(e=>e.style.display="none")),n=!Object.keys(this.tabs).length&&!this.folding||n,t.root||t);i.originalDisplay=i.style.display,i.style.display=n?i.originalDisplay:"none",i.classList.add("lextabcontent"),a.icon&&(a.icon.includes("fa-")?a.icon="<i class='"+a.icon+"'></i>":a.icon="<img src='https://raw.githubusercontent.com/jxarco/lexgui.js/master/"+a.icon+"'>");let s=document.createElement("span");s.dataset.name=e,s.className="lexareatab"+(n?" selected":""),s.innerHTML=(a.icon??"")+e,s.id=e.replace(/\s/g,"")+l.TAB_ID++,s.title=a.title??"",s.selected=n??!1,s.fixed=a.fixed,s.instance=this,i.id=s.id+"_content",s.selected&&(this.selected=e),y.addSignal("@on_tab_docked",s,function(){1==this.parentElement.childNodes.length&&this.parentElement.childNodes[0].click()}),s.addEventListener("click",e=>{var t;e.preventDefault(),e.stopPropagation(),s.fixed||(t=s.selected,s.parentElement.querySelectorAll("span").forEach(e=>e.selected=!1),s.selected=!t,s.parentElement.querySelectorAll("span").forEach(e=>e.classList.remove("selected")),s.classList.toggle("selected",this.folding&&s.selected),s.instance.area.root.querySelectorAll(".lextabcontent").forEach(e=>e.style.display="none"),i.style.display=i.originalDisplay,s.instance.selected=s.dataset.name),this.folding&&(this.folded=s.selected,this.area.root.classList.toggle("folded",!this.folded)),a.onSelect&&a.onSelect(e,s.dataset.name),this.thumb&&(this.thumb.style.transform="translate( "+s.childIndex*s.offsetWidth+"px )",this.thumb.style.width=s.offsetWidth-5+"px",this.thumb.style.height=s.offsetHeight-6+"px",this.thumb.item=s)}),s.addEventListener("contextmenu",e=>{e.preventDefault(),e.stopPropagation(),a.onContextMenu&&a.onContextMenu(e,s.dataset.name)}),s.addEventListener("mouseup",e=>{e.preventDefault(),e.stopPropagation(),1==e.button&&this.delete(s.dataset.name)}),s.setAttribute("draggable",!0),s.addEventListener("dragstart",function(e){1==this.parentElement.childNodes.length?e.preventDefault():e.dataTransfer.setData("source",e.target.id)}),s.childIndex=this.root.childElementCount-1,this.root.appendChild(s),this.area.attach(i),this.tabDOMs[e]=s,this.tabs[e]=t,setTimeout(()=>{a.onCreate&&a.onCreate.call(this,this.area.root.getBoundingClientRect()),n&&this.thumb&&(this.thumb.style.transform="translate( "+s.childIndex*s.offsetWidth+"px )",this.thumb.style.width=s.offsetWidth-5+"px",this.thumb.style.height=s.offsetHeight-6+"px",this.thumb.item=s)},10)}select(e){this.tabDOMs[e]&&this.tabDOMs[e].click()}delete(e){var t=this.tabDOMs[e];t&&!t.fixed&&(this.onclose&&this.onclose(e),this.tabDOMs[e].remove(),delete this.tabDOMs[e],this.tabs[e].remove(),delete this.tabs[e],t=this.root.lastChild)&&!t.fixed&&this.root.lastChild.click()}}y.Tabs=l;class i{constructor(e={}){this.root=document.createElement("div"),this.root.className="lexmenubar",e.float&&(this.root.style.justifyContent=e.float),this.items=[],this.buttons=[],this.icons={},this.shorts={}}_resetMenubar(){this.root.querySelectorAll(".lexmenuentry").forEach(e=>{e.classList.remove("selected"),e.built=!1}),y.root.querySelectorAll(".lexmenubox").forEach(e=>e.remove()),this.focused=!1}_createSubmenu(e,t,a,l){let r=document.createElement("div"),n=(r.className="lexmenubox",r.tabIndex="0",((a.currentMenu=r).parentEntry=a).classList.contains("lexmenuboxentry"));n&&(r.dataset.submenu=!0),r._updatePosition=()=>{let t=r.style.transition;r.style.transition="none",C(r),m(()=>{var e=a.getBoundingClientRect();e.x+=document.scrollingElement.scrollLeft,e.y+=document.scrollingElement.scrollTop,r.style.left=(n?e.x+e.width:e.x)+"px",r.style.top=(n?e.y:e.y+e.height-4)+"px",r.style.transition=t})},r._updatePosition(),m(()=>{r.dataset.open=!0},10),y.root.appendChild(r);for(var o=0;o<e[t].length;++o){let a=e[t][o],n=Object.keys(a)[0];var d,c,h=a[n].length,u="checkbox"==a.type;let i=document.createElement("div"),s=(i.className="lexmenuboxentry",i.className+=(o==e[t].length-1?" last":"")+(a.disabled?" disabled":""),""==n?i.className=" lexseparator":(i.id=n,(d=document.createElement("div")).innerHTML="",d.classList="lexmenuboxentrycontainer",i.appendChild(d),c=this.icons[n],u?d.innerHTML+="<input type='checkbox' >":c?d.innerHTML+="<a class='"+c+" fa-sm'></a>":(d.innerHTML+="<a class='fa-solid fa-sm noicon'></a>",d.classList.add("noicon")),d.innerHTML+="<div class='lexentryname'>"+n+"</div>"),i.querySelector("input"));s&&(s.checked=a.checked??!1,s.addEventListener("change",e=>{a.checked=s.checked;var t=a.callback;t&&(t.call(this,a.checked,n,i),this._resetMenubar()),e.stopPropagation(),e.stopImmediatePropagation()})),r.appendChild(i),""!=n&&(r.addEventListener("keydown",e=>{e.preventDefault();let t=this.shorts[n];t&&(t=1==t.length?t.toLowerCase():t)==e.key&&i.click()}),i.addEventListener("click",e=>{s&&(a.checked=!a.checked);var t=a.callback;t&&(t.call(this,s?a.checked:n,s?n:i),this._resetMenubar()),e.stopPropagation(),e.stopImmediatePropagation()}),h?((u=document.createElement("a")).className="fa-solid fa-angle-right fa-xs",i.appendChild(u),i.addEventListener("mouseover",e=>{i.built||(i.built=!0,this._createSubmenu(a,n,i,++l),e.stopPropagation())}),i.addEventListener("mouseleave",e=>{i.currentMenu&&i.currentMenu!=e.toElement&&(l=-1,delete i.built,i.currentMenu.remove(),delete i.currentMenu)})):this.shorts[n]&&((c=document.createElement("div")).className="lexentryshort",c.innerText=this.shorts[n],i.appendChild(c)))}r.style.width=r.offsetWidth+"px"}add(e,s={}){s.constructor==Function&&(s={callback:s});let l=e.split("/");e=l[l.length-1];this.icons[e]=s.icon,this.shorts[e]=s.short;let r=0,o=(n,e)=>{if(null!=n){let a=null;var t,i;e.forEach(e=>{var t=Object.keys(e).find(e=>e==n);t&&(a=e[t])}),a?o(l[r++],a):((t={})[n]=[],(i=l[r++])||(t.callback=s.callback,t.disabled=s.disabled,t.type=s.type,t.checked=s.checked),e.push(t),o(i,t[n]))}};o(l[r++],this.items);for(let i of this.items){let n=Object.keys(i)[0];var d=n.replace(/\s/g,"").replaceAll(".","");if(!this.root.querySelector("#"+d)){let t=document.createElement("div"),a=(t.className="lexmenuentry",t.id=d,t.innerHTML="<span>"+n+"</span>",t.tabIndex="1","left"==s.position?this.root.prepend(t):("right"==s.position&&(t.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(t):this.root.appendChild(t)),()=>{this._resetMenubar(),t.classList.add("selected"),t.built=!0,this._createSubmenu(i,n,t,-1)});t.addEventListener("click",()=>{var e=i.callback;e?e.call(this,n,t):(a(),this.focused=!0)}),t.addEventListener("mouseover",e=>{this.focused&&!t.built&&a()}),t.addEventListener("blur",e=>{e.relatedTarget&&e.relatedTarget.classList.contains("lexmenubox")||this._resetMenubar()})}}}getButton(e){return this.buttons[e]}getSubitem(t,a){var n=a[0];for(let e=0;e<t.length;e++)if(t[e][n])return 1==a.length?t[e]:(a.splice(0,1),this.getSubitem(t[e][n],a))}getItem(e){e=e.split("/");return this.getSubitem(this.items,e)}setButtonIcon(e,n,i,s={}){if(!e)throw"Set Button Name!";let l=this.buttons[e];if(l)l.querySelector("a").className="fa-solid "+n+" lexicon";else{l=document.createElement("div");let t=s.disabled??!1,a=(l.className="lexmenubutton main"+(t?" disabled":""),l.title=e,l.innerHTML="<a class='"+n+" lexicon'></a>","right"==s.float&&(l.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(l):"left"==s.float?this.root.prepend(l):this.root.appendChild(l),l.querySelector("a"));a.addEventListener("click",e=>{i&&!t&&i.call(this,a,e)}),this.buttons[e]=l}}setButtonImage(e,n,i,s={}){if(!e)throw"Set Button Name!";let l=this.buttons[e];if(l)l.querySelector("img").src=n;else{l=document.createElement("div");let t=s.disabled??!1,a=(l.className="lexmenubutton"+(t?" disabled":""),l.title=e,l.innerHTML="<a><image src='"+n+"' class='lexicon' style='height:32px;'></a>","right"==s.float&&(l.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(l):"left"==s.float?this.root.prepend(l):this.root.appendChild(l),l.querySelector("a"));a.addEventListener("click",e=>{i&&!t&&i.call(this,a,e)}),this.buttons[e]=l}}addButtons(s,e={}){if(!s)throw"No buttons to add!";this.buttonContainer||(this.buttonContainer=document.createElement("div"),this.buttonContainer.className="lexmenubuttons",this.buttonContainer.classList.add(e.float??"center"),"right"==e.position&&(this.buttonContainer.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(this.buttonContainer):this.root.appendChild(this.buttonContainer));for(let t=0;t<s.length;++t){let a=s[t],n=document.createElement("label");var l=a.title;let i=a.disabled??!1;n.className="lexmenubutton"+(i?" disabled":""),n.title=l??"",this.buttonContainer.appendChild(n);var r=document.createElement("a");r.className=a.icon+" lexicon",n.appendChild(r);let e=r;a.swap&&(n.classList.add("swap"),r.classList.add("swap-off"),(r=document.createElement("input")).type="checkbox",n.prepend(r),e=r,(r=document.createElement("a")).className=a.swap+" swap-on lexicon",n.appendChild(r),n.swap=function(){var e=this.querySelector("input");e.checked=!e.checked},n.setState=function(e){this.querySelector("input").checked=e}),e.addEventListener("click",e=>{var t;a.callback&&!i&&(t=n.querySelector("input"),a.callback.call(this,e,t?.checked))}),l&&(this.buttons[l]=n)}}}y.Menubar=i;class n{constructor(e={}){var t;this.root=document.createElement("div"),this.root.className="lexsidebar",this.collapsable=e.collapsable??!0,this._collapseWidth=e.collapseToIcons??!0?"58px":"0px",this.collapsed=!1,this.filterString="",m(()=>{this.root.parentElement.ogWidth=this.root.parentElement.style.width,this.root.parentElement.style.transition="width 0.25s ease-out",this.resizeObserver=new ResizeObserver(e=>{for(var t of e)this.siblingArea.setSize(["calc(100% - "+t.contentRect.width+"px )",null])})},10),e.skipHeader||(this.header=e.header??this._generateDefaultHeader(e),console.assert(this.header.constructor===HTMLDivElement,"Use an HTMLDivElement to build your custom header"),this.header.className="lexsidebarheader",this.root.appendChild(this.header),this.collapsable&&(t=y.makeIcon("Sidebar","Toggle Sidebar","toggler"),this.header.appendChild(t),t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.toggleCollapsed()}))),e.filter&&((t=new k).addText(null,"",(e,t)=>{this.filterString=e,this.update()},{placeholder:"Search...",icon:"fa-solid fa-magnifying-glass"}),this.filter=t.root.childNodes[0],this.root.appendChild(this.filter)),this.content=document.createElement("div"),this.content.className="lexsidebarcontent",this.root.appendChild(this.content),e.skipFooter||(this.footer=e.footer??this._generateDefaultFooter(e),console.assert(this.footer.constructor===HTMLDivElement,"Use an HTMLDivElement to build your custom footer"),this.footer.className="lexsidebarfooter",this.root.appendChild(this.footer)),m(()=>{var e=32+(this.header?.offsetHeight??0)+(this.filter?.offsetHeight??0)+(this.footer?.offsetHeight??0);this.content.style.height=`calc(100% - ${e}px)`},10),this.items=[],this.icons={},this.groups={}}_generateDefaultHeader(t){var e=document.createElement("div"),a=(e.addEventListener("click",e=>{this.collapsed?(e.preventDefault(),e.stopPropagation(),this.toggleCollapsed()):t.onHeaderPressed&&t.onHeaderPressed(e)}),document.createElement("span")),a=(a.className="lexavatar",e.appendChild(a),t.headerImage?((n=document.createElement("img")).src=t.headerImage,a.appendChild(n)):t.headerIcon&&(n=y.makeIcon(t.headerIcon),a.appendChild(n)),document.createElement("div")),n=(a.className="infodefault",e.appendChild(a),document.createElement("span")),n=(n.innerHTML=t.headerTitle??"",a.appendChild(n),document.createElement("span"));return n.innerHTML=t.headerSubtitle??"",a.appendChild(n),e}_generateDefaultFooter(t){var e=document.createElement("div"),a=(e.addEventListener("click",e=>{t.onFooterPressed&&t.onFooterPressed(e)}),document.createElement("span")),a=(a.className="lexavatar",e.appendChild(a),t.footerImage?((n=document.createElement("img")).src=t.footerImage,a.appendChild(n)):t.footerIcon&&(n=y.makeIcon(t.footerIcon),a.appendChild(n)),document.createElement("div")),n=(a.className="infodefault",e.appendChild(a),document.createElement("span")),n=(n.innerHTML=t.footerTitle??"",a.appendChild(n),document.createElement("span")),a=(n.innerHTML=t.footerSubtitle??"",a.appendChild(n),y.makeIcon("MenuArrows"));return e.appendChild(a),e}toggleCollapsed(e){if(this.collapsable){if(this.collapsed=e??!this.collapsed,this.collapsed?(this.root.classList.add("collapsing"),this.root.parentElement.style.width=this._collapseWidth):(this.root.classList.remove("collapsing"),this.root.classList.remove("collapsed"),this.root.parentElement.style.width=this.root.parentElement.ogWidth),!this.resizeObserver)throw"Wait until ResizeObserver has been created!";this.resizeObserver.observe(this.root.parentElement),m(()=>{this.root.classList.toggle("collapsed",this.collapsed),this.resizeObserver.unobserve(this.root.parentElement)},250)}}separator(){this.currentGroup=null,this.add("")}group(e,t){this.currentGroup=e,this.groups[e]=t}add(e,s={}){s.constructor==Function&&(s={callback:s});let l=e.split("/");e=l[l.length-1];this.icons[e]=s.icon;let r=0,o=(n,e)=>{if(null!=n){let a=null;var t,i;e.forEach(e=>{var t=Object.keys(e).find(e=>e==n);t&&(a=e[t])}),a?o(l[r++],a):((t={})[n]=[],(i=l[r++])||(t.callback=s.callback,t.group=this.currentGroup,t.options=s),e.push(t),o(i,t[n]))}};o(l[r++],this.items)}select(e){let t=e.replace(/\s/g,"").replaceAll(".","");e=this.items.find(e=>e.name===t);e&&e.dom.click()}update(){this.content.innerHTML="";for(var e of this.items)delete e.dom;for(let r of this.items){let n=r.options??{};if(!r.dom){let l=Object.keys(r)[0];if(!this.filterString.length||l.toLowerCase().includes(this.filterString.toLowerCase())){var i=l.replace(/\s/g,"").replaceAll(".","");let t=null,s=document.createElement("div");if(s.className="lexsidebarentry "+(n.className??""),s.id=r.name=i,r.group){var a=r.group.replace(/\s/g,"").replaceAll(".","");if(t=this.content.querySelector("#"+a)){if(!t.classList.contains("lexsidebargroup"))throw"Bad id: "+r.group}else{(t=document.createElement("div")).id=a,t.className="lexsidebargroup",this.content.appendChild(t);var a=document.createElement("div"),o=(a.className="lexsidebargrouptitle",t.appendChild(a),document.createElement("div"));o.innerHTML=r.group,a.appendChild(o),null!=this.groups[r.group]&&((o=document.createElement("a")).className=(this.groups[r.group].icon??"")+" lexicon",a.appendChild(o),o.addEventListener("click",e=>{this.groups[r.group].callback&&this.groups[r.group].callback(r.group,e)}))}}if(""==i){a=document.createElement("div");a.className="lexsidebarseparator",this.content.appendChild(a)}else{this.collapseContainer?(this.collapseContainer.appendChild(s),this.collapseQueue--,this.collapseQueue||delete this.collapseContainer):(t||this.content).appendChild(s);let a=document.createElement("div");s.appendChild(a),r.dom=s,"checkbox"==n.type?(r.value=n.value??!1,o=new k,r.checkbox=o.addCheckbox(null,r.value,(e,t)=>{t.preventDefault(),t.stopPropagation();var a=n.callback;r.value=e,a&&a.call(this,l,e,t)},{label:l,signal:"@checkbox_"+l}),a.appendChild(o.root.childNodes[0])):(n.icon&&((i=document.createElement("i")).className=n.icon,a.appendChild(i)),(i=document.createElement("a")).innerHTML=l,a.appendChild(i)),s.addEventListener("click",e=>{var t;e.target&&e.target.classList.contains("lexcheckbox")||(n.collapsable?a.querySelector(".collapser").click():((t=n.callback)&&t.call(this,l,r.value,e),r.checkbox&&(r.value=!r.value,r.checkbox.set(r.value,!0))),this.root.querySelectorAll(".lexsidebarentry").forEach(e=>e.classList.remove("selected")),s.classList.add("selected"))});var d,i=null!=n.collapsable?n.collapsable:n.collapsable||r[l].length;n.action?(d=y.makeIcon(n.action.icon??"MoreHorizontal",n.action.name),a.appendChild(d),d.addEventListener("click",e=>{e.preventDefault(),e.stopImmediatePropagation();var t=n.action.callback;t&&t.call(this,l,e)})):i&&(d=document.createElement("div"),Object.assign(d.style,{width:"100%",display:"none"}),y.makeCollapsible(a,d,t??this.content),this.collapseQueue=n.collapsable,this.collapseContainer=d);let e=document.createElement("span");if(e.className="lexsidebarentrydesc",e.innerHTML=l,s.appendChild(e),a.addEventListener("mouseenter",()=>{setTimeout(()=>{e.style.display="unset"},150)}),a.addEventListener("mouseleave",()=>{setTimeout(()=>{e.style.display="none"},150)}),r[l].length){var c=document.createElement("div");c.className="lexsidebarsubentrycontainer",i?(this.collapseContainer.appendChild(c),delete this.collapseContainer):(t||this.content).appendChild(c);for(let e=0;e<r[l].length;++e){var h=r[l][e];let n=h.options??{},i=Object.keys(h)[0];if(!this.filterString.length||i.toLowerCase().includes(this.filterString.toLowerCase())){let a=document.createElement("div");a.innerHTML=`<span>${i}</span>`,n.action&&(h=y.makeIcon(n.action.icon??"MoreHorizontal",n.action.name),a.appendChild(h),h.addEventListener("click",e=>{e.preventDefault(),e.stopImmediatePropagation();var t=n.action.callback;t&&t.call(this,i,e)})),a.className="lexsidebarentry",a.id=i,c.appendChild(a),a.addEventListener("click",e=>{var t=n.callback;t&&t.call(this,i,a,e),this.root.querySelectorAll(".lexsidebarentry").forEach(e=>e.classList.remove("selected")),s.classList.add("selected")})}}}}}}}}}y.SideBar=n;class T{static NONE=0;static TEXT=1;static TEXTAREA=2;static BUTTON=3;static DROPDOWN=4;static CHECKBOX=5;static TOGGLE=6;static RADIO=7;static BUTTONS=8;static COLOR=9;static RANGE=10;static NUMBER=11;static TITLE=12;static VECTOR=13;static TREE=14;static PROGRESS=15;static FILE=16;static LAYERS=17;static ARRAY=18;static LIST=19;static TAGS=20;static CURVE=21;static CARD=22;static IMAGE=23;static CONTENT=24;static CUSTOM=25;static SEPARATOR=26;static KNOB=27;static SIZE=28;static PAD=29;static FORM=30;static DIAL=31;static COUNTER=32;static TABLE=33;static TABS=34;static BLANK=35;static NO_CONTEXT_TYPES=[T.BUTTON,T.LIST,T.FILE,T.PROGRESS];constructor(e,t,a,n){this.name=e,this.type=t,this.options=n,this._initialValue=a}value(){if(this.onGetValue)return this.onGetValue();console.warn("Can't get value of "+this.typeName())}set(e,t,a){var n;if(this.onSetValue)return(n=this.domEl.querySelector(".lexwidgetname .lexicon"))&&(n.style.display=e!=this.value()?"block":"none",n.style.display=e!=this._initialValue?"block":"none"),this.onSetValue(e,t??!1,a);console.warn("Can't set value of "+this.typeName())}oncontextmenu(e){T.NO_CONTEXT_TYPES.includes(this.type)||S(this.typeName(),e,e=>{e.add("Copy",()=>{this.copy()}),e.add("Paste",{disabled:!this._can_paste(),callback:()=>{this.paste()}})})}copy(){navigator.clipboard.type=this.type,navigator.clipboard.customIdx=this.customIdx,navigator.clipboard.data=this.value(),navigator.clipboard.writeText(navigator.clipboard.data)}_can_paste(){return this.type===T.CUSTOM?void 0!==navigator.clipboard.customIdx&&this.customIdx==navigator.clipboard.customIdx:navigator.clipboard.type===this.type}paste(){this._can_paste()&&this.set(navigator.clipboard.data)}typeName(){switch(this.type){case T.TEXT:return"Text";case T.TEXTAREA:return"TextArea";case T.BUTTON:return"Button";case T.DROPDOWN:return"Dropdown";case T.CHECKBOX:return"Checkbox";case T.TOGGLE:return"Toggle";case T.RADIO:return"Radio";case T.COLOR:return"Color";case T.RANGE:return"Range";case T.NUMBER:return"Number";case T.VECTOR:return"Vector";case T.TREE:return"Tree";case T.PROGRESS:return"Progress";case T.FILE:return"File";case T.LAYERS:return"Layers";case T.ARRAY:return"Array";case T.LIST:return"List";case T.TAGS:return"Tags";case T.CURVE:return"Curve";case T.KNOB:return"Knob";case T.SIZE:return"Size";case T.PAD:return"Pad";case T.FORM:return"Form";case T.DIAL:return"Dial";case T.COUNTER:return"Counter";case T.TABLE:return"Table";case T.TABS:return"Tabs";case T.BLANK:return"Blank";case T.CUSTOM:return this.customName}console.error("Unknown Widget type: "+this.type)}refresh(){}}y.Widget=T,y.ADD_CUSTOM_WIDGET=function(p,m={}){let e=b();k.prototype["add"+p]=function(i,s,l){let r=this._createWidget(T.CUSTOM,i,null,m),o=(r.customName=p,r.customIdx=e,r.onGetValue=()=>s,r.onSetValue=(e,t,a)=>{s=e,u(),o.querySelector(".lexcustomitems").toggleAttribute("hidden",!1),t||this._trigger(new w(i,s,a),l)},r.domEl);o.style.flexWrap="wrap";let d,c,h=m.default??{},u=()=>{s&&(r.instance=s=Object.assign(g(h),s)),d&&d.remove(),c&&c.remove(),(d=document.createElement("div")).className="lexcustomcontainer",d.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")",this.queue(d);var e="<a class='fa-solid "+(m.icon??"fa-cube")+"' style='float:left'></a>",e=(e=e+(p+(s?"":" [empty]"))+("<a class='fa-solid "+(s?"fa-bars-staggered":" ")+" menu' style='float:right; width:5%;'></a>"),this.addButton(null,e,(e,t)=>{s?o.querySelector(".lexcustomitems").toggleAttribute("hidden"):S(null,t,e=>{e.add("New "+p,()=>{s={},u(),o.querySelector(".lexcustomitems").toggleAttribute("hidden",!1)})})},{buttonClass:"custom"}));if(this.clearQueue(),s&&e.querySelector("a.menu").addEventListener("click",e=>{e.stopImmediatePropagation(),e.stopPropagation(),S(null,e,e=>{e.add("Clear",()=>{s=null,u()})})}),(c=document.createElement("div")).className="lexcustomitems",c.toggleAttribute("hidden",!0),o.appendChild(d),o.appendChild(c),s){this.queue(c);var t,a=(e,t,a)=>{s[e]=t,this._trigger(new w(i,s,a),l)};for(t in h){var n=s[t]??h[t];switch(n.constructor){case String:"#"===n[0]?this.addColor(t,n,a.bind(this,t)):this.addText(t,n,a.bind(this,t));break;case Number:this.addNumber(t,n,a.bind(this,t));break;case Boolean:this.addCheckbox(t,n,a.bind(this,t));break;case Array:4<n.length?this.addArray(t,n,a.bind(this,t)):this._add_vector(n.length,t,n,a.bind(this,t))}}this.clearQueue()}};u()}};class N{constructor(e,t,a){if(this.domEl=e,this.data=t,this.onevent=a.onevent,this.options=a,this.selected=[],t.constructor===Object)this._create_item(null,t);else for(var n of t)this._create_item(null,n)}_create_item(e,s,t=0,a){let l=this;var n=this.domEl.querySelector("#lexnodetree_filter");if(s.children=s.children??[],n&&!s.id.includes(n.value)||null!=a&&a!=s.id){for(var i=0;i<s.children.length;++i)this._create_item(s,s.children[i],t+1,a);return}let r=this.domEl.querySelector("ul"),o=(s.visible=s.visible??!0,s.parent=e,0<s.children.length);n=-1<this.selected.indexOf(s)||s.selected;if(this.options.onlyFolders){let t=!1;s.children.forEach(e=>t|="folder"==e.type),o=!!t}let d=document.createElement("li"),c=(d.className="lextreeitem datalevel"+t+(o?" parent":"")+(n?" selected":""),d.id=y.getSupportedDOMName(s.id),d.tabIndex="0",this.options.skip_default_icon??!0?"":"fa-solid fa-square");o&&(c=s.closed?"fa-solid fa-caret-right":"fa-solid fa-caret-down"),d.innerHTML="<a class='"+c+" hierarchy'></a>",c=s.icon,s.icon&&(s.icon.includes("fa-")?d.innerHTML+="<a class='"+s.icon+" tree-item-icon'></a>":d.innerHTML+="<img src='https://raw.githubusercontent.com/jxarco/lexgui.js/master/"+s.icon+"'>"),d.innerHTML+=s.rename?"":s.id,d.setAttribute("draggable",!0),d.style.paddingLeft=(o?0:3)+(3+15*(t+1))+"px",r.appendChild(d),d.addEventListener("click",e=>{var t;h?h=!1:(e.shiftKey||(r.querySelectorAll("li").forEach(e=>{e.classList.remove("selected")}),this.selected.length=0),-1<(t=this.selected.indexOf(s))?(d.classList.remove("selected"),this.selected.splice(t,1)):(d.classList.add("selected"),this.selected.push(s)),o&&1<s.id.length&&(s.closed=!1,l.onevent&&(t=new L(L.NODE_CARETCHANGED,s,s.closed),l.onevent(t)),l.frefresh(s.id)),l.onevent&&((t=new L(L.NODE_SELECTED,e.shiftKey?this.selected:s)).multiple=e.shiftKey,l.onevent(t)))}),d.addEventListener("dblclick",function(){var e;(l.options.rename??!0)&&(s.rename=!0,l.refresh()),l.onevent&&(e=new L(L.NODE_DBLCLICKED,s),l.onevent(e))}),d.addEventListener("contextmenu",a=>{if(a.preventDefault(),l.onevent){let t=new L(L.NODE_CONTEXTMENU,1<this.selected.length?this.selected:s,a);t.multiple=1<this.selected.length,y.addContextMenu(t.multiple?"Selected Nodes":t.node.id,t.value,e=>{t.panel=e}),l.onevent(t),1==(this.options.addDefault??!1)&&(t.panel.items&&t.panel.add(""),t.panel.add("Select Children",()=>{let a=e=>{if(!e.closed)for(var t of e.children??[])t&&(this.domEl.querySelector("#"+t.id).classList.add("selected"),this.selected.push(t),a(t))};a(s)}),t.panel.add("Delete",{callback:()=>{var e,t;s.parent&&(l.onevent&&(e=new L(L.NODE_DELETED,s,a),l.onevent(e)),t=(e=s.parent.children).indexOf(s),e.splice(t,1),this.refresh())}}))}}),d.addEventListener("keydown",e=>{if(!s.rename)if(e.preventDefault(),"Delete"==e.key){var t;l.onevent&&((i=new L(L.NODE_DELETED,1<this.selected.length?this.selected:s,e)).multiple=1<this.selected.length,l.onevent(i));for(t of this.selected){var a=t.parent.children,n=a.indexOf(t);a.splice(n,1)}this.selected.length=0,this.refresh()}else{var i;("ArrowUp"==e.key||"ArrowDown"==e.key)&&(i=1<this.selected.length?"ArrowUp"==e.key?this.selected.shift():this.selected.pop():this.selected[0],i=this.domEl.querySelector("#"+y.getSupportedDOMName(i.id)),e="ArrowUp"==e.key?i.previousSibling:i.nextSibling)&&e.click()}});n=document.createElement("input");n.toggleAttribute("hidden",!s.rename),n.value=s.id,d.appendChild(n),s.rename&&(d.classList.add("selected"),n.focus()),n.addEventListener("keyup",function(e){var t;"Enter"==e.key?(this.value=this.value.replace(/\s/g,"_"),l.onevent&&(t=new L(L.NODE_RENAMED,s,this.value),l.onevent(t)),s.id=y.getSupportedDOMName(this.value),delete s.rename,l.frefresh(s.id),r.querySelector("#"+s.id).classList.add("selected")):"Escape"==e.key&&(delete s.rename,l.frefresh(s.id))}),n.addEventListener("blur",function(e){delete s.rename,l.refresh()}),(this.options.draggable??!0)&&(e&&d.addEventListener("dragstart",e=>{window.__tree_node_dragged=s}),d.addEventListener("dragover",e=>{e.preventDefault()},!1),d.addEventListener("dragenter",e=>{e.target.classList.add("draggingover")}),d.addEventListener("dragleave",e=>{e.target.classList.remove("draggingover")}),d.addEventListener("drop",e=>{e.preventDefault();let t=window.__tree_node_dragged;if(t){var a,e=s;if(t.id==e.id)console.warn("Cannot parent node to itself!");else{let i=function(e,t){var a,n=!1;for(a of t.children){if(a.id==e.id)return!0;n|=i(e,a)}return n};i(e,t)?console.warn("Cannot parent node to a current child!"):(l.onevent&&(a=new L(L.NODE_DRAGGED,t,e),l.onevent(a)),a=t.parent.children.findIndex(e=>e.id==t.id),a=t.parent.children.splice(a,1),e.children.push(a[0]),l.refresh(),delete window.__tree_node_dragged)}}}));let h=!1;o&&d.querySelector("a.hierarchy").addEventListener("click",function(e){h=!0,e.stopImmediatePropagation(),e.stopPropagation(),s.closed=!s.closed,l.onevent&&(e=new L(L.NODE_CARETCHANGED,s,s.closed),l.onevent(e)),l.frefresh(s.id)});var u=document.createElement("div");if(d.appendChild(u),s.actions)for(let e=0;e<s.actions.length;++e){let t=s.actions[e],a=document.createElement("a");a.className="lexicon "+t.icon,a.title=t.name,a.addEventListener("click",function(e){t.callback(s,a),e.stopPropagation()}),u.appendChild(a)}if(s.skipVisibility||((n=document.createElement("a")).className="lexicon fa-solid fa-eye"+(s.visible?"":"-slash"),n.title="Toggle visible",n.addEventListener("click",function(e){e.stopPropagation(),s.visible=void 0!==s.visible&&!s.visible,this.className="lexicon fa-solid fa-eye"+(s.visible?"":"-slash"),l.onevent&&(e=new L(L.NODE_VISIBILITY,s,s.visible),l.onevent(e))}),u.appendChild(n)),null!=a&&s.id==a&&(this.selected=[s],d.click()),!s.closed)for(i=0;i<s.children.length;++i){var p=s.children[i];this.options.onlyFolders&&"folder"!=p.type||this._create_item(s,p,t+1)}}refresh(e,t){this.data=e??this.data,this.domEl.querySelector("ul").innerHTML="",this._create_item(null,this.data,0,t)}frefresh(e){this.refresh();e=this.domEl.querySelector("#"+e);e&&e.focus()}select(e){this.refresh(null,e)}}class k{constructor(e={}){var t=document.createElement("div");t.className="lexpanel",e.id&&(t.id=e.id),e.className&&(t.className+=" "+e.className),t.style.width=e.width||"calc( 100% - 6px )",t.style.height=e.height||"100%",Object.assign(t.style,e.style??{}),this._inline_widgets_left=-1,this._inline_queued_container=null,this.root=t,this.onevent=e=>{},this._branchOpen=!1,this.branches=[],this._currentBranch=null,this.widgets={},this._queue=[]}get(e){return this.widgets[e]}getValue(e){var t=this.widgets[e];if(t)return t.value();throw"No widget called "+e}setValue(e,t,a){var n=this.widgets[e];if(n)return n.set(t,a);throw"No widget called "+e}attach(e){console.assert(e,"No content to attach!"),(e.parent=this).root.appendChild(e.root||e)}clear(){for(var t in this._branchOpen=!1,this.branches=[],this._currentBranch=null,this.widgets)if(this.widgets[t].options&&this.widgets[t].options.signal){var a=this.widgets[t].options.signal;for(let e=0;e<y.signals[a].length;e++)y.signals[a][e]==this.widgets[t]&&(y.signals[a]=[...y.signals[a].slice(0,e),...y.signals[a].slice(e+1)])}if(this.signals)for(let e=0;e<this.signals.length;e++){var n=Object.values(this.signals[e])[0],i=n.options.signal;for(let e=0;e<y.signals[i].length;e++)y.signals[i][e]==n&&(y.signals[i]=[...y.signals[i].slice(0,e),...y.signals[i].slice(e+1)])}this.widgets={},this.root.innerHTML=""}sameLine(e){this._inline_queued_container=this.queuedContainer,this._inline_widgets_left=e||1/0}endLine(e){if(-1==this._inline_widgets_left)console.warn("No pending widgets to be inlined!");else{this._inline_widgets_left=-1,this._inlineContainer||(this._inlineContainer=document.createElement("div"),this._inlineContainer.className="lexinlinewidgets",e&&(this._inlineContainer.style.justifyContent=e));for(var t of this._inlineWidgets)t.constructor==Array?(this._inline_queued_container?this._inlineContainer:t[1]).appendChild(t[0]):this._inlineContainer.appendChild(t);(this._inline_queued_container||(this._currentBranch?this._currentBranch.content:this.root)).appendChild(this._inlineContainer),delete this._inlineWidgets,delete this._inlineContainer}}branch(e,t={}){this._branchOpen&&this.merge();e=new a(e,t);return(e.panel=this)._branchOpen=!0,this._currentBranch=e,0==this.branches.length&&e.root.classList.add("first"),this.root.querySelectorAll(".lexbranch.last").forEach(e=>{e.classList.remove("last")}),e.root.classList.add("last"),this.branches.push(e),this.root.appendChild(e.root),t.filter&&this._addFilter(t.filter,{callback:this._searchWidgets.bind(this,e.name)}),e}merge(){this._branchOpen=!1,this._currentBranch=null}_pick(e,t){return void 0===e?t:e}static _dispatch_event(e,t,a,n,i){t=new CustomEvent(t,{detail:a,bubbles:n,cancelable:i});e.dispatchEvent(t)}static _add_reset_property(e,t){var a=document.createElement("a");return a.style.display="none",a.style.marginRight="6px",a.className="lexicon fa fa-rotate-left",a.addEventListener("click",t),e.appendChild(a),a}_createWidget(e,t,a,n={}){y.CREATED_INSTANCES||(y.CREATED_INSTANCES=[]),y.CREATED_INSTANCES[e]=!0;let i=new T(t,e,a,n);var s=document.createElement("div"),a=(s.className="lexwidget",s.id=n.id??"",s.title=n.title??"",n.className&&(s.className+=" "+n.className),e!=T.TITLE&&(s.style.width="calc(100% - "+(this._currentBranch||e==T.FILE||e==T.TREE?10:20)+"px)",n.width&&(s.style.width=s.style.minWidth=n.width),n.maxWidth&&(s.style.maxWidth=n.maxWidth),n.minWidth&&(s.style.minWidth=n.minWidth),n.height)&&(s.style.height=s.style.minHeight=n.height),null!=t?(n.hideName||((e=document.createElement("div")).className="lexwidgetname",n.justifyName&&e.classList.add("float-"+n.justifyName),e.innerHTML=t,e.title=n.title??e.innerHTML,e.style.width=n.nameWidth||y.DEFAULT_NAME_WIDTH,s.appendChild(e),(s.domName=e).addEventListener("contextmenu",function(e){e.preventDefault(),i.oncontextmenu(e)}),n.skipReset)||null==a||k._add_reset_property(e,function(e){i.set(i._initialValue,!1,e),this.style.display="none"}),this.widgets[t]=i):n.hideName=!0,n.signal&&(t||(this.signals||(this.signals=[]),this.signals.push({[n.signal]:i})),y.addSignal(n.signal,i)),(i.domEl=s).jsInstance=i,e=>{(n.container||this.queuedContainer||(this._currentBranch?(n.skipWidget||this._currentBranch.widgets.push(i),this._currentBranch.content):(e.classList.add("nobranch"),this.root))).appendChild(e)}),e=e=>{this.queuedContainer?this._inlineWidgets.push([e,this.queuedContainer]):this._inlineWidgets.push(e)};return 0<this._inline_widgets_left&&!n.skipInlineCount?(this._inlineWidgets||(this._inlineWidgets=[]),e(s),this._inline_widgets_left--,this._inline_widgets_left||this.endLine()):a(s),i}_addFilter(e,t={}){t.placeholder=e.constructor==String?e:"Filter properties..",t.skipWidget=t.skipWidget??!0,t.skipInlineCount=!0;e=this._createWidget(T.TEXT,null,null,t).domEl;e.className+=" lexfilter noname";let a=document.createElement("input");a.className="lexinput-filter",a.setAttribute("placeholder",t.placeholder),a.style.width="calc( 100% - 17px )",a.value=t.filterValue||"";var n=document.createElement("a");return n.className="fa-solid fa-magnifying-glass",e.appendChild(n),e.appendChild(a),a.addEventListener("input",e=>{t.callback&&t.callback(a.value,e)}),e}_searchWidgets(e,t){for(var a of this.branches)if(a.name===e){for(var n of a.widgets)n.domEl.classList.contains("lexfilter")||n.domEl.remove();this.queue(a.content);var i,s=!t.length;for(i of a.widgets){if(!s){if(!i.name)continue;t.toLowerCase();if(!i.name.toLowerCase().includes(t))continue}this.queuedContainer.appendChild(i.domEl)}return void this.clearQueue()}}_filterOptions(t,a){var n=!a.length,i=[];for(let e=0;e<t.length;e++){var s=t[e];if(!n){var l="string"==typeof s?s:s.value,r=a.toLowerCase();if(!l.toLowerCase().includes(r))continue}i.push(s)}this.refresh(i)}_trigger(e,t){t&&t.call(this,e.value,e.domEvent,e.name),this.onevent&&this.onevent.call(this,e)}getBranch(t){return t?this.branches.find(e=>e.name==t):this._currentBranch}queue(e){!e&&this._currentBranch&&(e=this._currentBranch.root),this.queuedContainer&&this._queue.push(this.queuedContainer),this.queuedContainer=e}clearQueue(){this._queue&&this._queue.length?this.queuedContainer=this._queue.pop():delete this.queuedContainer}addBlank(e=8,t){var a=this._createWidget(T.BLANK);return a.domEl.className+=" blank",a.domEl.style.height=e+"px",t&&(a.domEl.style.width=t),a}addTitle(e,t={}){console.assert(e,"Can't create Title Widget without text!");var a=this._createWidget(T.TITLE,null,null,t).domEl,n=(a.className="lextitle",t.icon&&((n=document.createElement("a")).className=t.icon,n.style.color=t.iconColor||"",a.appendChild(n)),document.createElement("span"));return n.innerText=e,a.appendChild(n),Object.assign(a.style,t.style??{}),null!=t.link&&((n=document.createElement("a")).innerText=e,n.href=t.link,n.target=t.target??"",n.className="lextitle link",Object.assign(n.style,t.style??{}),a.replaceWith(n)),a}addText(n,i,s,l={}){let r=this._createWidget(T.TEXT,n,String(i),l);r.onGetValue=()=>i,r.onSetValue=(e,t,a)=>{r.valid(e)&&this._lastValueTriggered!=e&&(this._lastValueTriggered=i=e,l.disabled?o.innerText=e:o.value=e,t||this._trigger(new w(n,e,a),s))},r.valid=e=>!e.length||""==o.pattern||new RegExp(o.pattern).test(e);var e,t=r.domEl,a=document.createElement("div");a.className="lextext"+(l.warning?" lexwarning":""),a.style.width=l.inputWidth||"calc( 100% - "+y.DEFAULT_NAME_WIDTH+" )",a.style.display="flex",l.textClass&&a.classList.add(l.textClass),this.disabled=(l.disabled||l.warning)??!!l.url;let o=null;return this.disabled?(o=document.createElement(l.url?"a":"div"),l.url&&(o.href=l.url,o.target="_blank"),o.innerHTML=(l.warning?'<i class="fa-solid fa-triangle-exclamation"></i>':"")+i||"",o.style.width="100%",o.style.textAlign=l.float??""):((o=document.createElement("input")).type=l.type||"",o.value=o.iValue=i||"",o.style.width="100%",o.style.textAlign=l.float??"",o.setAttribute("placeholder",l.placeholder??""),l.required&&o.setAttribute("required",l.required),l.pattern&&o.setAttribute("pattern",l.pattern),"default"==(e=l.trigger??"default")?(o.addEventListener("keyup",function(e){"Enter"==e.key&&o.blur()}),o.addEventListener("focusout",function(e){r.set(e.target.value,!1,e)})):"input"==e&&o.addEventListener("input",function(e){r.set(e.target.value,!1,e)}),o.addEventListener("mousedown",function(e){e.stopImmediatePropagation(),e.stopPropagation()}),l.icon&&((e=document.createElement("a")).className="inputicon "+l.icon,a.appendChild(e))),Object.assign(o.style,l.style??{}),a.appendChild(o),t.appendChild(a),l.hideName&&(t.className+=" noname",a.style.width="100%"),r}addTextArea(n,i,s,e={}){let t=this._createWidget(T.TEXTAREA,n,i,e);t.onGetValue=()=>i,t.onSetValue=(e,t,a)=>{r.value=i=e,t||this._trigger(new w(n,e,a),s)};var a=t.domEl,l=document.createElement("div");l.className="lextextarea",l.style.width=e.inputWidth||"calc( 100% - "+y.DEFAULT_NAME_WIDTH+" )",l.style.height=e.height,l.style.display="flex";let r=document.createElement("textarea");r.value=r.iValue=i||"",r.style.width="100%",r.style.textAlign=e.float??"",Object.assign(r.style,e.style??{}),e.disabled&&r.setAttribute("disabled",!0),e.placeholder&&r.setAttribute("placeholder",e.placeholder);var o=e.trigger??"default",o=("default"==o?(r.addEventListener("keyup",function(e){"Enter"==e.key&&r.blur()}),r.addEventListener("focusout",function(e){t.set(e.target.value,!1,e)})):"input"==o&&r.addEventListener("input",function(e){t.set(e.target.value,!1,e)}),e.icon&&((o=document.createElement("a")).className="inputicon "+e.icon,l.appendChild(o)),l.appendChild(r),a.appendChild(l),!e.hideName);return o||(a.className+=" noname",l.style.width="100%"),m(()=>{e.fitHeight&&(r.style.height=r.scrollHeight+"px")},10),t}addLabel(e,t={}){return t.disabled=!0,this.addText(null,e,null,t)}addButton(t,a,n,i={}){var e=this._createWidget(T.BUTTON,t,null,i),e=(e.onGetValue=()=>s.innerText,e.onSetValue=(e,t,a)=>{s.innerHTML=i.icon?"<a class='"+i.icon+"'></a>":i.img?"<img src='"+i.img+"'>":"<span>"+(e||"")+"</span>"},e.domEl),s=document.createElement("button"),l=(s.title=i.title??"",s.className="lexbutton "+(i.buttonClass??""),i.selected&&s.classList.add("selected"),s.innerHTML=i.icon?"<a class='"+i.icon+"'></a>":i.img?"<img src='"+i.img+"'>":"<span>"+(a||"")+"</span>",s.style.width="calc( 100% - "+(i.nameWidth??y.DEFAULT_NAME_WIDTH)+")",i.disabled&&s.setAttribute("disabled",!0),s.addEventListener("click",e=>{i.selectable&&(i.parent&&i.parent.querySelectorAll(".lexbutton.selected").forEach(e=>{e!=s&&e.classList.remove("selected")}),s.classList.toggle("selected")),this._trigger(new w(t,a,e),n)}),e.appendChild(s),!i.hideName&&!(i.icon||i.img));return l||(s.className+=" noname",s.style.width="100%"),e}addComboButtons(a,e,n={}){var t=this._createWidget(T.BUTTONS,a,null,n),i=t.domEl;let s=this,l=document.createElement("div");l.className="lexcombobuttons ",n.float&&(l.className+=n.float),l.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")";var r=document.createElement("div");r.className="lexcombobuttonsbox ";let o=!n.noSelection,d=o&&(n.toggle??!1);for(let t of e){if(!t.value)throw"Set 'value' for each button!";var c=document.createElement("button");c.className="lexbutton combo",c.title=t.icon?t.value:"",c.id=t.id??"",n.buttonClass&&c.classList.add(n.buttonClass),o&&(t.selected||n.selected==t.value)&&c.classList.add("selected"),c.innerHTML=(t.icon?"<a class='"+t.icon+"'></a>":"")+"<span>"+(t.icon?"":t.value)+"</span>",t.disabled&&c.setAttribute("disabled",!0),c.addEventListener("click",function(e){o&&(d?this.classList.toggle("selected"):(l.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),this.classList.add("selected"))),s._trigger(new w(a,t.value,e),t.callback)}),r.appendChild(c)}return!n.hideName||(i.className+=" noname",l.style.width="100%"),l.appendChild(r),i.appendChild(l),t}addCard(t,a={}){a.hideName=!0;var e=this._createWidget(T.CARD,t,null,a),n=e.domEl;let i=document.createElement("div");i.className="lexcard",i.style.width="100%",a.img&&((l=document.createElement("img")).src=a.img,i.appendChild(l),null!=a.link)&&(l.style.cursor="pointer",l.addEventListener("click",function(){var e=i.querySelector("a");e&&e.click()}));var s,l=document.createElement("span");return l.innerText=t,null!=a.link&&((s=document.createElement("a")).innerText=t,s.href=a.link,s.target=a.target??"",l.innerText="",l.appendChild(s)),i.appendChild(l),a.callback&&(i.style.cursor="pointer",i.addEventListener("click",e=>{this._trigger(new w(t,null,e),a.callback)})),n.appendChild(i),e}addForm(e,n,i,t={}){if(n.constructor!=Object)return void console.error("Form data must be an Object");t.hideName=!0;var e=this._createWidget(T.FORM,e,null,t),a=(e.onGetValue=()=>l.formData,e.onSetValue=(t,a,e)=>{l.formData=t;var n,i,s=l.querySelectorAll(".lexwidget");for(let e=0;e<s.length;++e)s[e].jsInstance.type==y.Widget.TEXT&&(n=s[e].querySelector(".lexwidgetname").innerText,(i=s[e].querySelector(".lextext input")).value=t[n]??"",k._dispatch_event(i,"focusout",a))},e.domEl);let l=document.createElement("div");l.className="lexformdata",this.queue(l),l.formData={};for(let t in n){let e=n[t];(e=e.constructor!=Object?{}:e).placeholder=e.placeholder??t,e.width="calc(100% - 10px)",this.addLabel(t,{textClass:"formlabel"}),e.textWidget=this.addText(null,e.constructor==Object?e.value:e,e=>{l.formData[t]=e},e),l.formData[t]=e.constructor==Object?e.value:e}return this.addBlank(),this.addButton(null,t.actionName??"Submit",(e,t)=>{for(var a in n)if(!n[a].textWidget.valid())return;i&&i(l.formData,t)},{buttonClass:"primary",width:"calc(100% - 10px)"}),this.clearQueue(),a.appendChild(l),a.className+=" noname",l.style.width="100%",e}addContent(e,t,a={}){console.assert(t,"Empty content!"),t.constructor==String&&((n=document.createElement("div")).innerHTML=t,t=1<n.childElementCount?n:n.firstElementChild),a.hideName=!0;var n=this._createWidget(T.CONTENT,e,null,a);return n.domEl.appendChild(t),n}async addImage(e,t,a={}){console.assert(t,"Empty src/url for Image!");var n,e=this._createWidget(T.IMAGE,e,null,a),i=e.domEl,s=document.createElement("div"),l=(s.className="leximage",s.style.width="100%",document.createElement("img"));for(n in l.src=t,a.style)l.style[n]=a.style[n];return await l.decode(),s.appendChild(l),i.appendChild(s),e}addDropdown(n,r,o,i,e={}){let d=this._createWidget(T.DROPDOWN,n,o,e),c=(d.onGetValue=()=>c.querySelector("li.selected").getAttribute("value"),d.onSetValue=(e,t,a)=>{o=e,m.querySelectorAll("li").forEach(e=>{e.getAttribute("value")==o&&e.click()}),t||this._trigger(new w(n,o,a),i)},d.domEl);var t=document.createElement("div");t.className="lexdropdown",t.style.width=e.inputWidth||"calc( 100% - "+y.DEFAULT_NAME_WIDTH+")";let h=document.createElement("div");h.className="lexdropdown lexoption",h.name=n;var a=h.iValue=o;a+="<a class='fa-solid fa-angle-down' style='float:right; margin-right: 3px;'></a>",this.queue(t);let u=this.addButton(null,a,(e,t)=>{m.unfocus_event?delete m.unfocus_event:(p.classList.remove("place-above"),p.hasAttribute("open")?p.close():(p.show(),(a=>{var n=a.getParentArea();let i=u.getBoundingClientRect();var s=a.parentElement.closest("dialog");{var l=a.offsetHeight;let t=i.y,e=window.innerHeight;if(n&&(r=n.getBoundingClientRect(),e=r.y+r.height),s){let e=s.getBoundingClientRect();t-=e.y}a.style.top=t+u.offsetHeight+"px",t+l>e&&(a.style.top=t-l+"px",a.classList.add("place-above"))}{var r=a.offsetWidth;let t=i.x;if(a.style.minWidth=i.width+"px",s){let e=s.getBoundingClientRect();t-=e.x}a.style.left=t+"px";let e=window.innerWidth;n&&(l=n.getBoundingClientRect(),e=l.x+l.width),t+r>e&&(a.style.left=t-(r-i.width)+"px")}})(p)),g&&g.querySelector("input").focus())},{buttonClass:"array",skipInlineCount:!0,disabled:e.disabled}),p=(this.clearQueue(),u.style.width="100%",u.refresh=e=>{""==u.querySelector("span").innerText?u.querySelector("span").innerText=e:u.querySelector("span").innerHTML=u.querySelector("span").innerHTML.replaceAll(u.querySelector("span").innerText,e)},document.createElement("dialog")),m=(p.className="lexdropdownoptions",document.createElement("ul")),g=(m.tabIndex=-1,m.className="lexoptions",p.appendChild(m),m.addEventListener("focusout",function(e){if(e.stopPropagation(),e.stopImmediatePropagation(),e.relatedTarget===u.querySelector("button"))this.unfocus_event=!0,setTimeout(()=>delete this.unfocus_event,200);else{if(e.relatedTarget&&"INPUT"==e.relatedTarget.tagName)return;if("lexinput-filter"==e.target.className)return}p.close()}),null),v=(e.filter&&(g=this._addFilter(e.placeholder??"Search...",{container:m,callback:this._filterOptions.bind(m,r)}),m.appendChild(g),g.addEventListener("focusout",function(e){e.relatedTarget&&"UL"==e.relatedTarget.tagName&&e.relatedTarget.classList.contains("lexoptions")||p.close()})),document.createElement("span"));return v.style.height="calc(100% - 25px)",m.appendChild(v),m.refresh=t=>{var e,a;if(v.innerHTML="",t.length)for(let e=0;e<t.length;e++){var n,i=t[e],s=document.createElement("li"),l=document.createElement("div");l.className="option",s.appendChild(l),s.addEventListener("click",e=>{p.close();var t=c.querySelector(".lexoptions .selected");t&&t.classList.remove("selected"),o=e.currentTarget.getAttribute("value"),e.currentTarget.toggleAttribute("hidden",!1),e.currentTarget.classList.add("selected"),u.refresh(o),d.set(o,!1,e),g&&(g.querySelector("input").value="",this._filterOptions.bind(m,r,"")())}),i.constructor!=Object?(l.style.flexDirection="unset",l.innerHTML="</a><span>"+i+"</span><a class='fa-solid fa-check'>",l.value=i,s.setAttribute("value",i),s.className="lexdropdownitem",i==o&&(s.classList.add("selected"),h.innerHTML=i)):((n=document.createElement("img")).src=i.src,s.setAttribute("value",i.value),s.className="lexlistitem",l.innerText=i.value,l.className+=" media",l.prepend(n),l.setAttribute("value",i.value),l.setAttribute("data-index",e),l.setAttribute("data-src",i.src),l.setAttribute("title",i.value),o==i.value&&s.classList.add("selected")),v.appendChild(s)}else a=t.emptyMsg??"No options found.",(e=document.createElement("div")).className="option",e.style.flexDirection="unset",e.innerHTML=a,(a=document.createElement("li")).className="lexdropdownitem empty",a.appendChild(e),v.appendChild(a)},m.refresh(r),t.appendChild(p),c.appendChild(t),e.hideName&&(c.className+=" noname",t.style.width="100%"),d}addCurve(n,e,i,t={}){var a=JSON.parse(JSON.stringify(e));let s=this;var a=this._createWidget(T.CURVE,n,a,t),l=(a.onGetValue=()=>JSON.parse(JSON.stringify(o.element.value)),a.onSetValue=(e,t,a)=>{o.element.value=JSON.parse(JSON.stringify(e)),o.redraw(),t||s._trigger(new w(n,o.element.value,a),i)},a.domEl),r=document.createElement("div");r.className="lexcurve",r.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")",t.callback=(e,t)=>{s._trigger(new w(n,e,t),i)},t.name=n;let o=new D(this,e,t);return r.appendChild(o.element),l.appendChild(r),a.onresize=o.redraw.bind(o),a.curveInstance=o,m(()=>{o.canvas.width=r.offsetWidth,o.redraw()}),a}addDial(n,e,i,t={}){var a=JSON.parse(JSON.stringify(e));let s=this;var a=this._createWidget(T.DIAL,n,a,t),l=(a.onGetValue=()=>JSON.parse(JSON.stringify(o.element.value)),a.onSetValue=(e,t,a)=>{o.element.value=JSON.parse(JSON.stringify(e)),o.redraw(),t||s._trigger(new w(n,o.element.value,a),i)},a.domEl),r=document.createElement("div");r.className="lexcurve",r.style.width=a.name?"calc( 100% - "+y.DEFAULT_NAME_WIDTH+")":"100%",t.callback=(e,t)=>{s._trigger(new w(n,e,t),i)},t.name=n;let o=new M(this,e,t);return r.appendChild(o.element),l.appendChild(r),a.onresize=o.redraw.bind(o),a.curveInstance=o,m(()=>{o.element.style.height=o.element.offsetWidth+"px",o.canvas.width=o.element.offsetWidth,r.style.width=o.element.offsetWidth+"px",o.canvas.height=o.canvas.width,o.redraw()}),a}addLayers(n,s,i,e={}){let l=this,r=this._createWidget(T.LAYERS,n,s,e),o=(r.onGetValue=()=>o.value,r.onSetValue=(e,t,a)=>{s=o.value=e,c(),t||l._trigger(new w(n,s,a),i)},r.domEl);var d=document.createElement("div");d.className="lexlayers",d.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")",o.value=s;let c=()=>{d.innerHTML="";let e=s.toString(2);for(var t=e.length,a=0;a<16-t;++a)e="0"+e;for(let t=0;t<16;++t){var n,i=document.createElement("div");i.className="lexlayer",null!=s&&null!=(n=e[16-t-1])&&"1"==n&&i.classList.add("selected"),i.innerText=t+1,i.title="Bit "+t+", value "+(1<<t),d.appendChild(i),i.addEventListener("click",e=>{e.stopPropagation(),e.stopImmediatePropagation(),e.target.classList.toggle("selected"),s^=1<<t,r.set(s,!1,e)})}};return c(),o.appendChild(d),r}addArray(i,s=[],l,r={}){var e=this._createWidget(T.ARRAY,i,null,r);e.onGetValue=()=>{var e,t=[];for(e of a.querySelectorAll("input"))t.push(e.value);return t},e.onSetValue=(e,t,a)=>{s=e,h(),t||this._trigger(new w(i,s,a),l)};let a=e.domEl,o=(a.style.flexWrap="wrap","4%"),t=document.createElement("div"),n=(t.className="lexarray",t.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")",this.queue(t),"<a class='fa-solid fa-angle-down' style='float:right; margin-right: 3px;'></a>"),d="Array (size "+s.length+")",c=(d+=n,this.addButton(null,d,()=>{a.querySelector(".lexarrayitems").toggleAttribute("hidden")},{buttonClass:"array"}),this.clearQueue(),document.createElement("div")),h=(c.className="lexarrayitems",c.toggleAttribute("hidden",!0),a.appendChild(t),a.appendChild(c),()=>{var e=a.querySelector(".lexbutton.array span");e.innerHTML="Array (size "+s.length+")",e.innerHTML+=n,c.innerHTML="",this.queue(c);for(let n=0;n<s.length;++n){let a=s[n];var t=r.innerValues?"dropdown":a.constructor;switch(this.sameLine(2),t){case String:this.addText(n+"",a,function(e,t){s[n]=e,l(s)},{nameWidth:o,inputWidth:"95%",skipReset:!0});break;case Number:this.addNumber(n+"",a,function(e,t){s[n]=e,l(s)},{nameWidth:o,inputWidth:"95%",skipReset:!0});break;case"dropdown":this.addDropdown(n+"",r.innerValues,a,function(e,t){s[n]=e,l(s)},{nameWidth:o,inputWidth:"95%",skipReset:!0})}this.addButton(null,"<a class='lexicon fa-solid fa-trash'></a>",(e,t)=>{s.splice(s.indexOf(a),1),h(),this._trigger(new w(i,s,t),l)},{title:"Remove item",className:"micro"})}d="Add item",d+="<a class='fa-solid fa-plus' style='float:right; margin-right: 3px; margin-top: 2px;'></a>",this.addButton(null,d,(e,t)=>{s.push(r.innerValues?r.innerValues[0]:""),h(),this._trigger(new w(i,s,t),l)},{buttonClass:"array"}),this.clearQueue()});return h(),e}addList(i,s,l,r,e={}){var t=this._createWidget(T.LIST,i,l,e),a=(t.onGetValue=()=>l,t.onSetValue=(e,t,a)=>{o.querySelectorAll(".lexlistitem").forEach(e=>e.classList.remove("selected"));var n=s.indexOf(e);-1==n||(o.children[n].classList.toggle("selected"),l=e,t)||this._trigger(new w(i,e,a),r)},t.updateValues=e=>{s=e,o.innerHTML="";for(let n=0;n<s.length;++n){let e=null,t=s[n],a=(t.constructor===Array&&(e=t[1],t=t[0]),document.createElement("div"));a.className="lexlistitem"+(l==t?" selected":""),a.innerHTML="<span>"+t+"</span>"+(e?"<a class='"+e+"'></a>":""),a.addEventListener("click",e=>{o.querySelectorAll(".lexlistitem").forEach(e=>e.classList.remove("selected")),a.classList.toggle("selected"),l=t,this._trigger(new w(i,t,e),r)}),o.appendChild(a)}},t.domEl);let o=document.createElement("div");return o.className="lexlist",o.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")",t.updateValues(s),e.hideName&&(a.className+=" noname",o.style.width="100%"),a.appendChild(o),t}addTags(n,i,s,e={}){i=i.replace(/\s/g,"").split(",");var t=[].concat(i);let l=this._createWidget(T.TAGS,n,t,e);l.onGetValue=()=>[].concat(i),l.onSetValue=(e,t,a)=>{i=[].concat(e),d(),t||r._trigger(new w(n,i,a),s)};t=l.domEl;let r=this,o=document.createElement("div"),d=(o.className="lextags",o.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")",()=>{o.innerHTML="";for(let e=0;e<i.length;++e){let t=i[e],a=document.createElement("span");a.className="lextag",a.innerHTML=t;var n=document.createElement("a");n.className="lextagrmb fa-solid fa-xmark lexicon",a.appendChild(n),n.addEventListener("click",e=>{a.remove(),i.splice(i.indexOf(t),1),l.set(i,!1,e)}),o.appendChild(a)}var e=document.createElement("input");e.value="",e.placeholder="Add tag...",o.appendChild(e),e.onkeydown=function(e){var t=this.value.replace(/\s/g,"");" "!=e.key&&"Enter"!=e.key||(e.preventDefault(),!t.length)||-1<i.indexOf(t)||(i.push(t),l.set(i,!1,e))},e.focus()});return d(),e.hideName&&(t.className+=" noname",o.style.width="100%"),t.appendChild(o),l}addCheckbox(n,i,s,e={}){if(!n&&!e.label)throw"Set Widget Name or at least a label!";let t=this._createWidget(T.CHECKBOX,n,i,e),l=(t.onGetValue=()=>i,t.onSetValue=(e,t,a)=>{e==i||(r.checked=i=e,l.querySelector(".lexcheckboxsubmenu")?.toggleAttribute("hidden",!e),t)||this._trigger(new w(n,e,a),s)},t.domEl),a=document.createElement("div"),r=(a.className="lexcheckboxcont",document.createElement("input"));r.type="checkbox",r.className="lexcheckbox "+(e.className??""),r.checked=i,r.disabled=e.disabled??!1;var o=document.createElement("span");return o.className="checkboxtext",o.innerHTML=e.label??"On",a.appendChild(r),a.appendChild(o),r.addEventListener("change",e=>{t.set(r.checked,!1,e)}),l.appendChild(a),e.suboptions&&(l.style.flexWrap="wrap",(o=document.createElement("div")).className="lexcheckboxsubmenu",o.toggleAttribute("hidden",!r.checked),this.queue(o),e.suboptions.call(this,this),this.clearQueue(),l.appendChild(o)),t}addToggle(n,i,s,e={}){let t=this._createWidget(T.TOGGLE,n,i,e),l=(t.onGetValue=()=>r.checked,t.onSetValue=(e,t,a)=>{e==i||(r.checked=i=e,l.querySelector(".lextogglesubmenu")?.toggleAttribute("hidden",!e),t)||this._trigger(new w(n,e,a),s)},t.domEl),a=document.createElement("div"),r=(a.className="lextogglecont",document.createElement("input"));r.type="checkbox",r.className="lextoggle "+(e.className??""),r.checked=i,r.iValue=i,r.disabled=e.disabled??!1;var o=document.createElement("span");return o.className="toggletext",o.innerHTML="On",a.appendChild(r),a.appendChild(o),r.addEventListener("change",e=>{t.set(r.checked,!1,e)}),l.appendChild(a),e.suboptions&&(l.style.flexWrap="wrap",(o=document.createElement("div")).className="lextogglesubmenu",o.toggleAttribute("hidden",!r.checked),this.queue(o),e.suboptions.call(this,this),this.clearQueue(),l.appendChild(o)),t}addRadioGroup(e,t,i,s,a={}){let n=this._createWidget(T.RADIO,e,null,a),l=null;n.onGetValue=()=>{var e=r.querySelectorAll("button");return l?[l,e[l]]:void 0},n.onSetValue=(e,t,a)=>{console.assert(e.constructor==Number,"RadioGroup _value_ must be an Array index!");var n=r.querySelectorAll("button"),n=(n.forEach(e=>{e.checked=!1,e.classList.remove("checked")}),n[e]);n.checked=!n.checked,n.classList.toggle("checked"),t||d._trigger(new w(null,[e,i[e]],a),s)};var e=n.domEl,r=document.createElement("div"),o=(r.className="lexradiogroup "+(a.className??""),document.createElement("span"));o.innerHTML=t,r.appendChild(o);let d=this;for(let t=0;t<i.length;++t){var c=document.createElement("div"),h=(c.className="lexradiogroupitem",r.appendChild(c),document.createElement("button")),u=(h.className="lexbutton",h.disabled=a.disabled??!1,c.appendChild(h),h.addEventListener("click",e=>{n.set(t,!1,e)}),document.createElement("span")),h=(h.appendChild(u),document.createElement("span"));h.innerHTML=i[t],c.appendChild(h)}return a.selected&&(console.assert(a.selected.constructor==Number,"RadioGroup _selected_ must be an Array index!"),l=a.selected,n.set(l,!0)),e.appendChild(r),n}addColor(n,i,s,e={}){i=i.constructor===Array?u(i):i;let t=this._createWidget(T.COLOR,n,i,e);t.onGetValue=()=>i,t.onSetValue=(e,t,a)=>{r.useRGB&&(e=h(e)),a&&o.set(e,!0,a),r.value=i=e,t||this._trigger(new w(n,e,a),s)};var a=t.domEl,l=document.createElement("span");l.className="lexcolor",l.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")";let r=document.createElement("input"),o=(r.style.width="32px",r.type="color",r.className="colorinput",r.id="color"+b(),r.useRGB=e.useRGB??!1,r.value=r.iValue=i,e.disabled&&(r.disabled=!0),r.addEventListener("input",e=>{t.set(e.target.value,!1,e)},!1),l.appendChild(r),this.queue(l),this.addText(null,r.value,e=>{t.set(e)},{width:"calc( 100% - 32px )"}));return o.domEl.style.marginLeft="4px",this.clearQueue(),a.appendChild(l),t}addRange(n,i,s,l={}){let t=this._createWidget(T.RANGE,n,i,l);t.onGetValue=()=>i,t.onSetValue=(e,t,a)=>{isNaN(e)||(r.value=i=f(+e,+r.min,+r.max),t)||this._trigger(new w(n,l.left?+r.max-i+ +r.min:i,a),s)};var e=t.domEl,a=document.createElement("div");a.className="lexrange",a.style.width=l.inputWidth||"calc( 100% - "+y.DEFAULT_NAME_WIDTH+")";let r=document.createElement("input");return r.className="lexrangeslider "+(l.className??""),r.value=r.iValue=i,r.min=l.min,r.max=l.max,r.step=l.step??1,r.type="range",r.disabled=l.disabled??!1,l.left&&r.classList.add("left"),(l.fill??!0)||r.classList.add("no-fill"),r.addEventListener("input",e=>{t.set(e.target.valueAsNumber,!1,e)},{passive:!1}),r.addEventListener("mousedown",function(e){l.onPress&&l.onPress.bind(r)(e,r)},!1),r.addEventListener("mouseup",function(e){l.onRelease&&l.onRelease.bind(r)(e,r)},!1),t.setLimits=(e,t,a)=>{r.min=e??r.min,r.max=t??r.max,r.step=a??r.step,k._dispatch_event(r,"input",!0)},i.constructor==Number&&(i=f(i,+r.min,+r.max)),a.appendChild(r),e.appendChild(a),l.hideName&&(e.className+=" noname",a.style.width="100%"),t}addNumber(n,i,s,l={}){let r=this._createWidget(T.NUMBER,n,i,l);r.onGetValue=()=>i,r.onSetValue=(e,t,a)=>{isNaN(e)||(i=f(+e,+d.min,+d.max),d.value=i=E(i,l.precision),o.querySelector(".lexinputslider")&&(o.querySelector(".lexinputslider").value=i),l.units&&(d.unitSpan.style.left=v(i)+"px"),t)||this._trigger(new w(n,i,a),s)};var e,t=r.domEl,a=document.createElement("div");a.className="lexnumber",a.style.width=l.inputWidth||"calc( 100% - "+y.DEFAULT_NAME_WIDTH+")";let o=document.createElement("div"),d=(o.className="numberbox",document.createElement("input")),c=(d.id="number_"+b(),d.className="vecinput",d.min=l.min??-1e24,d.max=l.max??1e24,d.step=l.step??"any",d.type="number",i.constructor==Number&&(i=E(i=f(i,+d.min,+d.max),l.precision)),d.value=d.iValue=i,o.appendChild(d),l.units&&((e=document.createElement("span")).className="lexunit",e.innerText=l.units,e.style.left=v(d.value)+"px",d.unitSpan=e,o.appendChild(e)),document.createElement("a"));if(c.className="fa-solid fa-arrows-up-down drag-icon hidden",o.appendChild(c),l.disabled&&(d.disabled=!0),!l.skipSlider&&void 0!==l.min&&void 0!==l.max){let n=document.createElement("input");n.className="lexinputslider",n.min=l.min,n.max=l.max,n.step=l.step??1,n.type="range",n.value=i,n.addEventListener("input",function(e){r.set(this.valueAsNumber,!1,e)},!1),n.addEventListener("mousedown",function(e){l.onPress&&l.onPress.bind(n)(e,n)},!1),n.addEventListener("mouseup",function(e){l.onRelease&&l.onRelease.bind(n)(e,n)},!1),o.appendChild(n),r.setLimits=(e,t,a)=>{d.min=n.min=e??d.min,d.max=n.max=t??d.max,d.step=a??d.step,n.step=a??n.step,r.set(i,!0)}}d.addEventListener("input",function(e){i=E(i=+this.valueAsNumber,l.precision),l.units&&(d.unitSpan.style.left=v(d.value)+"px")},!1),d.addEventListener("wheel",function(t){if(t.preventDefault(),this===document.activeElement){let e=l.step??1;t.shiftKey?e*=10:t.altKey&&(e*=.1),i=+this.valueAsNumber-e*(0<t.deltaY?1:-1),r.set(i,!1,t)}},{passive:!1}),d.addEventListener("change",function(e){r.set(this.valueAsNumber,!1,e)},{passive:!1}),d.addEventListener("mousedown",function(e){var t;document.activeElement!=d&&((t=h.root.ownerDocument).addEventListener("mousemove",u),t.addEventListener("mouseup",p),document.body.classList.add("noevents"),c.classList.remove("hidden"),e.stopImmediatePropagation(),e.stopPropagation(),document.pointerLockElement||d.requestPointerLock(),l.onPress)&&l.onPress.bind(d)(e,d)});var h=this;function u(t){var a=-t.movementY;if(0!=a){let e=l.step??1;t.shiftKey?e*=10:t.altKey&&(e*=.1),i=+d.valueAsNumber+e*a,r.set(i,!1,t)}t.stopPropagation(),t.preventDefault()}function p(e){var t=h.root.ownerDocument;t.removeEventListener("mousemove",u),t.removeEventListener("mouseup",p),document.body.classList.remove("noevents"),c.classList.add("hidden"),document.pointerLockElement&&document.exitPointerLock(),l.onRelease&&l.onRelease.bind(d)(e,d)}return a.appendChild(o),t.appendChild(a),l.hideName&&(t.className+=" noname",a.style.width="100%"),r}static VECTOR_COMPONENTS={0:"x",1:"y",2:"z",3:"w"};_add_vector(t,i,s,l,r={}){t=f(t,2,4),s=s??new Array(t).fill(0);let o=this._createWidget(T.VECTOR,i,[].concat(s),r),d=(o.onGetValue=()=>{var e,t=[];for(e of d.querySelectorAll("input"))t.push(+e.value);return t},o.onSetValue=(t,e,a)=>{if(c.length!=t.length)console.error("Input length does not match vector length.");else{for(let e=0;e<c.length;++e){var n;n=E(f(t[e],+c[e].min,+c[e].max),r.precision)??0,c[e].value=t[e]=n}e||this._trigger(new w(i,t,a),l)}},o.domEl),c=[],n=document.createElement("div");n.className="lexvector",n.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")";for(let e=0;e<t;++e){var h=document.createElement("div");h.className="vecbox",h.innerHTML="<span class='"+k.VECTOR_COMPONENTS[e]+"'></span>";let i=document.createElement("input"),a=(i.className="vecinput v"+t,i.min=r.min??-1e24,i.max=r.max??1e24,i.step=r.step??"any",i.type="number",i.id="vec"+t+"_"+b(),i.idx=e,c[e]=i,s[e].constructor==Number&&(s[e]=f(s[e],+i.min,+i.max),s[e]=E(s[e],r.precision)),i.value=i.iValue=s[e],document.createElement("a"));a.className="fa-solid fa-arrows-up-down drag-icon hidden",h.appendChild(a),r.disabled&&(i.disabled=!0),i.addEventListener("wheel",function(t){if(t.preventDefault(),this===document.activeElement){let e=r.step??1;if(t.shiftKey?e=10:t.altKey&&(e=.1),v.locked)for(var a of d.querySelectorAll(".vecinput"))a.value=E(+a.valueAsNumber-e*(0<t.deltaY?1:-1),r.precision),k._dispatch_event(a,"change");else this.value=E(+this.valueAsNumber-e*(0<t.deltaY?1:-1),r.precision),k._dispatch_event(i,"change")}},{passive:!1}),i.addEventListener("change",e=>{if(!isNaN(e.target.value)){var t=E(f(e.target.value,+i.min,+i.max),r.precision);if(v.locked)for(var a of c)a.value=t,s[a.idx]=t;else i.value=t,s[e.target.idx]=t;o.set(s,!1,e)}},!1),i.addEventListener("mousedown",p);var u=this;function p(e){var t;document.activeElement!=i&&((t=u.root.ownerDocument).addEventListener("mousemove",m),t.addEventListener("mouseup",g),document.body.classList.add("noevents"),a.classList.remove("hidden"),e.stopImmediatePropagation(),e.stopPropagation(),document.pointerLockElement||i.requestPointerLock(),r.onPress)&&r.onPress.bind(i)(e,i)}function m(t){var a=-t.movementY;if(0!=a){let e=r.step??1;if(t.shiftKey?e=10:t.altKey&&(e=.1),v.locked)for(var n of d.querySelectorAll(".vecinput"))n.value=E(+n.valueAsNumber+e*a,r.precision),k._dispatch_event(n,"change");else i.value=E(+i.valueAsNumber+e*a,r.precision),k._dispatch_event(i,"change")}t.stopPropagation(),t.preventDefault()}function g(e){var t=u.root.ownerDocument;t.removeEventListener("mousemove",m),t.removeEventListener("mouseup",g),document.body.classList.remove("noevents"),a.classList.add("hidden"),document.pointerLockElement&&document.exitPointerLock(),r.onRelease&&r.onRelease.bind(i)(e,i)}h.appendChild(i),n.appendChild(h)}void 0===r.min&&void 0===r.max||(o.setLimits=(e,t,a)=>{for(var n of c)n.min=e??n.min,n.max=t??n.max,n.step=a??n.step;o.set(s,!0)});let v=document.createElement("a");return v.title="Lock",v.className="fa-solid fa-lock-open lexicon lock",n.appendChild(v),v.addEventListener("click",function(e){this.locked=!this.locked,this.locked?(this.classList.add("fa-lock"),this.classList.remove("fa-lock-open")):(this.classList.add("fa-lock-open"),this.classList.remove("fa-lock"))},!1),d.appendChild(n),o}addVector2(e,t,a,n){return this._add_vector(2,e,t,a,n)}addVector3(e,t,a,n){return this._add_vector(3,e,t,a,n)}addVector4(e,t,a,n){return this._add_vector(4,e,t,a,n)}addSize(e,t,s,a={}){let l=this._createWidget(T.SIZE,e,t,a),r=(l.onGetValue=()=>{var t=[];for(let e=0;e<r.dimensions.length;++e)t.push(r.dimensions[e].value());return t},l.onSetValue=(t,a,e)=>{for(let e=0;e<r.dimensions.length;++e)r.dimensions[e].set(t[e],a)},l.domEl);this.queue(r),r.aspectRatio=2==t.length?t[0]/t[1]:null,r.dimensions=[];for(let i=0;i<t.length;++i){var n;r.dimensions[i]=this.addNumber(null,t[i],e=>{var t,a,n=l.value();r.locked&&(t=0==i?1/r.aspectRatio:r.aspectRatio,n[a=(1+i)%2]=e*t,r.dimensions[a].set(n[a],!0)),s&&s(n)},{min:0,disabled:a.disabled,precision:a.precision}),i+1!=t.length&&((n=document.createElement("a")).className="lexsizecross fa-solid fa-xmark",r.appendChild(n))}this.clearQueue(),a.units&&((e=document.createElement("span")).className="lexunit",e.innerText=a.units,r.appendChild(e)),r.aspectRatio&&((e=document.createElement("a")).title="Lock Aspect Ratio",e.className="fa-solid fa-lock-open lexicon lock",r.appendChild(e),e.addEventListener("click",function(e){var t;r.locked=!r.locked,r.locked?(this.classList.add("fa-lock"),this.classList.remove("fa-lock-open"),t=l.value(),r.aspectRatio=t[0]/t[1]):(this.classList.add("fa-lock-open"),this.classList.remove("fa-lock"))},!1));e=!a.hideName;return e||(r.className+=" noname",container.style.width="100%"),l}addPad(i,e,s,a={}){var t=this._createWidget(T.PAD,i,null,a),n=(t.onGetValue=()=>o.value.xy,t.onSetValue=(e,t,a)=>{o.value.set(e[0],e[1]),d(o.value),t||this._trigger(new w(i,o.value.xy),s)},t.domEl),l=document.createElement("div");l.className="lexpad",l.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")";let r=document.createElement("div"),o=(r.id="lexpad-"+i,r.className="lexinnerpad",r.style.width=a.padSize??"96px",r.style.height=a.padSize??"96px",document.createElement("div")),d=(o.className="lexpadthumb",o.value=new y.vec2(e[0],e[1]),o.min=a.min??0,o.max=a.max??1,e=>{var[t,a]=[r.offsetWidth,r.offsetHeight],e=new y.vec2(p(e.x,o.min,o.max,0,1),p(e.y,o.min,o.max,0,1));o.style.transform=`translate(calc( ${t*e.x}px - 50% ), calc( ${a*e.y}px - 50%)`}),c=(m(()=>{d(o.value)}),r.appendChild(o),l.appendChild(r),n.appendChild(l),r.addEventListener("mousedown",function(e){var t;document.activeElement!=o&&((t=c.root.ownerDocument).addEventListener("mousemove",h),t.addEventListener("mouseup",u),document.body.classList.add("nocursor"),document.body.classList.add("noevents"),e.stopImmediatePropagation(),e.stopPropagation(),a.onPress)&&a.onPress.bind(o)(e,o)}),this);function h(e){var t=r.getBoundingClientRect(),t=new y.vec2(e.x-t.x,e.y-t.y),[a,n]=(t.clp(0,r.offsetWidth,t),[r.offsetWidth,r.offsetHeight]),t=t.div(new y.vec2(r.offsetWidth,r.offsetHeight));o.style.transform=`translate(calc( ${a*t.x}px - 50% ), calc( ${n*t.y}px - 50%)`,o.value=new y.vec2(p(t.x,0,1,o.min,o.max),p(t.y,0,1,o.min,o.max)),c._trigger(new w(i,o.value.xy,e),s),e.stopPropagation(),e.preventDefault()}function u(e){var t=c.root.ownerDocument;t.removeEventListener("mousemove",h),t.removeEventListener("mouseup",u),document.body.classList.remove("nocursor"),document.body.classList.remove("noevents"),a.onRelease&&a.onRelease.bind(o)(e,o)}return t}addProgress(n,e,i={}){var t,a=this._createWidget(T.PROGRESS,n,e,i);a.onGetValue=()=>r.value,a.onSetValue=(e,t,a)=>{s.querySelector("meter").value=e,o(),s.querySelector("span")&&(s.querySelector("span").innerText=e)};let s=a.domEl,l=document.createElement("div"),r=(l.className="lexprogress",l.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")",document.createElement("meter")),o=(r.id="lexprogressbar-"+n,r.className="lexprogressbar",r.step="any",r.min=i.min??0,r.max=i.max??1,r.low=i.low??r.low,r.high=i.high??r.high,r.optimum=i.optimum??r.optimum,r.value=e,()=>{let e=y.getThemeColor("global-selected");null!=r.low&&r.value<r.low?e=y.getThemeColor("global-color-error"):null!=r.high&&r.value<r.high&&(e=y.getThemeColor("global-color-warning")),r.style.background=`color-mix(in srgb, ${e} 20%, transparent)`});if(l.appendChild(r),s.appendChild(l),i.showValue&&(document.getElementById("progressvalue-"+n)&&document.getElementById("progressvalue-"+n).remove(),(t=document.createElement("span")).id="progressvalue-"+n,t.style.padding="0px 5px",t.innerText=e,l.appendChild(t)),i.editable){r.classList.add("editable"),r.addEventListener("mousedown",function(e){var t=a.root.ownerDocument;t.addEventListener("mousemove",d),t.addEventListener("mouseup",c),document.body.classList.add("noevents"),r.classList.add("grabbing"),e.stopImmediatePropagation(),e.stopPropagation();t=r.getBoundingClientRect(),e=E(p(e.offsetX,0,t.width,r.min,r.max));a.setValue(n,e)});let a=this;function d(e){var t;0!=e.movementX&&(t=r.getBoundingClientRect(),t=E(p(e.offsetX-t.x,0,t.width,r.min,r.max)),a.setValue(n,t),i.callback)&&i.callback(t,e),e.stopPropagation(),e.preventDefault()}function c(e){var t=a.root.ownerDocument;t.removeEventListener("mousemove",d),t.removeEventListener("mouseup",c),document.body.classList.remove("noevents"),r.classList.remove("grabbing")}}return o(),a}addFile(e,a,n={}){var e=this._createWidget(T.FILE,e,null,n),t=e.domEl,i=n.local??!0;let s=n.type??"text",l=n.read??!0,r=document.createElement("input");if(r.className="lexfileinput",r.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+" - 10%)",r.type="file",r.disabled=n.disabled??!1,n.placeholder&&(r.placeholder=n.placeholder),r.addEventListener("change",function(e){let t=e.target.files;t.length&&(l?(n.onBeforeRead&&n.onBeforeRead(),e=new FileReader,"text"===s?e.readAsText(t[0]):"buffer"===s?e.readAsArrayBuffer(t[0]):"bin"===s?e.readAsBinaryString(t[0]):"url"===s&&e.readAsDataURL(t[0]),e.onload=e=>{a.call(this,e.target.result,t[0])}):a(t[0]))}),r.addEventListener("cancel",function(e){a(null)}),t.appendChild(r),this.queue(t),i){let t=null;this.addButton(null,"<a style='margin-top: 0px;' class='fa-solid fa-gear'></a>",()=>{t=t||new A("Load Settings",e=>{e.addDropdown("Type",["text","buffer","bin","url"],s,e=>{s=e}),e.addButton(null,"Reload",e=>{r.dispatchEvent(new Event("change"))})},{onclose:e=>{e.remove(),t=null}})},{className:"micro",skipInlineCount:!0,title:"Settings"})}return this.clearQueue(),e}addTree(e,t,a={}){a.hideName=!0;var n=this._createWidget(T.TREE,e,null,a).domEl,i=document.createElement("div"),s=(i.className="lextree",n.appendChild(i),e&&((n=document.createElement("span")).innerHTML=e,i.appendChild(n)),document.createElement("div"));if(s.className="lextreetools",e||(s.className+=" notitle"),a.icons)for(var l of a.icons){var r=document.createElement("a");r.title=l.name,r.className="lexicon "+l.icon,r.addEventListener("click",l.callback),s.appendChild(r)}a.filter=a.filter??!0;n=null,a.filter&&((n=document.createElement("input")).id="lexnodetree_filter",n.setAttribute("placeholder","Filter.."),n.style.width="calc( 100% - 17px )",n.addEventListener("input",function(){o.refresh()}),(e=document.createElement("a")).className="lexicon fa-solid fa-magnifying-glass",s.appendChild(n),s.appendChild(e)),(a.icons||a.filter)&&i.appendChild(s),n=document.createElement("ul");n.addEventListener("contextmenu",function(e){e.preventDefault()}),i.appendChild(n);let o=new N(i,t,a);return o}addSeparator(){var e=document.createElement("div"),t=(e.className="lexseparator",new T(T.SEPARATOR));t.domEl=e,this._currentBranch?(this._currentBranch.content.appendChild(e),this._currentBranch.widgets.push(t)):this.root.appendChild(e)}addTabs(i,e={}){var t=this._createWidget(T.TABS,null,null,e).domEl;if(i.constructor!=Array)throw"Param @tabs must be an Array!";var a=e.vertical??!0,s=!a&&(e.showNames??!1);let l=document.createElement("div"),r=(l.className="lextabscontainer",a||(l.className+=" horizontal"),document.createElement("div"));r.className="tabs",l.appendChild(r),t.appendChild(l);for(let e=0;e<i.length;++e){let t=i[e];console.assert(t.name);var o=0==e;let a=document.createElement("div"),n=(a.className="lextab "+(e==i.length-1?"last":"")+(o?"selected":""),a.innerHTML=(s?t.name:"")+"<a class='"+(t.icon||"fa fa-hashtag")+" "+(s?"withname":"")+"'></a>",a.title=t.name,document.createElement("div"));n.id=t.name.replace(/\s/g,""),n.className="widgets",o||n.toggleAttribute("hidden",!0),l.appendChild(n),a.addEventListener("click",e=>{r.querySelectorAll(".lextab").forEach(e=>{e.classList.remove("selected")}),a.classList.add("selected"),l.querySelectorAll(".widgets").forEach(e=>{e.toggleAttribute("hidden",!0)}),l.querySelector("#"+n.id).toggleAttribute("hidden"),t.onSelect&&t.onSelect(this,n)}),r.appendChild(a),t.onCreate&&(this.queue(n),t.onCreate(this,n),this.clearQueue())}this.addSeparator()}addCounter(n,e,i,t={}){let s=this._createWidget(T.COUNTER,n,e,t);s.onGetValue=()=>c.count,s.onSetValue=(e,t,a)=>{e=f(e,l,r),c.count=e,c.innerHTML=e,t||this._trigger(new w(n,e,a),i)};var a=s.domEl;let l=t.min??0,r=t.max??100,o=t.step??1;var d=document.createElement("div"),a=(d.className="lexcounter",a.appendChild(d),this.queue(d),this.addButton(null,"<a style='margin-top: 0px;' class='fa-solid fa-minus'></a>",(e,t)=>{let a=o??1;t.shiftKey&&(a*=10),s.set(c.count-a,!1,t)},{className:"micro",skipInlineCount:!0,title:"Minus"}),this.clearQueue(),document.createElement("div"));a.className="lexcounterbox",d.appendChild(a);let c=document.createElement("span");return c.className="lexcountervalue",c.innerHTML=e,c.count=e,a.appendChild(c),t.label&&((e=document.createElement("span")).className="lexcounterlabel",e.innerHTML=t.label,a.appendChild(e)),this.queue(d),this.addButton(null,"<a style='margin-top: 0px;' class='fa-solid fa-plus'></a>",(e,t)=>{let a=o??1;t.shiftKey&&(a*=10),s.set(c.count+a,!1,t)},{className:"micro",skipInlineCount:!0,title:"Plus"}),this.clearQueue(),s}addTable(e,m,g={}){if(!m)throw"Data is needed to create a table!";let v=this._createWidget(T.TABLE,e,null,g);v.onGetValue=()=>{},v.onSetValue=(e,t,a)=>{};var e=v.domEl,t=document.createElement("div");t.className="lextable",t.style.width="calc( 100% - "+y.DEFAULT_NAME_WIDTH+")";let f=document.createElement("table");function E(e,t,a,n){return a[e]<n[e]?-t:a[e]>n[e]?t:0}return t.appendChild(f),m.head=m.head??[],m.body=m.body??[],m.orderMap={},m.checkMap={},v.refreshTable=()=>{f.innerHTML="";var e,t,a=document.createElement("thead"),n=(a.className="lextablehead",f.appendChild(a),document.createElement("tr"));g.selectable&&(e=document.createElement("th"),(t=document.createElement("input")).type="checkbox",t.className="lexcheckbox",t.checked=m.checkMap[":root"]??!1,e.appendChild(t),t.addEventListener("change",function(){var e;m.checkMap[":root"]=this.checked;for(e of f.querySelector("tbody").childNodes)m.checkMap[e.getAttribute("rowId")]=this.checked,e.querySelector("input").checked=this.checked}),n.appendChild(e));for(let t of m.head){var i=document.createElement("th");i.innerHTML=t+' <a class="fa-solid fa-sort"></a>',i.querySelector("a").addEventListener("click",()=>{m.orderMap[t]||(m.orderMap[t]=1);var e=m.head.indexOf(t);m.body=m.body.sort(E.bind(this,e,m.orderMap[t])),m.orderMap[t]=-m.orderMap[t],v.refreshTable()}),n.appendChild(i)}g.rowActions&&((t=document.createElement("th")).className="sm",n.appendChild(t)),a.appendChild(n);var s=document.createElement("tbody");s.className="lextablebody",f.appendChild(s);for(let a=0;a<m.body.length;++a){var l,r,o=m.body[a];let e=document.createElement("tr"),t=y.getSupportedDOMName(o.join("-"));e.setAttribute("rowId",t),g.selectable&&(l=document.createElement("td"),(h=document.createElement("input")).type="checkbox",h.className="lexcheckbox",h.checked=m.checkMap[t],l.appendChild(h),h.addEventListener("change",function(){m.checkMap[t]=this.checked,this.checked||(f.querySelector("thead input[type='checkbox']").checked=m.checkMap[":root"]=!1)}),e.appendChild(l));for(r of o){var d=document.createElement("td");d.innerHTML=""+r,e.appendChild(d)}if(g.rowActions){var c,h=document.createElement("td"),u=(h.className="sm",document.createElement("div"));u.className="lextablebuttons",h.appendChild(u);for(c of g.rowActions){var p=document.createElement("a");p.className="lexicon","delete"==c?(p.className+=" fa-solid fa-trash-can",p.addEventListener("click",function(){m.body.splice(a,1),e.remove()})):"menu"==c?(p.className+=" fa-solid fa-ellipsis",p.addEventListener("click",function(e){S(null,e,e=>{g.onMenuAction?g.onMenuAction(e):console.warn("Using <Menu action> without action callbacks.")})})):(console.assert(c.constructor==Object),p.className+=" "+c.icon),u.appendChild(p)}e.appendChild(h)}s.appendChild(e)}},v.refreshTable(),g.hideName&&(e.className+=" noname",t.style.width="100%"),e.appendChild(t),v}}y.Panel=k;class a{constructor(e,t={}){this.name=e;var a=document.createElement("div"),n=(a.className="lexbranch",t.id&&(a.id=t.id),t.className&&(a.className+=" "+t.className),a.style.width="calc(100% - 7px)",a.style.margin="0 auto",this),i=(this.root=a,this.widgets=[],document.createElement("div")),s=(i.className="lexbranchtitle",t.icon&&(i.innerHTML="<a class='branchicon "+t.icon+"'>"),i.innerHTML+=e||"Branch",i.innerHTML+="<a class='fa-solid fa-angle-up switch-branch-button'></a>",a.appendChild(i),document.createElement("div"));s.id=e.replace(/\s/g,""),s.className="lexbranchcontent",a.appendChild(s),this.content=s,this._addBranchSeparator(),t.closed&&(i.className+=" closed",a.className+=" closed",this.grabber.setAttribute("hidden",!0),m(()=>{this.content.setAttribute("hidden",!0)},15)),this.onclick=function(e){e.stopPropagation(),this.classList.toggle("closed"),this.parentElement.classList.toggle("closed"),n.content.toggleAttribute("hidden"),n.grabber.toggleAttribute("hidden"),y.emit("@on_branch_closed",this.classList.contains("closed"),{target:n.panel})},this.oncontextmenu=function(t){t.preventDefault(),t.stopPropagation(),this.parentElement.classList.contains("dialog")||S("Dock",t,e=>{t.preventDefault(),e.add("Floating",n._on_make_floating.bind(n))},{icon:"fa-regular fa-window-restore"})},i.addEventListener("click",this.onclick),i.addEventListener("contextmenu",this.oncontextmenu)}_on_make_floating(){new A(this.name,e=>{for(var t of this.widgets)e.root.appendChild(t.domEl)}).widgets=this.widgets;var e=this.root.parentElement,t=(this.root.remove(),e.querySelector(".lexbranch")),t=(t&&t.classList.add("first"),e.querySelectorAll(".lexbranch"));t.length&&t[t.length-1].classList.add("last")}_addBranchSeparator(){var e=document.createElement("div");e.className="lexwidgetseparator",e.style.width="100%",e.style.background="none";let a=document.createElement("div"),n=(a.innerHTML="&#9662;",e.appendChild(a),m(()=>{a.style.marginLeft=parseFloat(y.DEFAULT_NAME_WIDTH)/100*this.content.offsetWidth+"px"},10),document.createElement("div"));n.style.width="1px",n.style.marginLeft="6px",n.style.marginTop="2px",n.style.height="0px",a.appendChild(n),a.addEventListener("mousedown",function(e){var t=i.root.ownerDocument;t.addEventListener("mouseup",l),t.addEventListener("mousemove",s),e.stopPropagation(),e.preventDefault();t=i.root.offsetHeight-i.root.children[0].offsetHeight;n.style.height=t-3+"px",document.body.classList.add("nocursor")}),this.grabber=a;let i=this;function s(e){var t,e=e.movementX;0!=e&&(t=parseFloat(a.style.marginLeft),a.style.marginLeft=f(t+e,32,i.content.offsetWidth-32)+"px")}function l(e){i._updateWidgets(),n.style.height="0px";var t=i.root.ownerDocument;t.removeEventListener("mouseup",l),t.removeEventListener("mousemove",s),document.body.classList.remove("nocursor")}this.content.appendChild(e)}_updateWidgets(){for(var t=this.grabber.style.marginLeft,e=0;e<this.widgets.length;e++){var a=this.widgets[e],n=a.domEl;if(!(n.children.length<2)){var i=n.children[0],n=n.children[1];i.style.width=t;let e="0px";a.type===T.FILE&&(e="10%"),n.style.width="-moz-calc( 100% - "+t+" - "+e+" )",n.style.width="-webkit-calc( 100% - "+t+" - "+e+" )",n.style.width="calc( 100% - "+t+" - "+e+" )",a.onresize&&a.onresize()}}}}y.Branch=a;y.Footer=class{constructor(e={}){var t=document.createElement("footer"),a=(t.className="lexfooter",document.createElement("div"));if(a.className="wrapper",t.appendChild(a),e.columns&&e.columns.constructor==Array){var n,i=document.createElement("div");i.className="columns",i.style.gridTemplateColumns="1fr ".repeat(e.columns.length),a.appendChild(i);for(n of e.columns){var s=document.createElement("div"),l=(s.className="col",i.appendChild(s),document.createElement("h2"));if(l.innerHTML=n.title,s.appendChild(l),n.items&&n.items.length){var r,o=document.createElement("ul");s.appendChild(o);for(r of n.items){var d=document.createElement("li");d.innerHTML=`<a class="" href="${r.link}">${r.title}</a>`,o.appendChild(d)}}}}if(e.credits||e.socials){var c=document.createElement("hr"),c=(a.appendChild(c),document.createElement("div"));if(c.className="credits-and-socials",a.appendChild(c),e.credits&&((a=document.createElement("p")).innerHTML=e.credits,c.appendChild(a)),e.socials){var h,u=document.createElement("div");u.className="social";for(h of e.socials){var p=document.createElement("a");p.title=h.title,p.innerHTML=h.icon,p.href=h.link,p.target="_blank",u.appendChild(p)}c.appendChild(u)}}(e.parent??document.body).appendChild(t)}};class A{static _last_id=0;constructor(l,e,t={}){e||console.warn("Content is empty, add some widgets using 'callback' parameter!"),this._oncreate=e,this.id=b();let a=t.size??[],n=t.position??[],i=t.draggable??!0,s=t.modal??!1;var r=document.createElement("dialog");r.className="lexdialog "+(t.className??""),r.id=t.id??"dialog"+A._last_id++,y.root.appendChild(r),m(()=>{s?r.showModal():r.show()},10);let o=this,d=document.createElement("div"),c;l&&(d.className="lexdialogtitle",d.innerHTML=l,d.setAttribute("draggable",!1),d.oncontextmenu=function(s){s.preventDefault(),s.stopPropagation(),y.main_area&&"horizontal"===y.main_area.type&&S("Dock",s,e=>{s.preventDefault();function n(e){let t=e.panels[0];if(t)return t;for(var a of e.sections)if(t=n(a))return t}function t(e){let t=e.branches.find(e=>e.name===l);t?e.root.appendChild(t.root):(e.branch(l),t=e.branches.find(e=>e.name===l));for(var a of o.widgets)t.content.appendChild(a.domEl);t.widgets=o.widgets,e.root.querySelectorAll(".lexbranch.last").forEach(e=>{e.classList.remove("last")}),t.root.classList.add("last"),r.remove()}let a=n(y.main_area.sections[1]),i=(e.add('<i class="fa-regular fa-window-maximize fa-window-maximize fa-rotate-90">',{disabled:!a,id:"dock_options0",callback:()=>{t(a)}}),n(y.main_area.sections[0]));e.add('<i class="fa-regular fa-window-maximize fa-window-maximize fa-rotate-270">',{disabled:!i,id:"dock_options1",callback:()=>{t(i)}})},{icon:"fa-regular fa-window-restore"})},r.appendChild(d)),(t.closable??!0)&&(this.close=()=>{t.onBeforeClose&&t.onBeforeClose(this),t.onclose?t.onclose(this.root):(r.close(),m(()=>{o.panel.clear(),r.remove()},150))},(c=document.createElement("a")).className="lexdialogcloser fa-solid fa-xmark",c.title="Close",c.addEventListener("click",this.close),(l?d:(c.classList.add("notitle"),r)).appendChild(c));var h=new k;h.root.classList.add("lexdialogcontent"),l||h.root.classList.add("notitle"),e&&e.call(this,h),r.appendChild(h.root),h.root.querySelectorAll(".lexbranch").forEach(e=>e.classList.add("dialog")),this.panel=h,this.root=r,this.title=d,i&&x(r,Object.assign({targetClass:"lexdialogtitle"},t)),a.length&&"string"!=typeof a[0]&&(a[0]+="px"),a.length&&"string"!=typeof a[1]&&(a[1]+="px"),r.style.width=a[0]||"25%",r.style.height=a[1]||"auto",r.style.translate=t.position?"unset":"-50% -50%",t.size&&(this.size=a),r.style.left=n[0]??"50%",r.style.top=n[1]??"50%",h.root.style.width="calc( 100% - 30px )",h.root.style.height=l?"calc( 100% - "+(d.offsetHeight+30)+"px )":"calc( 100% - 51px )"}destroy(){this.root.remove()}refresh(){this.panel.root.innerHTML="",this._oncreate.call(this,this.panel)}setPosition(e,t){this.root.style.left=e+"px",this.root.style.top=t+"px"}setTitle(e){var t=this.root.querySelector(".lexdialogtitle");t&&(t.innerText=e)}}y.Dialog=A;class r extends A{static TOP=0;static BOTTOM=1;constructor(e,t,a={}){a.draggable=a.draggable??!1,a.closable=a.closable??!1;super(e,t,a);let n=this;if(y.addSignal("@on_branch_closed",this.panel,e=>{this.dock_pos==r.BOTTOM&&(this.root.style.top="calc(100% - "+(this.root.offsetHeight+3)+"px)")}),this.root.classList.add("pocket"),this.root.style.translate="none",this.root.style.top="0",this.root.style.left="unset",a.position||(this.root.style.right="3px",this.root.style.top="3px"),this.panel.root.style.width="calc( 100% - 12px )",this.panel.root.style.height="calc( 100% - 40px )",this.dock_pos=r.TOP,this.minimized=!1,this.title.tabIndex=-1,this.title.addEventListener("click",e=>{this.title._eventCatched?this.title._eventCatched=!1:(this.size&&(this.minimized?this.root.style.height=this.size[1]:this.root.style.height="auto"),this.root.classList.toggle("minimized"),this.minimized=!this.minimized,this.dock_pos==r.BOTTOM&&(n.root.style.top=this.root.classList.contains("minimized")?"calc(100% - "+(n.title.offsetHeight+6)+"px)":"calc(100% - "+(n.root.offsetHeight+3)+"px)"))}),!a.draggable){var i=a.float;if(i)for(var s=0;s<i.length;s++)switch(i[s]){case"b":this.root.style.top="calc(100% - "+(this.root.offsetHeight+3)+"px)";break;case"l":this.root.style.right="unset",this.root.style.left=a.position?a.position[1]:"3px"}this.root.classList.add("dockable"),this.title.addEventListener("keydown",function(e){e.ctrlKey&&(n.root.style.right="unset","ArrowLeft"==e.key?n.root.style.left="0px":"ArrowRight"==e.key?n.root.style.left="calc(100% - "+(n.root.offsetWidth+3)+"px)":"ArrowUp"==e.key?(n.root.style.top="0px",n.dock_pos=r.TOP):"ArrowDown"==e.key&&(n.root.style.top="calc(100% - "+(n.root.offsetHeight+3)+"px)",n.dock_pos=r.BOTTOM))})}}}y.PocketDialog=r;class s{constructor(e,t,a={}){document.body.querySelectorAll(".lexcontextmenu").forEach(e=>e.remove()),this.root=document.createElement("div"),this.root.className="lexcontextmenu",this.root.style.left=e.x-48+document.scrollingElement.scrollLeft+"px",this.root.style.top=e.y-8+document.scrollingElement.scrollTop+"px",this.root.addEventListener("mouseleave",function(){this.remove()}),this.items=[],this.colors={},t&&((e={})[t]=[],e.className="cmtitle",e.icon=a.icon,this.items.push(e))}_adjustPosition(e,t,a=!1){var n=e.getBoundingClientRect();a?((a=window.innerWidth-n.right)<0&&(e.style.left=e.offsetLeft+(a-t)+"px"),(a=window.innerHeight-(n.top+n.height))<0&&(e.style.top=e.offsetTop+(a-t+20)+"px")):(a=n.width,n.left<0?e.style.left=t+"px":window.innerWidth-n.right<0&&(e.style.left=window.innerWidth-a-t+"px"),n.top<0?e.style.top=t+"px":n.top+n.height>window.innerHeight&&(e.style.top=window.innerHeight-n.height-t+"px"))}_createSubmenu(e,t,a,n){this.root.querySelectorAll(".lexcontextmenu").forEach(e=>e.remove());var i=document.createElement("div");i.className="lexcontextmenu",a.appendChild(i);for(var s=0;s<e[t].length;++s){var l=e[t][s],r=Object.keys(l)[0];this._createEntry(l,r,i,n)}var o=a.getBoundingClientRect();i.style.left=o.width+"px",i.style.marginTop=3.5-a.offsetHeight+"px",this._adjustPosition(i,6,!0)}_createEntry(t,a,e,n){let i=t[a].length,s=document.createElement("div");s.className="lexmenuboxentry"+(t.className?" "+t.className:""),s.id=t.id??"eId"+c(a),s.innerHTML="";var l=t.icon;l&&(s.innerHTML+="<a class='"+l+" fa-sm'></a>");let r=t.disabled;s.innerHTML+="<div class='lexentryname"+(r?" disabled":"")+"'>"+a+"</div>",e.appendChild(s),this.colors[a]&&(s.style.borderColor=this.colors[a]),""==a?s.className+=" cmseparator":(s.addEventListener("click",e=>{e.stopPropagation(),e.stopImmediatePropagation(),r||((e=t.callback)&&(e.call(this,a,s),this.root.remove()),i&&"click"==y.OPEN_CONTEXTMENU_ENTRY&&this._createSubmenu(t,a,s,++n))}),i&&((l=document.createElement("a")).className="fa-solid fa-bars-staggered fa-xs",s.appendChild(l),"mouseover"==y.OPEN_CONTEXTMENU_ENTRY&&s.addEventListener("mouseover",e=>{s.built||(s.built=!0,this._createSubmenu(t,a,s,++n),e.stopPropagation())}),s.addEventListener("mouseleave",()=>{n=-1,e.querySelectorAll(".lexcontextmenu").forEach(e=>e.remove())})))}onCreate(){m(()=>this._adjustPosition(this.root,6))}add(e,s={}){s.constructor==Function&&(s={callback:s});let l=(e+="").split("/");var t,a,e=l[l.length-1];this.colors[e]=s.color;let r=0,o=(n,e)=>{if(null!=n){let a=null;var t,i;e.forEach(e=>{var t=Object.keys(e).find(e=>e==n);t&&(a=e[t])}),a?o(l[r++],a):((t={})[n]=[],(i=l[r++])||(t.id=s.id,t.callback=s.callback,t.disabled=s.disabled??!1),e.push(t),o(i,t[n]))}},d=(o(l[r++],this.items),e=>{let t=Object.keys(e)[0];var a,n=e[t];if(n.length){null==n.find(e=>Object.keys(e)[0]==t)&&((n={})[t]=[],n.className="cmtitle",e[t].unshift(n));for(a of e[t])for(var i=Object.keys(a)[0],s=0;s<a[i].length;++s)d(a)}});for(t of this.items)d(t);for(a of this.items){var n=Object.keys(a)[0],i="eId"+c(n),i="#"+(a.id??i);this.root.querySelector(i)||this._createEntry(a,n,this.root,-1)}}setColor(e,t){"#"!==t[0]&&(t=u(t)),this.colors[e]=t}}function S(e,t,a,n){t=new s(t,e,n);return y.root.appendChild(t.root),a&&a(t),t.onCreate(),t}y.ContextMenu=s,y.addContextMenu=S;class D{constructor(e,t,a={}){let r=document.createElement("div"),o=(r.className="curve "+(a.className||""),r.style.minHeight="50px",r.style.width=a.width||"100%",r.style.minWidth="50px",r.style.minHeight="20px",r.bgcolor=a.bgColor||y.getThemeColor("global-intense-background"),r.pointscolor=a.pointsColor||y.getThemeColor("global-selected-light"),r.linecolor=a.lineColor||"#555",r.value=t||[],r.xrange=a.xrange||[0,1],r.yrange=a.yrange||[0,1],r.defaulty=null!=a.defaulty?a.defaulty:0,r.no_overlap=a.noOverlap||!1,r.show_samples=a.showSamples||0,r.allow_add_values=a.allowAddValues??!0,r.draggable_x=a.draggableX??!0,r.draggable_y=a.draggableY??!0,r.smooth=(a.smooth&&"number"==typeof a.smooth?a.smooth:.3)||!1,r.move_out=a.moveOutAction??y.CURVE_MOVEOUT_DELETE,y.addSignal("@on_new_color_scheme",(e,t)=>{r.bgcolor=a.bgColor||y.getThemeColor("global-intense-background"),r.pointscolor=a.pointsColor||y.getThemeColor("global-selected-light"),this.redraw()}),this.element=r,document.createElement("canvas"));function l(e){return[o.width*(e[0]-r.xrange[0])/r.xrange[1],o.height*(e[1]-r.yrange[0])/r.yrange[1]]}function d(e){return[e[0]*r.xrange[1]/o.width+r.xrange[0],e[1]*r.yrange[1]/o.height+r.yrange[0]]}o.width=a.width||200,o.height=a.height||50,r.appendChild(o),this.canvas=o,r.addEventListener("mousedown",function(e){document.addEventListener("mousemove",i),document.addEventListener("mouseup",u);var t=o.getBoundingClientRect(),a=e.clientX-t.left,t=e.clientY-t.top;{var n;c=((e,t)=>{for(var a=1e5,n=-1,i=0;i<r.value.length;i++){var s=l(r.value[i]),s=m([e,t],s);s<a&&s<8&&(a=s,n=i)}return n})(a,o.height-t),e.button==y.MOUSE_LEFT_CLICK&&-1==c&&r.allow_add_values&&(n=d([a,o.height-t]),r.value.push(n),g(),c=r.value.indexOf(n))}h=[a,t],r.redraw(),e.preventDefault(),e.stopPropagation()}),r.getValueAt=function(e){if(e<r.xrange[0]||e>r.xrange[1])return r.defaulty;for(var t=[r.xrange[0],r.defaulty],a=0,n=0;n<r.value.length;n+=1){var i=r.value[n];if(e==i[0])return i[1];if(e<i[0])return a=(e-t[0])/(i[0]-t[0]),t[1]*(1-a)+i[1]*a;t=i}return i=[r.xrange[1],r.defaulty],a=(e-t[0])/(i[0]-t[0]),t[1]*(1-a)+i[1]*a},r.resample=function(e){for(var t=[],a=(r.xrange[1]-r.xrange[0])/e,n=r.xrange[0];n<=r.xrange[1];n+=a)t.push(r.getValueAt(n));return t},r.addValue=function(e){for(var t=0;t<r.value;t++){var a=r.value[t];if(!(a[0]<e[0]))return r.value.splice(t,0,e),void redraw()}r.value.push(e),redraw()};var c=-1,h=(r.redraw=function(e={}){e.value&&(r.value=e.value),e.xrange&&(r.xrange=e.xrange),e.yrange&&(r.yrange=e.yrange),e.smooth&&(r.smooth=e.smooth);var e=o.parentElement.getBoundingClientRect(),t=((e=o.parentElement.parentElement?o.parentElement.parentElement.getBoundingClientRect():e)&&o.width!=e.width&&e.width&&e.width<1e3&&(o.width=e.width),o.getContext("2d")),a=(t.setTransform(1,0,0,1,0,0),t.translate(0,o.height),t.scale(1,-1),t.fillStyle=r.bgcolor,t.fillRect(0,0,o.width,o.height),t.strokeStyle=r.linecolor,t.beginPath(),l([r.xrange[0],r.defaulty])),n=(t.moveTo(a[0],a[1]),[a[0],a[1]]);for(i in r.value){a=l(r.value[i]);n.push(a[0]),n.push(a[1]),r.smooth||t.lineTo(a[0],a[1])}a=l([r.xrange[1],r.defaulty]),n.push(a[0]),n.push(a[1]),r.smooth?y.UTILS.drawSpline(t,n,r.smooth):(t.lineTo(a[0],a[1]),t.stroke());for(var i=0;i<r.value.length;i+=1)a=l(r.value[i]),t.fillStyle=c==i?"white":r.pointscolor,t.beginPath(),t.arc(a[0],a[1],c==i?4:3,0,2*Math.PI),t.fill();if(r.show_samples){var s=r.resample(r.show_samples);t.fillStyle="#888";for(i=0;i<s.length;i+=1)a=l([i*((r.xrange[1]-r.xrange[0])/r.show_samples)+r.xrange[0],s[i]]),t.beginPath(),t.arc(a[0],a[1],2,0,2*Math.PI),t.fill()}},[0,0]);function i(e){var t,a,n,i=o.getBoundingClientRect(),s=e.clientX-i.left,l=e.clientY-i.top,i=(s<0?s=0:s>o.width&&(s=o.width),l<0?l=0:l>o.height&&(l=o.height),[e.clientX-i.left,e.clientY-i.top]);-1!=c&&m(i,[s,l])>.5*o.height?(r.move_out==y.CURVE_MOVEOUT_DELETE?r.value.splice(c,1):(i=[i[0]-s,i[1]-l],(t=r.value[c])[0]=0==i[0]?t[0]:i[0]<0?r.xrange[0]:r.xrange[1],t[1]=0==i[1]?t[1]:i[1]<0?r.yrange[1]:r.yrange[0]),u(e)):(t=d([-(r.draggable_x?h[0]-s:0),r.draggable_y?h[1]-l:0]),-1!=c&&(i=r.xrange[0],a=r.xrange[1],r.no_overlap&&(0<c&&(i=r.value[c-1][0]),c<r.value.length-1)&&(a=r.value[c+1][0]),(n=r.value[c])[0]+=t[0],n[1]+=t[1],n[0]<i?n[0]=i:n[0]>a&&(n[0]=a),n[1]<r.yrange[0]?n[1]=r.yrange[0]:n[1]>r.yrange[1]&&(n[1]=r.yrange[1])),g(),r.redraw(),h[0]=s,h[1]=l,p(e),e.preventDefault(),e.stopPropagation())}function u(e){c=-1,r.redraw(),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",u),p(e),e.preventDefault(),e.stopPropagation()}function p(e){a.callback&&a.callback.call(r,r.value,e)}function m(e,t){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function g(){var e=null;-1!=c&&(e=r.value[c]),r.value.sort(function(e,t){return e[0]-t[0]}),e&&(c=r.value.indexOf(e))}return r.redraw(),this}redraw(e={}){this.element.redraw(e)}}y.Curve=D;class M{constructor(e,t,a={}){let r=document.createElement("div"),o=(r.className="dial "+(a.className||""),r.style.width=r.style.height=a.size||"100%",r.style.minWidth=r.style.minHeight="50px",r.bgcolor=a.bgColor||y.getThemeColor("global-dark-background"),r.pointscolor=a.pointsColor||y.getThemeColor("global-selected-light"),r.linecolor=a.lineColor||"#555",r.value=t||[],r.xrange=a.xrange||[0,1],r.yrange=a.yrange||[0,1],r.defaulty=null!=a.defaulty?a.defaulty:0,r.no_overlap=a.noOverlap||!1,r.show_samples=a.showSamples||0,r.allow_add_values=a.allowAddValues??!0,r.draggable_x=a.draggableX??!0,r.draggable_y=a.draggableY??!0,r.smooth=(a.smooth&&"number"==typeof a.smooth?a.smooth:.3)||!1,r.move_out=a.moveOutAction??y.CURVE_MOVEOUT_DELETE,this.element=r,document.createElement("canvas"));function l(e){return Math.pow(e[0],2),[o.width*(e[0]-r.xrange[0])/r.xrange[1],o.height*(e[1]-r.yrange[0])/r.yrange[1]]}function d(e){return[e[0]*r.xrange[1]/o.width+r.xrange[0],e[1]*r.yrange[1]/o.height+r.yrange[0]]}o.width=o.height=a.size||200,r.appendChild(o),this.canvas=o,r.addEventListener("mousedown",function(e){document.addEventListener("mousemove",i),document.addEventListener("mouseup",u);var t=o.getBoundingClientRect(),a=e.clientX-t.left,t=e.clientY-t.top;{var n;c=((e,t)=>{for(var a=1e5,n=-1,i=0;i<r.value.length;i++){var s=l(r.value[i]),s=m([e,t],s);s<a&&s<8&&(a=s,n=i)}return n})(a,o.height-t),e.button==y.MOUSE_LEFT_CLICK&&-1==c&&r.allow_add_values&&(n=d([a,o.height-t]),r.value.push(n),g(),c=r.value.indexOf(n))}h=[a,t],r.redraw(),e.preventDefault(),e.stopPropagation()}),r.getValueAt=function(e){if(e<r.xrange[0]||e>r.xrange[1])return r.defaulty;for(var t=[r.xrange[0],r.defaulty],a=0,n=0;n<r.value.length;n+=1){var i=r.value[n];if(e==i[0])return i[1];if(e<i[0])return a=(e-t[0])/(i[0]-t[0]),t[1]*(1-a)+i[1]*a;t=i}return i=[r.xrange[1],r.defaulty],a=(e-t[0])/(i[0]-t[0]),t[1]*(1-a)+i[1]*a},r.resample=function(e){for(var t=[],a=(r.xrange[1]-r.xrange[0])/e,n=r.xrange[0];n<=r.xrange[1];n+=a)t.push(r.getValueAt(n));return t},r.addValue=function(e){for(var t=0;t<r.value;t++){var a=r.value[t];if(!(a[0]<e[0]))return r.value.splice(t,0,e),void redraw()}r.value.push(e),redraw()};var c=-1,h=(r.redraw=function(e={}){e.value&&(r.value=e.value),e.xrange&&(r.xrange=e.xrange),e.yrange&&(r.yrange=e.yrange),e.smooth&&(r.smooth=e.smooth);var e=o.parentElement.getBoundingClientRect(),t=((e=o.parentElement.parentElement?o.parentElement.parentElement.getBoundingClientRect():e)&&o.width!=e.width&&e.width&&e.width<1e3&&(o.width=e.width),o.getContext("2d")),a=(t.setTransform(1,0,0,1,0,0),t.translate(0,o.height),t.scale(1,-1),t.fillStyle=r.bgcolor,t.fillRect(0,0,o.width,o.height),t.strokeStyle=r.linecolor,t.beginPath(),l([r.xrange[0],r.defaulty])),n=(t.moveTo(a[0],a[1]),[a[0],a[1]]);for(i in r.value){a=l(r.value[i]);n.push(a[0]),n.push(a[1])}a=l([r.xrange[1],r.defaulty]),n.push(a[0]),n.push(a[1]);a=l([0,0]),t.fillStyle="gray",t.beginPath(),t.arc(a[0],a[1],3,0,2*Math.PI),t.fill();for(var i=0;i<r.value.length;i+=1)a=l(r.value[i]),t.fillStyle=c==i?"white":r.pointscolor,t.beginPath(),t.arc(a[0],a[1],c==i?4:3,0,2*Math.PI),t.fill();if(r.show_samples){var s=r.resample(r.show_samples);t.fillStyle="#888";for(i=0;i<s.length;i+=1)a=l([i*((r.xrange[1]-r.xrange[0])/r.show_samples)+r.xrange[0],s[i]]),t.beginPath(),t.arc(a[0],a[1],2,0,2*Math.PI),t.fill()}},[0,0]);function i(e){var t,a,n,i=o.getBoundingClientRect(),s=e.clientX-i.left,l=e.clientY-i.top,i=(s<0?s=0:s>o.width&&(s=o.width),l<0?l=0:l>o.height&&(l=o.height),[e.clientX-i.left,e.clientY-i.top]);-1!=c&&m(i,[s,l])>.5*o.height?(r.move_out==y.CURVE_MOVEOUT_DELETE?r.value.splice(c,1):(i=[i[0]-s,i[1]-l],(t=r.value[c])[0]=0==i[0]?t[0]:i[0]<0?r.xrange[0]:r.xrange[1],t[1]=0==i[1]?t[1]:i[1]<0?r.yrange[1]:r.yrange[0]),u(e)):(t=d([-(r.draggable_x?h[0]-s:0),r.draggable_y?h[1]-l:0]),-1!=c&&(i=r.xrange[0],a=r.xrange[1],r.no_overlap&&(0<c&&(i=r.value[c-1][0]),c<r.value.length-1)&&(a=r.value[c+1][0]),(n=r.value[c])[0]+=t[0],n[1]+=t[1],n[0]<i?n[0]=i:n[0]>a&&(n[0]=a),n[1]<r.yrange[0]?n[1]=r.yrange[0]:n[1]>r.yrange[1]&&(n[1]=r.yrange[1])),g(),r.redraw(),h[0]=s,h[1]=l,p(e),e.preventDefault(),e.stopPropagation())}function u(e){c=-1,r.redraw(),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",u),p(e),e.preventDefault(),e.stopPropagation()}function p(e){a.callback&&a.callback.call(r,r.value,e)}function m(e,t){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function g(){var e=null;-1!=c&&(e=r.value[c]),r.value.sort(function(e,t){return e[0]-t[0]}),e&&(c=r.value.indexOf(e))}return r.redraw(),this}redraw(e={}){this.element.redraw(e)}}y.Dial=M;class P{static NONE=0;static ASSET_SELECTED=1;static ASSET_DELETED=2;static ASSET_RENAMED=3;static ASSET_CLONED=4;static ASSET_DBLCLICKED=5;static ENTER_FOLDER=6;static ASSET_CHECKED=7;constructor(e,t,a){this.type=e||L.NONE,this.item=t,this.value=a,this.multiple=!1}string(){switch(this.type){case P.NONE:return"assetview_event_none";case P.ASSET_SELECTED:return"assetview_event_selected";case P.ASSET_DELETED:return"assetview_event_deleted";case P.ASSET_RENAMED:return"assetview_event_renamed";case P.ASSET_CLONED:return"assetview_event_cloned";case P.ASSET_DBLCLICKED:return"assetview_event_dblclicked";case P.ENTER_FOLDER:return"assetview_event_enter_folder";case P.ASSET_CHECKED:return"assetview_event_checked"}}}y.AssetViewEvent=P;class O{static LAYOUT_CONTENT=0;static LAYOUT_LIST=1;static MAX_PAGE_ELEMENTS=50;constructor(e={}){this.rootPath="https://raw.githubusercontent.com/jxarco/lexgui.js/master/",this.layout=e.layout??O.LAYOUT_CONTENT,this.contentPage=1,e.rootPath&&(e.rootPath.constructor!==String?console.warn("Asset Root Path must be a String (now is "+path.constructor.name+")"):this.rootPath=e.rootPath);var t=document.createElement("div"),a=(t.className="lexassetbrowser",this.root=t,new y.Area({height:"100%"}));t.appendChild(a.root);let n,i,s=a;this.skipBrowser=e.skipBrowser??!1,this.skipPreview=e.skipPreview??!1,this.useNativeTitle=e.useNativeTitle??!1,this.onlyFolders=e.onlyFolders??!0,this.allowMultipleSelection=e.allowMultipleSelection??!1,this.previewActions=e.previewActions??[],this.contextMenu=e.contextMenu??[],this.onRefreshContent=e.onRefreshContent,this.skipBrowser||([n,i]=a.split({type:"horizontal",sizes:["15%","85%"]}),s=i,n.setLimitBox(210,0),i.setLimitBox(512,0)),this.skipPreview||([s,i]=s.split({type:"horizontal",sizes:["80%","20%"]})),this.allowedTypes=e.allowedTypes||["None","Image","Mesh","Script","JSON","Clip"],this.prevData=[],this.nextData=[],this.data=[],this._processData(this.data,null),this.currentData=this.data,this.path=["@"],this.skipBrowser||this._createTreePanel(n),this._createContentPanel(s),this.skipPreview||(this.previewPanel=i.addPanel({className:"lexassetcontentpanel",style:{overflow:"scroll"}}))}load(e,t){this.prevData.length=0,this.nextData.length=0,this.data=e,this._processData(this.data,null),this.currentData=this.data,this.path=["@"],this.skipBrowser||this._createTreePanel(this.area),this._refreshContent(),this.onevent=t}clear(){this.previewPanel&&this.previewPanel.clear(),this.leftPanel&&this.leftPanel.clear(),this.rightPanel&&this.rightPanel.clear()}_processData(e,t){e.constructor!==Array&&(e.folder=t,e.children=e.children??[]);for(var a=e.constructor===Array?e:e.children,n=0;n<a.length;++n)this._processData(a[n],e)}_updatePath(e){this.path.length=0;let t=e=>{e&&(e=(e.children||e)[0])&&e.folder&&(this.path.push(e.folder.id??"@"),t(e.folder.folder))};t(e),y.emit("@on_folder_change",this.path.reverse().join("/"))}_createTreePanel(e){this.leftPanel?this.leftPanel.clear():this.leftPanel=e.addPanel({className:"lexassetbrowserpanel"});e={id:"/",children:this.data};this.tree=this.leftPanel.addTree("Content Browser",e,{filter:!1,onlyFolders:this.onlyFolders,onevent:e=>{var t=e.node,a=e.value;switch(e.type){case y.TreeEvent.NODE_SELECTED:e.multiple||this._enterFolder(t),t.parent||(this.prevData.push(this.currentData),this.currentData=this.data,this._refreshContent(),this.path=["@"],y.emit("@on_folder_change",this.path.join("/")));break;case y.TreeEvent.NODE_DRAGGED:t.folder=a,this._refreshContent()}}})}_setContentLayout(e){this.layout=e,this._refreshContent()}_createContentPanel(e){this.rightPanel?this.rightPanel.clear():this.rightPanel=e.addPanel({className:"lexassetcontentpanel"});e=(e,t)=>{var a;this.allowNextPage&&(a=this.contentPage,this.contentPage+=e,this.contentPage=Math.min(this.contentPage,1+((this.currentData.length-1)/O.MAX_PAGE_ELEMENTS|0)),this.contentPage=Math.max(this.contentPage,1),a!=this.contentPage)&&this._refreshContent()};this.rightPanel.sameLine(),this.rightPanel.addDropdown("Filter",this.allowedTypes,this.allowedTypes[0],e=>this._refreshContent.call(this,null,e),{width:"30%",minWidth:"128px"}),this.rightPanel.addText(null,this.searchValue??"",e=>this._refreshContent.call(this,e,null),{placeholder:"Search assets.."}),this.rightPanel.addButton(null,"<a class='fa fa-arrow-up-short-wide'></a>",((e,t)=>{var t=S("Sort by",t,e=>{e.add("Name",()=>this._sortData("id")),e.add("Type",()=>this._sortData("type")),e.add(""),e.add("Ascending",()=>this._sortData()),e.add("Descending",()=>this._sortData(null,!0))}),a=this.parent.root.parentElement;a.classList.contains("lexdialog")&&(t.root.style.zIndex=+getComputedStyle(a).zIndex+1)}).bind(this),{className:"micro",title:"Sort"}),this.rightPanel.addButton(null,"<a class='fa-solid fa-grip'></a>",((e,t)=>{var t=S("Layout",t,e=>{e.add("Content",()=>this._setContentLayout(O.LAYOUT_CONTENT)),e.add(""),e.add("List",()=>this._setContentLayout(O.LAYOUT_LIST))}),a=this.parent.root.parentElement;a.classList.contains("lexdialog")&&(t.root.style.zIndex=+getComputedStyle(a).zIndex+1)}).bind(this),{className:"micro",title:"View"}),this.rightPanel.addButton(null,"<a class='fa-solid fa-angles-left'></a>",e.bind(this,-1),{className:"micro",title:"Previous Page"}),this.rightPanel.addButton(null,"<a class='fa-solid fa-angles-right'></a>",e.bind(this,1),{className:"micro",title:"Next Page"}),this.rightPanel.endLine(),this.skipBrowser||(this.rightPanel.sameLine(),this.rightPanel.addComboButtons(null,[{value:"Left",icon:"fa-solid fa-left-long",callback:e=>{this.prevData.length&&(this.nextData.push(this.currentData),this.currentData=this.prevData.pop(),this._refreshContent(),this._updatePath(this.currentData))}},{value:"Right",icon:"fa-solid fa-right-long",callback:e=>{this.nextData.length&&(this.prevData.push(this.currentData),this.currentData=this.nextData.pop(),this._refreshContent(),this._updatePath(this.currentData))}},{value:"Refresh",icon:"fa-solid fa-arrows-rotate",callback:e=>{this._refreshContent()}}],{width:"20%",minWidth:"164px",noSelection:!0}),this.rightPanel.addText(null,this.path.join("/"),null,{width:"70%",maxWidth:"calc(70% - 64px)",minWidth:"164px",disabled:!0,signal:"@on_folder_change",style:{fontWeight:"bolder",fontSize:"16px",color:"#aaa"}}),this.rightPanel.addText(null,"Page "+this.contentPage+" / "+(1+((this.currentData.length-1)/O.MAX_PAGE_ELEMENTS|0)),null,{disabled:!0,signal:"@on_page_change",width:"fit-content"}),this.rightPanel.endLine()),this.content=document.createElement("ul"),this.content.className="lexassetscontent",this.rightPanel.root.appendChild(this.content),this.content.addEventListener("dragenter",function(e){e.preventDefault(),this.classList.add("dragging")}),this.content.addEventListener("dragleave",function(e){e.preventDefault(),this.classList.remove("dragging")}),this.content.addEventListener("drop",e=>{e.preventDefault(),this._processDrop(e)}),this.content.addEventListener("click",function(){this.querySelectorAll(".lexassetitem").forEach(e=>e.classList.remove("selected"))}),this._refreshContent()}_refreshContent(a,n){let o=this.layout==O.LAYOUT_CONTENT,s=(this.filter=n??this.filter??"None",this.searchValue=a??this.searchValue??"",this.content.innerHTML="",this.content.className=o?"lexassetscontent":"lexassetscontent list",this);let i=new FileReader;var l=this.currentData.filter(e=>("None"==this.filter||e.type.toLowerCase()==this.filter.toLowerCase())&&e.id.toLowerCase().includes(this.searchValue.toLowerCase())),t=((n||a)&&(this.contentPage=1),(this.contentPage-1)*O.MAX_PAGE_ELEMENTS),r=Math.min(t+O.MAX_PAGE_ELEMENTS,l.length);for(let e=t;e<r;++e){let t=l[e];t.path?y.request({url:t.path,dataType:"blob",success:e=>{t.bytesize=e.size,i.readAsDataURL(e),i.onload=e=>{t.src=e.currentTarget.result,t._path=t.path,delete t.path,this._refreshContent(a,n)}}}):t.domEl=(n=>{var e=n.type.charAt(0).toUpperCase()+n.type.slice(1),t=d(n.id);let a="Folder"===e,r=document.createElement("li");if(r.className="lexassetitem "+n.type.toLowerCase(),r.tabIndex=-1,s.content.appendChild(r),s.useNativeTitle)r.title=e+": "+n.id;else{let l=document.createElement("span");l.className="lexitemdesc",l.innerHTML="File: "+n.id+"<br>Type: "+e,s.content.appendChild(l),r.addEventListener("mousemove",t=>{if(o){var a=r.getBoundingClientRect(),n=t.target.getBoundingClientRect(),i=l.parentElement.getBoundingClientRect(),s=n.x-i.x-(n.x-a.x);let e=n.y-i.y-(n.y-a.y);t.target.classList.contains("lexassettitle")&&(e+=n.y-a.y),l.style.left=s+t.offsetX+12+"px",l.style.top=e+t.offsetY+"px"}}),r.addEventListener("mouseenter",()=>{o&&(l.style.display="unset")}),r.addEventListener("mouseleave",()=>{o&&setTimeout(()=>{l.style.display="none"},100)})}s.allowMultipleSelection&&((i=document.createElement("input")).type="checkbox",i.className="lexcheckbox",i.checked=n.selected,i.addEventListener("change",(e,t)=>{var a;n.selected=!n.selected,s.onevent&&((a=new P(P.ASSET_CHECKED,e.shiftKey?[n]:n)).multiple=!!e.shiftKey,s.onevent(a)),e.stopPropagation(),e.stopImmediatePropagation()}),r.appendChild(i));var i=document.createElement("span");if(i.className="lexassettitle",i.innerText=n.id,r.appendChild(i),!s.skipPreview){let e=null;n.src&&(-1<["png","jpg"].indexOf(d(n.src))||n.src.includes("data:image/"))||a||!o?(e=document.createElement("img"),i=n.unknown_extension?s.rootPath+"images/file.png":a?s.rootPath+"images/folder.png":n.src,e.src=o||a?i:s.rootPath+"images/file.png",r.appendChild(e)):((e=document.createElement("svg")).className="asset-file-preview",r.appendChild(e),i=document.createElement("text"),e.appendChild(i),i.innerText=t&&t!=n.id?"."+t.toUpperCase():n.type.toUpperCase(),(t=2.5/i.innerText.length)<1&&(i.style.fontSize=64*t+"px",e.style.paddingTop="calc(50% - "+(.5*i.offsetHeight+10)+"px)"))}return a||((t=document.createElement("span")).className="lexassetinfo",t.innerText=e,r.appendChild(t)),r.addEventListener("click",function(e){e.stopImmediatePropagation(),e.stopPropagation();var t=e.detail==y.MOUSE_DOUBLE_CLICK;if(t){if(a)return void s._enterFolder(n)}else e.shiftKey||s.content.querySelectorAll(".lexassetitem").forEach(e=>e.classList.remove("selected")),this.classList.add("selected"),s.selectedItem=n,s.skipPreview||s._previewAsset(n);s.onevent&&((t=new P(t?P.ASSET_DBLCLICKED:P.ASSET_SELECTED,e.shiftKey?[n]:n)).multiple=!!e.shiftKey,s.onevent(t))}),s.contextMenu&&r.addEventListener("contextmenu",function(e){e.preventDefault();let t=s.content.querySelectorAll(".selected").length;y.addContextMenu(1<t?t+" selected":a?n.id:n.type,e,e=>{t<=1&&e.add("Rename"),a||e.add("Clone",s._cloneItem.bind(s,n)),t<=1&&e.add("Properties"),e.add(""),e.add("Delete",s._deleteItem.bind(s,n))})}),r.addEventListener("dragstart",function(e){e.preventDefault()},!1),r})(t)}this.allowNextPage=l.length-1>O.MAX_PAGE_ELEMENTS,y.emit("@on_page_change","Page "+this.contentPage+" / "+(1+((l.length-1)/O.MAX_PAGE_ELEMENTS|0))),this.onRefreshContent&&this.onRefreshContent(a,n)}_previewAsset(e){var t,a=e.src&&e.src.includes("data:image/"),a=(this.previewPanel.clear(),this.previewPanel.branch("Asset"),("image"==e.type||e.src)&&(-1<["png","jpg"].indexOf(d(e.src))||a)&&this.previewPanel.addImage(e.src,{style:{width:"100%"}}),{disabled:!0}),a=(this.previewPanel.addText("Filename",e.id,null,a),e.lastModified&&this.previewPanel.addText("Last Modified",new Date(e.lastModified).toLocaleString(),null,a),(e._path||e.src)&&this.previewPanel.addText("URL",e._path||e.src,null,a),this.previewPanel.addText("Path",this.path.join("/"),null,a),this.previewPanel.addText("Type",e.type,null,a),e.bytesize&&this.previewPanel.addText("Size",(e.bytesize/1024).toPrecision(3)+" KBs",null,a),"folder"==e.type&&this.previewPanel.addText("Files",e.children?e.children.length.toString():"0",null,a),this.previewPanel.addSeparator(),[...this.previewActions]);a.length||a.push({name:"Download",callback:()=>y.downloadURL(e.src,e.id)});for(t of a)t.type&&t.type!==e.type||t.path&&t.path!==this.path.join("/")||this.previewPanel.addButton(null,t.name,t.callback.bind(this,e));this.previewPanel.merge()}_processDrop(e){var t=new FileReader;let s=e.dataTransfer.files.length;for(let i=0;i<e.dataTransfer.files.length;++i){let n=e.dataTransfer.files[i];this.currentData.find(e=>e.id===n.name)||(t.readAsDataURL(n),t.onload=e=>{var t=n.name.substr(n.name.lastIndexOf(".")+1).toLowerCase(),a={id:n.name,src:e.currentTarget.result,extension:t,lastModified:n.lastModified};switch(t){case"png":case"jpg":a.type="image";break;case"js":case"css":a.type="script";break;case"json":a.type="json";break;case"obj":a.type="mesh";break;default:a.type=t,a.unknown_extension=!0}this.currentData.push(a),i==s-1&&(this._refreshContent(),this.skipBrowser||this.tree.refresh())})}}_sortData(n,i=!1){n=n??this._lastSortBy??"id",this.currentData=this.currentData.sort((e,t)=>{var a=i?t[n].localeCompare(e[n]):e[n].localeCompare(t[n]);return a=0==a?i?t.id.localeCompare(e.id):e.id.localeCompare(t.id):a}),this._lastSortBy=n,this._refreshContent()}_enterFolder(e){this.prevData.push(this.currentData),this.currentData=e.children,this.contentPage=1,this._refreshContent(),this._updatePath(this.currentData),this.onevent&&(e=new P(P.ENTER_FOLDER,e),this.onevent(e))}_deleteItem(e){var t=this.currentData.indexOf(e);t<0?console.error("[AssetView Error] Cannot delete. Item not found."):(this.currentData.splice(t,1),this._refreshContent(this.searchValue,this.filter),this.onevent&&(t=new P(P.ASSET_DELETED,e),this.onevent(t)),this.tree.refresh(),this._processData(this.data))}_cloneItem(e){var t,a=this.currentData.indexOf(e);a<0||(delete e.domEl,delete e.folder,t=g(e),this.currentData.splice(a,0,t),this._refreshContent(this.searchValue,this.filter),this.onevent&&(a=new P(P.ASSET_CLONED,e),this.onevent(a)),this._processData(this.data))}}y.AssetView=O,Object.assign(y,{request(n){var e=n.dataType||"text",t=("json"==e||"xml"==e?e="text":"binary"==e&&(e="arraybuffer",n.mimeType="application/octet-stream"),new XMLHttpRequest),a=(t.open(n.data?"POST":"GET",n.url,!0),e&&(t.responseType=e),n.mimeType&&t.overrideMimeType(n.mimeType),n.nocache&&t.setRequestHeader("Cache-Control","no-cache"),t.onload=function(e){var t,a=this.response;if(200!=this.status)t="Error "+this.status,n.error&&n.error(t);else{if("json"==n.dataType)try{a=JSON.parse(a)}catch(t){if(!n.error)throw t;n.error(t)}else if("xml"==n.dataType)try{a=(new DOMParser).parseFromString(a,"text/xml")}catch(t){if(!n.error)throw t;n.error(t)}n.success&&n.success.call(this,a,this)}},t.onerror=function(e){n.error&&n.error(e)},new FormData);if(n.data)for(var i in n.data)a.append(i,n.data[i]);return t.send(a),t},requestText(e,t,a){return this.request({url:e,dataType:"text",success:t,error:a})},requestJSON(e,t,a){return this.request({url:e,dataType:"json",success:t,error:a})},requestBinary(e,t,a){return this.request({url:e,dataType:"binary",success:t,error:a})},requireScript(e,t,a,n,i){if(!e)throw"invalid URL";var s,l=(e=e.constructor===String?[e]:e).length,r=[];for(s in e){var o=document.createElement("script");o.num=s,o.type="text/javascript",o.src=e[s]+(i?"?version="+i:""),o.original_src=e[s],o.async=!1,o.onload=function(e){l--,r.push(this),l?n&&n(this.original_src,this.num):t&&t(r)},a&&(o.onerror=function(e){a(e,this.original_src,this.num)}),document.getElementsByTagName("head")[0].appendChild(o)}},downloadURL(e,a){function t(e){var t=document.createElement("a");t.href=e,t.download=a,document.body.appendChild(t),t.click(),document.body.removeChild(t)}let n=new FileReader;e.includes("http")?y.request({url:e,dataType:"blob",success:e=>{n.readAsDataURL(e),n.onload=e=>{t(e.currentTarget.result)}}}):t(e)},downloadFile:function(e,t,a){var n,i;t?(a=a||(t.constructor===String?"text/plain":"application/octet-stream"),n=null,n=t.constructor!==File&&t.constructor!==Blob?new Blob([t],{type:a}):t,i=URL.createObjectURL(n),(a=document.createElement("a")).setAttribute("href",i),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(function(){URL.revokeObjectURL(i)},6e4)):console.warn("No file provided to download")}}),Object.defineProperty(String.prototype,"lastChar",{get:function(){return this[this.length-1]},enumerable:!0,configurable:!0}),Element.prototype.insertChildAtIndex=function(e,t=1/0){t>=this.children.length?this.appendChild(e):this.insertBefore(e,this.children[t])},Element.prototype.hasClass=function(e){return!!(e=[].concat(e)).filter(e=>this.classList.contains(e)).length},Element.prototype.addClass=function(e){e&&this.classList.add(e)},Element.prototype.getComputedSize=function(){var e=getComputedStyle(this);return{width:this.offsetWidth+e.getPropertyValue("marginLeft")+e.getPropertyValue("marginRight"),height:this.offsetHeight+e.getPropertyValue("marginTop")+e.getPropertyValue("marginBottom")}},Element.prototype.getParentArea=function(){let e=this.parentElement;for(;e;){if(e.classList.contains("lexarea"))return e;e=e.parentElement}},y.ICONS={Sidebar:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_iconCarrier"> <g id="Complete"> <g id="sidebar-left"> <g> <rect id="Square-2" data-name="Square" x="3" y="3" width="18" height="18" rx="2" ry="2" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="2"></rect> <line x1="9" y1="21" x2="9" y2="3" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="2"></line> </g> </g> </g> </g></svg>',More:'<svg fill="#000000" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_iconCarrier"> <g id="Complete"> <g id="F-More"> <path id="Vertical" d="M12,16a2,2,0,1,1-2,2A2,2,0,0,1,12,16ZM10,6a2,2,0,1,0,2-2A2,2,0,0,0,10,6Zm0,6a2,2,0,1,0,2-2A2,2,0,0,0,10,12Z"></path> </g> </g> </g></svg>',MoreHorizontal:'<svg fill="#000000" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_iconCarrier"> <g id="Complete"> <g id="F-More"> <path id="Horizontal" d="M8,12a2,2,0,1,1-2-2A2,2,0,0,1,8,12Zm10-2a2,2,0,1,0,2,2A2,2,0,0,0,18,10Zm-6,0a2,2,0,1,0,2,2A2,2,0,0,0,12,10Z"></path> </g> </g> </g></svg>',MenuArrows:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000" transform="rotate(90)"><g id="SVGRepo_iconCarrier"> <g id="Complete"> <g id="Code"> <g> <polyline id="Right-2" data-name="Right" points="15.5 7 20.5 12 15.5 17" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline> <polyline id="Left-2" data-name="Left" points="8.5 7 3.5 12 8.5 17" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline> </g> </g> </g> </g></svg>',Plus:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000"<g id="SVGRepo_iconCarrier"> <g id="Complete"> <g id="add-2" data-name="add"> <g> <line x1="12" y1="19" x2="12" y2="5" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line> <line x1="5" y1="12" x2="19" y2="12" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line> </g> </g> </g> </g></svg>',Down:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_iconCarrier"> <title>i</title> <g id="Complete"> <g id="F-Chevron"> <polyline id="Down" points="5 8.5 12 15.5 19 8.5" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline> </g> </g> </g></svg>',Up:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_iconCarrier"> <title>i</title> <g id="Complete"> <g id="F-Chevron"> <polyline id="Up" points="5 15.5 12 8.5 19 15.5" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline> </g> </g> </g></svg>',Right:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_iconCarrier"> <title>i</title> <g id="Complete"> <g id="F-Chevron"> <polyline id="Right" points="8.5 5 15.5 12 8.5 19" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline> </g> </g> </g></svg>',Left:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_iconCarrier"> <title>i</title> <g id="Complete"> <g id="F-Chevron"> <polyline id="Left" points="15.5 5 8.5 12 15.5 19" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline> </g> </g> </g></svg>'},y.UTILS={getTime(){return(new Date).getTime()},compareThreshold(e,t,a,n){return Math.abs(e-t)>=n||Math.abs(e-a)>=n},compareThresholdRange(e,t,a,n){return a<=e&&e<=n||a<=t&&t<=n||e<=a&&n<=t},uidGenerator:b,deleteElement(e){e&&e.remove()},flushCss(e){e.offsetHeight},getControlPoints(e,t,a,n,i,s,l){var r=Math.sqrt(Math.pow(a-e,2)+Math.pow(n-t,2)),r=l*r/(r+Math.sqrt(Math.pow(i-a,2)+Math.pow(s-n,2))),l=l-r;return[a+r*(e-i),n+r*(t-s),a-l*(e-i),n-l*(t-s)]},drawSpline(e,t,a){e.save();for(var n=[],i=t.length,s=0;s<i-4;s+=2)n=n.concat(y.UTILS.getControlPoints(t[s],t[s+1],t[s+2],t[s+3],t[s+4],t[s+5],a));for(s=2;s<t.length-5;s+=2)e.beginPath(),e.moveTo(t[s],t[s+1]),e.bezierCurveTo(n[2*s-2],n[2*s-1],n[2*s],n[2*s+1],t[s+2],t[s+3]),e.stroke(),e.closePath();e.beginPath(),e.moveTo(t[0],t[1]),e.quadraticCurveTo(n[0],n[1],t[2],t[3]),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(t[i-2],t[i-1]),e.quadraticCurveTo(n[2*i-10],n[2*i-9],t[i-4],t[i-3]),e.stroke(),e.closePath(),e.restore()}};export{y as LX};