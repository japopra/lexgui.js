"use strict";console.warn("Script _build/lexgui.js_ is depracated and will be removed soon. Please use ES Modules or alternatives: https://jxarco.github.io/lexgui.js/docs/"),function(e){var t={version:"0.3.0",ready:!1,components:[],signals:{},extraCommandbarEntries:[]};function i(e,t,i){return Math.min(Math.max(e,t),i)}function a(e,t){return 0==t?Math.floor(e):+e.toFixed(t??2).replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1")}function s(e,t,i,a,s){return(e-t)*(s-a)/(i-t)+a}function l(e,t){setTimeout(e,t??0)}function n(e){return e.replace(/\s/g,"").replaceAll("@","_").replaceAll("+","_plus_").replaceAll(".","")}function r(e){return e.includes(".")?e.split(".").pop():null}function o(e){return JSON.parse(JSON.stringify(e))}function d(e){let t=parseInt(e.substring(1,3),16)/255,i=parseInt(e.substring(3,5),16)/255,a=parseInt(e.substring(5,7),16)/255;return[t,i,a]}function c(e){let t="#";for(let i of e)t+=(i=Math.floor(255*i)).toString(16);return t}function h(e,i=8){var a=document.createElement("span");a.className="lexinputmeasure",a.innerHTML=e,document.body.appendChild(a);var s=a.getBoundingClientRect();return t.UTILS.deleteElement(a),s.width+i}function u(){var e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return e()+"-"+e()+"-"+e()}function p(e,a={}){let s=0,l=0,n=null,r=a.targetClass,o=a.dragMargin??3,d=(a,n,r)=>{let d=e.parentElement?e.parentElement.getBoundingClientRect():{x:0,y:0,width:0,height:0},c="fixed"==e.style.position,h=c?new t.vec2(d.x,d.y):new t.vec2;r=r??a.clientX-s-d.x,n=n??a.clientY-l-d.y,e.style.left=i(r,o+h.x,h.x+d.width-e.offsetWidth-o)+"px",e.style.top=i(n,o+h.y,h.y+d.height-e.offsetHeight-o)+"px"};a.autoAdjust&&d(null,parseInt(e.style.left),parseInt(e.style.top));let c=t.UTILS.uidGenerator();e["draggable-id"]=c;let h=e=>{n&&d(e)},u=e=>{n&&a.onMove&&a.onMove(n)},p=a.onMove?u:h,m=a.onDragStart;e.setAttribute("draggable",!0),e.addEventListener("mousedown",function(e){n=e.target.classList.contains(r)||!r?e.target:null}),e.addEventListener("dragstart",function(e){if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!n)return;var i=new Image;i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=",e.dataTransfer.setDragImage(i,0,0),e.dataTransfer.effectAllowed="move";let a=e.target.getBoundingClientRect(),r=n.parentElement.getBoundingClientRect(),o="fixed"==n.style.position,d=o?new t.vec2(r.x,r.y):new t.vec2;s=e.clientX-a.x-d.x,l=e.clientY-a.y-d.y,document.addEventListener("mousemove",p),m&&m(n,e)},!1),document.addEventListener("mouseup",()=>{n&&(n=null,document.removeEventListener("mousemove",p))})}t.MOUSE_LEFT_CLICK=0,t.MOUSE_MIDDLE_CLICK=1,t.MOUSE_RIGHT_CLICK=2,t.MOUSE_DOUBLE_CLICK=2,t.MOUSE_TRIPLE_CLICK=3,t.CURVE_MOVEOUT_CLAMP=0,t.CURVE_MOVEOUT_DELETE=1,t.clamp=i,t.round=a,t.remapRange=s,"undefined"!=typeof performance?t.getTime=performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?t.getTime=Date.now.bind(Date):"undefined"!=typeof process?t.getTime=function(){var e=process.hrtime();return .001*e[0]+1e-6*e[1]}:t.getTime=function(){return new Date().getTime()},t.doAsync=l,t.getSupportedDOMName=n,t.has=function e(i){return t.components.indexOf(i)>-1},t.getExtension=r,t.deepCopy=o,t.setTheme=function e(i){i="light"==i?"light":"dark",document.documentElement.setAttribute("data-theme",i),t.emit("@on_new_color_scheme",i)},t.setThemeColor=function e(t,i){document.querySelector(":root").style.setProperty("--"+t,i)},t.getThemeColor=function e(t){let i=getComputedStyle(document.querySelector(":root")),a=i.getPropertyValue("--"+t);if(document.documentElement.getAttribute("data-theme"),a.includes("light-dark")){let s=i.getPropertyValue("color-scheme");return"light"==s?a.substring(a.indexOf("(")+1,a.indexOf(",")).replace(/\s/g,""):a.substring(a.indexOf(",")+1,a.indexOf(")")).replace(/\s/g,"")}return a},t.getBase64Image=function e(t){var i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0),i.toDataURL("image/png")},t.hexToRgb=d,t.rgbToHex=c,t.measureRealWidth=h,t.guidGenerator=u,t.buildTextPattern=function e(t={}){let i=[];t.lowercase&&i.push("(?=.*[a-z])"),t.uppercase&&i.push("(?=.*[A-Z])"),t.digit&&i.push("(?=.*\\d)"),t.specialChar&&i.push("(?=.*[@#$%^&+=!])"),t.noSpaces&&i.push("(?!.*\\s)");let a,s=`^${i.join("")}.{${t.minLength||0},${t.maxLength||""}}$`;return t.asRegExp?RegExp(s):s},t.makeDraggable=p,t.makeCodeSnippet=function e(i,a,s={}){if(!t.has("CodeEditor")){console.error("Import the CodeEditor component to create snippets!");return}let l=document.createElement("div");l.className="lexcodesnippet",l.style.width=a?a[0]:"auto",l.style.height=a?a[1]:"auto";let n=new v({noAppend:!0}),r=new t.CodeEditor(n,{skipInfo:!0,disableEdition:!0,allowAddScripts:!1,name:s.tabName});if(r.setText(i,s.language??"Plain Text"),s.linesAdded){let o=r.root.querySelector(".code");for(let d of s.linesAdded)if(d.constructor==Number)o.childNodes[d-1].classList.add("added");else if(d.constructor==Array)for(let c=d[0]-1;c<=d[1]-1;c++)o.childNodes[c].classList.add("added")}if(s.linesRemoved){let h=r.root.querySelector(".code");for(let u of s.linesRemoved)if(u.constructor==Number)h.childNodes[u-1].classList.add("removed");else if(u.constructor==Array)for(let p=u[0]-1;p<=u[1]-1;p++)h.childNodes[p].classList.add("removed")}if(s.windowMode){let m=document.createElement("div");m.className="lexwindowbuttons";let f=document.createElement("span");f.style.background="#ee4f50";let g=document.createElement("span");g.style.background="#f5b720";let y=document.createElement("span");y.style.background="#53ca29",m.appendChild(f),m.appendChild(g),m.appendChild(y);let E=r.root.querySelector(".lexareatabs");E.prepend(m)}return(s.lineNumbers??!0)||r.root.classList.add("no-gutter"),l.appendChild(n.root),l},t.registerCommandbarEntry=function e(i,a){t.extraCommandbarEntries.push({name:i,callback:a})};class m{constructor(e,t){this.x=e??0,this.y=t??e??0}get xy(){return[this.x,this.y]}get yx(){return[this.y,this.x]}set(e,t){this.x=e,this.y=t}add(e,t=new m){return t.set(this.x+e.x,this.y+e.y),t}sub(e,t=new m){return t.set(this.x-e.x,this.y-e.y),t}mul(e,t=new m){return e.constructor==Number&&(e=new m(e)),t.set(this.x*e.x,this.y*e.y),t}div(e,t=new m){return e.constructor==Number&&(e=new m(e)),t.set(this.x/e.x,this.y/e.y),t}abs(e=new m){return e.set(Math.abs(this.x),Math.abs(this.y)),e}dot(e){return this.x*e.x+this.y*e.y}len2(){return this.dot(this)}len(){return Math.sqrt(this.len2())}nrm(e=new m){return e.set(this.x,this.y),e.mul(1/this.len(),e)}dst(e){return e.sub(this).len()}clp(e,t,a=new m){return a.set(i(this.x,e,t),i(this.y,e,t)),a}}t.vec2=m,t.init=function e(i={}){if(this.ready)return this.main_area;var a=document.createElement("div");a.id="lexroot",a.tabIndex=-1;var s=document.createElement("div");s.id="modal",this.modal=s,this.root=a,this.container=document.body,this.modal.classList.add("hiddenOpacity"),this.modal.toggle=function(e){this.classList.toggle("hiddenOpacity",e)},i.container&&(this.container=document.getElementById(i.container)),document.documentElement.setAttribute("data-strictVP",i.strictViewport??!0?"true":"false"),this.commandbar=function e(i){let a=document.createElement("dialog");a.className="commandbar",a.tabIndex=-1,i.appendChild(a);let s=[],l=null;a.addEventListener("keydown",function(e){if(e.stopPropagation(),e.stopImmediatePropagation(),l=l??-1,"Escape"==e.key)this.close(),f(!0);else if("Enter"==e.key){let t=s[l];if(t){let i=t.item.type&&"checkbox"===t.item.type;this.close(),i?(t.item.checked=!t.item.checked,t.callback.call(window,t.item.checked,t.entry_name)):t.callback.call(window,t.entry_name)}}else if("ArrowDown"==e.key&&l<s.length-1){l++,a.querySelectorAll(".hovered").forEach(e=>e.classList.remove("hovered")),s[l].classList.add("hovered");let n=s[l].offsetHeight*(l+1)-p.offsetHeight;n>0&&p.scrollTo({top:n,behavior:"smooth"})}else"ArrowUp"==e.key&&l>0&&(l--,a.querySelectorAll(".hovered").forEach(e=>e.classList.remove("hovered")),s[l].classList.add("hovered"))}),a.addEventListener("focusout",function(e){e.relatedTarget!=e.currentTarget&&(e.stopPropagation(),e.stopImmediatePropagation(),this.close(),f(!0))}),i.addEventListener("keydown",e=>{if(" "==e.key&&e.ctrlKey)e.stopImmediatePropagation(),e.stopPropagation(),t.setCommandbarState(!0);else for(let i of t.components){if(!t[i]||!t[i].prototype.onKeyPressed)continue;let a=t.CodeEditor.getInstances();for(let s of a)s.onKeyPressed(e)}});let n=document.createElement("div");n.className="gs-header";let r=document.createElement("a");r.className="fa-solid fa-magnifying-glass",n.appendChild(r);let o=document.createElement("input");o.placeholder="Search...",o.value="",n.appendChild(o);let d=new v({width:"100%",skipAppend:!0,className:"gs-tabs"}),c=d.addTabs(),h=null;{let u=(e,t)=>{h=t};c.add("All",document.createElement("div"),{selected:!0,onSelect:u})}let p=document.createElement("div");p.className="searchitembox";let m=null,f=e=>{p.innerHTML="",s.length=0,l=null,e&&(o.value="")},g=(e,i,n,r)=>{if(!e.length)return;m&&m.classList.remove("last");let o=document.createElement("div");o.className="searchitem last";let d=r&&r.type&&"checkbox"===r.type;d?o.innerHTML="<a class='fa fa-check'></a><span>"+(n+e)+"</span>":o.innerHTML=n+e,o.entry_name=e,o.callback=i,o.item=r,o.addEventListener("click",function(e){this.callback.call(window,this.entry_name),t.setCommandbarState(!1),f(!0)}),o.addEventListener("mouseenter",function(e){a.querySelectorAll(".hovered").forEach(e=>e.classList.remove("hovered")),this.classList.add("hovered"),l=s.indexOf(this)}),o.addEventListener("mouseleave",function(e){this.classList.remove("hovered")}),s.push(o),p.appendChild(o),m=o},y=(e,t,i)=>{let a=Object.keys(e)[0];if((e.name??i+a).toLowerCase().includes(t)&&e.callback&&g(e.name??a,e.callback,i,e),!e.name)for(let s of(i+=a+" > ",e[a]))y(s,t,i)};return a._addElements=e=>{for(let i of(f(),t.menubars))for(let a of i.items)y(a,e,"");for(let s of t.extraCommandbarEntries){let l=s.name;l.toLowerCase().includes(e)&&g(l,s.callback,"",{})}if(t.has("CodeEditor")){let n=t.CodeEditor.getInstances();if(!n.length)return;let r=n[0].languages;for(let o of Object.keys(r)){let d="Language: "+o,c=n[0]._getFileIcon(null,r[o].ext),h=c.includes("fa-")?"<i class='"+c+"'></i>":"<img src='https://raw.githubusercontent.com/jxarco/lexgui.js/master/"+c+"'>";h+=d+" <span class='lang-ext'>("+r[o].ext+")</span>",d.toLowerCase().includes(e)&&g(h,()=>{for(let e of n)e._changeLanguage(o)},"",{})}}},o.addEventListener("input",function(e){a._addElements(this.value.toLowerCase())}),a.appendChild(n),a.appendChild(d.root),a.appendChild(p),a}(this.container),this.container.appendChild(s),i.skipRoot?this.root=document.body:this.container.appendChild(a);{let l=document.createElement("section");l.className="notifications",this.notifications=document.createElement("ol"),this.notifications.className="",this.notifications.iWidth=0,l.appendChild(this.notifications),this.container.appendChild(l),this.notifications.addEventListener("mouseenter",()=>{this.notifications.classList.add("list")}),this.notifications.addEventListener("mouseleave",()=>{this.notifications.classList.remove("list")})}a.addEventListener("dragover",function(e){e.preventDefault()},!1),document.addEventListener("contextmenu",function(e){e.preventDefault()},!1);var n=document.getElementsByTagName("HEAD")[0],r=document.createElement("link");return r.rel="stylesheet",r.type="text/css",r.crossOrigin="anonymous",r.href="https://use.fontawesome.com/releases/v6.7.2/css/all.css",n.appendChild(r),this.DEFAULT_NAME_WIDTH="30%",this.DEFAULT_SPLITBAR_SIZE=4,this.OPEN_CONTEXTMENU_ENTRY="click",this.ready=!0,this.menubars=[],i.skipRoot||i.skipDefaultArea||(this.main_area=new v({id:i.id??"mainarea"})),(i.autoTheme??!0)&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&(t.setTheme("light"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{t.setTheme(e.matches?"dark":"light")})),this.main_area},t.setCommandbarState=function e(t,i=!0){let a=this.commandbar;t?(a.show(),a.querySelector("input").focus(),i&&a._addElements(void 0)):a.close()},t.message=function e(t,i,a={}){if(!t)throw"No message to show";return a.modal=!0,new _(i,e=>{e.addTextArea(null,t,null,{disabled:!0,fitHeight:!0})},a)},t.popup=function e(t,i,a={}){if(!t)throw"No message to show";a.size=a.size??["max-content","auto"],a.class="lexpopup";let s=a.timeout||3e3,l=new _(i,e=>{e.addTextArea(null,t,null,{disabled:!0,fitHeight:!0})},a);return setTimeout(()=>{l.close()},Math.max(s,150)),l},t.prompt=function e(t,i,a,s={}){s.modal=!0,s.className="prompt";let l="",n=new _(i,r=>{r.addTextArea(null,t,null,{disabled:!0,fitHeight:!0}),(s.input??!0)&&r.addText(null,s.input||l,e=>l=e,{placeholder:"..."}),r.sameLine(2),r.addButton(null,"Cancel",()=>{s.on_cancel&&s.on_cancel(),n.close()}),r.addButton(null,s.accept||"Continue",()=>{s.required&&""===l?(t+=t.includes("You must fill the input text.")?"":"\nYou must fill the input text.",n.close(),e(t,i,a,s)):(a&&a.call(this,l),n.close())},{buttonClass:"primary"})},s);return(s.input??!0)&&n.root.querySelector("input").focus(),n},t.toast=function e(t,i,a={}){if(!t)throw"The toast needs at least a title!";console.assert(this.notifications);let s=document.createElement("li");s.className="lextoast",s.style.translate="0 calc(100% + 30px)",this.notifications.prepend(s),l(()=>{this.notifications.offsetWidth>this.notifications.iWidth&&(this.notifications.iWidth=Math.min(this.notifications.offsetWidth,480),this.notifications.style.width=this.notifications.iWidth+"px"),s.dataset.open=!0},10);let n=document.createElement("div");n.className="lextoastcontent",s.appendChild(n);let r=document.createElement("div");if(r.className="title",r.innerHTML=t,n.appendChild(r),i){let o=document.createElement("div");o.className="desc",o.innerHTML=i,n.appendChild(o)}if(a.action){let d=new L;d.addButton(null,a.action.name??"Accept",a.action.callback.bind(this,s),{width:"auto",maxWidth:"150px",className:"right",buttonClass:"outline"}),s.appendChild(d.root.childNodes[0])}let c=this;if(s.close=function(){this.dataset.closed=!0,l(()=>{this.remove(),c.notifications.childElementCount||(c.notifications.style.width="unset",c.notifications.iWidth=0)},500)},a.closable??!0){let h=document.createElement("a");h.className="fa fa-xmark lexicon closer",h.addEventListener("click",()=>{s.close()}),s.appendChild(h)}let u=a.timeout??3e3;-1!=u&&l(()=>{s.close()},u)},t.badge=function e(t,i,a={}){let s=document.createElement("div");return s.innerHTML=t,s.className="lexbadge "+(i??""),Object.assign(s.style,a.style??{}),s.outerHTML},t.makeContainer=function e(t,i,a={}){let s=document.createElement("div");return s.className="lexcontainer "+(i??""),s.style.width=t&&t[0]?t[0]:"100%",s.style.height=t&&t[1]?t[1]:"100%",Object.assign(s.style,a),s};class f{constructor(e,t,i){this.name=e,this.value=t,this.domEvent=i}}t.IEvent=f;class g{static NONE=0;static NODE_SELECTED=1;static NODE_DELETED=2;static NODE_DBLCLICKED=3;static NODE_CONTEXTMENU=4;static NODE_DRAGGED=5;static NODE_RENAMED=6;static NODE_VISIBILITY=7;static NODE_CARETCHANGED=8;constructor(e,t,i){this.type=e||g.NONE,this.node=t,this.value=i,this.multiple=!1,this.panel=null}string(){switch(this.type){case g.NONE:return"tree_event_none";case g.NODE_SELECTED:return"tree_event_selected";case g.NODE_DELETED:return"tree_event_deleted";case g.NODE_DBLCLICKED:return"tree_event_dblclick";case g.NODE_CONTEXTMENU:return"tree_event_contextmenu";case g.NODE_DRAGGED:return"tree_event_dragged";case g.NODE_RENAMED:return"tree_event_renamed";case g.NODE_VISIBILITY:return"tree_event_visibility";case g.NODE_CARETCHANGED:return"tree_event_caretchanged"}}}t.TreeEvent=g,t.emit=function e(i,a,s={}){let l=t.signals[i];if(!l)return;let n=s.target;if(n){n[i]&&n[i].call(n,a);return}for(let r of l)if(r.constructor===b)r.set(a,s.skipCallback??!0),r.options&&r.options.callback&&r.options.callback(a,l);else{let o=r;o(null,a)}},t.addSignal=function e(i,a,s){a[i]=s,t.signals[i]||(t.signals[i]=[]),!(t.signals[i].indexOf(a)>-1)&&t.signals[i].push(a)};class v{constructor(e={}){var i=document.createElement("div");i.className="lexarea",e.id&&(i.id=e.id),e.className&&(i.className+=" "+e.className);var a=e.width||"calc( 100% )",s=e.height||"100%";this.setLimitBox(e.minWidth,e.minHeight,e.maxWidth,e.maxHeight),a.constructor==Number&&(a+="px"),s.constructor==Number&&(s+="px"),i.style.width=a,i.style.height=s,this.offset=0,this.root=i,this.size=[this.root.offsetWidth,this.root.offsetHeight],this.sections=[],this.panels=[],!e.skipAppend&&document.getElementById("lexroot").appendChild(this.root);let l=e.overlay;if(l){this.root.classList.add("overlay-"+l),e.left?this.root.style.left=e.left:e.right?this.root.style.right=e.right:e.top?this.root.style.top=e.top:e.bottom&&(this.root.style.bottom=e.bottom);let n=e.draggable??!0;if(n&&p(i,e),e.resizeable&&i.classList.add("resizeable"),e.resize){if(this.splitBar=document.createElement("div"),this.type=l,this.splitBar.className="lexsplitbar "+("left"==l||"right"==l?"horizontal":"vertical"),"right"==l)this.splitBar.style.width=t.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.left=-(t.DEFAULT_SPLITBAR_SIZE/2)+"px";else if("left"==l){let r=Math.min(document.body.clientWidth-t.DEFAULT_SPLITBAR_SIZE,this.root.clientWidth);this.splitBar.style.width=t.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.left=r+t.DEFAULT_SPLITBAR_SIZE/2+"px"}else if("top"==l){let o=Math.min(document.body.clientHeight-t.DEFAULT_SPLITBAR_SIZE,this.root.clientHeight);this.splitBar.style.height=t.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.top=o+t.DEFAULT_SPLITBAR_SIZE/2+"px"}else"bottom"==l&&(this.splitBar.style.height=t.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.style.top=-(t.DEFAULT_SPLITBAR_SIZE/2)+"px");this.splitBar.addEventListener("mousedown",function e(t){var i=d.root.ownerDocument;i.addEventListener("mousemove",h),i.addEventListener("mouseup",u),c[0]=t.x,c[1]=t.y,t.stopPropagation(),t.preventDefault(),document.body.classList.add("nocursor"),d.splitBar.classList.add("nocursor")}),this.root.appendChild(this.splitBar);var d=this,c=[0,0];function h(e){switch(d.type){case"right":var i=c[0]-e.x,a=d.root.offsetWidth+i;d.root.style.width=a+"px";break;case"left":var i=c[0]-e.x,a=Math.min(document.body.clientWidth-t.DEFAULT_SPLITBAR_SIZE,d.root.offsetWidth-i);d.root.style.width=a+"px",d.splitBar.style.left=a+t.DEFAULT_SPLITBAR_SIZE/2+"px";break;case"top":var i=c[1]-e.y,a=Math.min(document.body.clientHeight-t.DEFAULT_SPLITBAR_SIZE,d.root.offsetHeight-i);d.root.style.height=a+"px",d.splitBar.style.top=a+t.DEFAULT_SPLITBAR_SIZE/2+"px";break;case"bottom":var i=c[1]-e.y,a=d.root.offsetHeight+i;d.root.style.height=a+"px"}c[0]=e.x,c[1]=e.y,e.stopPropagation(),e.preventDefault(),d.onresize&&d.onresize(d.root.getBoundingClientRect())}function u(e){var t=d.root.ownerDocument;t.removeEventListener("mousemove",h),t.removeEventListener("mouseup",u),document.body.classList.remove("nocursor"),d.splitBar.classList.remove("nocursor")}}}}attach(e){if(this.sections.length){this.sections[1].attach(e);return}if(!e)throw"no content to attach";e.parent=this;let t=e.root?e.root:e;this.root.appendChild(t)}split(e={}){this.sections.length&&(this.offset=this.root.childNodes[0].offsetHeight,this._root=this.sections[0].root,this.root=this.sections[1].root);var i=e.type||"horizontal",a=e.sizes||["50%","50%"],s="auto"===e.sizes;if(!a[1]){let l=a[0],n=e.top?e.top:0;l.constructor==Number&&(l+=n,l+="px"),a[1]="calc( 100% - "+l+" )"}var r=new v({skipAppend:!0,className:"split"+(e.menubar||e.sidebar?"":" origin")}),o=new v({skipAppend:!0,className:"split"});r.parentArea=this,o.parentArea=this;let d=e.minimizable??!1,c=(e.resize??!0)||d;var h="0px";if(this.offset=0,c&&(this.resize=c,this.splitBar=document.createElement("div"),this.splitBar.className="lexsplitbar "+i,"horizontal"==i?this.splitBar.style.width=t.DEFAULT_SPLITBAR_SIZE+"px":this.splitBar.style.height=t.DEFAULT_SPLITBAR_SIZE+"px",this.splitBar.addEventListener("mousedown",function e(t){var i=E.root.ownerDocument;i.addEventListener("mousemove",$),i.addEventListener("mouseup",x),t.stopPropagation(),t.preventDefault(),document.body.classList.add("nocursor"),E.splitBar.classList.add("nocursor")}),h=t.DEFAULT_SPLITBAR_SIZE/2+"px",d&&(this.splitExtended=!1,o.root.addEventListener("animationend",e=>{let t=getComputedStyle(o.root).opacity;o.root.classList.remove(e.animationName+"-"+i),o.root.style.opacity=t,y(o.root)}),this.splitBar.addEventListener("contextmenu",e=>{e.preventDefault(),k(null,e,e=>{e.add("Extend",{disabled:this.splitExtended,callback:()=>{this.extend()}}),e.add("Reduce",{disabled:!this.splitExtended,callback:()=>{this.reduce()}})})}))),"horizontal"==i){var u=a[0],p=a[1];u.constructor==Number&&(u+="px"),p.constructor==Number&&(p+="px"),r.root.style.width="calc( "+u+" - "+h+" )",r.root.style.height="calc(100% - 0px)",o.root.style.width="calc( "+p+" - "+h+" )",o.root.style.height="calc(100% - 0px)",this.root.style.display="flex"}else if(r.root.style.width="100%",o.root.style.width="100%",s){r.root.style.height="auto";let m=new ResizeObserver(e=>{for(let t of e){let i=t.contentRect;o.root.style.height="calc(100% - "+(i.height+4)+"px )"}});m.observe(r.root)}else{var f=a[0],g=a[1];f.constructor==Number&&(f+="px"),g.constructor==Number&&(g+="px"),r.root.style.width="100%",r.root.style.height="auto"==f?f:"calc( "+f+" - "+h+" )",o.root.style.height="auto"==g?g:"calc( "+g+" - "+h+" )"}if(this.root.appendChild(r.root),c&&this.root.appendChild(this.splitBar),this.root.appendChild(o.root),this.sections=[r,o],this.type=i,this._update(),!c)return this.sections;var E=this;function $(e){"horizontal"==E.type?E._moveSplit(-e.movementX):E._moveSplit(-e.movementY);let t=E.root.querySelectorAll(".lexwidget");for(let i of t){let a=i.jsInstance;a.onresize&&a.onresize()}e.stopPropagation(),e.preventDefault()}function x(e){var t=E.root.ownerDocument;t.removeEventListener("mousemove",$),t.removeEventListener("mouseup",x),document.body.classList.remove("nocursor"),E.splitBar.classList.remove("nocursor")}return this.sections}setLimitBox(e=0,t=0,i=1/0,a=1/0){this.minWidth=e,this.minHeight=t,this.maxWidth=i,this.maxHeight=a}setSize(e){let[t,i]=e;void 0!=t&&t.constructor==Number&&(t+="px"),void 0!=i&&i.constructor==Number&&(i+="px"),t&&(this.root.style.width=t),i&&(this.root.style.height=i),this.size=[this.root.clientWidth,this.root.clientHeight],this.propagateEvent("onresize")}extend(){if(this.splitExtended)return;let[e,t]=this.sections;this.splitExtended=!0,"vertical"==this.type?(this.offset=t.root.offsetHeight,t.root.classList.add("fadeout-vertical"),this._moveSplit(-1/0,!0)):(this.offset=t.root.offsetWidth-8,t.root.classList.add("fadeout-horizontal"),this._moveSplit(-1/0,!0,8)),l(()=>this.propagateEvent("onresize"),150)}reduce(){if(!this.splitExtended)return;this.splitExtended=!1;let[e,t]=this.sections;"vertical"==this.type?(t.root.classList.add("fadein-vertical"),this._moveSplit(this.offset)):(t.root.classList.add("fadein-horizontal"),this._moveSplit(this.offset)),l(()=>this.propagateEvent("onresize"),150)}hide(){this.root.classList.add("hidden")}show(){this.root.classList.remove("hidden")}toggle(e){this.root.classList.toggle("hidden",e)}propagateEvent(e){for(var t=0;t<this.sections.length;t++){let i=this.sections[t];i[e]&&i[e].call(this,i.root.getBoundingClientRect()),i.propagateEvent(e)}}addPanel(e){let t=new L(e);return this.attach(t),this.panels.push(t),t}addMenubar(e,i={}){let a=new $(i);e&&e(a),t.menubars.push(a);let[s,l]=this.split({type:"vertical",sizes:[48,null],resize:!1,menubar:!0});return s.attach(a),s.is_menubar=!0,(i.sticky??!0)&&s.root.classList.add("sticky"),a}addSidebar(e,i={}){let a=new x(i);e&&e(a),t.menubars.push(a);let[s,l]=this.split({type:"horizontal",sizes:[64,null],resize:!1,sidebar:!0});return s.attach(a),s.is_sidebar=!0,a}addOverlayButtons(e,t={}){if(this.sections.length){this.sections[1].addOverlayButtons(e,t);return}console.assert(e.constructor==Array&&e.length),this.root.style.position="relative",t.className="lexoverlaybuttons";let i=this.addPanel(t),a=null,s=document.createElement("div");s.className="lexoverlaybuttonscontainer",s.appendChild(i.root),this.attach(s);let l=t.float;if(l)for(var n=0;n<l.length;n++){let r=l[n];switch(r){case"h":case"t":case"l":break;case"v":s.className+=" vertical";break;case"m":s.className+=" middle";break;case"b":s.className+=" bottom";break;case"c":s.className+=" center";break;case"r":s.className+=" right"}}let o=function(e,t,s){let l={width:"auto",selectable:e.selectable,selected:e.selected,icon:e.icon,img:e.img,className:e.class};t&&(a||((a=document.createElement("div")).className="lexoverlaygroup",i.queuedContainer=a),l.parent=a);let n=e.callback;e.options?i.addDropdown(null,e.options,e.name,n,l):i.addButton(null,e.name,function(t,i){if(e.selectable){if(e.group){let a=e.selected;e.group.forEach(e=>e.selected=!1),e.selected=!a}else e.selected=!e.selected}n(t,i)},l),a&&s&&(i.root.appendChild(a),a=null,i.clearQueue())};!function(){for(let t of(i.clear(),e))if(t.constructor===Array)for(let a=0;a<t.length;++a){let n=t[a];n.group=t,o(n,!0,a==t.length-1)}else o(t);if(l){var r=0;i.root.childNodes.forEach(e=>{r+=e.offsetHeight}),s.className.includes("middle")&&(s.style.top="-moz-calc( 50% - "+.5*r+"px )",s.style.top="-webkit-calc( 50% - "+.5*r+"px )",s.style.top="calc( 50% - "+.5*r+"px )")}}()}addTabs(e={}){let t=new E(this,e);return e.folding&&(this.parentArea._disableSplitResize(),this.root.style.paddingTop="4px"),t}_moveSplit(e,i=!1,a=0){if(!this.type)throw"No split area";if(void 0===e)return;let s=this.sections[0];var l=s.root;l.classList.contains("origin")||(l=l.parentElement);let n=this.sections[1],r=n.root,o=" - "+t.DEFAULT_SPLITBAR_SIZE+"px",d=null;if(i||(d=l.style.transition,l.style.transition=r.style.transition="none",y(l),y(r)),"horizontal"==this.type){var c=Math.max(r.offsetWidth+e,parseInt(n.minWidth));a&&(c=a),l.style.width="-moz-calc( 100% - "+c+"px "+o+" )",l.style.width="-webkit-calc( 100% - "+c+"px "+o+" )",l.style.width="calc( 100% - "+c+"px "+o+" )",l.style.minWidth=parseInt(s.minWidth)+"px",r.style.width=c+"px",s.maxWidth!=1/0&&(r.style.minWidth="calc( 100% - "+parseInt(s.maxWidth)+"px )")}else{var c=Math.max(r.offsetHeight+e+n.offset,parseInt(n.minHeight));a&&(c=a),l.style.height="-moz-calc( 100% - "+c+"px "+o+" )",l.style.height="-webkit-calc( 100% - "+c+"px "+o+" )",l.style.height="calc( 100% - "+c+"px "+o+" )",l.style.minHeight=s.minHeight+"px",r.style.height=c-n.offset+"px"}i||(l.style.transition=r.style.transition=d),this._update(),this.propagateEvent("onresize")}_disableSplitResize(){this.resize=!1,this.splitBar.remove(),delete this.splitBar}_update(){let e=this.root.getBoundingClientRect();this.size=[e.width,e.height];for(var t=0;t<this.sections.length;t++)this.sections[t]._update()}}function y(e){e.offsetHeight}t.Area=v;class E{static TAB_SIZE=28;static TAB_ID=0;constructor(e,i={}){this.onclose=i.onclose;let a=document.createElement("div");a.className="lexareatabs "+(i.fit?"fit":"row");let s=i.folding??!1;s&&a.classList.add("folding");let l=this;if(a.addEventListener("dragenter",function(e){e.preventDefault(),this.classList.add("dockingtab")}),a.addEventListener("dragleave",function(e){e.preventDefault(),this.classList.remove("dockingtab")}),a.addEventListener("drop",function(e){e.preventDefault();let i=e.dataTransfer.getData("source"),a=document.getElementById(i);if(!a)return;this.appendChild(a);let s=document.getElementById(i+"_content");l.area.attach(s),this.classList.remove("dockingtab"),t.emit("@on_tab_docked"),a.instance=l,a.click(),l.tabs[a.dataset.name]=s}),e.root.classList.add("lexareatabscontainer"),e.split({type:"vertical",sizes:i.sizes??"auto",resize:!1,top:6}),e.sections[0].attach(a),this.area=e.sections[1],this.area.root.className+=" lexareatabscontent",this.selected=null,this.root=a,this.tabs={},this.tabDOMs={},i.fit){let n=document.createElement("span");n.className="lexareatab thumb",this.thumb=n,this.root.appendChild(n);let r=new ResizeObserver(e=>{let t=this.thumb.item;if(t){var i=this.thumb.style.transition;this.thumb.style.transition="none",this.thumb.style.transform="translate( "+t.childIndex*t.offsetWidth+"px )",this.thumb.style.width=t.offsetWidth-5+"px",this.thumb.style.height=t.offsetHeight-6+"px",y(this.thumb),this.thumb.style.transition=i}});r.observe(this.area.root)}if(s){this.folded=!0,this.folding=s,"up"==s&&e.root.insertChildAtIndex(e.sections[1].root,0);let o=new ResizeObserver(t=>{for(let i of t){let a=i.contentRect,s=e.parentArea.sections[0].root;s.style.height="calc(100% - "+(42+a.height)+"px )"}});o.observe(this.area.root),this.area.root.classList.add("folded")}}add(e,i,a={}){let s=a.selected??!1;s&&(this.root.querySelectorAll("span").forEach(e=>e.classList.remove("selected")),this.area.root.querySelectorAll(".lextabcontent").forEach(e=>e.style.display="none")),s=!Object.keys(this.tabs).length&&!this.folding||s;let l=i.root?i.root:i;l.originalDisplay=l.style.display,l.style.display=s?l.originalDisplay:"none",l.classList.add("lextabcontent"),a.icon&&(a.icon.includes("fa-")?a.icon="<i class='"+a.icon+"'></i>":a.icon="<img src='https://raw.githubusercontent.com/jxarco/lexgui.js/master/"+a.icon+"'>");let n=document.createElement("span");n.dataset.name=e,n.className="lexareatab"+(s?" selected":""),n.innerHTML=(a.icon??"")+e,n.id=e.replace(/\s/g,"")+E.TAB_ID++,n.title=a.title??"",n.selected=s??!1,n.fixed=a.fixed,n.instance=this,l.id=n.id+"_content",n.selected&&(this.selected=e),t.addSignal("@on_tab_docked",n,function(){1==this.parentElement.childNodes.length&&this.parentElement.childNodes[0].click()}),n.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),!n.fixed){let t=n.selected;n.parentElement.querySelectorAll("span").forEach(e=>e.selected=!1),n.selected=!t,n.parentElement.querySelectorAll("span").forEach(e=>e.classList.remove("selected")),n.classList.toggle("selected",this.folding&&n.selected),n.instance.area.root.querySelectorAll(".lextabcontent").forEach(e=>e.style.display="none"),l.style.display=l.originalDisplay,n.instance.selected=n.dataset.name}this.folding&&(this.folded=n.selected,this.area.root.classList.toggle("folded",!this.folded)),a.onSelect&&a.onSelect(e,n.dataset.name),this.thumb&&(this.thumb.style.transform="translate( "+n.childIndex*n.offsetWidth+"px )",this.thumb.style.width=n.offsetWidth-5+"px",this.thumb.style.height=n.offsetHeight-6+"px",this.thumb.item=n)}),n.addEventListener("contextmenu",e=>{e.preventDefault(),e.stopPropagation(),a.onContextMenu&&a.onContextMenu(e,n.dataset.name)}),n.addEventListener("mouseup",e=>{e.preventDefault(),e.stopPropagation(),1==e.button&&this.delete(n.dataset.name)}),n.setAttribute("draggable",!0),n.addEventListener("dragstart",function(e){if(1==this.parentElement.childNodes.length){e.preventDefault();return}e.dataTransfer.setData("source",e.target.id)}),n.childIndex=this.root.childElementCount-1,this.root.appendChild(n),this.area.attach(l),this.tabDOMs[e]=n,this.tabs[e]=i,setTimeout(()=>{a.onCreate&&a.onCreate.call(this,this.area.root.getBoundingClientRect()),s&&this.thumb&&(this.thumb.style.transform="translate( "+n.childIndex*n.offsetWidth+"px )",this.thumb.style.width=n.offsetWidth-5+"px",this.thumb.style.height=n.offsetHeight-6+"px",this.thumb.item=n)},10)}select(e){this.tabDOMs[e]&&this.tabDOMs[e].click()}delete(e){let t=this.tabDOMs[e];if(!t||t.fixed)return;this.onclose&&this.onclose(e),this.tabDOMs[e].remove(),delete this.tabDOMs[e],this.tabs[e].remove(),delete this.tabs[e];let i=this.root.lastChild;i&&!i.fixed&&this.root.lastChild.click()}}t.Tabs=E;class ${constructor(e={}){this.root=document.createElement("div"),this.root.className="lexmenubar",e.float&&(this.root.style.justifyContent=e.float),this.items=[],this.buttons=[],this.icons={},this.shorts={}}add(e,i={}){i.constructor==Function&&(i={callback:i});let a=e.split("/"),s=a[a.length-1];this.icons[s]=i.icon,this.shorts[s]=i.short;let n=0,r=this,o=(e,t)=>{if(void 0==e)return;let s=null;if(t.forEach(t=>{let i=Object.keys(t),a=i.find(t=>t==e);a&&(s=t[a])}),s)o(a[n++],s);else{let l={};l[e]=[];let r=a[n++];r||(l.callback=i.callback,l.disabled=i.disabled,l.type=i.type,l.checked=i.checked),t.push(l),o(r,l[e])}};for(let d of(o(a[n++],this.items),this.items)){let c=Object.keys(d)[0],h=c.replace(/\s/g,"").replaceAll(".","");if(this.root.querySelector("#"+h))continue;let u=document.createElement("div");u.className="lexmenuentry",u.id=h,u.innerHTML="<span>"+c+"</span>",u.tabIndex="1","left"==i.position?this.root.prepend(u):("right"==i.position&&(u.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(u):this.root.appendChild(u));let p=function(){r.root.querySelectorAll(".lexmenuentry").forEach(e=>{e.classList.remove("selected"),e.built=!1}),t.root.querySelectorAll(".lexmenubox").forEach(e=>e.remove()),r.focused=!1},m=function(e,i,a,s){let n=document.createElement("div");n.className="lexmenubox",n.tabIndex="0",a.currentMenu=n;let o=a.classList.contains("lexmenuboxentry");o&&(n.dataset.submenu=!0);var d=a.getBoundingClientRect();n.style.left=(o?d.x+d.width:d.left)+"px",n.style.top=(o?d.y:d.bottom-4)+"px",d=n.getBoundingClientRect(),l(()=>{n.dataset.open=!0},10),t.root.appendChild(n),console.log(e,i,a,s);for(var c=0;c<e[i].length;++c){let h=e[i][c],u=Object.keys(h)[0],f=h[u].length,g="checkbox"==h.type,v=document.createElement("div");if(v.className="lexmenuboxentry",v.className+=(c==e[i].length-1?" last":"")+(h.disabled?" disabled":""),""==u)v.className=" lexseparator";else{v.id=u;let y=document.createElement("div");y.innerHTML="",y.classList="lexmenuboxentrycontainer",v.appendChild(y);let E=r.icons[u];g?y.innerHTML+="<input type='checkbox' >":E?y.innerHTML+="<a class='"+E+" fa-sm'></a>":(y.innerHTML+="<a class='fa-solid fa-sm noicon'></a>",y.classList.add("noicon")),y.innerHTML+="<div class='lexentryname'>"+u+"</div>"}let $=v.querySelector("input");if($&&($.checked=h.checked??!1,$.addEventListener("change",e=>{h.checked=$.checked;let t=h.callback;t&&(t.call(this,h.checked,u,v),p()),e.stopPropagation(),e.stopImmediatePropagation()})),n.appendChild(v),""==u)continue;if(n.addEventListener("keydown",function(e){e.preventDefault();let t=r.shorts[u];t&&(t=1==t.length?t.toLowerCase():t)==e.key&&v.click()}),v.addEventListener("click",e=>{$&&(h.checked=!h.checked);let t=h.callback;t&&(t.call(this,$?h.checked:u,$?u:v),p()),e.stopPropagation(),e.stopImmediatePropagation()}),!f){if(r.shorts[u]){let x=document.createElement("div");x.className="lexentryshort",x.innerText=r.shorts[u],v.appendChild(x)}continue}let b=document.createElement("a");b.className="fa-solid fa-angle-right fa-xs",v.appendChild(b),v.addEventListener("mouseover",e=>{!v.built&&(v.built=!0,m(h,u,v,++s),e.stopPropagation())}),v.addEventListener("mouseleave",e=>{v.currentMenu&&v.currentMenu!=e.toElement&&(s=-1,delete v.built,v.currentMenu.remove(),delete v.currentMenu)})}n.style.width=n.offsetWidth+"px"},f=()=>{p(),u.classList.add("selected"),u.built=!0,m(d,c,u,-1)};u.addEventListener("click",()=>{let e=d.callback;if(e){e.call(this,c,u);return}f(),this.focused=!0}),u.addEventListener("mouseover",e=>{this.focused&&!u.built&&f()}),u.addEventListener("blur",e=>{!(e.relatedTarget&&e.relatedTarget.classList.contains("lexmenubox"))&&p()})}}getButton(e){return this.buttons[e]}getSubitem(e,t){let i=null,a=t[0];for(let s=0;s<e.length;s++)if(e[s][a]){if(1==t.length)return e[s];return t.splice(0,1),this.getSubitem(e[s][a],t)}}getItem(e){let t=e.split("/");return this.getSubitem(this.items,t)}setButtonIcon(e,t,i,a={}){let s=this.buttons[e];if(s)s.querySelector("a").className="fa-solid "+t+" lexicon";else{let l=document.createElement("div"),n=a.disabled??!1;l.className="lexmenubutton"+(n?" disabled":""),l.title=e??"",l.innerHTML="<a class='"+t+" lexicon' style='font-size:x-large;'></a>",l.style.padding="5px 10px",l.style.maxHeight="calc(100% - 10px)",l.style.alignItems="center","right"==a.float&&(l.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(l):"left"==a.float?this.root.prepend(l):this.root.appendChild(l);let r=l.querySelector("a");r.addEventListener("click",e=>{i&&!n&&i.call(this,r,e)})}}setButtonImage(e,t,i,a={}){let s=this.buttons[e];if(s)s.querySelector("a").className="fa-solid "+icon+" lexicon";else{let l=document.createElement("div"),n=a.disabled??!1;l.className="lexmenubutton"+(n?" disabled":""),l.title=e??"",l.innerHTML="<a><image src='"+t+"' class='lexicon' style='height:32px;'></a>",l.style.padding="5px",l.style.alignItems="center","right"==a.float&&(l.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(l):"left"==a.float?this.root.prepend(l):this.root.appendChild(l);let r=l.querySelector("a");r.addEventListener("click",e=>{i&&!n&&i.call(this,r,e)})}}addButtons(e,t={}){if(!e)throw"No buttons to add!";this.buttonContainer||(this.buttonContainer=document.createElement("div"),this.buttonContainer.className="lexmenubuttons",this.buttonContainer.classList.add(t.float??"center"),"right"==t.position&&(this.buttonContainer.right=!0),this.root.lastChild&&this.root.lastChild.right?this.root.lastChild.before(this.buttonContainer):this.root.appendChild(this.buttonContainer));for(let i=0;i<e.length;++i){let a=e[i],s=document.createElement("label"),l=a.title,n=a.disabled??!1;s.className="lexmenubutton"+(n?" disabled":""),s.title=l??"",this.buttonContainer.appendChild(s);let r=document.createElement("a");r.className=a.icon+" lexicon",s.appendChild(r);let o=r;if(a.swap){s.classList.add("swap"),r.classList.add("swap-off");let d=document.createElement("input");d.type="checkbox",s.prepend(d),o=d;let c=document.createElement("a");c.className=a.swap+" swap-on lexicon",s.appendChild(c),s.swap=function(){let e=this.querySelector("input");e.checked=!e.checked},s.setState=function(e){let t=this.querySelector("input");t.checked=e}}o.addEventListener("click",e=>{if(a.callback&&!n){let t=s.querySelector("input");a.callback.call(this,e,t?.checked)}}),l&&(this.buttons[l]=s)}}}t.Menubar=$;class x{constructor(e={}){this.root=document.createElement("div"),this.root.className="lexsidebar",this.footer=document.createElement("div"),this.footer.className="lexsidebarfooter",this.root.appendChild(this.footer),this.items=[]}add(e,t={}){t.constructor==Function&&(t={callback:t});let i=e.replace(/\s/g,"").replaceAll(".","");if(this.items.findIndex((e,t)=>e.key==i)>-1){console.warn(`'${e}' already created in Sidebar`);return}let a=document.createElement("div");a.className="lexsidebarentry "+(t.className??""),a.id=i,t.bottom?this.footer.appendChild(a):this.root.appendChild(a),this.root.appendChild(this.footer);let s=document.createElement("button");s.innerHTML="<i class='"+(t.icon??"")+"'></i>",a.appendChild(s);let l=document.createElement("span");l.className="lexsidebarentrydesc",l.innerHTML=e,a.appendChild(l),s.addEventListener("mouseenter",()=>{setTimeout(()=>{l.style.display="unset"},100)}),s.addEventListener("mouseleave",()=>{setTimeout(()=>{l.style.display="none"},100)}),a.addEventListener("click",()=>{let i=t.callback;i&&i.call(this,e,a),t.bottom||(this.root.querySelectorAll(".lexsidebarentry").forEach(e=>e.classList.remove("selected")),a.classList.add("selected"))}),this.items.push({name:i,domEl:a,callback:t.callback})}select(e){let t=e.replace(/\s/g,"").replaceAll(".",""),i=this.items.find(e=>e.name===t);i&&i.domEl.click()}}t.SideBar=x;class b{static NONE=0;static TEXT=1;static TEXTAREA=2;static BUTTON=3;static DROPDOWN=4;static CHECKBOX=5;static TOGGLE=6;static COLOR=7;static RANGE=8;static NUMBER=9;static TITLE=10;static VECTOR=11;static TREE=12;static PROGRESS=13;static FILE=14;static LAYERS=15;static ARRAY=16;static LIST=17;static TAGS=18;static CURVE=19;static CARD=20;static IMAGE=21;static CONTENT=22;static CUSTOM=23;static SEPARATOR=24;static KNOB=25;static SIZE=26;static PAD=27;static FORM=28;static DIAL=29;static COUNTER=30;static TABLE=31;static NO_CONTEXT_TYPES=[b.BUTTON,b.LIST,b.FILE,b.PROGRESS];constructor(e,t,i){this.name=e,this.type=t,this.options=i}value(){if(this.onGetValue)return this.onGetValue();console.warn("Can't get value of "+this.typeName())}set(e,t=!1,i=""){if(this.onSetValue)return this.onSetValue(e,t);console.warn("Can't set value of "+this.typeName())}oncontextmenu(e){b.NO_CONTEXT_TYPES.includes(this.type)||k(this.typeName(),e,e=>{e.add("Copy",()=>{this.copy()}),e.add("Paste",{disabled:!this._can_paste(),callback:()=>{this.paste()}})})}copy(){navigator.clipboard.type=this.type,navigator.clipboard.customIdx=this.customIdx,navigator.clipboard.data=this.value(),navigator.clipboard.writeText(navigator.clipboard.data)}_can_paste(){return this.type===b.CUSTOM?void 0!==navigator.clipboard.customIdx&&this.customIdx==navigator.clipboard.customIdx:navigator.clipboard.type===this.type}paste(){this._can_paste()&&this.set(navigator.clipboard.data)}typeName(){switch(this.type){case b.TEXT:return"Text";case b.TEXTAREA:return"TextArea";case b.BUTTON:return"Button";case b.DROPDOWN:return"Dropdown";case b.CHECKBOX:return"Checkbox";case b.TOGGLE:return"Toggle";case b.COLOR:return"Color";case b.RANGE:return"Range";case b.NUMBER:return"Number";case b.VECTOR:return"Vector";case b.TREE:return"Tree";case b.PROGRESS:return"Progress";case b.FILE:return"File";case b.LAYERS:return"Layers";case b.ARRAY:return"Array";case b.LIST:return"List";case b.TAGS:return"Tags";case b.CURVE:return"Curve";case b.KNOB:return"Knob";case b.SIZE:return"Size";case b.PAD:return"Pad";case b.FORM:return"Form";case b.DIAL:return"Dial";case b.COUNTER:return"Counter";case b.TABLE:return"Table";case b.CUSTOM:return this.customName}console.error(`Unknown Widget type: ${this.type}`)}refresh(){}}t.Widget=b,t.ADD_CUSTOM_WIDGET=function e(i,a={}){let s=u();L.prototype["add"+i]=function(e,l,n){let r=this.create_widget(e,b.CUSTOM,a);r.customName=i,r.customIdx=s,r.onGetValue=()=>l,r.onSetValue=(t,i)=>{l=t,p(),d.querySelector(".lexcustomitems").toggleAttribute("hidden",!1),i||this._trigger(new f(e,l,null),n)};let d=r.domEl;d.style.flexWrap="wrap";let c,h,u=a.default??{},p=()=>{l&&(r.instance=l=Object.assign(o(u),l)),c&&c.remove(),h&&h.remove(),(c=document.createElement("div")).className="lexcustomcontainer",c.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")",this.queue(c);let s="<a class='fa-solid "+(a.icon??"fa-cube")+"' style='float:left'></a>";s+=i+(l?"":" [empty]"),s+="<a class='fa-solid "+(l?"fa-bars-staggered":" ")+" menu' style='float:right; width:5%;'></a>";let m=this.addButton(null,s,(e,t)=>{l?d.querySelector(".lexcustomitems").toggleAttribute("hidden"):k(null,t,e=>{e.add("New "+i,()=>{l={},p(),d.querySelector(".lexcustomitems").toggleAttribute("hidden",!1)})})},{buttonClass:"custom"});if(this.clearQueue(),l&&m.querySelector("a.menu").addEventListener("click",e=>{e.stopImmediatePropagation(),e.stopPropagation(),k(null,e,e=>{e.add("Clear",()=>{l=null,p()})})}),(h=document.createElement("div")).className="lexcustomitems",h.toggleAttribute("hidden",!0),d.appendChild(c),d.appendChild(h),l){this.queue(h);let g=(t,i,a)=>{l[t]=i,this._trigger(new f(e,l,a),n)};for(let v in u){let y=l[v]??u[v];switch(y.constructor){case String:"#"===y[0]?this.addColor(v,y,g.bind(this,v)):this.addText(v,y,g.bind(this,v));break;case Number:this.addNumber(v,y,g.bind(this,v));break;case Boolean:this.addCheckbox(v,y,g.bind(this,v));break;case Array:y.length>4?this.addArray(v,y,g.bind(this,v)):this._add_vector(y.length,v,y,g.bind(this,v))}}this.clearQueue()}};p()}};class w{constructor(e,t,i){if(this.domEl=e,this.data=t,this.onevent=i.onevent,this.options=i,this.selected=[],t.constructor===Object)this._create_item(null,t);else for(let a of t)this._create_item(null,a)}_create_item(e,i,a=0,s){let l=this,n=this.domEl.querySelector("#lexnodetree_filter");if(i.children=i.children??[],n&&!i.id.includes(n.value)||void 0!=s&&s!=i.id){for(var r=0;r<i.children.length;++r)this._create_item(i,i.children[r],a+1,s);return}let o=this.domEl.querySelector("ul");i.visible=i.visible??!0,i.parent=e;let d=i.children.length>0,c=this.selected.indexOf(i)>-1||i.selected;if(this.options.onlyFolders){let h=!1;i.children.forEach(e=>h|="folder"==e.type),d=!!h}let u=document.createElement("li");u.className="lextreeitem datalevel"+a+(d?" parent":"")+(c?" selected":""),u.id=t.getSupportedDOMName(i.id),u.tabIndex="0";let p=this.options.skip_default_icon??!0?"":"fa-solid fa-square";d&&(p=i.closed?"fa-solid fa-caret-right":"fa-solid fa-caret-down"),u.innerHTML="<a class='"+p+" hierarchy'></a>",p=i.icon,i.icon&&(i.icon.includes("fa-")?u.innerHTML+="<a class='"+i.icon+" tree-item-icon'></a>":u.innerHTML+="<img src='https://raw.githubusercontent.com/jxarco/lexgui.js/master/"+i.icon+"'>"),u.innerHTML+=i.rename?"":i.id,u.setAttribute("draggable",!0),u.style.paddingLeft=(d?0:3)+(3+(a+1)*15)+"px",o.appendChild(u),u.addEventListener("click",e=>{if(f){f=!1;return}e.shiftKey||(o.querySelectorAll("li").forEach(e=>{e.classList.remove("selected")}),this.selected.length=0);let t=this.selected.indexOf(i);if(t>-1?(u.classList.remove("selected"),this.selected.splice(t,1)):(u.classList.add("selected"),this.selected.push(i)),d&&i.id.length>1){if(i.closed=!1,l.onevent){let a=new g(g.NODE_CARETCHANGED,i,i.closed);l.onevent(a)}l.frefresh(i.id)}if(l.onevent){let s=new g(g.NODE_SELECTED,e.shiftKey?this.selected:i);s.multiple=e.shiftKey,l.onevent(s)}}),u.addEventListener("dblclick",function(){if((l.options.rename??!0)&&(i.rename=!0,l.refresh()),l.onevent){let e=new g(g.NODE_DBLCLICKED,i);l.onevent(e)}}),u.addEventListener("contextmenu",e=>{if(e.preventDefault(),!l.onevent)return;let a=new g(g.NODE_CONTEXTMENU,this.selected.length>1?this.selected:i,e);a.multiple=this.selected.length>1,t.addContextMenu(a.multiple?"Selected Nodes":a.node.id,a.value,e=>{a.panel=e}),l.onevent(a),(this.options.addDefault??!1)==!0&&(a.panel.items&&a.panel.add(""),a.panel.add("Select Children",()=>{let e=t=>{if(!t.closed)for(let i of t.children??[]){if(i)this.domEl.querySelector("#"+i.id).classList.add("selected"),this.selected.push(i),e(i)}};e(i)}),a.panel.add("Delete",{callback:()=>{if(!i.parent)return;if(l.onevent){let t=new g(g.NODE_DELETED,i,e);l.onevent(t)}let a=i.parent.children,s=a.indexOf(i);a.splice(s,1),this.refresh()}}))}),u.addEventListener("keydown",e=>{if(!i.rename){if(e.preventDefault(),"Delete"==e.key){if(l.onevent){let a=new g(g.NODE_DELETED,this.selected.length>1?this.selected:i,e);a.multiple=this.selected.length>1,l.onevent(a)}for(let s of this.selected){let n=s.parent.children,r=n.indexOf(s);n.splice(r,1)}this.selected.length=0,this.refresh()}else if("ArrowUp"==e.key||"ArrowDown"==e.key){var o=this.selected.length>1?"ArrowUp"==e.key?this.selected.shift():this.selected.pop():this.selected[0],d=this.domEl.querySelector("#"+t.getSupportedDOMName(o.id)),c="ArrowUp"==e.key?d.previousSibling:d.nextSibling;c&&c.click()}}});let m=document.createElement("input");m.toggleAttribute("hidden",!i.rename),m.value=i.id,u.appendChild(m),i.rename&&(u.classList.add("selected"),m.focus()),m.addEventListener("keyup",function(e){if("Enter"==e.key){if(this.value=this.value.replace(/\s/g,"_"),l.onevent){let a=new g(g.NODE_RENAMED,i,this.value);l.onevent(a)}i.id=t.getSupportedDOMName(this.value),delete i.rename,l.frefresh(i.id),o.querySelector("#"+i.id).classList.add("selected")}else"Escape"==e.key&&(delete i.rename,l.frefresh(i.id))}),m.addEventListener("blur",function(e){delete i.rename,l.refresh()}),(this.options.draggable??!0)&&(e&&u.addEventListener("dragstart",e=>{window.__tree_node_dragged=i}),u.addEventListener("dragover",e=>{e.preventDefault()},!1),u.addEventListener("dragenter",e=>{e.target.classList.add("draggingover")}),u.addEventListener("dragleave",e=>{e.target.classList.remove("draggingover")}),u.addEventListener("drop",e=>{e.preventDefault();let t=window.__tree_node_dragged;if(!t)return;let a=i;if(t.id==a.id){console.warn("Cannot parent node to itself!");return}let s=function(e,t){var i=!1;for(var a of t.children){if(a.id==e.id)return!0;i|=s(e,a)}return i};if(s(a,t)){console.warn("Cannot parent node to a current child!");return}if(l.onevent){let n=new g(g.NODE_DRAGGED,t,a);l.onevent(n)}let r=t.parent.children.findIndex(e=>e.id==t.id),o=t.parent.children.splice(r,1);a.children.push(o[0]),l.refresh(),delete window.__tree_node_dragged}));let f=!1;if(d&&u.querySelector("a.hierarchy").addEventListener("click",function(e){if(f=!0,e.stopImmediatePropagation(),e.stopPropagation(),i.closed=!i.closed,l.onevent){let t=new g(g.NODE_CARETCHANGED,i,i.closed);l.onevent(t)}l.frefresh(i.id)}),!i.skipVisibility){let v=document.createElement("a");v.className="itemicon fa-solid fa-eye"+(i.visible?"":"-slash"),v.title="Toggle visible",v.addEventListener("click",function(e){if(e.stopPropagation(),i.visible=void 0!==i.visible&&!i.visible,this.className="itemicon fa-solid fa-eye"+(i.visible?"":"-slash"),l.onevent){let t=new g(g.NODE_VISIBILITY,i,i.visible);l.onevent(t)}}),u.appendChild(v)}if(i.actions)for(var r=0;r<i.actions.length;++r){let y=i.actions[r];var E=document.createElement("a");E.className="itemicon "+y.icon,E.title=y.name,E.addEventListener("click",function(e){y.callback(i,E),e.stopPropagation()}),u.appendChild(E)}if(void 0!=s&&i.id==s&&(this.selected=[i],u.click()),!i.closed)for(var r=0;r<i.children.length;++r){let $=i.children[r];(!this.options.onlyFolders||"folder"==$.type)&&this._create_item(i,$,a+1)}}refresh(e,t){this.data=e??this.data,this.domEl.querySelector("ul").innerHTML="",this._create_item(null,this.data,0,t)}frefresh(e){this.refresh();var t=this.domEl.querySelector("#"+e);t&&t.focus()}select(e){this.refresh(null,e)}}class L{constructor(e={}){var t=document.createElement("div");t.className="lexpanel",e.id&&(t.id=e.id),e.className&&(t.className+=" "+e.className),t.style.width=e.width||"calc( 100% - 6px )",t.style.height=e.height||"100%",Object.assign(t.style,e.style??{}),this._inline_widgets_left=-1,this._inline_queued_container=null,this.root=t,this.onevent=e=>{},this.branch_open=!1,this.branches=[],this.current_branch=null,this.widgets={},this._queue=[]}get(e){return this.widgets[e]}getValue(e){let t=this.widgets[e];if(!t)throw"No widget called "+e;return t.value()}setValue(e,t,i){let a=this.widgets[e];if(!a)throw"No widget called "+e;return a.set(t,i)}attach(e){if(!e)throw"no content to attach";e.parent=this;let t=e.root?e.root:e;this.root.appendChild(t)}clear(){for(let e in this.branch_open=!1,this.branches=[],this.current_branch=null,this.widgets)if(this.widgets[e].options&&this.widgets[e].options.signal){let i=this.widgets[e].options.signal;for(let a=0;a<t.signals[i].length;a++)t.signals[i][a]==this.widgets[e]&&(t.signals[i]=[...t.signals[i].slice(0,a),...t.signals[i].slice(a+1)])}if(this.signals)for(let s=0;s<this.signals.length;s++){let l=Object.values(this.signals[s])[0],n=l.options.signal;for(let r=0;r<t.signals[n].length;r++)t.signals[n][r]==l&&(t.signals[n]=[...t.signals[n].slice(0,r),...t.signals[n].slice(r+1)])}this.widgets={},this.root.innerHTML=""}sameLine(e){this._inline_queued_container=this.queuedContainer,this._inline_widgets_left=e||1/0}endLine(e){if(-1==this._inline_widgets_left){console.warn("No pending widgets to be inlined!");return}for(let t of(this._inline_widgets_left=-1,!this._inlineContainer&&(this._inlineContainer=document.createElement("div"),this._inlineContainer.className="lexinlinewidgets",e&&(this._inlineContainer.style.justifyContent=e)),this._inlineWidgets)){let i=t.constructor==Array;i?this._inline_queued_container?this._inlineContainer.appendChild(t[0]):t[1].appendChild(t[0]):this._inlineContainer.appendChild(t)}this._inline_queued_container?this._inline_queued_container.appendChild(this._inlineContainer):this.current_branch?this.current_branch.content.appendChild(this._inlineContainer):this.root.appendChild(this._inlineContainer),delete this._inlineWidgets,delete this._inlineContainer}branch(e,t={}){this.branch_open&&this.merge();var i=new C(e,t);return i.panel=this,this.branch_open=!0,this.current_branch=i,0==this.branches.length&&i.root.classList.add("first"),this.root.querySelectorAll(".lexbranch.last").forEach(e=>{e.classList.remove("last")}),i.root.classList.add("last"),this.branches.push(i),this.root.appendChild(i.root),t.filter&&this._addFilter(t.filter,{callback:this._searchWidgets.bind(this,i.name)}),i}merge(){this.branch_open=!1,this.current_branch=null}_pick(e,t){return void 0===e?t:e}static _dispatch_event(e,t,i,a,s){let l=new CustomEvent(t,{detail:i,bubbles:a,cancelable:s});e.dispatchEvent(l)}static _add_reset_property(e,t){var i=document.createElement("a");return i.style.display="none",i.style.marginRight="6px",i.className="lexicon fa fa-rotate-left",i.addEventListener("click",t),e.appendChild(i),i}create_widget(e,i,a={}){let s=new b(e,i,a),l=document.createElement("div");if(l.className="lexwidget",l.id=a.id??"",l.title=a.title??"",a.className&&(l.className+=" "+a.className),i!=b.TITLE&&(l.style.width="calc(100% - "+(this.current_branch||i==b.FILE?10:20)+"px)",a.width&&(l.style.width=l.style.minWidth=a.width),a.maxWidth&&(l.style.maxWidth=a.maxWidth),a.minWidth&&(l.style.minWidth=a.minWidth),a.height&&(l.style.height=l.style.minHeight=a.height)),void 0!=e){if(!a.hideName){let n=document.createElement("div");n.className="lexwidgetname",a.justifyName&&n.classList.add("float-"+a.justifyName),n.innerHTML=e||"",n.title=a.title??n.innerHTML,n.style.width=a.nameWidth||t.DEFAULT_NAME_WIDTH,l.appendChild(n),l.domName=n,n.addEventListener("contextmenu",function(e){e.preventDefault(),s.oncontextmenu(e)})}this.widgets[e]=s}return a.signal&&(e||(this.signals||(this.signals=[]),this.signals.push({[a.signal]:s})),t.addSignal(a.signal,s)),s.domEl=l,l.jsInstance=s,this._inline_widgets_left>0&&!a.skipInlineCount?(this._inlineWidgets||(this._inlineWidgets=[]),(e=>{this.queuedContainer?this._inlineWidgets.push([e,this.queuedContainer]):this._inlineWidgets.push(e)})(l),this._inline_widgets_left--,this._inline_widgets_left||this.endLine()):(e=>{a.container?a.container.appendChild(e):this.queuedContainer?this.queuedContainer.appendChild(e):this.current_branch?(a.skipWidget||this.current_branch.widgets.push(s),this.current_branch.content.appendChild(e)):(e.classList.add("nobranch"),this.root.appendChild(e))})(l),s}_addFilter(e,t={}){t.placeholder=e.constructor==String?e:"Filter properties..",t.skipWidget=t.skipWidget??!0,t.skipInlineCount=!0;let i=this.create_widget(null,b.TEXT,t).domEl;i.className+=" lexfilter noname";let a=document.createElement("input");a.className="lexinput-filter",a.setAttribute("placeholder",t.placeholder),a.style.width="calc( 100% - 17px )",a.value=t.filterValue||"";let s=document.createElement("a");return s.className="fa-solid fa-magnifying-glass",i.appendChild(s),i.appendChild(a),a.addEventListener("input",e=>{t.callback&&t.callback(a.value,e)}),i}_searchWidgets(e,t){for(let i of this.branches){if(i.name!==e)continue;for(let a of i.widgets)!a.domEl.classList.contains("lexfilter")&&a.domEl.remove();this.queue(i.content);let s=!t.length;for(let l of i.widgets){if(!s){if(!l.name)continue;t.toLowerCase();let n=l.name.toLowerCase();if(!n.includes(t))continue}this.queuedContainer.appendChild(l.domEl)}this.clearQueue();return}}_filterOptions(e,t){let i=!t.length,a=[];for(let s=0;s<e.length;s++){let l=e[s];if(!i){let n="string"==typeof l?l:l.value,r=t.toLowerCase(),o=n.toLowerCase();if(!o.includes(r))continue}a.push(l)}this.refresh(a)}_trigger(e,t){t&&t.call(this,e.value,e.domEvent,e.name),this.onevent&&this.onevent.call(this,e)}getBranch(e){return e?this.branches.find(t=>t.name==e):this.current_branch}queue(e){!e&&this.current_branch&&(e=this.current_branch.root),this.queuedContainer&&this._queue.push(this.queuedContainer),this.queuedContainer=e}clearQueue(){if(this._queue&&this._queue.length){this.queuedContainer=this._queue.pop();return}delete this.queuedContainer}addBlank(e=8,t){let i=this.create_widget(null,b.addBlank);return i.domEl.className+=" blank",i.domEl.style.height=e+"px",t&&(i.domEl.style.width=t),i}addTitle(e,t={}){if(!e)throw"Can't create Title without text!";let i=this.create_widget(null,b.TITLE,t).domEl;if(i.className="lextitle",t.icon){let a=document.createElement("a");a.className=t.icon,a.style.color=t.iconColor||"",i.appendChild(a)}let s=document.createElement("span");if(s.innerText=e,i.appendChild(s),Object.assign(i.style,t.style??{}),void 0!=t.link){let l=document.createElement("a");l.innerText=e,l.href=t.link,l.target=t.target??"",l.className="lextitle link",Object.assign(l.style,t.style??{}),i.replaceWith(l)}return i}addText(e,i,a,s={}){let l=this.create_widget(e,b.TEXT,s);l.onGetValue=()=>o.value,l.onSetValue=(e,t)=>{this.disabled?o.innerText=e:o.value=e,L._dispatch_event(o,"focusout",t)},l.valid=()=>{if(""==o.pattern)return!0;let e=RegExp(o.pattern);return e.test(o.value)};let n=l.domEl;l.name&&!s.skipReset&&L._add_reset_property(n.domName,function(){o.value=o.iValue,this.style.display="none",L._dispatch_event(o,"focusout")});let r=document.createElement("div");r.className="lextext"+(s.warning?" lexwarning":""),r.style.width=s.inputWidth||"calc( 100% - "+t.DEFAULT_NAME_WIDTH+" )",r.style.display="flex",s.textClass&&r.classList.add(s.textClass),this.disabled=(s.disabled||s.warning)??!!s.url;let o=null;if(this.disabled){o=document.createElement(s.url?"a":"div"),s.url&&(o.href=s.url,o.target="_blank");let d=s.warning?'<i class="fa-solid fa-triangle-exclamation"></i>':"";o.innerHTML=d+i||"",o.style.width="100%",o.style.textAlign=s.float??""}else{(o=document.createElement("input")).type=s.type||"",o.value=o.iValue=i||"",o.style.width="100%",o.style.textAlign=s.float??"",o.setAttribute("placeholder",s.placeholder??""),s.required&&o.setAttribute("required",s.required),s.pattern&&o.setAttribute("pattern",s.pattern);var c=(function(t,i){if(!l.valid())return;let s=i.detail,r=n.querySelector(".lexwidgetname .lexicon");r&&(r.style.display=t!=o.iValue?"block":"none"),s||this._trigger(new f(e,t,i),a)}).bind(this);let h=s.trigger??"default";if("default"==h?(o.addEventListener("keyup",function(e){"Enter"==e.key&&c(e.target.value,e)}),o.addEventListener("focusout",function(e){c(e.target.value,e)})):"input"==h&&o.addEventListener("input",function(e){c(e.target.value,e)}),o.addEventListener("mousedown",function(e){e.stopImmediatePropagation(),e.stopPropagation()}),s.icon){let u=document.createElement("a");u.className="inputicon "+s.icon,r.appendChild(u)}}return Object.assign(o.style,s.style??{}),r.appendChild(o),n.appendChild(r),l.name||(n.className+=" noname",r.style.width="100%"),l}addTextArea(e,i,a,s={}){let n=this.create_widget(e,b.TEXTAREA,s);n.onGetValue=()=>d.value,n.onSetValue=(e,t)=>{d.value=e,L._dispatch_event(d,"focusout",t)};let r=n.domEl;n.name&&!s.skipReset&&L._add_reset_property(r.domName,function(){d.value=d.iValue,this.style.display="none",L._dispatch_event(d,"focusout")});let o=document.createElement("div");o.className="lextextarea",o.style.width=s.inputWidth||"calc( 100% - "+t.DEFAULT_NAME_WIDTH+" )",o.style.height=s.height,o.style.display="flex";let d=document.createElement("textarea");d.value=d.iValue=i||"",d.style.width="100%",d.style.textAlign=s.float??"",Object.assign(d.style,s.style??{}),s.disabled&&d.setAttribute("disabled",!0),s.placeholder&&d.setAttribute("placeholder",s.placeholder);var c=(function(t,i){let s=i.detail,l=r.querySelector(".lexwidgetname .lexicon");l&&(l.style.display=t!=d.iValue?"block":"none"),s||this._trigger(new f(e,t,i),a)}).bind(this);let h=s.trigger??"default";if("default"==h?(d.addEventListener("keyup",function(e){"Enter"==e.key&&c(e.target.value,e)}),d.addEventListener("focusout",function(e){c(e.target.value,e)})):"input"==h&&d.addEventListener("input",function(e){c(e.target.value,e)}),s.icon){let u=document.createElement("a");u.className="inputicon "+s.icon,o.appendChild(u)}return o.appendChild(d),r.appendChild(o),n.name||(r.className+=" noname",o.style.width="100%"),l(()=>{s.fitHeight&&(d.style.height=d.scrollHeight+"px")},10),n}addLabel(e,t={}){return t.disabled=!0,this.addText(null,e,null,t)}addButton(e,i,a,s={}){let l=this.create_widget(e,b.BUTTON,s);l.onGetValue=()=>r.innerText,l.onSetValue=(e,t)=>{r.innerHTML=s.icon?"<a class='"+s.icon+"'></a>":s.img?"<img src='"+s.img+"'>":"<span>"+(e||"")+"</span>"};let n=l.domEl;var r=document.createElement("button");return r.title=s.title??"",r.className="lexbutton "+(s.buttonClass??""),s.selected&&r.classList.add("selected"),r.innerHTML=s.icon?"<a class='"+s.icon+"'></a>":s.img?"<img src='"+s.img+"'>":"<span>"+(i||"")+"</span>",r.style.width="calc( 100% - "+(s.nameWidth??t.DEFAULT_NAME_WIDTH)+")",s.disabled&&r.setAttribute("disabled",!0),r.addEventListener("click",t=>{s.selectable&&(s.parent&&s.parent.querySelectorAll(".lexbutton.selected").forEach(e=>{e!=r&&e.classList.remove("selected")}),r.classList.toggle("selected")),this._trigger(new f(e,i,t),a)}),n.appendChild(r),l.name||(r.className+=" noname",r.style.width="100%"),n}addComboButtons(e,i,a={}){let s=this.create_widget(e,b.BUTTON,a),l=s.domEl,n=this,r=document.createElement("div");r.className="lexcombobuttons ",a.float&&(r.className+=a.float),r.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";let o=document.createElement("div");o.className="lexcombobuttonsbox ";let d=!a.noSelection,c=d&&(a.toggle??!1);for(let h of i){if(!h.value)throw"Set 'value' for each button!";let u=document.createElement("button");u.className="lexbutton combo",u.title=h.icon?h.value:"",u.id=h.id??"",a.buttonClass&&u.classList.add(a.buttonClass),d&&(h.selected||a.selected==h.value)&&u.classList.add("selected"),u.innerHTML=(h.icon?"<a class='"+h.icon+"'></a>":"")+"<span>"+(h.icon?"":h.value)+"</span>",h.disabled&&u.setAttribute("disabled",!0),u.addEventListener("click",function(t){d&&(c?this.classList.toggle("selected"):(r.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),this.classList.add("selected"))),n._trigger(new f(e,h.value,t),h.callback)}),o.appendChild(u)}return s.name||(l.className+=" noname",r.style.width="100%"),r.appendChild(o),l.appendChild(r),s}addCard(e,t={}){t.hideName=!0;let i=this.create_widget(e,b.CARD,t),a=i.domEl,s=document.createElement("div");if(s.className="lexcard",s.style.width="100%",t.img){let l=document.createElement("img");l.src=t.img,s.appendChild(l),void 0!=t.link&&(l.style.cursor="pointer",l.addEventListener("click",function(){let e=s.querySelector("a");e&&e.click()}))}let n=document.createElement("span");if(n.innerText=e,void 0!=t.link){let r=document.createElement("a");r.innerText=e,r.href=t.link,r.target=t.target??"",n.innerText="",n.appendChild(r)}return s.appendChild(n),t.callback&&(s.style.cursor="pointer",s.addEventListener("click",i=>{this._trigger(new f(e,null,i),t.callback)})),a.appendChild(s),i}addForm(e,i,a,s={}){if(i.constructor!=Object){console.error("Form data must be an Object");return}s.hideName=!0;let l=this.create_widget(e,b.FORM,s);l.onGetValue=()=>r.formData,l.onSetValue=(e,i)=>{r.formData=e;let a=r.querySelectorAll(".lexwidget");for(let s=0;s<a.length;++s){let l=a[s];if(l.jsInstance.type!=t.Widget.TEXT)continue;let n=a[s].querySelector(".lexwidgetname").innerText,o=a[s].querySelector(".lextext input");o.value=e[n]??"",L._dispatch_event(o,"focusout",i)}};let n=l.domEl,r=document.createElement("div");for(let o in r.className="lexformdata",this.queue(r),r.formData={},i){let d=i[o];d.constructor!=Object&&(d={}),d.placeholder=d.placeholder??o,d.width="calc(100% - 10px)",this.addLabel(o,{textClass:"formlabel"}),d.textWidget=this.addText(null,d.constructor==Object?d.value:d,e=>{r.formData[o]=e},d),r.formData[o]=d.constructor==Object?d.value:d}return this.addBlank(),this.addButton(null,s.actionName??"Submit",(e,t)=>{for(let s in i)if(!i[s].textWidget.valid())return;a&&a(r.formData,t)},{buttonClass:"primary",width:"calc(100% - 10px)"}),this.clearQueue(),n.appendChild(r),(!l.name||s.hideName)&&(n.className+=" noname",r.style.width="100%"),l}addContent(e,t={}){if(!e)return;if(e.constructor==String){let i=document.createElement("div");i.innerHTML=e,e=i.childElementCount>1?i:i.firstElementChild}let a=this.create_widget(null,b.CONTENT,t);return a.domEl.appendChild(e),a}async addImage(e,t={}){if(!e)return;t.hideName=!0;let i=this.create_widget(null,b.IMAGE,t),a=i.domEl,s=document.createElement("div");s.className="leximage",s.style.width="100%";let l=document.createElement("img");for(let n in l.src=e,t.style)l.style[n]=t.style[n];return await l.decode(),s.appendChild(l),a.appendChild(s),i}addDropdown(e,i,a,s,l={}){let n=this.create_widget(e,b.DROPDOWN,l);n.onGetValue=()=>r.querySelector("li.selected").getAttribute("value"),n.onSetValue=(t,i)=>{let l=r.querySelector(".lexwidgetname .lexicon");l&&(l.style.display=t!=c.iValue?"block":"none"),a=t,g.querySelectorAll("li").forEach(e=>{e.getAttribute("value")==a&&e.click()}),i||this._trigger(new f(e,a,null),s)};let r=n.domEl,o=this;n.name&&!l.skipReset&&L._add_reset_property(r.domName,function(){a=c.iValue,g.querySelectorAll("li").forEach(e=>{e.getAttribute("value")==a&&e.click()}),this.style.display="none"});let d=document.createElement("div");d.className="lexdropdown",d.style.width=l.inputWidth||"calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";let c=document.createElement("div");c.className="lexdropdown lexoption",c.name=e,c.iValue=a;let h=a;h+="<a class='fa-solid fa-angle-down' style='float:right; margin-right: 3px;'></a>",this.queue(d);let u=e=>{console.log("Replacing container");let t=e.getParentArea(),i=p.getBoundingClientRect(),a=e.parentElement.closest("dialog");{let s=e.offsetHeight,l=i.y,n=window.innerHeight;if(t){let r=t.getBoundingClientRect();n=r.y+r.height}if(a){let o=a.getBoundingClientRect();l-=o.y}e.style.top=l+p.offsetHeight+"px";let d=l+s>n;d&&(e.style.top=l-s+"px",e.classList.add("place-above"))}{let c=e.offsetWidth,h=i.x;if(e.style.minWidth=i.width+"px",a){let u=a.getBoundingClientRect();h-=u.x}e.style.left=h+"px";let m=window.innerWidth;if(t){let f=t.getBoundingClientRect();m=f.x+f.width}let g=h+c>m;g&&(e.style.left=h-(c-i.width)+"px")}},p=this.addButton(null,h,(e,t)=>{if(g.unfocus_event){delete g.unfocus_event;return}m.classList.remove("place-above");let i=m.hasAttribute("open");i?m.close():(m.show(),u(m)),v&&v.querySelector("input").focus()},{buttonClass:"array",skipInlineCount:!0,disabled:l.disabled});this.clearQueue(),p.style.width="100%",p.refresh=e=>{""==p.querySelector("span").innerText?p.querySelector("span").innerText=e:p.querySelector("span").innerHTML=p.querySelector("span").innerHTML.replaceAll(p.querySelector("span").innerText,e)};let m=document.createElement("dialog");m.className="lexdropdownoptions";let g=document.createElement("ul");g.tabIndex=-1,g.className="lexoptions",m.appendChild(g),g.addEventListener("focusout",function(e){if(e.stopPropagation(),e.stopImmediatePropagation(),e.relatedTarget===p.querySelector("button"))this.unfocus_event=!0,setTimeout(()=>delete this.unfocus_event,200);else if(e.relatedTarget&&"INPUT"==e.relatedTarget.tagName)return;else if("lexinput-filter"==e.target.className)return;m.close()});let v=null;l.filter&&(v=this._addFilter(l.placeholder??"Search...",{container:g,callback:this._filterOptions.bind(g,i)}),g.appendChild(v),v.addEventListener("focusout",function(e){!(e.relatedTarget&&"UL"==e.relatedTarget.tagName&&e.relatedTarget.classList.contains("lexoptions"))&&m.close()}));let y=document.createElement("span");return y.style.height="calc(100% - 25px)",g.appendChild(y),g.refresh=t=>{if(y.innerHTML="",!t.length){let l=t.emptyMsg??"No options found.",n=document.createElement("div");n.className="option",n.style.flexDirection="unset",n.innerHTML=l;let d=document.createElement("li");d.className="lexdropdownitem empty",d.appendChild(n),y.appendChild(d);return}for(let h=0;h<t.length;h++){let u=t[h],E=document.createElement("li"),$=document.createElement("div");if($.className="option",E.appendChild($),E.addEventListener("click",t=>{m.close();let l=r.querySelector(".lexoptions .selected");l&&l.classList.remove("selected"),a=t.currentTarget.getAttribute("value"),t.currentTarget.toggleAttribute("hidden",!1),t.currentTarget.classList.add("selected"),p.refresh(a);let n=r.querySelector(".lexwidgetname .lexicon");n&&(n.style.display=a!=c.iValue?"block":"none"),o._trigger(new f(e,a,null),s),v&&(v.querySelector("input").value="",this._filterOptions.bind(g,i,"")())}),u.constructor!=Object)$.style.flexDirection="unset",$.innerHTML="</a><span>"+u+"</span><a class='fa-solid fa-check'>",$.value=u,E.setAttribute("value",u),E.className="lexdropdownitem",u==a&&(E.classList.add("selected"),c.innerHTML=u);else{let x=document.createElement("img");x.src=u.src,E.setAttribute("value",u.value),E.className="lexlistitem",$.innerText=u.value,$.className+=" media",$.prepend(x),$.setAttribute("value",u.value),$.setAttribute("data-index",h),$.setAttribute("data-src",u.src),$.setAttribute("title",u.value),a==u.value&&E.classList.add("selected")}y.appendChild(E)}},g.refresh(i),d.appendChild(m),r.appendChild(d),n.name||(r.className+=" noname",d.style.width="100%"),n}addCurve(e,i,a,s={}){if(!e)throw"Set Widget Name!";let n=this,r=this.create_widget(e,b.CURVE,s);r.onGetValue=()=>JSON.parse(JSON.stringify(h.element.value)),r.onSetValue=(t,i)=>{let s=o.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=t!=h.element.value?"block":"none"),h.element.value=JSON.parse(JSON.stringify(t)),h.redraw(),i||n._trigger(new f(e,h.element.value,null),a)};let o=r.domEl,d=JSON.parse(JSON.stringify(i));s.skipReset||L._add_reset_property(o.domName,function(t){this.style.display="none",h.element.value=JSON.parse(JSON.stringify(d)),h.redraw(),n._trigger(new f(e,h.element.value,t),a)});var c=document.createElement("div");c.className="lexcurve",c.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")",s.callback=(t,i)=>{let s=o.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=t!=d?"block":"none"),n._trigger(new f(e,t,i),a)},s.name=e;let h=new A(this,i,s);return c.appendChild(h.element),o.appendChild(c),r.onresize=h.redraw.bind(h),r.curveInstance=h,l(()=>{h.canvas.width=c.offsetWidth,h.redraw()}),r}addDial(e,i,a,s={}){let n=this,r=this.create_widget(e,b.DIAL,s);r.onGetValue=()=>JSON.parse(JSON.stringify(h.element.value)),r.onSetValue=(t,i)=>{let s=o.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=t!=h.element.value?"block":"none"),h.element.value=JSON.parse(JSON.stringify(t)),h.redraw(),i||n._trigger(new f(e,h.element.value,null),a)};let o=r.domEl,d=JSON.parse(JSON.stringify(i));r.name&&!s.skipReset&&L._add_reset_property(o.domName,function(t){this.style.display="none",h.element.value=JSON.parse(JSON.stringify(d)),h.redraw(),n._trigger(new f(e,h.element.value,t),a)});var c=document.createElement("div");c.className="lexcurve",c.style.width=r.name?"calc( 100% - "+t.DEFAULT_NAME_WIDTH+")":"100%",s.callback=(t,i)=>{let s=o.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=t!=d?"block":"none"),n._trigger(new f(e,t,i),a)},s.name=e;let h=new S(this,i,s);return c.appendChild(h.element),o.appendChild(c),r.onresize=h.redraw.bind(h),r.curveInstance=h,l(()=>{h.element.style.height=h.element.offsetWidth+"px",h.canvas.width=h.element.offsetWidth,c.style.width=h.element.offsetWidth+"px",h.canvas.height=h.canvas.width,h.redraw()}),r}addLayers(e,i,a,s={}){if(!e)throw"Set Widget Name!";let l=this,n=this.create_widget(e,b.LAYERS,s);n.onGetValue=()=>r.value,n.onSetValue=(t,s)=>{let n=r.querySelector(".lexwidgetname .lexicon");n&&(n.style.display=t!=d?"block":"none"),i=r.value=t,c(),s||l._trigger(new f(e,i),a)};let r=n.domEl;L._add_reset_property(r.domName,function(t){this.style.display="none",i=r.value=d,c(),l._trigger(new f(e,i,t),a)});var o=document.createElement("div");o.className="lexlayers",o.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";let d=r.value=i,c=()=>{o.innerHTML="";let t=i.toString(2),s=t.length;for(var l=0;l<16-s;++l)t="0"+t;for(let n=0;n<16;++n){let c=document.createElement("div");if(c.className="lexlayer",void 0!=i){let h=t[16-n-1];void 0!=h&&"1"==h&&c.classList.add("selected")}c.innerText=n+1,c.title="Bit "+n+", value "+(1<<n),o.appendChild(c),c.addEventListener("click",t=>{t.stopPropagation(),t.stopImmediatePropagation(),t.target.classList.toggle("selected"),i^=1<<n,r.value=i;let s=r.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=i!=d?"block":"none"),this._trigger(new f(e,i,t),a)})}};return c(),r.appendChild(o),n}addArray(e,i=[],a,s={}){if(!e)throw"Set Widget Name!";let l=this.create_widget(e,b.ARRAY,s);l.onGetValue=()=>{let e=n.querySelectorAll("input"),t=[];for(var i of e)t.push(i.value);return t},l.onSetValue=(t,s)=>{i=t,h(),s||this._trigger(new f(e,i,null),a)};let n=l.domEl;n.style.flexWrap="wrap";var r=document.createElement("div");r.className="lexarray",r.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")",this.queue(r);let o="<a class='fa-solid fa-angle-down' style='float:right; margin-right: 3px;'></a>",d="Array (size "+i.length+")";d+=o,this.addButton(null,d,()=>{n.querySelector(".lexarrayitems").toggleAttribute("hidden")},{buttonClass:"array"}),this.clearQueue();let c=document.createElement("div");c.className="lexarrayitems",c.toggleAttribute("hidden",!0),n.appendChild(r),n.appendChild(c);let h=()=>{let t=n.querySelector(".lexbutton.array span");t.innerHTML="Array (size "+i.length+")",t.innerHTML+=o,c.innerHTML="",this.queue(c);for(let l=0;l<i.length;++l){let r=i[l],u=s.innerValues?"dropdown":r.constructor;switch(this.sameLine(2),u){case String:this.addText(l+"",r,function(e,t){i[l]=e,a(i)},{nameWidth:"4%",inputWidth:"95%",skipReset:!0});break;case Number:this.addNumber(l+"",r,function(e,t){i[l]=e,a(i)},{nameWidth:"4%",inputWidth:"95%",skipReset:!0});break;case"dropdown":this.addDropdown(l+"",s.innerValues,r,function(e,t){i[l]=e,a(i)},{nameWidth:"4%",inputWidth:"95%",skipReset:!0})}this.addButton(null,"<a class='lexicon fa-solid fa-trash'></a>",(t,s)=>{i.splice(i.indexOf(r),1),h(),this._trigger(new f(e,i,s),a)},{title:"Remove item",className:"micro"})}d="Add item",d+="<a class='fa-solid fa-plus' style='float:right; margin-right: 3px; margin-top: 2px;'></a>",this.addButton(null,d,(t,l)=>{i.push(s.innerValues?s.innerValues[0]:""),h(),this._trigger(new f(e,i,l),a)},{buttonClass:"array"}),this.clearQueue()};return h(),l}addList(e,i,a,s,l={}){let n=this.create_widget(e,b.LIST,l);n.onGetValue=()=>a,n.onSetValue=(t,l)=>{o.querySelectorAll(".lexlistitem").forEach(e=>e.classList.remove("selected"));let n=i.indexOf(t);-1==n||(o.children[n].classList.toggle("selected"),a=t,l||this._trigger(new f(e,t),s))},n.updateValues=t=>{i=t,o.innerHTML="";for(let l=0;l<i.length;++l){let n=null,r=i[l];r.constructor===Array&&(n=r[1],r=r[0]);let d=document.createElement("div");d.className="lexlistitem"+(a==r?" selected":""),d.innerHTML="<span>"+r+"</span>"+(n?"<a class='"+n+"'></a>":""),d.addEventListener("click",t=>{o.querySelectorAll(".lexlistitem").forEach(e=>e.classList.remove("selected")),d.classList.toggle("selected"),a=r,this._trigger(new f(e,r,t),s)}),o.appendChild(d)}};let r=n.domEl,o=document.createElement("div");return o.className="lexlist",o.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")",n.updateValues(i),n.name||(r.className+=" noname",o.style.width="100%"),r.appendChild(o),n}addTags(e,i,a,s={}){let l=[].concat(i=i.replace(/\s/g,"").split(",")),n=this.create_widget(e,b.TAGS,s);n.onGetValue=()=>[].concat(i),n.onSetValue=(t,s)=>{i=[].concat(t),c();let n=r.querySelector(".lexwidgetname .lexicon");n&&(n.style.display=t!=l?"block":"none"),s||o._trigger(new f(e,i),a)};let r=n.domEl,o=this;n.name&&L._add_reset_property(r.domName,function(t){this.style.display="none",i=[].concat(l),c(),o._trigger(new f(e,i,t),a)});let d=document.createElement("div");d.className="lextags",d.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";let c=()=>{d.innerHTML="";for(let t=0;t<i.length;++t){let s=i[t],n=document.createElement("span");n.className="lextag",n.innerHTML=s;let h=document.createElement("a");h.className="lextagrmb fa-solid fa-xmark lexicon",n.appendChild(h),h.addEventListener("click",t=>{n.remove(),i.splice(i.indexOf(s),1);let d=r.querySelector(".lexwidgetname .lexicon");d&&(d.style.display=i!=l?"block":"none"),o._trigger(new f(e,i,t),a)}),d.appendChild(n)}let u=document.createElement("input");u.value="",u.placeholder="Add tag...",d.appendChild(u),u.onkeydown=function(t){let s=this.value.replace(/\s/g,"");if(" "==t.key||"Enter"==t.key){if(t.preventDefault(),!s.length||i.indexOf(s)>-1)return;i.push(s),c();let l=r.querySelector(".lexwidgetname .lexicon");l&&(l.style.display="block"),o._trigger(new f(e,i,t),a)}},u.focus()};return c(),n.name||(r.className+=" noname",d.style.width="100%"),r.appendChild(d),n}addCheckbox(e,t,i,a={}){if(!e)throw"Set Widget Name!";let s=this.create_widget(e,b.CHECKBOX,a);s.onGetValue=()=>r.checked,s.onSetValue=(e,t)=>{r.checked!==e&&(r.checked=e,L._dispatch_event(r,"change",t))};let l=s.domEl;L._add_reset_property(l.domName,function(){r.checked=!r.checked,L._dispatch_event(r,"change")});var n=document.createElement("div");n.className="lexcheckboxcont";let r=document.createElement("input");r.type="checkbox",r.className="lexcheckbox "+(a.className??""),r.checked=t,r.iValue=t,r.disabled=a.disabled??!1;let o=document.createElement("span");if(o.className="checkboxtext",o.innerHTML="On",n.appendChild(r),n.appendChild(o),r.addEventListener("change",t=>{let a=t.detail?.constructor==Number?null:t.detail;if(!a){let s=l.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=r.checked!=r.iValue?"block":"none")}let n=l.querySelector(".lexcheckboxsubmenu");n&&n.toggleAttribute("hidden",!r.checked),a||this._trigger(new f(e,r.checked,t),i)}),l.appendChild(n),a.suboptions){l.style.flexWrap="wrap";let d=document.createElement("div");d.className="lexcheckboxsubmenu",d.toggleAttribute("hidden",!r.checked),this.queue(d),a.suboptions.call(this,this),this.clearQueue(),l.appendChild(d)}return s}addToggle(e,t,i,a={}){if(!e)throw"Set Widget Name!";let s=this.create_widget(e,b.TOGGLE,a);s.onGetValue=()=>r.checked,s.onSetValue=(e,t)=>{r.checked!==e&&(r.checked=e,L._dispatch_event(r,"change",t))};let l=s.domEl;L._add_reset_property(l.domName,function(){r.checked=!r.checked,L._dispatch_event(r,"change")});var n=document.createElement("div");n.className="lextogglecont";let r=document.createElement("input");r.type="checkbox",r.className="lextoggle "+(a.className??""),r.checked=t,r.iValue=t,r.disabled=a.disabled??!1;let o=document.createElement("span");if(o.className="toggletext",o.innerHTML="On",n.appendChild(r),n.appendChild(o),r.addEventListener("change",t=>{let a=t.detail?.constructor==Number?null:t.detail;if(!a){let s=l.querySelector(".lexwidgetname .lexicon");s&&(s.style.display=r.checked!=r.iValue?"block":"none")}let n=l.querySelector(".lextogglesubmenu");n&&n.toggleAttribute("hidden",!r.checked),a||this._trigger(new f(e,r.checked,t),i)}),l.appendChild(n),a.suboptions){l.style.flexWrap="wrap";let d=document.createElement("div");d.className="lextogglesubmenu",d.toggleAttribute("hidden",!r.checked),this.queue(d),a.suboptions.call(this,this),this.clearQueue(),l.appendChild(d)}return s}addColor(e,i,a,s={}){if(!e)throw"Set Widget Name!";let l=this.create_widget(e,b.COLOR,s);l.onGetValue=()=>h.value,l.onSetValue=(e,t)=>{h.value=e,L._dispatch_event(h,"input",t)};let n=l.domEl,r=!1;L._add_reset_property(n.domName,function(){this.style.display="none",h.value=h.iValue,L._dispatch_event(h,"input")});var o=document.createElement("span");o.className="lexcolor",o.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";let h=document.createElement("input");h.style.width="32px",h.type="color",h.className="colorinput",h.id="color"+u(),h.useRGB=s.useRGB??!1,h.value=h.iValue=i.constructor===Array?c(i):i,s.disabled&&(h.disabled=!0),h.addEventListener("input",t=>{let i=t.target.value,s=t.detail;if(r||p.set(i),!s){let l=n.querySelector(".lexwidgetname .lexicon");l&&(l.style.display=i!=h.iValue?"block":"none")}h.useRGB&&(i=d(i)),s||this._trigger(new f(e,i,t),a)},!1),o.appendChild(h),this.queue(o);let p=this.addText(null,h.value,e=>{r=!0,l.set(e),r=!1},{width:"calc( 100% - 32px )"});return p.domEl.style.marginLeft="4px",this.clearQueue(),n.appendChild(o),l}addRange(e,a,s,l={}){let n=this.create_widget(e,b.RANGE,l);n.onGetValue=()=>+d.value,n.onSetValue=(e,t)=>{d.value=e,L._dispatch_event(d,"input",t)};let r=n.domEl;n.name&&L._add_reset_property(r.domName,function(){this.style.display="none",d.value=d.iValue,L._dispatch_event(d,"input")});var o=document.createElement("div");o.className="lexrange",o.style.width=l.inputWidth||"calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";let d=document.createElement("input");return d.className="lexrangeslider "+(l.className??""),d.value=d.iValue=a,d.min=l.min,d.max=l.max,d.step=l.step??1,d.type="range",d.disabled=l.disabled??!1,l.left&&d.classList.add("left"),(l.fill??!0)||d.classList.add("no-fill"),d.addEventListener("input",t=>{if(isNaN(t.target.valueAsNumber))return;let a=t.detail,n=t.target.value=i(+t.target.valueAsNumber,+d.min,+d.max);if(d.value=n,!a){let o=r.querySelector(".lexwidgetname .lexicon");o&&(o.style.display=n!=d.iValue?"block":"none")}l.left&&(n=+d.max-n+ +d.min),a||this._trigger(new f(e,n,t),s)},{passive:!1}),d.addEventListener("mousedown",function(e){l.onPress&&l.onPress.bind(d)(e,d)},!1),d.addEventListener("mouseup",function(e){l.onRelease&&l.onRelease.bind(d)(e,d)},!1),n.setLimits=(e,t,i)=>{d.min=e??d.min,d.max=t??d.max,d.step=i??d.step,L._dispatch_event(d,"input",!0)},a.constructor==Number&&(a=i(a,+d.min,+d.max)),o.appendChild(d),r.appendChild(o),n.name||(r.className+=" noname",o.style.width="100%"),n}addNumber(e,s,l,n={}){let r=this.create_widget(e,b.NUMBER,n);r.onGetValue=()=>+p.value,r.onSetValue=(e,t)=>{p.value=a(e,n.precision),L._dispatch_event(p,"change",t)};let o=r.domEl;r.name&&L._add_reset_property(o.domName,function(){this.style.display="none",p.value=p.iValue,L._dispatch_event(p,"change")});var d=document.createElement("div");d.className="lexnumber",d.style.width=n.inputWidth||"calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";let c=document.createElement("div");c.className="numberbox";let p=document.createElement("input");if(p.id="number_"+u(),p.className="vecinput",p.min=n.min??-1e24,p.max=n.max??1e24,p.step=n.step??"any",p.type="number",s.constructor==Number&&(s=i(s,+p.min,+p.max),s=a(s,n.precision)),p.value=p.iValue=s,c.appendChild(p),n.units){let m=document.createElement("span");m.className="lexunit",m.innerText=n.units,m.style.left=h(p.value)+"px",p.unitSpan=m,c.appendChild(m)}let g=document.createElement("a");if(g.className="fa-solid fa-arrows-up-down drag-icon hidden",c.appendChild(g),n.disabled&&(p.disabled=!0),!n.skipSlider&&void 0!==n.min&&void 0!==n.max){let v=document.createElement("input");v.className="lexinputslider",v.min=n.min,v.max=n.max,v.step=n.step??1,v.type="range",v.value=s,v.addEventListener("input",function(e){let t=+this.valueAsNumber;p.value=a(t,n.precision),L._dispatch_event(p,"change")},!1),v.addEventListener("mousedown",function(e){n.onPress&&n.onPress.bind(v)(e,v)},!1),v.addEventListener("mouseup",function(e){n.onRelease&&n.onRelease.bind(v)(e,v)},!1),c.appendChild(v),r.setLimits=(e,t,i)=>{p.min=v.min=e??p.min,p.max=v.max=t??p.max,p.step=i??p.step,v.step=i??v.step,L._dispatch_event(p,"change",!0)}}p.addEventListener("input",function(e){let t=+this.valueAsNumber;p.value=a(t,n.precision),n.units&&(p.unitSpan.style.left=h(p.value)+"px")},!1),p.addEventListener("wheel",function(e){if(e.preventDefault(),this!==document.activeElement)return;let t=n.step??1;e.shiftKey?t*=10:e.altKey&&(t*=.1);let i=+this.valueAsNumber-t*(e.deltaY>0?1:-1);this.value=a(i,n.precision),L._dispatch_event(p,"change")},{passive:!1}),p.addEventListener("change",t=>{if(isNaN(t.target.valueAsNumber))return;let s=t.detail,r=t.target.value=i(+t.target.valueAsNumber,+p.min,+p.max);if(r=n.precision?a(r,n.precision):r,c.querySelector(".lexinputslider")&&(c.querySelector(".lexinputslider").value=r),p.value=r,n.units&&(p.unitSpan.style.left=h(p.value)+"px"),!s){let d=o.querySelector(".lexwidgetname .lexicon");d&&(d.style.display=r!=p.iValue?"block":"none")}s||this._trigger(new f(e,r,t),l)},{passive:!1}),p.addEventListener("mousedown",function e(t){if(document.activeElement!=p){var i=y.root.ownerDocument;i.addEventListener("mousemove",E),i.addEventListener("mouseup",$),document.body.classList.add("noevents"),g.classList.remove("hidden"),t.stopImmediatePropagation(),t.stopPropagation(),document.pointerLockElement||p.requestPointerLock(),n.onPress&&n.onPress.bind(p)(t,p)}});var y=this;function E(e){let t=-e.movementY;if(0!=t){let i=n.step??1;e.shiftKey?i*=10:e.altKey&&(i*=.1);let a=+p.valueAsNumber+i*t;p.value=(+a).toFixed(4).replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1"),L._dispatch_event(p,"change")}e.stopPropagation(),e.preventDefault()}function $(e){var t=y.root.ownerDocument;t.removeEventListener("mousemove",E),t.removeEventListener("mouseup",$),document.body.classList.remove("noevents"),g.classList.add("hidden"),document.pointerLockElement&&document.exitPointerLock(),n.onRelease&&n.onRelease.bind(p)(e,p)}return d.appendChild(c),o.appendChild(d),r.name||(o.className+=" noname",d.style.width="100%"),r}static VECTOR_COMPONENTS={0:"x",1:"y",2:"z",3:"w"};_add_vector(e,s,l,n,r={}){if(e=i(e,2,4),l=l??Array(e).fill(0),!s)throw"Set Widget Name!";let o=this.create_widget(s,b.VECTOR,r);o.onGetValue=()=>{let e=d.querySelectorAll("input"),t=[];for(var i of e)t.push(+i.value);return t},o.onSetValue=(e,t)=>{let i=d.querySelectorAll(".vecinput");if(i.length==e.length){console.error("Input length does not match vector length.");return}for(let s=0;s<i.length;++s){let l=e[s];i[s].value=a(l,r.precision)??0,L._dispatch_event(i[s],"change",t)}};let d=o.domEl;L._add_reset_property(d.domName,function(){for(let e of(this.style.display="none",d.querySelectorAll(".vecinput")))e.value=e.iValue,L._dispatch_event(e,"change")});var c=document.createElement("div");c.className="lexvector",c.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";for(let h=0;h<e;++h){let p=document.createElement("div");p.className="vecbox",p.innerHTML="<span class='"+L.VECTOR_COMPONENTS[h]+"'></span>";let m=document.createElement("input");m.className="vecinput v"+e,m.min=r.min??-1e24,m.max=r.max??1e24,m.step=r.step??"any",m.type="number",m.id="vec"+e+"_"+u(),m.idx=h,l[h].constructor==Number&&(l[h]=i(l[h],+m.min,+m.max),l[h]=a(l[h],r.precision)),m.value=m.iValue=l[h];let g=document.createElement("a");g.className="fa-solid fa-arrows-up-down drag-icon hidden",p.appendChild(g),r.disabled&&(m.disabled=!0),m.addEventListener("wheel",function(e){if(e.preventDefault(),this!==document.activeElement)return;let t=r.step??1;if(e.shiftKey?t=10:e.altKey&&(t=.1),x.locked)for(let i of d.querySelectorAll(".vecinput"))i.value=a(+i.valueAsNumber-t*(e.deltaY>0?1:-1),r.precision),L._dispatch_event(i,"change");else this.value=a(+this.valueAsNumber-t*(e.deltaY>0?1:-1),r.precision),L._dispatch_event(m,"change")},{passive:!1}),m.addEventListener("change",e=>{if(isNaN(e.target.value))return;let t=e.detail,o=e.target.value=i(e.target.value,+m.min,+m.max);if(o=a(o,r.precision),!t){let c=d.querySelector(".lexwidgetname .lexicon");c&&(c.style.display=o!=m.iValue?"block":"none")}if(x.locked)for(let h of d.querySelectorAll(".vecinput"))h.value=o,l[h.idx]=o;else m.value=o,l[e.target.idx]=o;t||this._trigger(new f(s,l,e),n)},!1),m.addEventListener("mousedown",y);var v=this;function y(e){if(document.activeElement!=m){var t=v.root.ownerDocument;t.addEventListener("mousemove",E),t.addEventListener("mouseup",$),document.body.classList.add("noevents"),g.classList.remove("hidden"),e.stopImmediatePropagation(),e.stopPropagation(),document.pointerLockElement||m.requestPointerLock(),r.onPress&&r.onPress.bind(m)(e,m)}}function E(e){let t=-e.movementY;if(0!=t){let i=r.step??1;if(e.shiftKey?i=10:e.altKey&&(i=.1),x.locked)for(let s of d.querySelectorAll(".vecinput"))s.value=a(+s.valueAsNumber+i*t,r.precision),L._dispatch_event(s,"change");else m.value=a(+m.valueAsNumber+i*t,r.precision),L._dispatch_event(m,"change")}e.stopPropagation(),e.preventDefault()}function $(e){var t=v.root.ownerDocument;t.removeEventListener("mousemove",E),t.removeEventListener("mouseup",$),document.body.classList.remove("noevents"),g.classList.add("hidden"),document.pointerLockElement&&document.exitPointerLock(),r.onRelease&&r.onRelease.bind(m)(e,m)}p.appendChild(m),c.appendChild(p)}(void 0!==r.min||void 0!==r.max)&&(o.setLimits=(e,t,i)=>{let a=d.querySelectorAll(".vecinput");for(let r of a)r.min=e??r.min,r.max=t??r.max,r.step=i??r.step,L._dispatch_event(r,"change",!0);this._trigger(new f(s,l),n)});let x=document.createElement("a");return x.title="Lock",x.className="fa-solid fa-lock-open lexicon lock",c.appendChild(x),x.addEventListener("click",function(e){this.locked=!this.locked,this.locked?(this.classList.add("fa-lock"),this.classList.remove("fa-lock-open")):(this.classList.add("fa-lock-open"),this.classList.remove("fa-lock"))},!1),d.appendChild(c),o}addVector2(e,t,i,a){return this._add_vector(2,e,t,i,a)}addVector3(e,t,i,a){return this._add_vector(3,e,t,i,a)}addVector4(e,t,i,a){return this._add_vector(4,e,t,i,a)}addSize(e,t,i,a={}){let s=this.create_widget(e,b.SIZE,a);s.onGetValue=()=>{let e=[];for(let t=0;t<l.dimensions.length;++t)e.push(l.dimensions[t].onGetValue());return e},s.onSetValue=(e,t)=>{for(let i=0;i<l.dimensions.length;++i)l.dimensions[i].onSetValue(e[i],t)};let l=s.domEl;this.queue(l),l.aspectRatio=2==t.length?t[0]/t[1]:null,l.dimensions=[];for(let n=0;n<t.length;++n)if(l.dimensions[n]=this.addNumber(null,t[n],e=>{let t=s.onGetValue();if(l.locked){let a=0==n?1/l.aspectRatio:l.aspectRatio,r=(1+n)%2;t[r]=e*a,l.dimensions[r].onSetValue(t[r],!0)}i&&i(t)},{min:0,disabled:a.disabled,precision:a.precision}),n+1!=t.length){let r=document.createElement("a");r.className="lexsizecross fa-solid fa-xmark",l.appendChild(r)}if(this.clearQueue(),a.units){let o=document.createElement("span");o.className="lexunit",o.innerText=a.units,l.appendChild(o)}if(l.aspectRatio){let d=document.createElement("a");d.title="Lock Aspect Ratio",d.className="fa-solid fa-lock-open lexicon lock",l.appendChild(d),d.addEventListener("click",function(e){if(l.locked=!l.locked,l.locked){this.classList.add("fa-lock"),this.classList.remove("fa-lock-open");let t=s.onGetValue();l.aspectRatio=t[0]/t[1]}else this.classList.add("fa-lock-open"),this.classList.remove("fa-lock")},!1)}return s.name||(l.className+=" noname",container.style.width="100%"),s}addPad(e,i,a,n={}){if(!e)throw"Set Widget Name!";let r=this.create_widget(e,b.PAD,n);r.onGetValue=()=>h.value.xy,r.onSetValue=(t,i)=>{h.value.set(t[0],t[1]),u(h.value),i||this._trigger(new f(e,h.value.xy),a)};let o=r.domEl;var d=document.createElement("div");d.className="lexpad",d.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";let c=document.createElement("div");c.id="lexpad-"+e,c.className="lexinnerpad",c.style.width=n.padSize??"96px",c.style.height=n.padSize??"96px";let h=document.createElement("div");h.className="lexpadthumb",h.value=new t.vec2(i[0],i[1]),h.min=n.min??0,h.max=n.max??1;let u=e=>{let[i,a]=[c.offsetWidth,c.offsetHeight],l=new t.vec2(s(e.x,h.min,h.max,0,1),s(e.y,h.min,h.max,0,1));h.style.transform=`translate(calc( ${i*l.x}px - 50% ), calc( ${a*l.y}px - 50%)`};l(()=>{u(h.value)}),c.appendChild(h),d.appendChild(c),o.appendChild(d),c.addEventListener("mousedown",function e(t){if(document.activeElement!=h){var i=p.root.ownerDocument;i.addEventListener("mousemove",m),i.addEventListener("mouseup",g),document.body.classList.add("nocursor"),document.body.classList.add("noevents"),t.stopImmediatePropagation(),t.stopPropagation(),n.onPress&&n.onPress.bind(h)(t,h)}});let p=this;function m(i){let l=c.getBoundingClientRect(),n=new t.vec2(i.x-l.x,i.y-l.y);n.clp(0,c.offsetWidth,n);let[r,o]=[c.offsetWidth,c.offsetHeight],d=n.div(new t.vec2(c.offsetWidth,c.offsetHeight));h.style.transform=`translate(calc( ${r*d.x}px - 50% ), calc( ${o*d.y}px - 50%)`,h.value=new t.vec2(s(d.x,0,1,h.min,h.max),s(d.y,0,1,h.min,h.max)),p._trigger(new f(e,h.value.xy,i),a),i.stopPropagation(),i.preventDefault()}function g(e){var t=p.root.ownerDocument;t.removeEventListener("mousemove",m),t.removeEventListener("mouseup",g),document.body.classList.remove("nocursor"),document.body.classList.remove("noevents"),n.onRelease&&n.onRelease.bind(h)(e,h)}return r}addProgress(e,i,l={}){if(!e)throw"Set Widget Name!";let n=this.create_widget(e,b.PROGRESS,l);n.onGetValue=()=>d.value,n.onSetValue=(e,t)=>{r.querySelector("meter").value=e,c(),r.querySelector("span")&&(r.querySelector("span").innerText=e)};let r=n.domEl;var o=document.createElement("div");o.className="lexprogress",o.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";let d=document.createElement("meter");d.id="lexprogressbar-"+e,d.className="lexprogressbar",d.step="any",d.min=l.min??0,d.max=l.max??1,d.low=l.low??d.low,d.high=l.high??d.high,d.optimum=l.optimum??d.optimum,d.value=i;let c=()=>{let e=t.getThemeColor("global-selected");void 0!=d.low&&d.value<d.low?e=t.getThemeColor("global-color-error"):void 0!=d.high&&d.value<d.high&&(e=t.getThemeColor("global-color-warning")),d.style.background=`color-mix(in srgb, ${e} 20%, transparent)`};if(o.appendChild(d),r.appendChild(o),l.showValue){document.getElementById("progressvalue-"+e)&&document.getElementById("progressvalue-"+e).remove();let h=document.createElement("span");h.id="progressvalue-"+e,h.style.padding="0px 5px",h.innerText=i,o.appendChild(h)}if(l.editable){d.classList.add("editable"),d.addEventListener("mousedown",function t(i){var l=u.root.ownerDocument;l.addEventListener("mousemove",p),l.addEventListener("mouseup",m),document.body.classList.add("noevents"),d.classList.add("grabbing"),i.stopImmediatePropagation(),i.stopPropagation();let n=d.getBoundingClientRect(),r=a(s(i.offsetX,0,n.width,d.min,d.max));u.setValue(e,r)});let u=this;function p(t){if(0!=t.movementX){let i=d.getBoundingClientRect(),n=a(s(t.offsetX-i.x,0,i.width,d.min,d.max));u.setValue(e,n),l.callback&&l.callback(n,t)}t.stopPropagation(),t.preventDefault()}function m(e){var t=u.root.ownerDocument;t.removeEventListener("mousemove",p),t.removeEventListener("mouseup",m),document.body.classList.remove("noevents"),d.classList.remove("grabbing")}}return c(),n}addFile(e,i,a={}){if(!e)throw"Set Widget Name!";let s=this.create_widget(e,b.FILE,a),l=s.domEl,n=a.local??!0,r=a.type??"text",o=a.read??!0,d=document.createElement("input");if(d.className="lexfileinput",d.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+" - 10%)",d.type="file",d.disabled=a.disabled??!1,a.placeholder&&(d.placeholder=a.placeholder),d.addEventListener("change",function(e){let t=e.target.files;if(t.length){if(o){a.onBeforeRead&&a.onBeforeRead();let s=new FileReader;"text"===r?s.readAsText(t[0]):"buffer"===r?s.readAsArrayBuffer(t[0]):"bin"===r?s.readAsBinaryString(t[0]):"url"===r&&s.readAsDataURL(t[0]),s.onload=e=>{i.call(this,e.target.result,t[0])}}else i(t[0])}}),d.addEventListener("cancel",function(e){i(null)}),l.appendChild(d),this.queue(l),n){let c=null;this.addButton(null,"<a style='margin-top: 0px;' class='fa-solid fa-gear'></a>",()=>{!c&&(c=new _("Load Settings",e=>{e.addDropdown("Type",["text","buffer","bin","url"],r,e=>{r=e}),e.addButton(null,"Reload",e=>{d.dispatchEvent(new Event("change"))})},{onclose(e){e.remove(),c=null}}))},{className:"micro",skipInlineCount:!0,title:"Settings"})}return this.clearQueue(),s}addTree(e,t,i={}){let a=document.createElement("div");if(a.className="lextree",e){let s=document.createElement("span");s.innerHTML=e,a.appendChild(s)}let l=document.createElement("div");if(l.className="lextreetools",e||(l.className+=" notitle"),i.icons)for(let n of i.icons){let r=document.createElement("a");r.title=n.name,r.className="lexicon "+n.icon,r.addEventListener("click",n.callback),l.appendChild(r)}i.filter=i.filter??!0;let o=null;if(i.filter){(o=document.createElement("input")).id="lexnodetree_filter",o.setAttribute("placeholder","Filter.."),o.style.width="calc( 100% - 17px )",o.addEventListener("input",function(){h.refresh()});let d=document.createElement("a");d.className="lexicon fa-solid fa-magnifying-glass",l.appendChild(o),l.appendChild(d)}(i.icons||i.filter)&&a.appendChild(l);let c=document.createElement("ul");c.addEventListener("contextmenu",function(e){e.preventDefault()}),a.appendChild(c),this.root.appendChild(a);let h=new w(a,t,i);return h}addSeparator(){var e=document.createElement("div");e.className="lexseparator";let t=new b(null,b.SEPARATOR);t.domEl=e,this.current_branch?(this.current_branch.content.appendChild(e),this.current_branch.widgets.push(t)):this.root.appendChild(e)}addTabs(e,t={}){let i=this.current_branch?this.current_branch.content:this.root;if(this.current_branch||console.warn("No current branch!"),e.constructor!=Array)throw"Param @tabs must be an Array!";let a=t.vertical??!0,s=!a&&(t.showNames??!1),l=document.createElement("div");l.className="lextabscontainer",a||(l.className+=" horizontal");let n=document.createElement("div");n.className="tabs",l.appendChild(n),i.appendChild(l);for(let r=0;r<e.length;++r){let o=e[r];console.assert(o.name);let d=0==r,c=document.createElement("div");c.className="lextab "+(r==e.length-1?"last":"")+(d?"selected":""),c.innerHTML=(s?o.name:"")+"<a class='"+(o.icon||"fa fa-hashtag")+" "+(s?"withname":"")+"'></a>",c.title=o.name;let h=document.createElement("div");h.id=o.name.replace(/\s/g,""),h.className="widgets",d||h.toggleAttribute("hidden",!0),l.appendChild(h),c.addEventListener("click",e=>{n.querySelectorAll(".lextab").forEach(e=>{e.classList.remove("selected")}),e.target.classList.add("selected"),l.querySelectorAll(".widgets").forEach(e=>{e.toggleAttribute("hidden",!0)});let t=l.querySelector("#"+h.id);t.toggleAttribute("hidden"),o.onSelect&&o.onSelect(this,h)}),n.appendChild(c),o.onCreate&&(this.queue(h),o.onCreate(this,h),this.clearQueue())}this.addSeparator()}addCounter(e,t,a,s={}){let l=this.create_widget(e,b.COUNTER,s);l.onGetValue=()=>p.count,l.onSetValue=(e,t)=>{c(e,t)};let n=l.domEl,r=s.min??0,o=s.max??100,d=s.step??1,c=(t,s,l)=>{t=i(t,r,o),p.count=t,p.innerHTML=t,s||this._trigger(new f(e,t,l),a)},h=document.createElement("div");h.className="lexcounter",n.appendChild(h),this.queue(h),this.addButton(null,"<a style='margin-top: 0px;' class='fa-solid fa-minus'></a>",(e,t)=>{let i=d??1;t.shiftKey&&(i*=10),c(p.count-i,!1,t)},{className:"micro",skipInlineCount:!0,title:"Minus"}),this.clearQueue();let u=document.createElement("div");u.className="lexcounterbox",h.appendChild(u);let p=document.createElement("span");if(p.className="lexcountervalue",p.innerHTML=t,p.count=t,u.appendChild(p),s.label){let m=document.createElement("span");m.className="lexcounterlabel",m.innerHTML=s.label,u.appendChild(m)}return this.queue(h),this.addButton(null,"<a style='margin-top: 0px;' class='fa-solid fa-plus'></a>",(e,t)=>{let i=d??1;t.shiftKey&&(i*=10),c(p.count+i,!1,t)},{className:"micro",skipInlineCount:!0,title:"Plus"}),this.clearQueue(),l}addTable(e,i,a={}){if(!i)throw"Data is needed to create a table!";let s=this.create_widget(e,b.TABLE,a);s.onGetValue=()=>{},s.onSetValue=(e,t)=>{};let l=s.domEl,n=document.createElement("div");n.className="lextable",n.style.width="calc( 100% - "+t.DEFAULT_NAME_WIDTH+")";let r=document.createElement("table");function o(e,t,i,a){return i[e]<a[e]?-t:i[e]>a[e]?t:0}return n.appendChild(r),i.head=i.head??[],i.body=i.body??[],i.orderMap={},i.checkMap={},s.refreshTable=()=>{r.innerHTML="";{let e=document.createElement("thead");e.className="lextablehead",r.appendChild(e);let l=document.createElement("tr");if(a.selectable){let n=document.createElement("th"),d=document.createElement("input");d.type="checkbox",d.className="lexcheckbox",d.checked=i.checkMap[":root"]??!1,n.appendChild(d),d.addEventListener("change",function(){i.checkMap[":root"]=this.checked;let e=r.querySelector("tbody");for(let t of e.childNodes)i.checkMap[t.getAttribute("rowId")]=this.checked,t.querySelector("input").checked=this.checked}),l.appendChild(n)}for(let c of i.head){let h=document.createElement("th");h.innerHTML=`${c} <a class="fa-solid fa-sort"></a>`,h.querySelector("a").addEventListener("click",()=>{i.orderMap[c]||(i.orderMap[c]=1);let e=i.head.indexOf(c);i.body=i.body.sort(o.bind(this,e,i.orderMap[c])),i.orderMap[c]=-i.orderMap[c],s.refreshTable()}),l.appendChild(h)}if(a.rowActions){let u=document.createElement("th");u.className="sm",l.appendChild(u)}e.appendChild(l)}{let p=document.createElement("tbody");p.className="lextablebody",r.appendChild(p);for(let m=0;m<i.body.length;++m){let f=i.body[m],g=document.createElement("tr"),v=t.getSupportedDOMName(f.join("-"));if(g.setAttribute("rowId",v),a.selectable){let y=document.createElement("td"),E=document.createElement("input");E.type="checkbox",E.className="lexcheckbox",E.checked=i.checkMap[v],y.appendChild(E),E.addEventListener("change",function(){i.checkMap[v]=this.checked}),g.appendChild(y)}for(let $ of f){let x=document.createElement("td");x.innerHTML=`${$}`,g.appendChild(x)}if(a.rowActions){let b=document.createElement("td");b.className="sm";let w=document.createElement("div");for(let L of(w.className="lextablebuttons",b.appendChild(w),a.rowActions)){let C=document.createElement("a");C.className="lexicon","delete"==L?(C.className+=" fa-solid fa-trash-can",C.addEventListener("click",function(){i.body.splice(m,1),g.remove()})):"menu"==L?(C.className+=" fa-solid fa-ellipsis",C.addEventListener("click",function(e){k(null,e,e=>{if(a.onMenuAction){a.onMenuAction(e);return}console.warn("Using <Menu action> without action callbacks.")})})):(console.assert(L.constructor==Object),C.className+=` ${L.icon}`),w.appendChild(C)}g.appendChild(b)}p.appendChild(g)}}},s.refreshTable(),s.name||(l.className+=" noname",n.style.width="100%"),l.appendChild(n),s}}t.Panel=L;class C{constructor(e,i={}){this.name=e;var a=document.createElement("div");a.className="lexbranch",i.id&&(a.id=i.id),i.className&&(a.className+=" "+i.className),a.style.width="calc(100% - 7px)",a.style.margin="0 auto";var s=this;this.root=a,this.widgets=[];var n=document.createElement("div");n.className="lexbranchtitle",n.innerHTML="<a class='fa-solid fa-angle-up switch-branch-button'></a>",i.icon&&(n.innerHTML+="<a class='branchicon "+i.icon+"' style='margin-right: 8px; margin-bottom: -2px;'>"),n.innerHTML+=e||"Branch",a.appendChild(n);var r=document.createElement("div");r.id=e.replace(/\s/g,""),r.className="lexbranchcontent",a.appendChild(r),this.content=r,this._addBranchSeparator(),i.closed&&(n.className+=" closed",a.className+=" closed",this.grabber.setAttribute("hidden",!0),l(()=>{this.content.setAttribute("hidden",!0)},15)),this.onclick=function(e){e.stopPropagation(),this.classList.toggle("closed"),this.parentElement.classList.toggle("closed"),s.content.toggleAttribute("hidden"),s.grabber.toggleAttribute("hidden"),t.emit("@on_branch_closed",this.classList.contains("closed"),{target:s.panel})},this.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation(),!this.parentElement.classList.contains("dialog")&&k("Dock",e,t=>{e.preventDefault(),t.add("Floating",s._on_make_floating.bind(s))},{icon:"fa-regular fa-window-restore"})},n.addEventListener("click",this.onclick),n.addEventListener("contextmenu",this.oncontextmenu)}_on_make_floating(){let e=new _(this.name,e=>{for(let t of this.widgets)e.root.appendChild(t.domEl)});e.widgets=this.widgets;let t=this.root.parentElement;this.root.remove();let i=t.querySelector(".lexbranch");i&&i.classList.add("first");let a=t.querySelectorAll(".lexbranch");a.length&&a[a.length-1].classList.add("last")}_addBranchSeparator(){let e=document.createElement("div");e.className="lexwidgetseparator",e.style.width="100%",e.style.background="none";let a=document.createElement("div");a.innerHTML="&#9662;",e.appendChild(a),l(()=>{a.style.marginLeft=parseFloat(t.DEFAULT_NAME_WIDTH)/100*this.content.offsetWidth+"px"},10);let s=document.createElement("div");s.style.width="1px",s.style.marginLeft="6px",s.style.marginTop="2px",s.style.height="0px",a.appendChild(s),a.addEventListener("mousedown",function e(t){var i=n.root.ownerDocument;i.addEventListener("mouseup",o),i.addEventListener("mousemove",r),t.stopPropagation(),t.preventDefault();let a=n.root.offsetHeight-n.root.children[0].offsetHeight;s.style.height=a-3+"px",document.body.classList.add("nocursor")}),this.grabber=a;let n=this;function r(e){let t=e.movementX;if(0!=t){let s=parseFloat(a.style.marginLeft);a.style.marginLeft=i(s+t,32,n.content.offsetWidth-32)+"px"}}function o(e){n._updateWidgets(),s.style.height="0px";var t=n.root.ownerDocument;t.removeEventListener("mouseup",o),t.removeEventListener("mousemove",r),document.body.classList.remove("nocursor")}this.content.appendChild(e)}_updateWidgets(){for(var e=this.grabber.style.marginLeft,t=0;t<this.widgets.length;t++){let i=this.widgets[t],a=i.domEl;if(a.children.length<2)continue;var s=a.children[0],l=a.children[1];s.style.width=e;let n="0px";i.type===b.FILE&&(n="10%"),l.style.width="-moz-calc( 100% - "+e+" - "+n+" )",l.style.width="-webkit-calc( 100% - "+e+" - "+n+" )",l.style.width="calc( 100% - "+e+" - "+n+" )",i.onresize&&i.onresize()}}}t.Branch=C,t.Footer=class e{constructor(e={}){let t=document.createElement("footer");t.className="lexfooter";let i=document.createElement("div");if(i.className="wrapper",t.appendChild(i),e.columns&&e.columns.constructor==Array){let a=document.createElement("div");for(let s of(a.className="columns",a.style.gridTemplateColumns="1fr ".repeat(e.columns.length),i.appendChild(a),e.columns)){let l=document.createElement("div");l.className="col",a.appendChild(l);let n=document.createElement("h2");if(n.innerHTML=s.title,l.appendChild(n),!s.items||!s.items.length)continue;let r=document.createElement("ul");for(let o of(l.appendChild(r),s.items)){let d=document.createElement("li");d.innerHTML=`<a class="" href="${o.link}">${o.title}</a>`,r.appendChild(d)}}}if(e.credits||e.socials){let c=document.createElement("hr");i.appendChild(c);let h=document.createElement("div");if(h.className="credits-and-socials",i.appendChild(h),e.credits){let u=document.createElement("p");u.innerHTML=e.credits,h.appendChild(u)}if(e.socials){let p=document.createElement("div");for(let m of(p.className="social",e.socials)){let f=document.createElement("a");f.title=m.title,f.innerHTML=m.icon,f.href=m.link,f.target="_blank",p.appendChild(f)}h.appendChild(p)}}let g=e.parent??document.body;g.appendChild(t)}};class _{static _last_id=0;constructor(e,i,a={}){i||console.warn("Content is empty, add some widgets using 'callback' parameter!"),this._oncreate=i,this.id=u();let s=a.size??[],n=a.position??[],r=a.draggable??!0,o=a.modal??!1;var d=document.createElement("dialog");d.className="lexdialog "+(a.className??""),d.id=a.id??"dialog"+_._last_id++,t.root.appendChild(d),l(()=>{o?d.showModal():d.show()},10);let c=this;var h=document.createElement("div");if(e&&(h.className="lexdialogtitle",h.innerHTML=e,h.setAttribute("draggable",!1),h.oncontextmenu=function(i){i.preventDefault(),i.stopPropagation(),t.main_area&&"horizontal"===t.main_area.type&&k("Dock",i,a=>{i.preventDefault();let s=function(e){let t=e.panels[0];if(t)return t;for(var i of e.sections)if(t=s(i))return t},l=function(t){let i=t.branches.find(t=>t.name===e);for(let a of(i?t.root.appendChild(i.root):(t.branch(e),i=t.branches.find(t=>t.name===e)),c.widgets))i.content.appendChild(a.domEl);i.widgets=c.widgets,t.root.querySelectorAll(".lexbranch.last").forEach(e=>{e.classList.remove("last")}),i.root.classList.add("last"),d.remove()},n=s(t.main_area.sections[1]);a.add('<i class="fa-regular fa-window-maximize fa-window-maximize fa-rotate-90">',{disabled:!n,id:"dock_options0",callback(){l(n)}});let r=s(t.main_area.sections[0]);a.add('<i class="fa-regular fa-window-maximize fa-window-maximize fa-rotate-270">',{disabled:!r,id:"dock_options1",callback(){l(r)}})},{icon:"fa-regular fa-window-restore"})},d.appendChild(h)),a.closable??!0){this.close=()=>{a.onBeforeClose&&a.onBeforeClose(this),a.onclose?a.onclose(this.root):(d.close(),l(()=>{c.panel.clear(),d.remove()},150))};var m=document.createElement("a");m.className="lexdialogcloser fa-solid fa-xmark",m.title="Close",m.addEventListener("click",this.close),e?h.appendChild(m):(m.classList.add("notitle"),d.appendChild(m))}let f=new L;f.root.classList.add("lexdialogcontent"),e||f.root.classList.add("notitle"),i&&i.call(this,f),d.appendChild(f.root),f.root.querySelectorAll(".lexbranch").forEach(e=>e.classList.add("dialog")),this.panel=f,this.root=d,this.title=h,r&&p(d,Object.assign({targetClass:"lexdialogtitle"},a)),s.length&&"string"!=typeof s[0]&&(s[0]+="px"),s.length&&"string"!=typeof s[1]&&(s[1]+="px"),d.style.width=s[0]?s[0]:"25%",d.style.height=s[1]?s[1]:"auto",d.style.margin="auto",a.size&&(this.size=s),a.position&&(d.style.margin="unset"),d.style.left=n[0]??"0",d.style.top=n[1]??"0",f.root.style.width="calc( 100% - 30px )",f.root.style.height=e?"calc( 100% - "+(h.offsetHeight+30)+"px )":"calc( 100% - 51px )"}destroy(){this.root.remove()}refresh(){this.panel.root.innerHTML="",this._oncreate.call(this,this.panel)}setPosition(e,t){this.root.style.left=e+"px",this.root.style.top=t+"px"}setTitle(e){let t=this.root.querySelector(".lexdialogtitle");t&&(t.innerText=e)}}t.Dialog=_;class T extends _{static TOP=0;static BOTTOM=1;constructor(e,i,a={}){a.draggable=a.draggable??!1,a.closable=a.closable??!1,super(e,i,a);let s=this;if(t.addSignal("@on_branch_closed",this.panel,e=>{this.dock_pos==T.BOTTOM&&(this.root.style.top="calc(100% - "+(this.root.offsetHeight+3)+"px)")}),this.root.classList.add("pocket"),this.root.style.left="unset",a.position||(this.root.style.right="3px",this.root.style.top="3px"),this.panel.root.style.width="calc( 100% - 12px )",this.panel.root.style.height="calc( 100% - 40px )",this.dock_pos=T.TOP,this.minimized=!1,this.title.tabIndex=-1,this.title.addEventListener("click",e=>{this.size&&(this.minimized?this.root.style.height=this.size[1]:this.root.style.height="auto"),this.root.classList.toggle("minimized"),this.minimized=!this.minimized,this.dock_pos==T.BOTTOM&&(s.root.style.top=this.root.classList.contains("minimized")?"calc(100% - "+(s.title.offsetHeight+6)+"px)":"calc(100% - "+(s.root.offsetHeight+3)+"px)")}),!a.draggable){let l=a.float;if(l)for(var n=0;n<l.length;n++){let r=l[n];switch(r){case"b":this.root.style.top="calc(100% - "+(this.root.offsetHeight+3)+"px)";break;case"l":this.root.style.right="unset",this.root.style.left=a.position?a.position[1]:"3px"}}this.root.classList.add("dockable"),this.title.addEventListener("keydown",function(e){e.ctrlKey&&(s.root.style.right="unset","ArrowLeft"==e.key?s.root.style.left="0px":"ArrowRight"==e.key?s.root.style.left="calc(100% - "+(s.root.offsetWidth+3)+"px)":"ArrowUp"==e.key?(s.root.style.top="0px",s.dock_pos=T.TOP):"ArrowDown"==e.key&&(s.root.style.top="calc(100% - "+(s.root.offsetHeight+3)+"px)",s.dock_pos=T.BOTTOM))})}}}t.PocketDialog=T;class N{constructor(e,t,i={}){if(document.body.querySelectorAll(".lexcontextmenu").forEach(e=>e.remove()),this.root=document.createElement("div"),this.root.className="lexcontextmenu",this.root.style.left=e.x-48+document.scrollingElement.scrollLeft+"px",this.root.style.top=e.y-8+document.scrollingElement.scrollTop+"px",this.root.addEventListener("mouseleave",function(){this.remove()}),this.items=[],this.colors={},t){let a={};a[t]=[],a.className="cmtitle",a.icon=i.icon,this.items.push(a)}}_adjust_position(e,t,i=!1){let a=e.getBoundingClientRect();if(i){let s=window.innerWidth-a.right;s<0&&(e.style.left=e.offsetLeft+(s-t)+"px"),(s=window.innerHeight-(a.top+a.height))<0&&(e.style.top=e.offsetTop+(s-t+20)+"px")}else{let l=a.width;a.left<0?e.style.left=t+"px":window.innerWidth-a.right<0&&(e.style.left=window.innerWidth-l-t+"px"),a.top<0?e.style.top=t+"px":a.top+a.height>window.innerHeight&&(e.style.top=window.innerHeight-a.height-t+"px")}}_create_submenu(e,t,i,a){this.root.querySelectorAll(".lexcontextmenu").forEach(e=>e.remove());let s=document.createElement("div");s.className="lexcontextmenu",i.appendChild(s);for(var l=0;l<e[t].length;++l){let n=e[t][l],r=Object.keys(n)[0];this._create_entry(n,r,s,a)}var o=i.getBoundingClientRect();s.style.left=o.width+"px",s.style.marginTop=3.5-i.offsetHeight+"px",this._adjust_position(s,6,!0)}_create_entry(e,i,a,s){let l=e[i].length,r=document.createElement("div");r.className="lexmenuboxentry"+(e.className?" "+e.className:""),r.id=e.id??"eId"+n(i),r.innerHTML="";let o=e.icon;o&&(r.innerHTML+="<a class='"+o+" fa-sm'></a>");let d=e.disabled;if(r.innerHTML+="<div class='lexentryname"+(d?" disabled":"")+"'>"+i+"</div>",a.appendChild(r),this.colors[i]&&(r.style.borderColor=this.colors[i]),""==i){r.className+=" cmseparator";return}if(r.addEventListener("click",a=>{if(a.stopPropagation(),a.stopImmediatePropagation(),d)return;let n=e.callback;n&&(n.call(this,i,r),this.root.remove()),l&&"click"==t.OPEN_CONTEXTMENU_ENTRY&&this._create_submenu(e,i,r,++s)}),!l)return;let c=document.createElement("a");c.className="fa-solid fa-bars-staggered fa-xs",r.appendChild(c),"mouseover"==t.OPEN_CONTEXTMENU_ENTRY&&r.addEventListener("mouseover",t=>{r.built||(r.built=!0,this._create_submenu(e,i,r,++s),t.stopPropagation())}),r.addEventListener("mouseleave",()=>{s=-1,a.querySelectorAll(".lexcontextmenu").forEach(e=>e.remove())})}onCreate(){l(()=>this._adjust_position(this.root,6))}add(e,t={}){t.constructor==Function&&(t={callback:t}),e+="";let i=e.split("/"),a=i[i.length-1];this.colors[a]=t.color;let s=0,l=(e,a)=>{if(void 0==e)return;let n=null;if(a.forEach(t=>{let i=Object.keys(t),a=i.find(t=>t==e);a&&(n=t[a])}),n)l(i[s++],n);else{let r={};r[e]=[];let o=i[s++];o||(r.id=t.id,r.callback=t.callback,r.disabled=t.disabled??!1),a.push(r),l(o,r[e])}};l(i[s++],this.items);let r=e=>{let t=Object.keys(e)[0],i=e[t];if(i.length){if(null==i.find(e=>Object.keys(e)[0]==t)){let a={};a[t]=[],a.className="cmtitle",e[t].unshift(a)}for(var s of e[t]){let l=Object.keys(s)[0];for(var n=0;n<s[l].length;++n)r(s)}}};for(let o of this.items)r(o);for(let d of this.items){let c=Object.keys(d)[0],h="eId"+n(c),u="#"+(d.id??h);this.root.querySelector(u)||this._create_entry(d,c,this.root,-1)}}setColor(e,t){"#"!==t[0]&&(t=c(t)),this.colors[e]=t}}function k(e,i,a,s){var l=new N(i,e,s);return t.root.appendChild(l.root),a&&a(l),l.onCreate(),l}t.ContextMenu=N,t.addContextMenu=k;class A{constructor(e,i,a={}){let s=document.createElement("div");s.className="curve "+(a.className?a.className:""),s.style.minHeight="50px",s.style.width=a.width||"100%",s.style.minWidth="50px",s.style.minHeight="20px",s.bgcolor=a.bgColor||t.getThemeColor("global-intense-background"),s.pointscolor=a.pointsColor||t.getThemeColor("global-selected-light"),s.linecolor=a.lineColor||"#555",s.value=i||[],s.xrange=a.xrange||[0,1],s.yrange=a.yrange||[0,1],s.defaulty=null!=a.defaulty?a.defaulty:0,s.no_overlap=a.noOverlap||!1,s.show_samples=a.showSamples||0,s.allow_add_values=a.allowAddValues??!0,s.draggable_x=a.draggableX??!0,s.draggable_y=a.draggableY??!0,s.smooth=(a.smooth&&"number"==typeof a.smooth?a.smooth:.3)||!1,s.move_out=a.moveOutAction??t.CURVE_MOVEOUT_DELETE,t.addSignal("@on_new_color_scheme",(e,i)=>{s.bgcolor=a.bgColor||t.getThemeColor("global-intense-background"),s.pointscolor=a.pointsColor||t.getThemeColor("global-selected-light"),this.redraw()}),this.element=s;let l=document.createElement("canvas");function n(e){return[l.width*(e[0]-s.xrange[0])/s.xrange[1],l.height*(e[1]-s.yrange[0])/s.yrange[1]]}function r(e){return[e[0]*s.xrange[1]/l.width+s.xrange[0],e[1]*s.yrange[1]/l.height+s.yrange[0]]}l.width=a.width||200,l.height=a.height||50,s.appendChild(l),this.canvas=l,s.addEventListener("mousedown",function e(i){document.addEventListener("mousemove",c),document.addEventListener("mouseup",h);var a=l.getBoundingClientRect(),u=i.clientX-a.left,f=i.clientY-a.top;if(o=function e(t,i){for(var a=1e5,l=-1,r=0;r<s.value.length;r++){var o=n(s.value[r]),d=p([t,i],o);d<a&&d<8&&(a=d,l=r)}return l}(u,l.height-f),i.button==t.MOUSE_LEFT_CLICK&&-1==o&&s.allow_add_values){var g=r([u,l.height-f]);s.value.push(g),m(),o=s.value.indexOf(g)}d=[u,f],s.redraw(),i.preventDefault(),i.stopPropagation()}),s.getValueAt=function(e){if(e<s.xrange[0]||e>s.xrange[1])return s.defaulty;for(var t=[s.xrange[0],s.defaulty],i=0,a=0;a<s.value.length;a+=1){var l=s.value[a];if(e==l[0])return l[1];if(e<l[0])return i=(e-t[0])/(l[0]-t[0]),t[1]*(1-i)+l[1]*i;t=l}return l=[s.xrange[1],s.defaulty],i=(e-t[0])/(l[0]-t[0]),t[1]*(1-i)+l[1]*i},s.resample=function(e){for(var t=[],i=(s.xrange[1]-s.xrange[0])/e,a=s.xrange[0];a<=s.xrange[1];a+=i)t.push(s.getValueAt(a));return t},s.addValue=function(e){for(var t=0;t<s.value;t++)if(!(s.value[t][0]<e[0])){s.value.splice(t,0,e),redraw();return}s.value.push(e),redraw()};var o=-1;s.redraw=function(e={}){e.value&&(s.value=e.value),e.xrange&&(s.xrange=e.xrange),e.yrange&&(s.yrange=e.yrange),e.smooth&&(s.smooth=e.smooth);var i=l.parentElement.getBoundingClientRect();l.parentElement.parentElement&&(i=l.parentElement.parentElement.getBoundingClientRect()),i&&l.width!=i.width&&i.width&&i.width<1e3&&(l.width=i.width);var a=l.getContext("2d");a.setTransform(1,0,0,1,0,0),a.translate(0,l.height),a.scale(1,-1),a.fillStyle=s.bgcolor,a.fillRect(0,0,l.width,l.height),a.strokeStyle=s.linecolor,a.beginPath();var r=n([s.xrange[0],s.defaulty]);a.moveTo(r[0],r[1]);let d=[r[0],r[1]];for(var c in s.value){var h=s.value[c];r=n(h),d.push(r[0]),d.push(r[1]),s.smooth||a.lineTo(r[0],r[1])}r=n([s.xrange[1],s.defaulty]),d.push(r[0]),d.push(r[1]),s.smooth?t.UTILS.drawSpline(a,d,s.smooth):(a.lineTo(r[0],r[1]),a.stroke());for(var c=0;c<s.value.length;c+=1){var h=s.value[c];r=n(h),o==c?a.fillStyle="white":a.fillStyle=s.pointscolor,a.beginPath(),a.arc(r[0],r[1],o==c?4:3,0,2*Math.PI),a.fill()}if(s.show_samples){var u=s.resample(s.show_samples);a.fillStyle="#888";for(var c=0;c<u.length;c+=1){var h=[c*((s.xrange[1]-s.xrange[0])/s.show_samples)+s.xrange[0],u[c]];r=n(h),a.beginPath(),a.arc(r[0],r[1],2,0,2*Math.PI),a.fill()}}};var d=[0,0];function c(e){var i=l.getBoundingClientRect(),a=e.clientX-i.left,n=e.clientY-i.top;a<0?a=0:a>l.width&&(a=l.width),n<0?n=0:n>l.height&&(n=l.height);let c=[e.clientX-i.left,e.clientY-i.top];if(-1!=o&&p(c,[a,n])>.5*l.height){if(s.move_out==t.CURVE_MOVEOUT_DELETE)s.value.splice(o,1);else{let f=[c[0]-a,c[1]-n],g=s.value[o];g[0]=0==f[0]?g[0]:f[0]<0?s.xrange[0]:s.xrange[1],g[1]=0==f[1]?g[1]:f[1]<0?s.yrange[1]:s.yrange[0]}h(e);return}var v,y=r([-(s.draggable_x?d[0]-a:0),s.draggable_y?d[1]-n:0]);if(-1!=o){var E=s.xrange[0],$=s.xrange[1];s.no_overlap&&(o>0&&(E=s.value[o-1][0]),o<s.value.length-1&&($=s.value[o+1][0]));var x=s.value[o];x[0]+=y[0],x[1]+=y[1],x[0]<E?x[0]=E:x[0]>$&&(x[0]=$),x[1]<s.yrange[0]?x[1]=s.yrange[0]:x[1]>s.yrange[1]&&(x[1]=s.yrange[1])}m(),s.redraw(),d[0]=a,d[1]=n,u(e),e.preventDefault(),e.stopPropagation()}function h(e){o=-1,s.redraw(),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",h),u(e),e.preventDefault(),e.stopPropagation()}function u(e){a.callback&&a.callback.call(s,s.value,e)}function p(e,t){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function m(){var e=null;-1!=o&&(e=s.value[o]),s.value.sort(function(e,t){return e[0]-t[0]}),e&&(o=s.value.indexOf(e))}return s.redraw(),this}redraw(e={}){this.element.redraw(e)}}t.Curve=A;class S{constructor(e,i,a={}){let s=document.createElement("div");s.className="dial "+(a.className?a.className:""),s.style.width=s.style.height=a.size||"100%",s.style.minWidth=s.style.minHeight="50px",s.bgcolor=a.bgColor||t.getThemeColor("global-dark-background"),s.pointscolor=a.pointsColor||t.getThemeColor("global-selected-light"),s.linecolor=a.lineColor||"#555",s.value=i||[],s.xrange=a.xrange||[0,1],s.yrange=a.yrange||[0,1],s.defaulty=null!=a.defaulty?a.defaulty:0,s.no_overlap=a.noOverlap||!1,s.show_samples=a.showSamples||0,s.allow_add_values=a.allowAddValues??!0,s.draggable_x=a.draggableX??!0,s.draggable_y=a.draggableY??!0,s.smooth=(a.smooth&&"number"==typeof a.smooth?a.smooth:.3)||!1,s.move_out=a.moveOutAction??t.CURVE_MOVEOUT_DELETE,this.element=s;let l=document.createElement("canvas");function n(e,t){return e[0],[l.width*(e[0]-s.xrange[0])/s.xrange[1],l.height*(e[1]-s.yrange[0])/s.yrange[1]]}function r(e){return[e[0]*s.xrange[1]/l.width+s.xrange[0],e[1]*s.yrange[1]/l.height+s.yrange[0]]}l.width=l.height=a.size||200,s.appendChild(l),this.canvas=l,s.addEventListener("mousedown",function e(i){document.addEventListener("mousemove",c),document.addEventListener("mouseup",h);var a=l.getBoundingClientRect(),u=i.clientX-a.left,f=i.clientY-a.top;if(o=function e(t,i){for(var a=1e5,l=-1,r=0;r<s.value.length;r++){var o=n(s.value[r]),d=p([t,i],o);d<a&&d<8&&(a=d,l=r)}return l}(u,l.height-f),i.button==t.MOUSE_LEFT_CLICK&&-1==o&&s.allow_add_values){var g=r([u,l.height-f]);s.value.push(g),m(),o=s.value.indexOf(g)}d=[u,f],s.redraw(),i.preventDefault(),i.stopPropagation()}),s.getValueAt=function(e){if(e<s.xrange[0]||e>s.xrange[1])return s.defaulty;for(var t=[s.xrange[0],s.defaulty],i=0,a=0;a<s.value.length;a+=1){var l=s.value[a];if(e==l[0])return l[1];if(e<l[0])return i=(e-t[0])/(l[0]-t[0]),t[1]*(1-i)+l[1]*i;t=l}return l=[s.xrange[1],s.defaulty],i=(e-t[0])/(l[0]-t[0]),t[1]*(1-i)+l[1]*i},s.resample=function(e){for(var t=[],i=(s.xrange[1]-s.xrange[0])/e,a=s.xrange[0];a<=s.xrange[1];a+=i)t.push(s.getValueAt(a));return t},s.addValue=function(e){for(var t=0;t<s.value;t++)if(!(s.value[t][0]<e[0])){s.value.splice(t,0,e),redraw();return}s.value.push(e),redraw()};var o=-1;s.redraw=function(e={}){e.value&&(s.value=e.value),e.xrange&&(s.xrange=e.xrange),e.yrange&&(s.yrange=e.yrange),e.smooth&&(s.smooth=e.smooth);var t=l.parentElement.getBoundingClientRect();l.parentElement.parentElement&&(t=l.parentElement.parentElement.getBoundingClientRect()),t&&l.width!=t.width&&t.width&&t.width<1e3&&(l.width=t.width);var i=l.getContext("2d");i.setTransform(1,0,0,1,0,0),i.translate(0,l.height),i.scale(1,-1),i.fillStyle=s.bgcolor,i.fillRect(0,0,l.width,l.height),i.strokeStyle=s.linecolor,i.beginPath();var a=n([s.xrange[0],s.defaulty]);i.moveTo(a[0],a[1]);let r=[a[0],a[1]];for(var d in s.value){var c=s.value[d];a=n(c),r.push(a[0]),r.push(a[1])}a=n([s.xrange[1],s.defaulty]),r.push(a[0]),r.push(a[1]),a=n([0,0]),i.fillStyle="gray",i.beginPath(),i.arc(a[0],a[1],3,0,2*Math.PI),i.fill();for(var d=0;d<s.value.length;d+=1){var c=s.value[d];a=n(c),o==d?i.fillStyle="white":i.fillStyle=s.pointscolor,i.beginPath(),i.arc(a[0],a[1],o==d?4:3,0,2*Math.PI),i.fill()}if(s.show_samples){var h=s.resample(s.show_samples);i.fillStyle="#888";for(var d=0;d<h.length;d+=1){var c=[d*((s.xrange[1]-s.xrange[0])/s.show_samples)+s.xrange[0],h[d]];a=n(c),i.beginPath(),i.arc(a[0],a[1],2,0,2*Math.PI),i.fill()}}};var d=[0,0];function c(e){var i=l.getBoundingClientRect(),a=e.clientX-i.left,n=e.clientY-i.top;a<0?a=0:a>l.width&&(a=l.width),n<0?n=0:n>l.height&&(n=l.height);let c=[e.clientX-i.left,e.clientY-i.top];if(-1!=o&&p(c,[a,n])>.5*l.height){if(s.move_out==t.CURVE_MOVEOUT_DELETE)s.value.splice(o,1);else{let f=[c[0]-a,c[1]-n],g=s.value[o];g[0]=0==f[0]?g[0]:f[0]<0?s.xrange[0]:s.xrange[1],g[1]=0==f[1]?g[1]:f[1]<0?s.yrange[1]:s.yrange[0]}h(e);return}var v,y=r([-(s.draggable_x?d[0]-a:0),s.draggable_y?d[1]-n:0]);if(-1!=o){var E=s.xrange[0],$=s.xrange[1];s.no_overlap&&(o>0&&(E=s.value[o-1][0]),o<s.value.length-1&&($=s.value[o+1][0]));var x=s.value[o];x[0]+=y[0],x[1]+=y[1],x[0]<E?x[0]=E:x[0]>$&&(x[0]=$),x[1]<s.yrange[0]?x[1]=s.yrange[0]:x[1]>s.yrange[1]&&(x[1]=s.yrange[1])}m(),s.redraw(),d[0]=a,d[1]=n,u(e),e.preventDefault(),e.stopPropagation()}function h(e){o=-1,s.redraw(),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",h),u(e),e.preventDefault(),e.stopPropagation()}function u(e){a.callback&&a.callback.call(s,s.value,e)}function p(e,t){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function m(){var e=null;-1!=o&&(e=s.value[o]),s.value.sort(function(e,t){return e[0]-t[0]}),e&&(o=s.value.indexOf(e))}return s.redraw(),this}redraw(e={}){this.element.redraw(e)}}t.Dial=S;class D{static NONE=0;static ASSET_SELECTED=1;static ASSET_DELETED=2;static ASSET_RENAMED=3;static ASSET_CLONED=4;static ASSET_DBLCLICKED=5;static ENTER_FOLDER=6;static ASSET_CHECKED=7;constructor(e,t,i){this.type=e||g.NONE,this.item=t,this.value=i,this.multiple=!1}string(){switch(this.type){case D.NONE:return"assetview_event_none";case D.ASSET_SELECTED:return"assetview_event_selected";case D.ASSET_DELETED:return"assetview_event_deleted";case D.ASSET_RENAMED:return"assetview_event_renamed";case D.ASSET_CLONED:return"assetview_event_cloned";case D.ASSET_DBLCLICKED:return"assetview_event_dblclicked";case D.ENTER_FOLDER:return"assetview_event_enter_folder";case D.ASSET_CHECKED:return"assetview_event_checked"}}}t.AssetViewEvent=D;class P{static LAYOUT_CONTENT=0;static LAYOUT_LIST=1;static MAX_PAGE_ELEMENTS=50;constructor(e={}){this.rootPath="https://raw.githubusercontent.com/jxarco/lexgui.js/master/",this.layout=e.layout??P.LAYOUT_CONTENT,this.contentPage=1,e.rootPath&&(e.rootPath.constructor!==String?console.warn("Asset Root Path must be a String (now is "+path.constructor.name+")"):this.rootPath=e.rootPath);let i=document.createElement("div");i.className="lexassetbrowser",this.root=i;let a=new t.Area({height:"100%"});i.appendChild(a.root);let s,l,n=a;this.skipBrowser=e.skipBrowser??!1,this.skipPreview=e.skipPreview??!1,this.useNativeTitle=e.useNativeTitle??!1,this.onlyFolders=e.onlyFolders??!0,this.allowMultipleSelection=e.allowMultipleSelection??!1,this.previewActions=e.previewActions??[],this.contextMenu=e.contextMenu??[],this.onRefreshContent=e.onRefreshContent,this.skipBrowser||([s,l]=a.split({type:"horizontal",sizes:["15%","85%"]}),n=l,s.setLimitBox(210,0),l.setLimitBox(512,0)),this.skipPreview||([n,l]=n.split({type:"horizontal",sizes:["80%","20%"]})),this.allowedTypes=e.allowedTypes||["None","Image","Mesh","Script","JSON","Clip"],this.prevData=[],this.nextData=[],this.data=[],this._processData(this.data,null),this.currentData=this.data,this.path=["@"],this.skipBrowser||this._createTreePanel(s),this._createContentPanel(n),this.skipPreview||(this.previewPanel=l.addPanel({className:"lexassetcontentpanel",style:{overflow:"scroll"}}))}load(e,t){this.prevData.length=0,this.nextData.length=0,this.data=e,this._processData(this.data,null),this.currentData=this.data,this.path=["@"],this.skipBrowser||this._createTreePanel(this.area),this._refreshContent(),this.onevent=t}clear(){this.previewPanel&&this.previewPanel.clear(),this.leftPanel&&this.leftPanel.clear(),this.rightPanel&&this.rightPanel.clear()}_processData(e,t){e.constructor!==Array&&(e.folder=t,e.children=e.children??[]);let i=e.constructor===Array?e:e.children;for(var a=0;a<i.length;++a)this._processData(i[a],e)}_updatePath(e){this.path.length=0;let i=e=>{if(!e)return;let t=(e.children?e.children:e)[0];t&&t.folder&&(this.path.push(t.folder.id??"@"),i(t.folder.folder))};i(e),t.emit("@on_folder_change",this.path.reverse().join("/"))}_createTreePanel(e){this.leftPanel?this.leftPanel.clear():this.leftPanel=e.addPanel({className:"lexassetbrowserpanel"});let i={id:"/",children:this.data};this.tree=this.leftPanel.addTree("Content Browser",i,{filter:!1,onlyFolders:this.onlyFolders,onevent:e=>{let i=e.node,a=e.value;switch(e.type){case t.TreeEvent.NODE_SELECTED:e.multiple||this._enterFolder(i),i.parent||(this.prevData.push(this.currentData),this.currentData=this.data,this._refreshContent(),this.path=["@"],t.emit("@on_folder_change",this.path.join("/")));break;case t.TreeEvent.NODE_DRAGGED:i.folder=a,this._refreshContent()}}})}_setContentLayout(e){this.layout=e,this._refreshContent()}_createContentPanel(e){this.rightPanel?this.rightPanel.clear():this.rightPanel=e.addPanel({className:"lexassetcontentpanel"});let t=(e,t)=>{let i=k("Sort by",t,e=>{e.add("Name",()=>this._sortData("id")),e.add("Type",()=>this._sortData("type")),e.add(""),e.add("Ascending",()=>this._sortData()),e.add("Descending",()=>this._sortData(null,!0))}),a=this.parent.root.parentElement;a.classList.contains("lexdialog")&&(i.root.style.zIndex=+getComputedStyle(a).zIndex+1)},i=(e,t)=>{let i=k("Layout",t,e=>{e.add("Content",()=>this._setContentLayout(P.LAYOUT_CONTENT)),e.add(""),e.add("List",()=>this._setContentLayout(P.LAYOUT_LIST))}),a=this.parent.root.parentElement;a.classList.contains("lexdialog")&&(i.root.style.zIndex=+getComputedStyle(a).zIndex+1)},a=(e,t)=>{if(!this.allowNextPage)return;let i=this.contentPage;this.contentPage+=e,this.contentPage=Math.min(this.contentPage,((this.currentData.length-1)/P.MAX_PAGE_ELEMENTS|0)+1),this.contentPage=Math.max(this.contentPage,1),i!=this.contentPage&&this._refreshContent()};this.rightPanel.sameLine(),this.rightPanel.addDropdown("Filter",this.allowedTypes,this.allowedTypes[0],e=>this._refreshContent.call(this,null,e),{width:"30%",minWidth:"128px"}),this.rightPanel.addText(null,this.searchValue??"",e=>this._refreshContent.call(this,e,null),{placeholder:"Search assets.."}),this.rightPanel.addButton(null,"<a class='fa fa-arrow-up-short-wide'></a>",t.bind(this),{className:"micro",title:"Sort"}),this.rightPanel.addButton(null,"<a class='fa-solid fa-grip'></a>",i.bind(this),{className:"micro",title:"View"}),this.rightPanel.addButton(null,"<a class='fa-solid fa-angles-left'></a>",a.bind(this,-1),{className:"micro",title:"Previous Page"}),this.rightPanel.addButton(null,"<a class='fa-solid fa-angles-right'></a>",a.bind(this,1),{className:"micro",title:"Next Page"}),this.rightPanel.endLine(),this.skipBrowser||(this.rightPanel.sameLine(),this.rightPanel.addComboButtons(null,[{value:"Left",icon:"fa-solid fa-left-long",callback:e=>{this.prevData.length&&(this.nextData.push(this.currentData),this.currentData=this.prevData.pop(),this._refreshContent(),this._updatePath(this.currentData))}},{value:"Right",icon:"fa-solid fa-right-long",callback:e=>{this.nextData.length&&(this.prevData.push(this.currentData),this.currentData=this.nextData.pop(),this._refreshContent(),this._updatePath(this.currentData))}},{value:"Refresh",icon:"fa-solid fa-arrows-rotate",callback:e=>{this._refreshContent()}}],{width:"auto",noSelection:!0}),this.rightPanel.addText(null,this.path.join("/"),null,{disabled:!0,signal:"@on_folder_change",style:{fontWeight:"bolder",fontSize:"16px",color:"#aaa"}}),this.rightPanel.addText(null,"Page "+this.contentPage+" / "+(((this.currentData.length-1)/P.MAX_PAGE_ELEMENTS|0)+1),null,{disabled:!0,signal:"@on_page_change",width:"fit-content"}),this.rightPanel.endLine()),this.content=document.createElement("ul"),this.content.className="lexassetscontent",this.rightPanel.root.appendChild(this.content),this.content.addEventListener("dragenter",function(e){e.preventDefault(),this.classList.add("dragging")}),this.content.addEventListener("dragleave",function(e){e.preventDefault(),this.classList.remove("dragging")}),this.content.addEventListener("drop",e=>{e.preventDefault(),this._processDrop(e)}),this.content.addEventListener("click",function(){this.querySelectorAll(".lexassetitem").forEach(e=>e.classList.remove("selected"))}),this._refreshContent()}_refreshContent(e,i){let a=this.layout==P.LAYOUT_CONTENT;this.filter=i??this.filter??"None",this.searchValue=e??this.searchValue??"",this.content.innerHTML="",this.content.className=a?"lexassetscontent":"lexassetscontent list";let s=this,l=function(e){let i=e.type.charAt(0).toUpperCase()+e.type.slice(1),l=r(e.id),n="Folder"===i,o=document.createElement("li");if(o.className="lexassetitem "+e.type.toLowerCase(),o.tabIndex=-1,s.content.appendChild(o),s.useNativeTitle)o.title=i+": "+e.id;else{let d=document.createElement("span");d.className="lexitemdesc",d.innerHTML="File: "+e.id+"<br>Type: "+i,s.content.appendChild(d),o.addEventListener("mousemove",e=>{if(!a)return;let t=o.getBoundingClientRect(),i=e.target.getBoundingClientRect(),s=d.parentElement.getBoundingClientRect(),l=i.x-s.x-(i.x-t.x),n=i.y-s.y-(i.y-t.y);e.target.classList.contains("lexassettitle")&&(n+=i.y-t.y),d.style.left=l+e.offsetX+12+"px",d.style.top=n+e.offsetY+"px"}),o.addEventListener("mouseenter",()=>{a&&(d.style.display="unset")}),o.addEventListener("mouseleave",()=>{a&&setTimeout(()=>{d.style.display="none"},100)})}if(s.allowMultipleSelection){let c=document.createElement("input");c.type="checkbox",c.className="lexcheckbox",c.checked=e.selected,c.addEventListener("change",(t,i)=>{if(e.selected=!e.selected,s.onevent){let a=new D(D.ASSET_CHECKED,t.shiftKey?[e]:e);a.multiple=!!t.shiftKey,s.onevent(a)}t.stopPropagation(),t.stopImmediatePropagation()}),o.appendChild(c)}let h=document.createElement("span");if(h.className="lexassettitle",h.innerText=e.id,o.appendChild(h),!s.skipPreview){let u=null,p=e.src&&(["png","jpg"].indexOf(r(e.src))>-1||e.src.includes("data:image/"));if(p||n||!a){u=document.createElement("img");let m=e.unknown_extension?s.rootPath+"images/file.png":n?s.rootPath+"images/folder.png":e.src;u.src=a||n?m:s.rootPath+"images/file.png",o.appendChild(u)}else{(u=document.createElement("svg")).className="asset-file-preview",o.appendChild(u);let f=document.createElement("text");u.appendChild(f),f.innerText=l&&l!=e.id?"."+l.toUpperCase():e.type.toUpperCase();var g,v=2.5/f.innerText.length;v<1&&(f.style.fontSize=64*v+"px",u.style.paddingTop="calc(50% - "+(.5*f.offsetHeight+10)+"px)")}}if(!n){let y=document.createElement("span");y.className="lexassetinfo",y.innerText=i,o.appendChild(y)}return o.addEventListener("click",function(i){i.stopImmediatePropagation(),i.stopPropagation();let a=i.detail==t.MOUSE_DOUBLE_CLICK;if(a){if(n){s._enterFolder(e);return}}else i.shiftKey||s.content.querySelectorAll(".lexassetitem").forEach(e=>e.classList.remove("selected")),this.classList.add("selected"),s.selectedItem=e,s.skipPreview||s._previewAsset(e);if(s.onevent){let l=new D(a?D.ASSET_DBLCLICKED:D.ASSET_SELECTED,i.shiftKey?[e]:e);l.multiple=!!i.shiftKey,s.onevent(l)}}),s.contextMenu&&o.addEventListener("contextmenu",function(i){i.preventDefault();let a=s.content.querySelectorAll(".selected").length;t.addContextMenu(a>1?a+" selected":n?e.id:e.type,i,t=>{a<=1&&t.add("Rename"),n||t.add("Clone",s._cloneItem.bind(s,e)),a<=1&&t.add("Properties"),t.add(""),t.add("Delete",s._deleteItem.bind(s,e))})}),o.addEventListener("dragstart",function(e){e.preventDefault()},!1),o},n=new FileReader,o=this.currentData.filter(e=>("None"==this.filter||e.type.toLowerCase()==this.filter.toLowerCase())&&e.id.toLowerCase().includes(this.searchValue.toLowerCase()));(i||e)&&(this.contentPage=1);let d=(this.contentPage-1)*P.MAX_PAGE_ELEMENTS,c=Math.min(d+P.MAX_PAGE_ELEMENTS,o.length);for(let h=d;h<c;++h){let u=o[h];u.path?t.request({url:u.path,dataType:"blob",success:t=>{u.bytesize=t.size,n.readAsDataURL(t),n.onload=t=>{u.src=t.currentTarget.result,u._path=u.path,delete u.path,this._refreshContent(e,i)}}}):u.domEl=l(u)}this.allowNextPage=o.length-1>P.MAX_PAGE_ELEMENTS,t.emit("@on_page_change","Page "+this.contentPage+" / "+(((o.length-1)/P.MAX_PAGE_ELEMENTS|0)+1)),this.onRefreshContent&&this.onRefreshContent(e,i)}_previewAsset(e){let i=e.src&&e.src.includes("data:image/");if(this.previewPanel.clear(),this.previewPanel.branch("Asset"),"image"==e.type||e.src){let a=["png","jpg"].indexOf(r(e.src))>-1||i;a&&this.previewPanel.addImage(e.src,{style:{width:"100%"}})}let s={disabled:!0};this.previewPanel.addText("Filename",e.id,null,s),e.lastModified&&this.previewPanel.addText("Last Modified",new Date(e.lastModified).toLocaleString(),null,s),(e._path||e.src)&&this.previewPanel.addText("URL",e._path?e._path:e.src,null,s),this.previewPanel.addText("Path",this.path.join("/"),null,s),this.previewPanel.addText("Type",e.type,null,s),e.bytesize&&this.previewPanel.addText("Size",(e.bytesize/1024).toPrecision(3)+" KBs",null,s),"folder"==e.type&&this.previewPanel.addText("Files",e.children?e.children.length.toString():"0",null,s),this.previewPanel.addSeparator();let l=[...this.previewActions];for(let n of(l.length||l.push({name:"Download",callback:()=>t.downloadURL(e.src,e.id)}),l))n.type&&n.type!==e.type||n.path&&n.path!==this.path.join("/")||this.previewPanel.addButton(null,n.name,n.callback.bind(this,e));this.previewPanel.merge()}_processDrop(e){let t=new FileReader,i=e.dataTransfer.files.length;for(let a=0;a<e.dataTransfer.files.length;++a){let s=e.dataTransfer.files[a],l=this.currentData.find(e=>e.id===s.name);l||(t.readAsDataURL(s),t.onload=e=>{let t=s.name.substr(s.name.lastIndexOf(".")+1).toLowerCase(),l={id:s.name,src:e.currentTarget.result,extension:t,lastModified:s.lastModified};switch(t){case"png":case"jpg":l.type="image";break;case"js":case"css":l.type="script";break;case"json":l.type="json";break;case"obj":l.type="mesh";break;default:l.type=t,l.unknown_extension=!0}this.currentData.push(l),a!=i-1||(this._refreshContent(),this.skipBrowser||this.tree.refresh())})}}_sortData(e,t=!1){e=e??this._lastSortBy??"id",this.currentData=this.currentData.sort((i,a)=>{var s=t?a[e].localeCompare(i[e]):i[e].localeCompare(a[e]);return 0==s&&(s=t?a.id.localeCompare(i.id):i.id.localeCompare(a.id)),s}),this._lastSortBy=e,this._refreshContent()}_enterFolder(e){if(this.prevData.push(this.currentData),this.currentData=e.children,this.contentPage=1,this._refreshContent(),this._updatePath(this.currentData),this.onevent){let t=new D(D.ENTER_FOLDER,e);this.onevent(t)}}_deleteItem(e){let t=this.currentData.indexOf(e);if(t<0){console.error("[AssetView Error] Cannot delete. Item not found.");return}if(this.currentData.splice(t,1),this._refreshContent(this.searchValue,this.filter),this.onevent){let i=new D(D.ASSET_DELETED,e);this.onevent(i)}this.tree.refresh(),this._processData(this.data)}_cloneItem(e){let t=this.currentData.indexOf(e);if(t<0)return;delete e.domEl,delete e.folder;let i=o(e);if(this.currentData.splice(t,0,i),this._refreshContent(this.searchValue,this.filter),this.onevent){let a=new D(D.ASSET_CLONED,e);this.onevent(a)}this._processData(this.data)}}t.AssetView=P,Object.assign(t,{request(e){var t=e.dataType||"text";"json"==t?t="text":"xml"==t?t="text":"binary"==t&&(t="arraybuffer",e.mimeType="application/octet-stream");var i=new XMLHttpRequest;i.open(e.data?"POST":"GET",e.url,!0),t&&(i.responseType=t),e.mimeType&&i.overrideMimeType(e.mimeType),e.nocache&&i.setRequestHeader("Cache-Control","no-cache"),i.onload=function(t){var i=this.response;if(200!=this.status){var a="Error "+this.status;e.error&&e.error(a);return}if("json"==e.dataType)try{i=JSON.parse(i)}catch(s){if(e.error)e.error(s);else throw s}else if("xml"==e.dataType)try{i=new DOMParser().parseFromString(i,"text/xml")}catch(l){if(e.error)e.error(l);else throw l}e.success&&e.success.call(this,i,this)},i.onerror=function(t){e.error&&e.error(t)};var a=new FormData;if(e.data)for(var s in e.data)a.append(s,e.data[s]);return i.send(a),i},requestText(e,t,i){return this.request({url:e,dataType:"text",success:t,error:i})},requestJSON(e,t,i){return this.request({url:e,dataType:"json",success:t,error:i})},requestBinary(e,t,i){return this.request({url:e,dataType:"binary",success:t,error:i})},requireScript(e,t,i,a,s){if(!e)throw"invalid URL";e.constructor===String&&(e=[e]);var l=e.length,n=[];for(var r in e){var o=document.createElement("script");o.num=r,o.type="text/javascript",o.src=e[r]+(s?"?version="+s:""),o.original_src=e[r],o.async=!1,o.onload=function(e){l--,n.push(this),l?a&&a(this.original_src,this.num):t&&t(n)},i&&(o.onerror=function(e){i(e,this.original_src,this.num)}),document.getElementsByTagName("head")[0].appendChild(o)}},downloadURL(e,i){let a=new FileReader,s=function(e){var t=document.createElement("a");t.href=e,t.download=i,document.body.appendChild(t),t.click(),document.body.removeChild(t)};e.includes("http")?t.request({url:e,dataType:"blob",success(e){a.readAsDataURL(e),a.onload=e=>{s(e.currentTarget.result)}}}):s(e)},downloadFile:function(e,t,i){if(!t){console.warn("No file provided to download");return}i||(i=t.constructor===String?"text/plain":"application/octet-stream");var a=null;a=t.constructor!==File&&t.constructor!==Blob?new Blob([t],{type:i}):t;var s=URL.createObjectURL(a),l=document.createElement("a");l.setAttribute("href",s),l.setAttribute("download",e),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout(function(){URL.revokeObjectURL(s)},6e4)}}),Object.defineProperty(String.prototype,"lastChar",{get:function(){return this[this.length-1]},enumerable:!0,configurable:!0}),Element.prototype.insertChildAtIndex=function(e,t=1/0){t>=this.children.length?this.appendChild(e):this.insertBefore(e,this.children[t])},Element.prototype.hasClass=function(e){return!!(e=[].concat(e)).filter(e=>this.classList.contains(e)).length},Element.prototype.addClass=function(e){e&&this.classList.add(e)},Element.prototype.getComputedSize=function(){let e=getComputedStyle(this);return{width:this.offsetWidth+e.getPropertyValue("marginLeft")+e.getPropertyValue("marginRight"),height:this.offsetHeight+e.getPropertyValue("marginTop")+e.getPropertyValue("marginBottom")}},Element.prototype.getParentArea=function(){let e=this.parentElement;for(;e;){if(e.classList.contains("lexarea"))return e;e=e.parentElement}},t.UTILS={getTime:()=>new Date().getTime(),compareThreshold:(e,t,i,a)=>Math.abs(e-t)>=a||Math.abs(e-i)>=a,compareThresholdRange:(e,t,i,a)=>e>=i&&e<=a||t>=i&&t<=a||e<=i&&t>=a,uidGenerator:u,deleteElement(e){e&&e.remove()},flushCss(e){e.offsetHeight},getControlPoints(e,t,i,a,s,l,n){var r=Math.sqrt(Math.pow(i-e,2)+Math.pow(a-t,2)),o=n*r/(r+Math.sqrt(Math.pow(s-i,2)+Math.pow(l-a,2))),d=n-o;return[i+o*(e-s),a+o*(t-l),i-d*(e-s),a-d*(t-l)]},drawSpline(e,i,a){e.save();for(var s=[],l=i.length,n=0;n<l-4;n+=2)s=s.concat(t.UTILS.getControlPoints(i[n],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5],a));for(var n=2;n<i.length-5;n+=2)e.beginPath(),e.moveTo(i[n],i[n+1]),e.bezierCurveTo(s[2*n-2],s[2*n-1],s[2*n],s[2*n+1],i[n+2],i[n+3]),e.stroke(),e.closePath();e.beginPath(),e.moveTo(i[0],i[1]),e.quadraticCurveTo(s[0],s[1],i[2],i[3]),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(i[l-2],i[l-1]),e.quadraticCurveTo(s[2*l-10],s[2*l-9],i[l-4],i[l-3]),e.stroke(),e.closePath(),e.restore()}}}("undefined"!=typeof window?window:"undefined"!=typeof self?self:global);