<script type="module">
    import {LX} from "lexgui"
    import {KeyFramesTimeline, ClipsTimeline} from "lexgui/components/timeline.js"

    MAKE_HEADER( "Timeline", "h1", "timeline" );
    MAKE_PARAGRAPH( `Timeline is an abstrac class and it has the following derived clases:` );
    MAKE_CODE_BULLET_LIST( [
        `<a href="#keyframes-timeline">KeyframesTimeline</a>`,
        `<a href="#curves-timeline">CurvesTimeline</a>`,
        `<a href="#clips-timeline">ClipsTimeline</a>`,
    ] );
    MAKE_HEADER( "Constructor", "h2", "" );
    MAKE_CLASS_CONSTRUCTOR( "Timeline", [
        ["name", "String"],
        ["options", "Object"]
    ] );
    
    MAKE_PARAGRAPH(`Each timeline has to be appended to an existing panel, where the possible ${INLINE_CODE(`options`)} are the following:` );
    MAKE_CODE_BULLET_LIST( [
        ["loop", "Boolean", "Set looping mode animation by default."],
        ["skipVisibility", "Boolean", "When it's true, the un/active track button is disabled."],
        ["skipLock", "Boolean", "When it's true, the un/lock track button is disabled."],
        ["disableNewTracks", "Boolean", "When it's true, add new tracks option is disabled."],                
    ] );

    MAKE_PARAGRAPH( `Callback functions can be defined also in the ${INLINE_CODE("options")}. These are the possible functions that can be called after an actions is triggered:` );
    MAKE_CODE_BULLET_LIST( [
        ["onBeforeCreateTopBar", "Function", "Callback to add widgets on the top bar before the default ones."],
        ["onAfterCreateTopBar", "Function", "Callback to add widgets on the top bar after the default ones."],
        ["onChangePlayMode", "Function", "Function called when the play mode is changed (loop or once)."],
        ["onChangeState", "Function", "Function called when the play/pause mode is changed."],
        ["onSetDuration", "Function", "Function called when the duration is changed."],
        ["onSetSpeed", "Function", "Function called when the speed is changed."],
        ["onSetTime", "Function", "Function called when the current time is changed."],
        ["onSelectTrack", "Function", "Function called when a track is selected."],
        ["onLockTrack", "Function", "Function called when a track is un/locked."],
        ["onChangeTrackVisibility", "Function", "Function called when a un/active track mode is triggered."],
        ["onChangeTrackDisplay", "Function", "Function called when a un/active track is shown/hidden in the timeline."],
    ] );
        
    MAKE_HEADER( "Properties", "h2", "" );
    MAKE_CODE_BULLET_LIST( [
        [".root", "LX.Area", "Container where the whole timeline is created"],
        [".animationClip", "Object"],
        [
            [".idx", "Number", "Id of the clip"],
            [".tracks", "Array", "Tracks of the animation clip"],
            [".duration", "Number", "0 by default"],
            [".speed", "Number", "1 by default"],
        ],
        [".tracksDrawn", "Array", "Contains the information of all tracks currently displayed on the timeline"],
        [".tracksPerItem", "Object", "Contains all the information of the tracks for each item. For example, an item can has multiple tracks such as for position, for rotation or scale. "],
        [".playing", "Boolean", ""],
        [".duration", "Float", ""],               
    ] );

    MAKE_HEADER( "Methods", "h2", "" );

    MAKE_CLASS_METHOD( ".addNewTrack", "Add a new empty track in the timeline.", [], "Number" );
    MAKE_CLASS_METHOD( ".getCurrentKeyFrame", "Get the nearest keyframe to _time_ given a maximum threshold.", [
        ["track", "Object"],
        ["time", "Number"],
        ["threshold", "Number"]
    ], "Number" );
    MAKE_CLASS_METHOD( ".getTracksInRange", "Get the tracks inside the specified vertical range (pixels) with a threshold.", [
        ["minY", "Number"],
        ["maxY", "Number"],
        ["threshold", "Number"]
    ], "Array" );
    MAKE_CLASS_METHOD( ".selectTrack", "Select the track that contains the info passed.", [
        ["trackInfo", "Object"]
    ] );
    MAKE_CLASS_METHOD( ".setAnimationClip", "Process and format the animation tracks and set it as the animationClip.", [
        ["animation", "Object"]
    ] );
    MAKE_CLASS_METHOD( ".setDuration", "Set the duration of the animation.", [
        ["duration", "Number"]
    ] );
    MAKE_CLASS_METHOD( ".setFramerate", "Set the playback framerate of the animation.", [
        ["framerate", "Number"]
    ] );
    MAKE_CLASS_METHOD( ".setScale", "Set the scale of the timeline. Usually called when the user zooms in/out.", [
        ["scale", "Number"]
    ] );
    MAKE_CLASS_METHOD( ".setSpeed", "Set the playback speed of the animation.", [
        ["speed", "Number"]
    ] );

    MAKE_HEADER( "Keyframes timeline", "h2", "keyframes-timeline" );

    {
        const keyframestimeline = new KeyFramesTimeline( "Keyframes Timeline" );
        const content = document.getElementById( 'content' );
        const area = new LX.Area( { skipAppend: true, height: "350px" } );
        area.attach(keyframestimeline);
        content.appendChild( area.root );
        keyframestimeline.resize();
        window.keyframeTimeline = keyframestimeline;
        
        const animation = {
            duration: 10,
            tracks: [
                { id: "track1" },
                { id: "group.track2", times: [0,1,2,3] },
                { id: "group.track3", times: [0,1,2,3], values:[0,11,22,33], curvesRange:[0,33] },
                { id: "group.track333", times: [0,1,2,3], values:[0,11,22,33], curves: false, curvesRange:[0,33] },
                { id: "group.track4", times: [0,1,2,3], values:[0,0,0,1,11,111,2,22,222,3,33,333], dim:3 },
                { id: "track5", times: [0,1,2,3] },
                { times: [0,1,2,3], values: [0,1,2,3], curvesRange:[0,3]  },
            ]
        }
        keyframestimeline.setAnimationClip(animation, true);
        keyframestimeline.setSelectedItems( ["group", 0, 6] );

        function render(){
            requestAnimationFrame( render );
            keyframestimeline.draw();
        }

        render();
    }

    MAKE_PARAGRAPH( `Callback functions can be defined also in the ${INLINE_CODE("options")}. These are the possible functions that can be called after an actions is triggered:` );
    MAKE_CODE_BULLET_LIST( [
        ["onShowOptimizeMenu (function)", ""],
        ["onGetOptimizeThreshold (function)", ""]
    ] );

    MAKE_CODE( `@let@ kfTimeline = @new@ LX.@[typ]KeyframesTimeline@(@"Timeline name"@ );
panel.attach(kfTimeline.root);` );
        
    MAKE_HEADER( "Clips timeline", "h2", "clips-timeline" );
    {
        const clipstimeline = new ClipsTimeline( "Clips Timeline" );
        const content = document.getElementById( 'content' );
        const area = new LX.Area( { skipAppend: true, height: "350px" } );
        area.attach(clipstimeline);
        content.appendChild( area.root );
        clipstimeline.resize();
        window.clipsTimeline = clipstimeline;
        
        const animation = {
            duration: 10,
            tracks: [
                { id: "track0" },
                { id: "track1", clips: [{id:"clip1", start: 0, duration:1, clipColor:"#800"}] },
                { id: "track2", clips: [{id:"clip1", start: 1, fadein: 1.2, fadeout: 1.7, duration:1, clipColor:"#080"}] },
                { id: "My Track", clips: [{id:"clip1", start: 1, fadein: 1.2, fadeout: 1.7, duration:1, clipColor:"#008", fadeColor: "#003"}] },
            ]
        }
        clipstimeline.setAnimationClip(animation, true);

        clipsTimeline.onAddNewTrack = function( trackInfo ){
            trackInfo.id = "Track_" + (this.animationClip.tracks.length-1);
        }

        function render(){
            requestAnimationFrame( render );
            clipstimeline.draw();
        }

        render();
    }

    MAKE_PARAGRAPH( `..TODO` );

    MAKE_LINE_BREAK();
    MAKE_LINE_BREAK();

</script>